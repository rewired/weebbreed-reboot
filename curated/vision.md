# Vision

## AGENT.md — Weed Breed (TypeScript Backend + React/Vite) (AGENTS.md)

Source: [`AGENTS.md`](../AGENTS.md)

# AGENT.md — Weed Breed (TypeScript Backend + React/Vite)

**Purpose.** Steer a coding AI ("Codex") to implement and maintain this project correctly. Backend is **TypeScript** (Node 20/23), **not** plain ESM‑JS at runtime. Frontend is **React + Vite**. All work must follow the domain docs in `/docs` (schemas, naming rules, formulas, architecture). **Do not rename JSON keys**; only additive, **user‑trusted extensions/changes** are allowed.

---

## 0) Ground Rules

- **No experimental loaders.** Do **not** use `ts-node` loaders or experimental ESM loaders at runtime. Use **`tsx`** for dev, **`tsup`**/**`tsc`** for builds.
- **TypeScript everywhere in backend.** Frontend stays React + Vite.
- **Deterministic simulation.** RNG always via a **seeded generator**. No `Math.random`.
- **Respect `/docs`** schemas & naming conventions: SI units implicit, camelCase, **no unit suffixes** in keys.
- **Do not rename JSON keys.** Only additive, user‑approved fields (optional) are allowed.
- **Tick‑based engine, explicit phase order.** Events are **telemetry only** (no commands through the bus).
- **Economics externalized.** Prices/maintenance are outside device blueprints (separate price maps). Do **not** re‑introduce prices into device JSONs.
- **Socket transport parity.** Keep `socket.io` and `socket.io-client` on the **same minor version** across backend and frontend packages. Update both sides together to avoid wire-protocol drift.
- **No breaking directory churn.** Prefer additive refactors with clear commits, green CI at every step.
- **Documentation** is crucial. Please document changes before committing (`CHANGELOG.md`). Always check against `/docs/weedbreed-final-truth.md` and `/docs/ui-building_guide.md` - change missalginments. Also take a look at the rest of `/docs/**/*.md`.
- **Centralize simulation constants.** Author new or updated constants in the shared backend modules under `src/backend/src/constants/`, include a short JSDoc description, and mirror every change in `/docs/constants/**`. See [ADR 0009](docs/system/adr/0009-simulation-constants-governance.md) for the stewardship checklist that codifies this policy.
- **Before commiting** use `pnpm run check` to satisfy `husky` rules.
- **If unsure: ask!**

---

## 1) Monorepo Layout (pnpm workspaces)

- Root `pnpm-workspace.yaml` groups the backend and frontend packages alongside
  shared libraries.
- **Backend package:** `src/backend` (`@weebbreed/backend`). Source lives under
  `src/backend/src`; build outputs are emitted to `src/backend/dist`. Scripts
  run with the package directory as the working directory.
- **Frontend package:** `src/frontend`. React + Vite application code resides in
  `src/frontend/src`; production assets land in `src/frontend/dist`.
- **Shared TypeScript modules:** `src/backend/src/engine/physio` (domain
  formulas packaged with the engine) and
  `src/runtime` (cross-cutting runtime helpers). These folders are consumed via
  the `@/` and `@runtime/` path aliases exposed through the workspace
  TypeScript configs.

## 2) Toolchain & Config (backend)

- **Dev runner:** `tsx` (e.g., `pnpm --filter @weebbreed/backend dev`) — **no
  experimental loaders**.
- **Testing:** `vitest` (+ happy-dom or Node environment).
- **Lint/format:** ESLint (TS) + Prettier.
- **Path alias:** `@/*` → `./src/*` via `tsconfig.json` + `tsconfig.paths.json`.
- **Build:** `tsup` bundles `src/index.ts` to an **ESM** artifact at
  `dist/index.js` with sourcemaps. `pnpm start` executes `node dist/index.js`
  under the package `type: module` contract.

**Monitoring CLI (`src/monitoring`)**

- Use the Node-based CLI (`@weebbreed/monitoring`) to watch the SSE gateway
  during backend smoke tests. Install dependencies via `pnpm install` and run
  `pnpm monitor` (alias for `pnpm --filter @weebbreed/monitoring dev`) to launch
  the dashboard with hot reload.
- The CLI mirrors the RESIN flow: focus panes for structures/rooms/zones,
  environment KPIs, and reconnect handling. Default endpoint is
  `http://localhost:7331/events`; override with `--url` when targeting another
  host.

**`src/backend/tsconfig.json` (minimal)**

---

## 3) Toolchain & Config (frontend)

- React + Vite TypeScript app under `src/frontend`. No CRA. Keep the setup lean and
  align ESLint/Prettier rules with the backend package.
- Tailwind CSS is part of the standard UI stack. It is wired through
  `index.css`, `postcss.config.js`, and `tailwind.config.js` with design tokens
  exposed as CSS custom properties.

**`src/frontend/package.json` scripts**

```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "test": "vitest run",
    "preview": "vite preview"
  }
}
```

---

## 4) Simulation Contract (must implement)

### 4.1 Tick Phases (strict order)

1. **applyDevices** – apply device effects (lamp heat/PPFD, HVAC, vent, dehumid)
2. **deriveEnvironment** – combine effects → effective zone env
3. **irrigationAndNutrients** – watering + NPK
4. **updatePlants** – growth, stress, disease, stage transitions
5. **harvestAndInventory** – produce items, storage, spoilage timers
6. **accounting** – OpEx, CapEx‑related maintenance, sales/market
7. **commit** – snapshot, emit batched telemetry events

> Implement as a small state machine so pausing/stepping is trivial.

### 4.2 Physio Modules (pure, unit‑aware)

Create pure TS modules under `src/backend/src/engine/physio/`:

`vpd.ts`, `ppfd.ts`, `co2.ts`, `temp.ts`, `rh.ts`, `transpiration.ts`

Each exports pure functions with explicit units in JSDoc and TS types.
Add **Golden‑Master tests** for typical scenarios with tight tolerances (`ε_rel = 1e-6`, `ε_abs = 1e-9`).

**Example stub (`src/backend/src/engine/physio/vpd.ts`)**

```ts
/**
 * Computes a simple VPD proxy.
 * @param T Temperature [°C]
 * @param RH Relative humidity [0..1]
 * @param Tbase Base temperature for activity [°C]
 * @returns VPD proxy [unitless]
 */
export function vpdProxy(T: number, RH: number, Tbase = 10): number {
  const x = Math.max(T - Tbase, 0);
  return (1 - RH) * x; // tuned coefficient applied by caller
}
```

### 4.3 Event Bus & Real-Time Transports (telemetry only)

- Minimal API: `emit(type, payload, tick, level = 'info')`.
- Provide `uiStream$` with basic filtering/buffering for UI consumption.
- **Transports:** Socket.IO gateway (`src/backend/src/server/socketGateway.ts`) and SSE gateway (`src/backend/src/server/sseGateway.ts`) both subscribe to the shared stream. Keep docs (`docs/system/socket_protocol.md`) and frontend bridge hooks in sync with payload updates.
- **Socket endpoint discovery:** The dashboard resolves its Socket.IO endpoint through `src/frontend/src/config/socket.ts`. It exports a `SOCKET_URL` constant derived from `import.meta.env.VITE_SOCKET_URL` and falls back to `http://localhost:7331/socket.io` (backend dev default). Update the docs whenever this lookup changes so integrators can point non-proxied deployments at a custom URL.
- **No commands through the event bus.**

### 4.4 Factories + JSON Blueprints

- Strains, Devices, Cultivation Methods, Strain Prices load from `/data`.
- Validate shape on load (lightweight Zod/Ajv optional but recommended).
- **Do not store prices/maintenance inside device JSONs.** Keep separate `devicePrices.json` and `strainPrices.json`.
- **Do not change field names in JSON models** (only user‑trusted additive fields).

### 4.5 Determinism & RNG

Provide `lib/rng.ts` with `createRng(seed: string, streamId?: string)`.
All randomness (pests/events/market) comes from here.

### 4.6 Facade Intent Catalog & Command Routing

- **Modular registry.** `SimulationFacade` owns a domain registry built via
  `registerDomain(domain, commands)`. Each domain maps actions to Zod schemas
  and service handlers; Socket.IO clients issue `facade.intent` payloads with
  `{ domain, action, payload?, requestId? }`.
- **Result channels.** Responses for façade intents are emitted on
  `<domain>.intent.result` and mirror the `CommandResult` shape
  (`{ ok, data?, warnings?, errors? }`). Validation failures always return
  `ERR_VALIDATION` with a dotted `path` back to the offending field.
- **World intents** (beyond the original CRUD):
  `renameStructure`, `deleteStructure`, `duplicateStructure`, `duplicateRoom`,
  `duplicateZone` — all accept optional `name` overrides where applicable.
- **Device intents** include `toggleDeviceGroup` (batch enable/disable by
  domain/kind) alongside `installDevice`, `updateDevice`, `moveDevice`,
  `removeDevice`.
- **Plant intents** include `togglePlantingPlan` (automation enable/disable)
  plus `addPlanting`, `cullPlanting`, `harvestPlanting`, `applyIrrigation`,
  `applyFertilizer`.
- **Future extensions.** When adding a domain/action, register it through the
  façade builders, export the typed intent, and document it under
  `/docs/system` + `/docs/tasks`. Keep Socket docs in sync so UI teams can
  adopt new actions without spelunking through code.

### 4.7 Zone Setpoint Contract

- Socket clients issue zone setpoint updates via
  `config.update { type: 'setpoint', zoneId, metric, value }`.
- Supported metrics and their routing:
  - `temperature` → writes `targetTemperature` on HVAC-capable devices.
  - `relativeHumidity` → writes `targetHumidity` on humidifier/dehumidifier
    devices (also clears active VPD setpoint).
  - `vpd` → converts the VPD target (at the zone control reference
    temperature) into a humidity value and programs it on humidity devices
    while storing both humidity and VPD setpoints.
  - `co2` → writes `targetCO2` on enrichment/scrubber devices.
  - `ppfd` → writes `ppfd` (and scales `power` when present) on dimmable
    lighting.
- Values are validated and clamped (finite numbers, non-negative for PPFD/CO₂
  /VPD, humidity forced to `[0,1]`); clamp warnings are returned to the client
  in the command response.
- A zone without supporting devices returns `ERR_INVALID_STATE`.
- Successful updates emit `env.setpointUpdated` with `{ zoneId, metric, value,
control }` and, when humidity is derived (RH/VPD), `effectiveHumidity`.

### 4.7a Recurring Cost Normalization

- Treat `structure.rentPerTick` and `devicePrices[].baseMaintenanceCostPerTick`
  as **hourly** base rates. Multiply by the current tick length in hours when
  charging rent or maintenance so recurring costs track simulated hours, not raw
  tick counts.
- Tick-length updates via `facade.setTickLength` (which refresh
  `state.metadata.tickLengthMinutes`) must be observed before the accounting
  phase runs, ensuring immediate normalization.

---

### 4.8 UI Snapshot & Time Status Contract

- `buildSimulationSnapshot(state, roomPurposeSource)` is the single producer for
  UI-visible state. It MUST include the `clock` block with
  `{ tick, isPaused, targetTickRate, startedAt, lastUpdatedAt }` in addition to
  structures, rooms, zones (with control/resources/health), personnel, and
  finance summaries.
- Socket telemetry mirrors this structure and augments each update with the
  scheduler-derived `time` payload from `SimulationFacade.getTimeStatus()`. Treat
  `time` as ephemeral (scheduler view) and `snapshot.clock` as the persisted
  state; both are required for consumers to reconcile pause/resume UX.
- `time.status` is only emitted on the initial connection handshake. Subsequent
  time drift is communicated through the `simulationUpdate.time` entries. Keep
  dashboard logic and docs aligned with this behaviour.
- Keep `docs/system/socket_protocol.md`, `README.md`, and ADR 0005 synchronized
  with any snapshot/time-shape evolution so downstream clients and automation
  stay in lock-step.

**Read the document `/docs/ui-building_guide.md` for full frontend description.**

---

## 5) Developer Ergonomics

- **Env:** load `.env` (tick length, log level, seeds…).
- **Logging:** `pino` (JSON logs; pretty in dev).
- **Hot‑data reload:** watch `/data` in dev and reload blueprints safely.
- **Error policy:** fail fast on malformed JSON; emit a structured error event.

---

## 6) Workspace Commands (root)

```json
{
  "scripts": {
    "dev": "pnpm -r --parallel dev",
    "build": "pnpm -r build",
    "test": "pnpm -r test",
    "lint": "pnpm -r lint",
    "format": "pnpm -r format"
  }
}
```

**Expected dev output:**

- Backend starts via `tsx src/index.ts` (**no** `ExperimentalWarning`).
- Frontend Vite dev server available. UI connects to backend event stream.

---

## 7) Definition of Done (DoD)

- ✅ No usage of ts-node loaders; no `ExperimentalWarning` on startup.
- ✅ `pnpm build` produces `src/backend/dist/**` and `src/frontend/dist/**`.
- ✅ Golden‑Master tests for physio modules green with tight tolerances.
- ✅ Deterministic 200‑day run: same seed ⇒ identical summary metrics.
- ✅ JSON blueprints conform to docs; naming rules respected.
- ✅ ESLint (no warnings) + Prettier (clean) in CI.

---

## 8) Guardrails & Non‑Goals

- ❌ Do **not** change field names in JSON models (except user‑trusted additive fields).
- ❌ Do **not** push real‑time threads or physics‑heavy libs without need.
- ❌ Do **not** route commands via telemetry bus.
- ❌ Do **not** re‑introduce device prices into device JSONs.

---

## 9) Acceptance Checks (manual)

- Start dev: `pnpm dev` → **no** experimental loader warnings.
- Trigger a short sim (e.g., 7 days) → UI shows phase events in order; summary log contains energy/water/costs.
- Run same sim twice with same seed → identical outputs (byte‑equal summaries).

---

## 10) Notes for Future Work

- Upgrade temp/RH model from proxy to proper psychrometrics when needed.
- Add device degradation & maintenance curves (externalized config).
- Expand market engine (quality × demand × brand value multiplier).

**End of AGENT.md.**

## Changelog (CHANGELOG.md)

Source: [`CHANGELOG.md`](../CHANGELOG.md)

# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added

- Introduced `@weebbreed/monitoring`, a Node-based terminal CLI that mirrors the
  RESIN workflow with neo-blessed panes, keyboard navigation, and automatic
  reconnects for the SSE stream (`src/monitoring`).
- Added `colorama` to the Python monitor tooling and initialized ANSI handling
  on startup to keep Windows consoles warning-free while retaining rich output.
- Added state selector unit tests that build multi-structure fixtures and validate
  structure, room, and zone lookup metadata including miss cases for empty
  collections and similar-looking ids.
- Added zone service unit tests validating create/clone/duplicate flows with
  blueprint compatibility fixtures, geometry validation, and cost accounting
  purchase recording.
- Documented the refactoring roadmap covering world service, state model, and modal host decompositions under `docs/tasks/20250929-refactoring-roadmap.md`.
- Captured refactoring governance thresholds and reuse triggers in ADR 0012.
- Documented the cultivation setup UI consolidation in ADR 0011, covering the shared
  hook/component contract for zone modals.【F:docs/system/adr/0011-cultivation-setup-sharing.md†L1-L50】
- Dokumentiert den Umsetzungsplan für die Irrigation-&-Nutrient-Überarbeitung unter
  `docs/tasks/20250928-irrgitation-nutrient-overhaul.md`.
- Implemented a device removal engine service that clears unsupported zone setpoints, emits
  `device.removed` telemetry, and exposes the facade command with unit and integration
  coverage.
- Added a plant lifecycle service with single-plant harvest/cull commands that honor zone
  safety restrictions, wiring the backend facade, socket intents, and frontend bridge
  contracts to return typed results.
- Erstellt den Alignment-Report zu Phase 0 der Irrigation-&-Nutrient-Überarbeitung mit Stakeholder-Bestätigungen,
  Quellensichtung und Deprecation-Empfehlungen für Reservoir-Aufgaben (`docs/tasks/irrigation/phase0-alignment-report.md`).
- Added an `isHarvestable` flag to plant snapshots, plumbing the backend UI snapshot,
  frontend types, fixtures, and store hydration so harvest readiness survives updates.
- Introduced zone plant-table harvest management: a harvestable-only filter, per-plant
  harvest/cull controls, and a batch "Harvest all" action that respects zone safety
  restrictions, invokes the bridge intents, and keeps the list in sync.
- Added a harvest/cull confirmation modal with toast feedback, wiring ZoneView actions,
  facade mocks, and Vitest coverage to require confirmation and surface command
  success or failure states.
- Added substrate and container blueprint collections with dedicated schemas, loader
  cross-checks, repository helpers, and documentation updates so cultivation methods
  reference shared consumables by slug instead of embedding media/container payloads.
- Added optional `meta` payloads to substrate and container blueprints, extending schemas,
  fixtures, loader expectations, and docs so designers can surface descriptions plus
  advantage/disadvantage call-outs alongside quantitative specs.
- Externalized cultivation method setup costs and consumable pricing into dedicated
  ledgers (`data/prices/cultivationMethodPrices.json`, `data/prices/consumablePrices.json`),
  extending schemas, repository accessors, loader cross-checks, and docs to surface
  the new price sources.
- Added an interactive structure list to the CLI monitoring tool with cursor navigation
  for selecting structures while streaming simulation updates (`tools/monitor/weedmonitor.py`).

### Changed

- Replaced Python monitor setup docs with the Node CLI workflow and wired a
  `pnpm monitor` helper script to launch it from the workspace root.
- Refactored the SSE console monitor list handling to share a reusable selection
  helper, keeping the 80×30 viewport formatting intact while deduplicating the
  structure and room pane logic (`tools/monitor/weedmonitor.py`).
- Reworked the Python SSE monitor to use platform-specific terminal controllers,
  enabling Windows console input handling and a safe fallback when interactive
  controls are unavailable.
- Expanded the SSE console monitor with a zone pane, hierarchical focus
  navigation, and viewport-safe rendering when drilling into rooms so zone
  metrics stay within the 80×30 frame (`tools/monitor/weedmonitor.py`).
- Bounded the SSE console monitor viewport to a framed 80×30 layout, adding
  clipping, ellipsis truncation, and list row limiting so KPIs and selections
  render consistently across terminals.
- Excluded the Python-based monitoring utilities under `tools/monitor` from JavaScript
  linting and formatting workflows so repository checks ignore non-Node tooling.
- Tightened façade device-setting schemas to accept only canonical numeric controls and
  two-value tuples, rejecting undefined patches and unknown keys. Updated command docs and
  regression tests capture the stricter validation.
- Tagged command errors with `category` metadata and taught the socket gateway to
  budget per-socket internal failures, leaving clients connected on user
  mistakes while disconnecting after repeated `ERR_INTERNAL` responses.
- Hardened the backend bootstrap pipeline to surface data-load summaries,
  propagate structured state-factory degradation events, and keep the server
  responsive when blueprints are missing, alongside a resilience integration
  test covering incomplete data directories.
- Wrapped the simulation loop phases in per-phase state drafts, cloning structures and
  accounting buffers so recoverable errors restore both state and telemetry buffers before
  emitting any events.
- Expanded the frontend Vite and TypeScript path aliases to cover scoped
  `@/components`, `@/store`, `@/hooks`, `@/styles`, `@/data`, `@/facade`,
  `@/config`, `@/types`, and `@/utils` imports so build tooling resolves the
  shared modules consistently.
- Extracted lightweight state type exports into `src/backend/src/state/types.ts`, split
  personnel blueprint loaders into dedicated `state/personnel/*` modules, and updated
  backend imports/tests to rely on the smaller entry points instead of the monolithic
  `state/models` export.
- Extended pending treatment applications with treatment categories, updating save
  schemas, engine normalization, and tests so workforce safety policies can infer
  hazard levels immediately after load.
- Typed the workforce candidate refresh command to surface the job-market summary through
  the facade and server layers, aligning downstream consumers on the structured result.
- Extended the `UtilityPrices` state type with an index signature so passthrough schema
  metadata can round-trip without breaking strongly-typed access to known price fields.
- Replaced the monolithic world service with dedicated structure/room/zone collaborators,
  extracted cloning helpers, and completed the `ZoneService.updateZone` migration so
  cultivation defaults, validations, and telemetry align with the refactored delegates.

- Extended the `world.updateZone` intent to accept container and substrate patches, revalidating
  method compatibility, clamping container capacity, recomputing substrate volume, and persisting
  consumable metadata with regression coverage and facade bridge support.【F:src/backend/src/facade/commands/world.ts†L109-L133】【F:src/backend/src/engine/world/worldService.ts†L828-L1106】【F:src/backend/src/engine/world/worldService.updateZone.test.ts†L128-L210】【F:src/frontend/src/facade/systemFacade.ts†L440-L456】

- Added cultivation metadata (method, container, substrate) to zone UI snapshots, updating backend tests and frontend types/fixtures to surface the new fields.【F:src/backend/src/lib/uiSnapshot.ts†L102-L178】【F:src/backend/src/lib/uiSnapshot.test.ts†L103-L159】【F:src/frontend/src/types/simulation.ts†L1-L64】【F:src/frontend/src/data/mockTelemetry.ts†L1-L207】
- Added a "Change cultivation method" flow and consolidated its UI with the Add Zone dialog by reusing the shared cultivation setup section/hook. The Zone header surfaces method/container/substrate labels, the dialog filters compatible catalogs, clamps container capacity, recomputes substrate estimates, reuses the storage handoff stub, and dispatches `bridge.world.updateZone` with consumable metadata while leveraging the shared layout for visual parity. RTL coverage exercises the filtering, clamping, and dispatched payload.【F:src/frontend/src/views/ZoneView.tsx†L332-L370】【F:src/frontend/src/components/modals/ModalHost.tsx†L365-L544】【F:src/frontend/src/components/modals/zones/CultivationSetupSection.tsx†L1-L635】【F:src/frontend/src/components/modals/zones/ChangeZoneMethodModal.tsx†L1-L352】【F:src/frontend/src/components/modals/**tests**/ChangeZoneMethodModal.test.tsx†L1-L210】【F:src/frontend/src/facade/systemFacade.ts†L440-L456】

### Changed

- Refined the Create Zone modal with a Max area shortcut, stricter numeric clamps,
  and automatic container-capacity recalculation while delegating catalog and cost
  logic to the shared cultivation setup hook/section for parity with the change
  modal. Updated docs capture the shared contract and regression coverage keeps
  the workflow green.【F:src/frontend/src/components/modals/ModalHost.tsx†L2003-L2145】【F:src/frontend/src/components/modals/zones/CultivationSetupSection.tsx†L1-L635】【F:src/frontend/src/components/modals/zones/CreateZoneModal.tsx†L1-L165】【F:src/frontend/src/components/modals/ModalHost.test.tsx†L288-L363】【F:docs/ui/ui-components-desciption.md†L301-L312】
- Renamed the substrate and container schema modules to `substrateSchema` and
  `containerSchema`, updating imports to follow the shared schema naming
  convention and documenting the decision in ADR 0010.
- Shifted cultivation method media compatibility to `compatibleSubstrateTypes`,
  teaching the loader to index substrates by type, validate referenced media,
  warn when pricing is missing, and refreshing documentation plus blueprints to
  list both soil and coco support.
- Switched cultivation method container compatibility to `compatibleContainerTypes`,
  normalizing existing methods to the shared `pot` category, indexing containers
  by type in the loader, and extending cross-checks, fixtures, and docs to flag
  missing container pricing per category.
- Normalized substrate consumable pricing to `costPerLiter`, updating schemas,
  fixtures, loader expectations, and docs so per-liter figures are enforced in
  validation and surfaced consistently across the toolchain.
- Removed the zone "Health" summary card from the Zone Detail view to declutter the
  plants panel.
- Collapsed zone device groups by default behind accessible toggle buttons in
  `ZoneView`, surfacing icons and coverage for the expanded state while
  extending Vitest coverage for the new behaviour.
- Surfaced per-plant pest, disease, and treatment indicators in simulation
  snapshots and rendered matching status icons in the zone plant table,
  complete with accessibility labels and regression tests.
- Expanded the EnvironmentPanel photoperiod slider to cover the full 1–23 hour
  light window with integer steps, refreshed the helper copy, and synced the
  backend lighting-cycle command so zone snapshots persist and broadcast the
  updated photoperiod.
- Ergänzte `docs/tasks/20250928-irrgitation-nutrient-overhaul.md` um Pseudocode-
  Hinweise und JSON-Beispiele zur weiteren Umsetzungsklärung.
- Exposed a compact 50-entry finance ledger in the simulation snapshot and
  taught the frontend store plus revenue/expense breakdowns to hydrate from the
  live data instead of placeholder totals.
- Added `strainName` lookups to zone plant snapshots, refreshed gateway callers
  and docs, and reworked the dashboard plant table to show friendly strain
  labels without the legacy Plant ID column.
- Shortened the default simulation tick length to 5 minutes (down from 60),
  exposing shared timekeeping constants for the scheduler/state factory and
  updating documentation to reflect the faster cadence.
- Typed strain growth model harvest index and temperature metadata, wiring the
  schema defaults into the plant model and refreshing strain blueprints with
  curated coefficients for Q10, reference temperature, and flowering harvest
  targets.
- Extended cultivation method labor modelling by accepting optional
  `laborProfile.hoursPerPlantPerWeek` in blueprints and teaching the
  compatibility service to honor the value while retaining safe defaults.
- Clarified simulation constant authoring guidance in `AGENTS.md` and `/docs/constants/physiology.md`, pointing to ADR 0009 on constant stewardship.
- Refactored the simulation loop to delegate tick-state orchestration and accounting flows to dedicated modules with updated tests safeguarding the phase order.
- Centralized shared plant physiology coefficients (Magnus, canopy conductance, photon conversions) in `@/constants/physiology` and documented the module.
- Consolidated plant growth defaults (light/CO₂ saturation, VPD tolerances, health alerts, yield multipliers) into `@/constants/plants` and documented the tuning guide for designers.
- Promoted environment device coefficients, climate controller gains, and transpiration feedback defaults into `@/constants/environment` with updated references and documentation.
- Extracted disease/pest detection and spread thresholds plus treatment defaults into `@/constants/health` with supporting documentation.
- Shared world-state resource and maintenance defaults through `@/constants/world` and extended the constants documentation with rationale for each value.
- Derived strain environmental band, stress tolerance, method affinity, and phase
  duration helpers directly from the strain blueprint schema, updating
  environment evaluators to accept passthrough properties while preserving
  numeric safety when widening bands or reading optional durations.
- Extended the frontend `FacadeIntentCommand` domain union with the `config` channel so facade hooks mirror the backend contract for configuration updates.
- Expanded dashboard game-speed presets to `0.5×/1×/10×/25×/50×/100×/250×`, widened button styling to fit three-digit labels, and refreshed UI documentation to match the new list.
- Debounced zone EnvironmentPanel setpoint sliders so local adjustments respond instantly while bridge updates batch after a short delay, flushing on blur/mouseup and cancelling on unmount alongside new regression coverage.
- Removed the EnvironmentPanel VPD slider, keeping the badge summary while routing VPD adjustments through humidity controls only.
- Reworked the Install Device modal to expose blueprint target defaults as structured inputs, validate overrides inline, and
  submit only changed setpoints when installing devices.
- Surfaced blueprint coverage limits in the Install Device modal, presenting area and volume capacities (deriving floor
  coverage from room height when only volume is supplied) and extending Vitest coverage for both metrics.

- Refreshed the Room view zone cards with cultivation method/substrate labels and icon-only duplicate/delete actions wired to the new zone modals, retiring the reservoir row and extending coverage/documentation for the updated flow.【F:src/frontend/src/views/RoomView.tsx†L1-L139】【F:src/frontend/src/views/**tests**/RoomView.test.tsx†L1-L68】【F:src/frontend/src/components/modals/ModalHost.tsx†L1635-L1727】【F:src/frontend/src/components/modals/ModalHost.test.tsx†L381-L434】【F:docs/ui/ui-components-desciption.md†L20-L22】【F:docs/ui/ui-components-desciption.md†L506-L516】
- Documented the expanded Change Method modal flow with consumable selectors,
  capacity-aware clamping, and price estimates in the UI component guide.【F:docs/ui/ui-components-desciption.md†L45-L58】【F:docs/ui/ui-components-desciption.md†L532-L540】

### Fixed

- Backfilled missing zone control state during legacy save migrations so
  migrated zones expose empty setpoints while the schema keeps the control field
  optional for pre-existing save files.
- Prevented `devices.installDevice` from crashing when a command context lacks
  an event collector and added regression coverage to ensure telemetry still
  emits when the collector is available, keeping socket intents resilient.
- Corrected humidity device mass scaling so per-tick rates humidify/dehumidify
  zones consistently regardless of tick length while leaving energy usage tied
  to the simulated duration.
- Allowed dehumidifier-only zones to accept humidity setpoints by aligning facade
  device-kind filters with environment services, adding integration coverage, and
  documenting the supported device kinds for socket clients.
- Hardened the frontend seed generator by typing `seed-config.json`, dropping
  unused config overrides, routing weighted picks through the Mulberry32 RNG,
  and enforcing blacklist lookups with `Set<string>` to keep deterministic name
  generation aligned with the shipped configuration.
- Corrected the workforce shift handover integration test to assert the night
  shift technician remains assigned to the active maintenance task after the
  handover.
- Aligned the personnel refresh button with the shared button primitive by
  removing the unsupported `lg` size option and matching the default variant
  to the primitive configuration.
- Updated the finance ProfitChart to read the finance summary snapshot safely
  and derive chart metrics from available totals instead of missing ledger
  entries.
- Ensured blueprint hot reload waits for the underlying staging promise so the
  first commit after a file change applies the updated data even when reloads
  take longer than a tick interval.
- Unified difficulty preset usage across the engine: initial state creation and world.newGame now derive economics from `data/configs/difficulty.json` via injected config. Removed duplicated hard-coded tables and added tests to prevent regressions.
- Accepted prefixed zone identifiers when toggling planting plans and added façade/socket gateway integration coverage to prevent regressions.
- Prevented undefined CapEx/OpEx totals in the finance expense breakdown and aligned badge tones with the supported palette.
- Extended game metadata and save envelopes with difficulty plant stress and device failure modifiers, ensuring state resets and saves load them consistently.

### Added

- Added an EnvironmentPanel photoperiod slider that programs lighting cycles
  via the new `devices.adjustLightingCycle` bridge intent, keeps KPI badges in
  sync through lighting-cycle domain events, and includes Vitest coverage for
  command payloads and synchronization behaviour.
- Introduced a zone EnvironmentPanel component with collapsed KPI chips, device-aware setpoint sliders for temperature/humidity/VPD/CO₂/PPFD, and a PPFD lighting toggle wired through the simulation bridge with inline warning feedback.
- Documented simulation constant governance in [ADR 0009](docs/system/adr/0009-simulation-constants-governance.md) and cross-linked the constants catalogue.
- Exposed typed strain/device blueprint catalog fetchers and convenience wrappers for
  `plants.addPlanting` and `devices.installDevice` on the frontend simulation bridge,
  including Vitest coverage to lock down the intent envelopes.
- Extended the simulation bridge and modal host with `devices.moveDevice` and
  `devices.removeDevice` flows, replacing the zone "Adjust" control with Move
  and Delete actions plus regression coverage for the new UI intents.
- Enabled façade support for `devices.installDevice` and `plants.addPlanting`, including zone compatibility checks,
  capacity validation, and new `device.installed` / `plant.planted` telemetry events.
- Added zone-level "Plant zone" and "Install device" flows that launch capacity-aware modals backed by blueprint catalogs and new Vitest coverage.【F:src/frontend/src/views/ZoneView.tsx†L286-L398】【F:src/frontend/src/components/modals/ModalHost.tsx†L104-L470】【F:src/frontend/src/components/modals/**tests**/PlantAndDeviceModals.test.tsx†L64-L149】
- Introduced a Tune Device modal workflow that surfaces per-device settings, routes setpoint changes through `sendConfigUpdate`, dispatches other adjustments via the device intent channel, and ships accompanying UI store, modal host, and Vitest coverage.【F:src/frontend/src/store/ui.ts†L1-L63】【F:src/frontend/src/components/modals/TuneDeviceModal.tsx†L1-L210】【F:src/frontend/src/components/modals/ModalHost.tsx†L1-L40】【F:src/frontend/src/components/modals/**tests**/PlantAndDeviceModals.test.tsx†L248-L352】
- **Dynamic Structure Blueprint Loading**: The "Rent Structure" modal now dynamically loads available structure blueprints from the backend instead of using hardcoded frontend data. The backend exposes structure blueprints from `/data/blueprints/structures/*.json` through a new `getStructureBlueprints` facade intent. This ensures the frontend always displays the most current and accurate structure options available in the game.
- Added world facade intents `getStrainBlueprints` and `getDeviceBlueprints` with deterministic catalog payloads (IDs, names, compatibility hints, default settings, and price hints), wired through the simulation facade/socket gateway and documented in the protocol guide.

- **Enhanced Seed Generation System**: Implemented sophisticated seed generation for the New Game view based on `/reports/start_new_game-changes.md`. Features include:
  - **MULLBERRY32 PRNG**: Replaced simple LCG with high-quality MULLBERRY32 algorithm for better randomness distribution
  - **Template-based Generation**: Configurable templates with weighted categories (color, strain, fruit, dessert, suffix)
  - **Quality Scoring System**: Advanced scoring algorithm considering alliteration, vowel/consonant flow, length heuristics, and strong endings
  - **Local Search Optimization**: 3-iteration mutation process to improve seed quality
  - **Configurable Parameters**: JSON-based configuration with separator, minScore, count, blacklist, and lexicon settings
  - **Deterministic Generation**: Microtime-based 32-bit seed conversion for reproducible results within process
  - **Lexicon Categories**: Comprehensive word lists for colors, strains, fruits, desserts, and suffixes with weighted selection
  - **Alliteration Support**: Optional alliteration preference with soft upweighting for cohesive naming
  - **Quality Constraints**: Length limits, score thresholds, and blacklist enforcement for consistent output

- **Difficulty Presets Facade Investigation**: Documented how `config.getDifficultyConfig` travels from `difficulty.json` through the backend facade to the frontend socket bridge, and identified the socket channel mismatch (`config.intent.result` vs. `facade.intent.result`) that prevents the UI from receiving the presets.

### Fixed

- **New Game Difficulty Presets**: Restored automatic loading of backend
  difficulty presets in the New Game setup flow by deferring the fetch until
  the Socket.IO bridge reports an active connection, so presets appear without
  manual retries once the UI connects to the server.
- **Facade intent channel alignment**: Socket gateway now emits all facade
  intent responses on the shared `facade.intent.result` channel expected by the
  frontend bridge, ensuring difficulty presets and other facade intents resolve
  correctly.
- **Facade difficulty config intent**: Fixed `config.getDifficultyConfig`
  responses being rejected because the request metadata leaked into the intent
  payload validation. The backend now strips the transport `requestId` before
  schema validation and an integration test covers the happy path, so the New
  Game view receives the difficulty presets reliably.
- **Game Menu Reset Session Button**: Implemented functionality for the "Reset Session" button in the game menu modal, which previously did nothing. The button now properly stops the simulation (if running) and returns the user to the start screen, clearing the current session state and allowing them to start fresh or load a different game.
- **Finance View Data Access**: Corrected data access in FinanceView to use `snapshot.finance` instead of `snapshot.finances` to properly display financial data
- **ExpenseBreakdown Component**: Simplified ExpenseBreakdown to work with available snapshot data instead of relying on detailed ledger entries not present in frontend
- **Finance View Blank Page**: Resolved blank page issue - Finance view now displays correctly with financial KPIs, charts, and breakdown components
- **Simulation Play Button**: Fixed play button not advancing simulation by reducing default tick length from 60 minutes to 30 seconds for development - simulation now visibly advances every 30 seconds instead of requiring hour-long waits
- Hardened backend test suites by adding length assertions and safe destructuring before indexed reads so strict null checks catch missing event batches or workforce assignments early.

### Added

- **New Game Setup View**: Completely redesigned the New Game experience from a cramped modal to a full-screen dedicated view. Features clean layout with Game Seed as the first, full-width section, followed by Difficulty Preset selection. The Game Balance Modifiers section uses a 2-column grid layout for better space utilization. Removed unnecessary border styling for cleaner appearance. All modifier inputs now use proper float number inputs with 2 decimal precision, supporting direct keyboard input without complex parsing. Users can fine-tune plant stress multipliers, device failure rates, and economic settings within validated ranges. Difficulty presets (Easy, Normal, Hard) serve as starting points with automatic state synchronization via useEffect. Backend integration supports custom seed storage and modifier application to game state initialization.
- **Financial Dashboard Enhancement**: Implemented comprehensive Financial Dashboard system providing detailed revenue, expense, and profitability analysis. Created dedicated FinanceView with interactive time-range filters (1D, 1W, 1M, 1Y) displaying key financial metrics including cash on hand, total revenue, net income with profit margins, and burn rate calculations with runway days. Added RevenueBreakdown component showcasing detailed analysis of harvest sales and market pricing with revenue analytics. Implemented ExpenseBreakdown component featuring comprehensive expense analysis covering CapEx, OpEx, maintenance, and payroll with categorical breakdowns and cost optimization insights. Created ProfitChart component rendering interactive time-series visualizations of financial performance trends with computed growth metrics. Added UtilityPricing component enabling adjustment of electricity, water, and nutrient costs via facade intents with market context and price impact analysis. Enhanced DashboardHeader with Finance navigation button and integrated routing in App.tsx. All components leverage the facade intent system for backend integration and provide responsive UI with financial insights for business decision-making.

- **FireModal: Enhanced Employee Termination Safety System**: Implemented comprehensive employee termination modal with multi-layered safety checks to prevent accidental dismissals. Features include mandatory name confirmation requiring exact employee name input, detailed employee information display (role, status, morale, energy, salary, assignment), termination impact analysis showing payroll changes and staff count effects, visual warning indicators with danger-themed styling, structured confirmation workflow with permanent action warnings, and robust error handling for network issues. Provides professional HR management interface ensuring deliberate decision-making for permanent workforce changes.
- **PersonnelView: Staff Roster with Hiring/Firing Capabilities**: Implemented comprehensive personnel management system featuring a dedicated Personnel view with staff roster, applicant management, and workforce administration. Includes employee cards showing status, morale, energy, and salary information; applicant cards with skills, traits, and hiring capabilities; staff recruitment functionality; employee termination with confirmation dialogs; detailed employee information modals; role distribution analytics; and integrated navigation through sidebar. Enhances user experience by providing centralized workforce management tools for hiring, firing, and monitoring staff performance.
- **CandidateCard: Enhanced Job Market Applicant Display**: Added reusable CandidateCard component for displaying job market applicants with comprehensive skill visualization. Features include float skill levels (0-10) with color-coded proficiency indicators, skill descriptions (Novice to Expert), role display name formatting, gender-specific icons, personal information display, application summaries with average skill calculations, and trait visualization with psychology icons. Integrates with personnel skill blueprints from /data/blueprints/personnel/skills and role definitions from /data/blueprints/personnel/roles for accurate candidate representation.
- **Enhanced Personnel Management System**: Comprehensive overhaul of personnel management with dedicated components for improved user experience. Added EmployeeCard component displaying current staff with morale, energy, assignment status, performance metrics, and productivity indicators. Created HireModal with detailed candidate review workflow including skills analysis, hiring impact calculations, and comprehensive confirmation process. Implemented FireModal with safety checks, termination impact analysis, and name confirmation requirements. Added RefreshButton component for candidate pool refresh via facade.workforce.refreshCandidates with loading states and refresh timing. Introduced shared utility functions for consistent skill color coding, role display formatting, and status management across all personnel components.
- **Room Creation System**: Implemented complete room creation functionality allowing players to add custom rooms to structures with configurable names, purposes (Grow Room, Laboratory, Break Room, Sales Room), and areas. Includes frontend modal interface, backend validation, and real-time UI updates.
- **Zone Creation System**: Added comprehensive zone creation functionality enabling players to add cultivation zones to rooms with selectable names, areas, and cultivation methods (Basic Soil Pot, Screen of Green, Sea of Green). Features area validation, real-time available space calculation, and full game integration.
- **Available Space Display**: Enhanced room creation modal to show available space within structures, including real-time calculation of remaining footprint area, visual feedback for invalid inputs, and form validation to prevent exceeding structure capacity.
- Introduced the changelog to capture noteworthy changes for upcoming releases.
- Recorded ADR 0003 describing the façade messaging overhaul and modular intent registry.
- Created a clickdummy fixture translator (`src/frontend/src/fixtures/translator.ts`) to hydrate stores with `SimulationSnapshot`-konformen Daten inklusive normalisierter SI-Einheiten und Geometriefeldern.
- Erweiterte die clickdummy-Fixtures um strain-/Stadium-Metadaten, Geräte-Blueprint-Kennungen und deterministische `financeHistory`-Einträge, sodass Frontend-Stores vollständige Snapshot-Typen erhalten.
- Ergänzte ZoneDetail um interaktive Setpoint-Steuerungen, Pflanzenaktionen und Gerätegruppenlisten, nutzt dafür neue Form-Komponenten unter `components/forms` sowie die bestehenden Setpoint- und Intent-Dispatches des Zone-Stores.
- Ergänzte das Finanzdashboard um einen tick-basierten Zeitbereichs-Umschalter samt Aufschlüsselungslisten für OpEx, Utilities und Wartungsgeräte. Die Listen basieren auf dem neuen `components/panels/BreakdownList`.
- Registrierte typisierte Modal-Descriptoren für Infrastruktur- und Detail-Workflows und implementierte dedizierte Modal-Inhalte unter `views/world/modals` bzw. `views/zone/modals`, gerendert über den aktualisierten `ModalHost`.
- Modularisierte die deterministischen Clickdummy-Fixtures unter `src/frontend/src/fixtures` (inklusive `createClickDummyFixture`, Jobrollen- und Kostenkonstanten) zur Wiederverwendung in Offline-Bootstrap, Tests und künftigen Previews.
- Ergänzte `createOfflineBootstrapPayload` samt Vitest-Absicherung (`offlineBootstrap.test.ts`), sodass wiederholte Hydrationen mit gleichem Seed identische Snapshots liefern und RNG-Tausch-Regressionen früh auffallen.
- Added `ModalHost.test.tsx` regression coverage to drive the facility management modals and assert that the zone store dispatches the expected façade intents.

### Changed

- New Game setup view and modal now request difficulty presets from the backend façade
  (`config.getDifficultyConfig`), ensuring the UI reflects `/data/configs/difficulty.json`
  without relying on bundled frontend JSON assets.
- Updated ADR 0001 to reflect the accepted `tsx` + `tsup` ESM backend toolchain
  and documentation touchpoints.
- Realigned workspace documentation and ADR 0001 with the `src/backend` and
  `src/frontend` layout plus the ESM backend build output.
- Refreshed AGENTS.md, socket protocol, façade, and UI interaction docs to cover
  `facade.intent`, duplication workflows, structure rename support, and
  automation toggles.
- Documented Socket.IO transport parity across AGENTS.md, the README, and the
  socket protocol reference; recorded ADR 0006 with the upgrade policy.
- Explained Socket.IO endpoint discovery (`src/frontend/src/config/socket.ts`,
  `VITE_SOCKET_URL`, and the localhost default) across AGENTS.md, the socket
  protocol guide, package READMEs, and ADR 0006 after wiring the shared
  `SOCKET_URL` constant.
- Normalized rent and maintenance accounting to use hourly base rates scaled by
  the active tick length, keeping recurring costs consistent across runtime tick
  changes.
- Wired the world management modals so renting structures, creating rooms/zones,
  and duplicating structures/rooms/zones dispatch façade intents via the zone
  store, adding dedicated rent/duplicate structure dialog components in the
  frontend.
- Collocated the physiology helpers with the engine, removed redundant path
  aliases, and recorded ADR 0007 to explain the consolidation. Confirmed the
  frontend `@/engine` alias cleanup so the tooling no longer advertises the
  defunct path.
- Expanded the clickdummy translator to normalize zone telemetry, resources,
  and health restrictions in SI units before the frontend stores hydrate.
- Rebuilt the frontend layout shell so `App.tsx` composes `DashboardHeader`, `TimeDisplay`, and `Navigation`
  with the game/navigation slices, including a facility sidebar and header ticker wired to live telemetry.
- Extended the frontend navigation slice with a facility hierarchy and shared view metadata so the header
  tabs and sidebar tree consume the same state without recomputing local copies.
- Ported the structure, room, and zone cards into reusable components and wired the overview/detail
  drilldown so DashboardOverview and ZoneDetail mirror the facility hierarchy with breadcrumbs and
  aggregated telemetry panels.
- Offline-Bootstrap erzeugt den Store-Hydrationssnapshot jetzt über `createClickDummyFixture()` aus dem modularen Fixturepaket.
- Portierte Struktur-/Raum-/Zonen-Helfer in wiederverwendbare Store-Selektoren und ersetzte duplizierte Filterlogik in ZoneDetail
  sowie ModalHost durch die neuen Utilities.
- Ergänzte Vitest-Abdeckung für die migrierten Selektoren, deterministischen Fixture-Utilities sowie `StructureSummaryCard` und
  `Navigation`, inklusive Snapshot-Assertions für die UI-Komponenten.

### Fixed

- **Fixed Personnel Hiring and Firing Actions**: Corrected frontend-backend communication mismatch preventing employee hiring and firing. The frontend was sending incorrect action names ('hireApplicant' and 'fireEmployee') while the backend facade expected ('hire' and 'fire'). Updated HireModal to send proper 'hire' action with required candidateId, role, and wage parameters, and FireModal to send 'fire' action. Both workforce actions now function correctly through the facade intent system.
- Corrected the validate-data CLI import path to target the actual data loader module location.
- Upgraded the frontend Socket.IO client to `^4.8.1` to match the backend
  dependency and eliminate protocol drift.
- Fixed simulation control flow so new games always start in paused state, allowing players to examine initial conditions before starting the simulation clock.
- Implemented real-time time status synchronization between backend and frontend, ensuring play/pause button states reflect actual simulation status across all connected clients.
- Added immediate snapshot broadcasts for successful domain commands (structure rentals, room/zone creation, etc.) so UI updates appear instantly regardless of simulation running/paused state.
- Resolved duplicate structure rental prevention that was blocking multiple rentals of the same blueprint type - players can now rent multiple "Small Warehouse" structures and other blueprint types as intended.
- Fixed missing "Add Room" functionality that was showing incorrect "Room data unavailable" messages - implemented proper CreateRoomModal component with backend validation and room purpose resolution.
- Resolved missing "Add Zone" interface preventing users from adding zones to rooms - added CreateZoneModal with cultivation method selection and area validation against room constraints.

## WeedBreed Reboot (README.md)

Source: [`README.md`](../README.md)

# WeedBreed Reboot

[![Data Validation](https://github.com/WeedBreed/weebbreed-reboot/actions/workflows/data-validation.yml/badge.svg?branch=main&job=validate)](https://github.com/WeedBreed/weebbreed-reboot/actions/workflows/data-validation.yml)
[![Audit](https://github.com/WeedBreed/weebbreed-reboot/actions/workflows/data-validation.yml/badge.svg?branch=main&job=audit)](https://github.com/WeedBreed/weebbreed-reboot/actions/workflows/data-validation.yml)
[![Lint](https://github.com/WeedBreed/weebbreed-reboot/actions/workflows/data-validation.yml/badge.svg?branch=main&job=lint)](https://github.com/WeedBreed/weebbreed-reboot/actions/workflows/data-validation.yml)

Modular plant-growth simulation and dashboard platform inspired by the WeedBreed
architecture. The backend (Node.js + TypeScript) runs a deterministic
multi-phase tick loop that models climate, physiology, and save/load flows,
while a React front end streams telemetry for real-time visualization.

## Architecture at a Glance

- **Backend** – Deterministic simulation engine, schema validation, and
  Socket.IO gateway housed under `src/backend`. The production build ships as an
  ESM bundle at `dist/index.js` for direct execution on modern Node runtimes.
- **Frontend** – Vite + React dashboard in `src/frontend` for live telemetry,
  controls, and analytics.
- **Blueprint data** – Authoritative JSON bundles in `/data` define strains,
  devices, cultivation methods, and price tables per the data dictionary.
- **Telemetry contract** – Socket and SSE gateways stream
  `SimulationSnapshot` payloads plus scheduler `TimeStatus` metadata. The shape
  is documented in [`docs/system/socket_protocol.md`](docs/system/socket_protocol.md)
  and anchored by ADR 0005. Keep the Socket.IO server (`socket.io`) and client
  (`socket.io-client`) dependencies on the **same minor version** across
  packages to avoid protocol drift in the wire format and handshake helpers.
- **Socket endpoint discovery** – The dashboard imports `SOCKET_URL` from
  `src/frontend/src/config/socket.ts`. It reads `import.meta.env.VITE_SOCKET_URL`
  (set via a `.env` file beside `src/frontend`) and falls back to
  `http://localhost:7331/socket.io`, the backend development default
  (`WEEBBREED_BACKEND_PORT=7331`).

Detailed architecture, module boundaries, and naming rules live in the
workspace documentation. Start with the product vision and system references in
[`docs/vision_scope.md`](docs/vision_scope.md), the data dictionary in
[`docs/DD.md`](docs/DD.md), and additional deep dives under `docs/system/`.

### Project History & Decisions

- Track notable workspace changes in [`CHANGELOG.md`](CHANGELOG.md) following the
  Keep a Changelog convention with Semantic Versioning.
- Accepted architecture decisions are recorded in `docs/system/adr/`. The
  TypeScript toolchain direction lives in
  [`docs/system/adr/0001-typescript-toolchain.md`](docs/system/adr/0001-typescript-toolchain.md)
  and the snapshot/time-status contract is captured in
  [`docs/system/adr/0005-snapshot-time-sync.md`](docs/system/adr/0005-snapshot-time-sync.md).
  Real-time transport version parity is tracked in
  [`docs/system/adr/0006-socket-transport-parity.md`](docs/system/adr/0006-socket-transport-parity.md).

## Continuous Verification

Our automation pipeline keeps data, security, and code quality aligned with the
"docs as source of truth" directive:

- `Data Validation` checks run `pnpm validate:data` to guard blueprint changes.
  Workflow and tooling notes are captured in
  [`docs/addendum/data-validation.md`](docs/addendum/data-validation.md).
- `Audit` jobs execute `pnpm audit:run` to surface dependency vulnerabilities
  early.
- `Lint` jobs enforce workspace-wide lint rules via `pnpm lint`.

## Getting Started

1. Install Node.js 23 and pnpm 10 (matching CI).
2. Install dependencies with `pnpm install`.
3. Use `pnpm dev` for parallel backend/frontend development, or individual
   package scripts (`pnpm --filter @weebbreed/backend dev`, etc.).
4. Run targeted checks locally before opening a pull request:
   - `pnpm validate:data`
   - `pnpm audit:run`
   - `pnpm lint`

### Monitoring CLI (`@weebbreed/monitoring`)

For real-time smoke tests against the simulation stream, use the Node-based
terminal dashboard that mirrors the legacy RESIN workflow. The CLI listens to
the SSE feed, presents structure/room/zone hierarchies, and surfaces the key
environmental KPIs the React dashboard consumes.

```
pnpm install
pnpm monitor             # runs `pnpm --filter @weebbreed/monitoring dev`
# or
pnpm --filter @weebbreed/monitoring start -- --url http://localhost:7331/events
```

Keyboard controls:

- `Tab` / `Shift+Tab` / `←` / `→` – cycle focus between structures, rooms, and
  zones.
- `↑` / `↓` – move within the focused list.
- `r` – force a reconnect when testing connection handling.
- `q` / `Ctrl+C` – exit the monitor.

By default the CLI targets `http://localhost:7331/events`; pass `--url` to
point at a different backend instance.

Refer to the docs for simulation tuning, schema updates, and naming conventions
before changing blueprints or code. Review the changelog and ADRs when planning
tooling or architecture updates to stay aligned with previous decisions.

### Personnel Role Blueprints

- Author editable role definitions under
  [`data/blueprints/personnel/roles/`](docs/system/personnel_roles_blueprint.md).
  The backend validates every file at startup so changes feed both the initial
  roster factory and the job market without code edits. Keep the doc in sync
  when adding new roles or fields and run `pnpm validate:data` before
  committing blueprint updates.

## Contributing

Contribution guidelines, review expectations, and commit hygiene requirements
are documented in [`CONTRIBUTING.md`](CONTRIBUTING.md). Please follow them in
concert with the domain rules captured across the `/docs` tree.

## WARP.md (WARP.md)

Source: [`WARP.md`](../WARP.md)

# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

Project: WeedBreed Reboot (pnpm monorepo: backend + frontend)

1. Common commands

Root (workspace-wide)

- Install deps: pnpm install
- Dev (backend + frontend in parallel): pnpm dev
- Build all: pnpm build
- Lint all: pnpm lint
- Format (write): pnpm fmt
- Check (lint + prettier check + tests + typecheck + data validation): pnpm check
- Tests (all packages): pnpm test
- Typecheck (all packages): pnpm typecheck
- Data validation (blueprints): pnpm validate:data
- Audit runner: pnpm audit:run

Scoped/package commands

- Backend dev: pnpm --filter @weebbreed/backend dev
- Backend build: pnpm --filter @weebbreed/backend build
- Backend start (built artifact): pnpm --filter @weebbreed/backend start
- Backend tests: pnpm --filter @weebbreed/backend test
- Backend tests with coverage: pnpm --filter @weebbreed/backend exec vitest run --coverage
- Backend single test by name: pnpm --filter @weebbreed/backend exec vitest run -t "Name or regex"
- Backend bench: pnpm --filter @weebbreed/backend bench

- Frontend dev (Vite): pnpm --filter @weebbreed/frontend dev
- Frontend build: pnpm --filter @weebbreed/frontend build
- Frontend preview: pnpm --filter @weebbreed/frontend preview
- Frontend tests: pnpm --filter @weebbreed/frontend test
- Frontend single test by name: pnpm --filter @weebbreed/frontend exec vitest run -t "Name or regex"

Notes

- Node 23 and pnpm 10 are expected (see README). On Windows PowerShell, commands are the same.
- Keep socket.io and socket.io-client on the same minor version across packages.

2. High-level architecture and structure

Overview

- Backend (src/backend, @weebbreed/backend): Deterministic simulation engine with a tick-based loop. Exposes telemetry over Socket.IO and SSE. Built as ESM via tsup; development uses tsx. Emits structured logs via pino and validates blueprint data on startup.
- Frontend (src/frontend, @weebbreed/frontend): React + Vite dashboard for live telemetry, controls, and analytics. Uses Tailwind. Connects to the backend’s Socket.IO endpoint.
- Runtime utilities (src/runtime): Cross-cutting event bus, logging, RNG, data watcher utilities used by the backend and for tests.
- Data (data/\*): Authoritative content for configs, personnel, and prices. Validated via tools/validate-data.ts and surfaced in reports/.

Key backend pieces

- Entry point: src/backend/src/index.ts boots data, starts server (startBackendServer), and registers fatal handlers. The server binds transports and manages graceful shutdown on SIGINT/SIGTERM.
- Event bus: src/runtime/eventBus\*.ts provides an emit/stream abstraction for telemetry only (no commands). ui stream is derived from runtime events for the transports.
- Facade and intents: src/backend/src/facade exposes typed command routing with validation; results are structured and emitted on dedicated channels. Frontend (or clients) send facade.intent payloads; responses mirror CommandResult.
- Simulation loop and scheduler: src/backend/src/sim/\* drive the deterministic tick phases and time status. The UI receives both snapshot.clock and scheduler-derived time metadata to reconcile pause/resume/step UX.
- Persistence & hot reload: src/backend/src/persistence handles save/load flows and dev-time blueprint hot reload.

Key frontend notes

- Socket endpoint resolution: Frontend reads import.meta.env.VITE_SOCKET_URL (from src/frontend/.env.\*). Fallback aligns with backend default dev port (see README). Keep env and docs consistent when changing.
- State and data: React + common libraries (TanStack) for tables/lists/virtualization; socket.io-client must match backend’s minor version.

Validation and CI hooks

- Data validation: pnpm validate:data runs tools/validate-data.ts, generating reports in reports/validation and failing on errors. Use flags like --data and --out if needed (see docs/system/data-validation.md).
- Husky pre-commit is installed via prepare script; lint-staged enforces formatting/lint on staged files.

Critical rules and guardrails (from AGENTS.md and README/docs)

- Determinism: All randomness must use a seeded RNG; do not use Math.random in simulation core.
- No experimental loaders: Use tsx for development and tsup/tsc for builds. Backend runtime is ESM.
- Schema and naming: Follow docs/DD.md rules. Do not rename JSON keys in blueprints; only additive, user-approved fields are allowed.
- Transport parity: Maintain same minor version for socket.io and socket.io-client in backend and frontend to avoid protocol drift.
- Telemetry only on event bus: Command/control flows go through the facade, not the telemetry stream.

Quick start (summary)

- pnpm install
- pnpm dev (runs backend and frontend together)
- Frontend dev server shows dashboard; it connects to the backend Socket.IO endpoint per env.
- Before PRs, run: pnpm validate:data && pnpm audit:run && pnpm lint && pnpm test && pnpm typecheck

## Sources Inventory (sources_inventory.md)

Source: [`sources_inventory.md`](../sources_inventory.md)

# Sources Inventory

status: pending

| Path                                                        | Title                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Modified                   | Size (bytes) | Tags                                                                                   | Status  |
| ----------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------- | ------------ | -------------------------------------------------------------------------------------- | ------- |
| AGENTS.md                                                   | AGENT.md — Weed Breed (TypeScript Backend + React/Vite)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 2025-10-01T11:53:08.092112 | 13829        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| CHANGELOG.md                                                | Changelog                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 2025-10-01T11:53:08.092112 | 38089        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| CONTRIBUTING.md                                             | Contributing to Weed Breed Reboot                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 2025-10-01T07:35:57.006946 | 2583         | [vision, data/schema, simulation loop, agents/tasks, UI, tests, ops]                   | pending |
| README.md                                                   | WeedBreed Reboot                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 2025-10-01T11:53:08.092112 | 5919         | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| WARP.md                                                     | WARP.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 2025-10-01T11:53:08.092112 | 4971         | [vision, data/schema, simulation loop, economy, agents/tasks, UI, tests, ops]          | pending |
| docs/CHANGELOG.md                                           | Documentation Changelog                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 2025-10-01T11:53:08.100111 | 1007         | [simulation loop, devices, economy, agents/tasks, UI]                                  | pending |
| docs/DD.md                                                  | Weedbreed.AI — Data Dictionary (DD)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 2025-10-01T11:53:08.100111 | 16569        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/TDD.md                                                 | Weedbreed.AI — Technical Design Document (TDD)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2025-10-01T11:53:08.100111 | 12587        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/\_extraction/formulas.md                               | Extracted Formulas                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 2025-10-01T11:53:08.100111 | 11548        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, ops]            | pending |
| docs/\_final/01-title-scope.md                              | Title & Scope [ # Source: docs/vision_scope.md § 1. Vision; docs/backend-overview.md § 1. Purpose & Non-Goals ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 2025-10-01T11:53:08.100111 | 1105         | [vision, simulation loop, devices, economy, ops]                                       | pending |
| docs/\_final/02-core-principles.md                          | Core Principles [ # Source: docs/vision_scope.md § 1. Vision; docs/system/simulation_philosophy.md § 1. Time & Simulation Loop: Stability and Fairness; docs/system/simulation_philosophy.md § 2. Environmental Model: Emergent Complexity from Simple Rules; docs/backend-overview.md § 3. Blueprints Provided & How to Use Them ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 2025-10-01T11:53:08.100111 | 2249         | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, ops]        | pending |
| docs/\_final/03-domain-model.md                             | Domain Model [ # Source: docs/vision_scope.md § 4. Canonical Domain Model; docs/DD.md § 1) Strains — `/data/blueprints/strains/*.json`; docs/DD.md § 2) Devices — `/data/blueprints/devices/*.json`; docs/DD.md § 3) Cultivation Methods — `/data/blueprints/cultivationMethods/*.json` ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 2025-10-01T11:53:08.100111 | 1476         | [vision, data/schema, simulation loop, devices, UI, ops]                               | pending |
| docs/\_final/04-simulation-lifecycle.md                     | Simulation Lifecycle [ # Source: docs/system/simulation-engine.md § Timebase & Core Loop (fixed-step, scheduler-agnostic); docs/system/simulation-engine.md § Environment Model (per Zone; well-mixed, delta-based); docs/system/simulation-engine.md § Plant Growth, Stress, Health (per Planting/Plant); docs/system/simulation-engine.md § Tasks & Agentic Employees (utility-based; overtime-aware); docs/system/simulation-engine.md § Economics (currency-neutral) ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 2025-10-01T11:53:08.100111 | 2416         | [data/schema, simulation loop, devices, economy, agents/tasks, UI, ops]                | pending |
| docs/\_final/05-math-formulas-overview.md                   | Math Formulas Overview [ # Source: docs/_extraction/formulas.md § Extracted Formulas ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 2025-10-01T11:53:08.100111 | 4086         | [vision, simulation loop, devices, economy, agents/tasks, ops]                         | pending |
| docs/\_final/06-devices-and-effects.md                      | Devices and Effects [ # Source: docs/system/simulation-engine.md § Environment Model (per Zone; well-mixed, delta-based); docs/DD.md § 2) Devices — `/data/blueprints/devices/*.json`; docs/backend-overview.md § 3.2 Blueprint–to–Subsystem Mapping ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 2025-10-01T11:53:08.100111 | 1585         | [vision, data/schema, simulation loop, devices, tests, ops]                            | pending |
| docs/\_final/07-economy-and-costs.md                        | Economy and Costs [ # Source: docs/vision_scope.md § 6. Progression & Economy; docs/vision_scope.md § 6a. Quality Grades & Price Functions; docs/system/simulation-engine.md § Economics (currency-neutral); docs/system/simulation_philosophy.md § 5. Economic Model: Constant Pressure and Rewarding Mastery ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 2025-10-01T11:53:08.100111 | 1549         | [vision, simulation loop, devices, economy, ops]                                       | pending |
| docs/\_final/08-data-and-blueprints.md                      | Data and Blueprints [ # Source: docs/backend-overview.md § 3. Blueprints Provided & How to Use Them; docs/system/data-validation.md § Blueprint Data Validation Workflow; docs/DD.md § Conventions (apply to all files) ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 2025-10-01T11:53:08.100111 | 1790         | [vision, data/schema, devices, economy, UI, tests, ops]                                | pending |
| docs/\_final/09-telemetry-and-ui-views.md                   | Telemetry and UI Views [ # Source: docs/system/socket_protocol.md § UI Stream (`uiStream$`); docs/system/socket_protocol.md § Connection & Handshake; docs/ui-building_guide.md § Guiding Principles; docs/ui-building_guide.md § Layout & Navigation; docs/ui-building_guide.md § Dashboard & Global Chrome ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2025-10-01T11:53:08.100111 | 1839         | [data/schema, simulation loop, economy, UI, tests, ops]                                | pending |
| docs/\_final/10-assumptions-constraints.md                  | Assumptions and Constraints [ # Source: docs/vision_scope.md § 3. Success Criteria; docs/vision_scope.md § 12. Non-Functional Requirements (NFR); docs/vision_scope.md § 15. Risks & Assumptions; docs/vision_scope.md § 16. Binding Rules & Technical Guardrails (Coding‑Ready) ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 2025-10-01T11:53:08.100111 | 1613         | [vision, data/schema, simulation loop, agents/tasks, UI, tests, ops]                   | pending |
| docs/\_final/11-open-questions.md                           | Open Questions [ # Source: docs/vision_scope.md § 3. Success Criteria; docs/vision_scope.md § 4. Canonical Domain Model; docs/vision_scope.md § 8. Content & Data Strategy; docs/vision_scope.md § 13. Legal & Ethics ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 2025-10-01T11:53:08.100111 | 1330         | [vision, simulation loop, devices, agents/tasks, ops]                                  | pending |
| docs/\_final/12-provenance-index.md                         | Provenance Index [ # Source: docs/vision_scope.md § 1. Vision; docs/backend-overview.md § 3. Blueprints Provided & How to Use Them; docs/system/simulation-engine.md § Timebase & Core Loop (fixed-step, scheduler-agnostic); docs/_extraction/formulas.md § Extracted Formulas; docs/system/socket_protocol.md § UI Stream (`uiStream$`); docs/ui-building_guide.md § Guiding Principles; docs/system/data-validation.md § Blueprint Data Validation Workflow; docs/DD.md § Conventions (apply to all files); docs/system/simulation_philosophy.md § 1. Time & Simulation Loop: Stability and Fairness ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 2025-10-01T11:53:08.100111 | 4508         | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, ops]        | pending |
| docs/\_inventory/outline.md                                 | Documentation Outline                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 2025-10-01T11:53:08.104111 | 25731        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/addendum/all-json.md                                   | ﻿# All JSON configurations file, currently available in `/data`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 2025-10-01T11:53:08.104111 | 96101        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/addendum/ideas/breeding_module.md                      | Weed Breed — Breeding Module (TS + Pseudocode)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2025-10-01T11:53:08.104111 | 23251        | [vision, data/schema, simulation loop, devices, economy, UI, tests, ops]               | pending |
| docs/addendum/ideas/kief_dsl.md                             | KIEF DSL — High‑Level Integration (Monorepo, `data/kief`, Pseudocode‑Only)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 2025-10-01T11:53:08.104111 | 11340        | [vision, data/schema, simulation loop, devices, economy, UI, tests, ops]               | pending |
| docs/addendum/ideas/room-purpose-registry.md                | Room Purpose Registry                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 2025-10-01T11:53:08.104111 | 2738         | [vision, data/schema, simulation loop, economy, UI]                                    | pending |
| docs/addendum/ideas/terpenes.md                             | Terpene & Effects — High‑Level Concepts for Strain Blueprints (Augmented)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 2025-10-01T11:53:08.104111 | 9944         | [vision, data/schema, devices, economy, UI, tests, ops]                                | pending |
| docs/addendum/migrations/2025-01-22-typescript-toolchain.md | Migration — Backend TypeScript Toolchain                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 2025-10-01T07:35:57.014946 | 1329         | [UI, ops]                                                                              | pending |
| docs/backend-overview.md                                    | Backend Overview                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 2025-10-01T11:53:08.104111 | 19050        | [vision, data/schema, simulation loop, devices, economy, UI, tests, ops]               | pending |
| docs/constants/balance.md                                   | Game Balance Constants                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 2025-10-01T11:53:08.104111 | 3371         | [simulation loop, economy, agents/tasks, UI, ops]                                      | pending |
| docs/constants/environment.md                               | Environmental Simulation Constants                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 2025-10-01T11:53:08.104111 | 6178         | [simulation loop, devices, UI, tests, ops]                                             | pending |
| docs/constants/health.md                                    | Plant Health Constants                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 2025-10-01T11:53:08.104111 | 1266         | [simulation loop, devices, UI, ops]                                                    | pending |
| docs/constants/physiology.md                                | Plant Physiology Constants                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 2025-10-01T11:53:08.104111 | 1537         | [simulation loop, ops]                                                                 | pending |
| docs/constants/plants.md                                    | Plant Growth Defaults                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 2025-10-01T11:53:08.104111 | 4045         | [data/schema, simulation loop, devices, ops]                                           | pending |
| docs/constants/time.md                                      | Timekeeping Defaults                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 2025-10-01T11:53:08.104111 | 2129         | [simulation loop, economy, UI, ops]                                                    | pending |
| docs/constants/world.md                                     | World Defaults                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2025-10-01T11:53:08.104111 | 2120         | [simulation loop, devices, economy, ops]                                               | pending |
| docs/contradictions.md                                      | User-provided custom instructions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 2025-10-01T11:53:08.104111 | 1854         | [simulation loop, economy, UI, ops]                                                    | pending |
| docs/enhanced-cultivation-methods-summary.md                | Enhanced Cultivation Methods Summary\n\nAll cultivation methods have been successfully aligned with the new enhanced schema including environmental bias, labor profiles, and capacity hints.\n\n## Enhanced Fields Added to All Methods\n\n### ✅ Environmental Bias (`envBias`)\nPreferred environmental offsets that the cultivation method naturally creates:\n- **Temperature bias** (`temp_C`): Method's tendency to raise/lower temperature\n- **Humidity bias** (`rh_frac`): Method's effect on humidity levels\n- **CO2 bias** (`co2_ppm`): Method's CO2 consumption or retention characteristics\n- **Light bias** (`ppfd_umol_m2s`): Method's light distribution effects\n- **VPD bias** (`vpd_kPa`): Method's impact on vapor pressure deficit\n\n### ✅ Labor Profile (`laborProfile`)\nWork requirements for successful cultivation:\n- **Hours per plant per week** (`hoursPerPlantPerWeek`): Labor intensity measurement\n\n### ✅ Capacity Hints (`capacityHints`)\nSpace utilization characteristics:\n- **Plants per m²** (`plantsPer_m2`): Optimal plant density\n- **Canopy height** (`canopyHeight_m`): Typical final plant height\n\n## Method-Specific Characteristics\n\n### Basic Soil Pot\n- **Environmental Bias**: Neutral (no specific biases)\n- **Labor Profile**: 0.2 hours/plant/week (very low maintenance)\n- **Capacity**: 4 plants/m², 1.2m canopy height\n- **Philosophy**: Simple, beginner-friendly, universally compatible\n\n### Sea of Green (SOG)\n- **Environmental Bias**: \n - `vpd_kPa: +0.1` (higher VPD for dense canopy air circulation)\n - `rh_frac: -0.05` (slightly lower humidity to prevent mold)\n- **Labor Profile**: 0.3 hours/plant/week (moderate plant management)\n- **Capacity**: 18 plants/m², 0.6m canopy height\n- **Philosophy**: High-density, fast-cycling, indica-optimized\n\n### Screen of Green (SCROG)\n- **Environmental Bias**:\n - `temp_C: +0.5` (slightly warmer for enhanced growth)\n - `co2_ppm: +50` (better CO2 utilization with trained canopy)\n- **Labor Profile**: 1.2 hours/plant/week (high training effort)\n- **Capacity**: 2 plants/m², 0.8m canopy height\n- **Philosophy**: Low-density, maximum yield per plant, sativa-optimized\n\n## Compatibility System\n\n### Method vs Strain Compatibility Calculation\nThe new `MethodCompatibilityService` evaluates:\n\n1. **Environmental Fit (60% weight)**\n - Compares method `envBias` against strain environmental bands\n - Calculates if method biases align with strain preferences\n - Accounts for growth phase differences\n\n2. **Labor Fit (25% weight)**\n - Matches method labor requirements with strain resilience\n - Considers existing strain method affinity scores\n - Evaluates strain tolerance for labor-intensive techniques\n\n3. **Capacity Fit (15% weight)**\n - Compares method density with strain genetic preferences\n - Indica strains favor higher density (SOG-style)\n - Sativa strains prefer lower density (SCROG-style)\n\n### Compatibility Categories\n- **Excellent** (0.85+): Method is ideal for this strain\n- **Good** (0.7-0.84): Method performs well with this strain\n- **Acceptable** (0.5-0.69): Method works but may not be optimal\n- **Poor** (0.3-0.49): Method may struggle with this strain\n- **Incompatible** (<0.3): Method not recommended for this strain\n\n## Integration Benefits\n\n### For Players\n- **Smart recommendations**: System suggests optimal method-strain combinations\n- **Environmental insights**: Understand how methods affect growing conditions\n- **Labor planning**: Accurate time estimates for cultivation management\n- **Space optimization**: Realistic density and height planning\n\n### For Simulation\n- **Realistic constraints**: Method biases affect environmental control\n- **Dynamic compatibility**: Scores adapt based on strain and growth phase\n- **Resource planning**: Labor and space requirements drive economic decisions\n- **Educational value**: Learn real cultivation trade-offs and techniques\n\n## Technical Implementation\n\n### Schema Validation\n`typescript\n// Enhanced cultivation method schema with new fields\nenvBias: z.object({\n  temp_C: z.number().optional(),\n  rh_frac: z.number().optional(),\n  co2_ppm: z.number().optional(),\n  ppfd_umol_m2s: z.number().optional(),\n  vpd_kPa: z.number().optional(),\n}).optional(),\n\nlaborProfile: z.object({\n  hoursPerPlantPerWeek: z.number().positive(),\n}).optional(),\n\ncapacityHints: z.object({\n  plantsPer_m2: z.number().positive(),\n  canopyHeight_m: z.number().positive(),\n}).optional()\n`\n\n### Compatibility Service\n- **Weighted scoring**: Environmental fit is most important (60%)\n- **Phase-aware**: Evaluations consider current plant growth stage\n- **Extensible**: Easy to add new compatibility factors\n- **Recommendation engine**: Provides actionable cultivation advice\n\n## Example Usage\n\n`typescript\n// Calculate strain-method compatibility\nconst compatibility = methodCompatibilityService.calculateCompatibility({\n  strain: ak47Strain,\n  method: sogMethod,\n  stage: 'flowering'\n});\n\nconsole.log(compatibility.category); // 'excellent'\nconsole.log(compatibility.overallScore); // 0.87\nconsole.log(compatibility.details.environmental); // Detailed breakdown\n`\n\n## Files Updated\n\n1. **Basic Soil Pot** (`data/blueprints/cultivationMethods/basic_soil_pot.json`)\n - Added neutral environmental bias (no offsets)\n - Low labor requirements (0.2 hours/plant/week)\n - Moderate density (4 plants/m², 1.2m height)\n\n2. **Sea of Green** (`data/blueprints/cultivationMethods/sog.json`)\n - Added VPD and humidity bias for dense canopy management\n - Moderate labor (0.3 hours/plant/week)\n - High density (18 plants/m², 0.6m height)\n\n3. **Screen of Green** (`data/blueprints/cultivationMethods/scrog.json`)\n - Added temperature and CO2 bias for optimal training\n - High labor (1.2 hours/plant/week for screen management)\n - Low density (2 plants/m², 0.8m height)\n\n4. **Schema Validation** (`src/backend/src/data/schemas/cultivationMethodSchema.ts`)\n - Added Zod validation for all new fields\n - Type-safe environmental bias definitions\n - Positive number validation for capacity hints\n\n5. **Compatibility Service** (`src/backend/src/engine/cultivation/methodCompatibilityService.ts`)\n - Comprehensive strain-method compatibility analysis\n - Weighted scoring system with detailed breakdowns\n - Recommendation engine for cultivation decisions\n\nAll cultivation methods are now fully enhanced and ready for advanced strain-method compatibility analysis in the simulation engine!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 2025-10-01T11:53:08.104111 | 6512         | [data/schema, simulation loop, UI, tests, ops]                                         | pending |
| docs/enhanced-strain-blueprint-system.md                    | Enhanced Strain Blueprint System\n\nThis document describes the enhanced strain blueprint system that provides more realistic and detailed strain-specific environmental preferences, yield modeling, and cultivation method compatibility.\n\n## Overview\n\nThe enhanced strain system extends the basic strain blueprint with new fields that enable:\n- Phase-specific environmental preferences (seedling, veg, flower, ripening)\n- Stress tolerance modeling for environmental metrics\n- Cultivation method affinity scoring\n- Phase-specific durations for phenology\n- Advanced yield modeling with CO2 response curves\n\n## Core Components\n\n### 1. Enhanced Strain Blueprint\n\n**Location**: `src/backend/src/engine/strains/enhancedStrainInterface.ts`\n\nThe enhanced strain blueprint includes these new fields:\n\n`typescript\ninterface EnhancedStrainBlueprint {\n  // ... existing fields (id, name, genetics, etc.)\n  \n  // Environmental bands per phase\n  envBands?: {\n    default: EnvBands;\n    veg?: Partial<EnvBands>;\n    flower?: Partial<EnvBands>;\n  };\n  \n  // Stress tolerance per metric\n  stressTolerance?: {\n    temp_C?: number;\n    rh_frac?: number;\n    co2_ppm?: number;\n    ppfd_umol_m2s?: number;\n    vpd_kPa?: number;\n  };\n  \n  // Method compatibility\n  methodAffinity?: Record<string, number>; // method ID -> affinity (0-1)\n  \n  // Growth phase durations\n  phaseDurations?: {\n    seedling?: number;\n    veg?: number;\n    flower?: number;\n    ripening?: number;\n  };\n  \n  // Enhanced yield model\n  yieldModel?: {\n    baseGmPerPlant?: number;\n    qualityFactors?: {\n      temp?: number;\n      rh?: number;\n      ppfd?: number;\n      vpd?: number;\n    };\n    co2Response?: {\n      halfMax_ppm: number;\n      saturation_ppm: number;\n    };\n  };\n}\n`\n\n### 2. Environmental Evaluation Service\n\n**Location**: `src/backend/src/engine/strains/enhancedStrainService.ts`\n\nThe service provides methods for:\n- Evaluating zone environment against strain preferences\n- Calculating yield estimates based on environmental conditions\n- Determining cultivation method compatibility\n- Emitting environmental events for monitoring\n\n#### Key Methods:\n\n`typescript\n// Evaluate environment against strain bands\nevaluateEnvironment(\n  strain: EnhancedStrainBlueprint,\n  environment: ZoneEnvironmentState,\n  stage: PlantStage,\n  applyStressTolerance?: boolean\n): StrainEnvironmentResult\n\n// Calculate enhanced yield estimate\ncalculateYield(context: YieldCalculationContext): CalculatedYield\n\n// Get method compatibility rating\ngetMethodCompatibility(\n  strain: EnhancedStrainBlueprint,\n  methodId: string\n): MethodCompatibility\n`\n\n### 3. Plant Growth Integration\n\n**Location**: `src/backend/src/engine/strains/plantGrowthIntegration.ts`\n\nIntegrates the enhanced strain evaluation with the plant growth engine:\n- Calculates health and growth multipliers based on environmental stress\n- Provides phase-aware growth rate calculations\n- Generates yield estimates and environmental tooltips for the UI\n\n### 4. Frontend UI Component\n\n**Location**: `src/frontend/src/components/strain/StrainEnvironmentPanel.tsx`\n\nDisplays comprehensive strain environmental analysis including:\n- Overall stress level with color-coded indicators\n- Individual metric status (optimal, acceptable, stress, critical)\n- Yield estimates with breakdown of quality and CO2 multipliers\n- Method compatibility ratings\n- Environmental recommendations\n\n## Environmental Band System\n\n### Band Structure\n\n`typescript\ninterface EnvBand {\n  green: [number, number];    // Optimal range\n  yellowLow: number;          // Acceptable lower bound\n  yellowHigh: number;         // Acceptable upper bound\n}\n`\n\n### Phase Overrides\n\nStrains can define different environmental preferences for different growth phases:\n- **Default**: Base environmental preferences\n- **Veg**: Overrides for vegetative growth (often higher humidity, lower light)\n- **Flower**: Overrides for flowering phase (often lower humidity, higher light)\n\n### Evaluation Logic\n\n1. **Optimal (Green)**: Value falls within the green range\n2. **Acceptable (Yellow)**: Value falls between yellowLow and green[0], or between green[1] and yellowHigh\n3. **Stress (Orange)**: Value deviates moderately from acceptable range\n4. **Critical (Red)**: Value deviates severely from acceptable range\n\n### Stress Tolerance\n\nMature plants (>14 days) can apply stress tolerance, which widens the acceptable ranges:\n- Reduces yellowLow by tolerance amount\n- Increases yellowHigh by tolerance amount\n- Allows plants to better handle environmental fluctuations as they mature\n\n## Yield Modeling\n\n### Quality Factors\n\nEach environmental metric can contribute to yield quality:\n`typescript\nqualityFactors: {\n  temp: 0.3,     // Temperature contributes 30% to quality score\n  rh: 0.2,       // Humidity contributes 20%\n  ppfd: 0.4,     // Light contributes 40%\n  vpd: 0.1       // VPD contributes 10%\n}\n`\n\n### CO2 Response Curve\n\nModels diminishing returns for CO2 supplementation:\n- **halfMax_ppm**: CO2 level that gives 50% of maximum response\n- **saturation_ppm**: CO2 level beyond which no additional benefit occurs\n- Uses Michaelis-Menten kinetics for realistic CO2 response\n\n### Final Yield Calculation\n\n`\nEstimated Yield = Base Yield × Quality Multiplier × CO2 Multiplier\n`\n\n## Method Affinity System\n\n### Affinity Scores\n\nEach strain can define compatibility with cultivation methods:\n- **1.0**: Perfect compatibility\n- **0.8**: Good compatibility\n- **0.6**: Moderate compatibility\n- **0.4**: Poor compatibility\n- **0.2**: Very poor compatibility\n- **0.0**: Incompatible\n\n### Categories\n\n- **Excellent** (0.9+): Strain thrives with this method\n- **Good** (0.7-0.89): Strain performs well\n- **Neutral** (0.5-0.69): Strain is compatible but not optimal\n- **Poor** (0.3-0.49): Strain may struggle\n- **Incompatible** (<0.3): Not recommended\n\n## Example Usage\n\n### Backend Integration\n\n`typescript\n// In plant growth tick processing\nconst environmentResult = enhancedStrainService.evaluateEnvironment(\n  strain,\n  zoneEnvironment,\n  plant.stage,\n  plant.age_days > 14 // Apply stress tolerance for mature plants\n);\n\n// Calculate growth multipliers\nconst healthMultiplier = 1.0 - (environmentResult.overallStress * 0.3);\nconst growthRate = baseGrowthRate * healthMultiplier;\n\n// Emit monitoring events\nenhancedStrainService.emitEnvironmentalEvents(\n  plant.id,\n  plant.zone_id,\n  strain,\n  environmentResult,\n  currentTick,\n  eventCollector\n);\n`\n\n### Frontend Integration\n\n`tsx\n// Display strain environment analysis\n<StrainEnvironmentPanel\n  strainName=\"AK-47\"\n  environmentResult={environmentResult}\n  yieldEstimate={yieldEstimate}\n  methodCompatibility={methodCompatibility}\n  baseYield={120}\n/>\n`\n\n## Migration Path\n\n### Existing Strains\n\nStrains without enhanced fields will use fallback defaults:\n- Default environmental bands based on cannabis cultivation best practices\n- No stress tolerance (0 for all metrics)\n- No method affinity (assumes neutral compatibility)\n- Standard phase durations\n- Simple yield model without quality factors\n\n### Gradual Enhancement\n\nStrains can be enhanced incrementally:\n1. Add basic `envBands` with default values\n2. Add phase-specific overrides for `veg` and `flower`\n3. Configure `stressTolerance` based on strain resilience\n4. Define `methodAffinity` for cultivation methods\n5. Add `yieldModel` with quality factors and CO2 response\n\n## Benefits\n\n### Realism\n- Different strains now have unique environmental preferences\n- Phase-specific requirements (e.g., lower humidity in flower)\n- Realistic CO2 response curves\n- Method-specific compatibility\n\n### Gameplay\n- Strategic strain selection based on available equipment\n- Environmental optimization becomes strain-specific\n- Yield predictions become more accurate and meaningful\n- Player education about real cultivation practices\n\n### UI/UX\n- Rich environmental feedback with source attribution\n- Clear visual indicators for environmental status\n- Actionable recommendations for improvement\n- Detailed yield breakdowns showing impact of environment\n\n## Future Enhancements\n\n### Planned Features\n\n1. **Nutrient Affinity**: Strain preferences for different nutrient regimens\n2. **Training Response**: How well strains respond to LST, SCROG, etc.\n3. **Harvest Window**: Strain-specific ripening characteristics\n4. **Genetic Stability**: Phenotype variation modeling\n5. **Disease Resistance**: Environmental stress leading to pathogen susceptibility\n\n### Advanced Modeling\n\n1. **Multi-factor Interactions**: How temperature and humidity interact for VPD optimization\n2. **Seasonal Adaptation**: Strains that prefer different conditions at different times\n3. **Epigenetic Memory**: Plants \"remembering\" previous environmental stress\n4. **Breeding Integration**: Parent strain characteristics affecting offspring\n\nThis enhanced strain system provides a solid foundation for realistic, engaging, and educational cannabis cultivation simulation while maintaining backward compatibility with existing strain data.\n\n## Implementation Summary\n\n### Files Created\n\n1. **Enhanced AK-47 Blueprint**: `data/strains/ak-47-enhanced.json`\n - Complete strain blueprint with all new fields populated\n - Phase-specific environmental preferences\n - Stress tolerance configuration\n - Method affinity scores\n - Advanced yield model\n\n2. **Backend Schema**: `src/backend/src/schemas/strainsSchema.ts`\n - Zod validation schema for enhanced strain fields\n - Type-safe validation and parsing\n\n3. **Strain Interface**: `src/backend/src/engine/strains/enhancedStrainInterface.ts`\n - TypeScript interfaces and utility functions\n - Environmental evaluation logic\n - Phase mapping functions\n\n4. **Strain Service**: `src/backend/src/engine/strains/enhancedStrainService.ts`\n - Environmental evaluation service\n - Yield calculation engine\n - Method compatibility assessment\n - Event emission for monitoring\n\n5. **Growth Integration**: `src/backend/src/engine/strains/plantGrowthIntegration.ts`\n - Integration with plant growth engine\n - Health and growth multiplier calculations\n - UI tooltip generation\n\n6. **UI Component**: `src/frontend/src/components/strain/StrainEnvironmentPanel.tsx`\n - React component for environmental analysis display\n - Color-coded status indicators\n - Yield breakdown visualization\n - Environmental recommendations\n\nThe system is designed to be backward compatible, extensible, and provides a rich foundation for realistic cannabis cultivation simulation. | 2025-10-01T11:53:08.104111 | 10744        | [vision, data/schema, simulation loop, devices, agents/tasks, UI, tests, ops]          | pending |
| docs/enhanced-strain-system.md                              | Enhanced Strain Blueprint System\n\nThis document describes the enhanced strain blueprint system that has been implemented to provide more realistic and detailed strain-specific environmental preferences, yield modeling, and cultivation method compatibility.\n\n## Overview\n\nThe enhanced strain system extends the basic strain blueprint with new fields that enable:\n- Phase-specific environmental preferences (seedling, veg, flower, ripening)\n- Stress tolerance modeling for environmental metrics\n- Cultivation method affinity scoring\n- Phase-specific durations for phenology\n- Advanced yield modeling with CO2 response curves\n\n## Core Components\n\n### 1. Enhanced Strain Blueprint\n\nLocation: `src/backend/src/engine/strains/enhancedStrainInterface.ts`\n\nThe enhanced strain blueprint includes these new fields:\n\n`typescript\ninterface EnhancedStrainBlueprint {\n  // ... existing fields (id, name, genetics, etc.)\n  \n  // Environmental bands per phase\n  envBands?: {\n    default: EnvBands;\n    veg?: Partial<EnvBands>;\n    flower?: Partial<EnvBands>;\n  };\n  \n  // Stress tolerance per metric\n  stressTolerance?: {\n    temp_C?: number;\n    rh_frac?: number;\n    co2_ppm?: number;\n    ppfd_umol_m2s?: number;\n    vpd_kPa?: number;\n  };\n  \n  // Method compatibility\n  methodAffinity?: Record<string, number>; // method ID -> affinity (0-1)\n  \n  // Growth phase durations\n  phaseDurations?: {\n    seedling?: number;\n    veg?: number;\n    flower?: number;\n    ripening?: number;\n  };\n  \n  // Enhanced yield model\n  yieldModel?: {\n    baseGmPerPlant?: number;\n    qualityFactors?: {\n      temp?: number;\n      rh?: number;\n      ppfd?: number;\n      vpd?: number;\n    };\n    co2Response?: {\n      halfMax_ppm: number;\n      saturation_ppm: number;\n    };\n  };\n}\n`\n\n### 2. Environmental Evaluation Service\n\nLocation: `src/backend/src/engine/strains/enhancedStrainService.ts`\n\nThe service provides methods for:\n- Evaluating zone environment against strain preferences\n- Calculating yield estimates based on environmental conditions\n- Determining cultivation method compatibility\n- Emitting environmental events for monitoring\n\n#### Key Methods:\n\n`typescript\n// Evaluate environment against strain bands\nevaluateEnvironment(\n  strain: EnhancedStrainBlueprint,\n  environment: ZoneEnvironmentState,\n  stage: PlantStage,\n  applyStressTolerance?: boolean\n): StrainEnvironmentResult\n\n// Calculate enhanced yield estimate\ncalculateYield(context: YieldCalculationContext): CalculatedYield\n\n// Get method compatibility rating\ngetMethodCompatibility(\n  strain: EnhancedStrainBlueprint,\n  methodId: string\n): MethodCompatibility\n`\n\n### 3. Plant Growth Integration\n\nLocation: `src/backend/src/engine/strains/plantGrowthIntegration.ts`\n\nIntegrates the enhanced strain evaluation with the plant growth engine:\n- Calculates health and growth multipliers based on environmental stress\n- Provides phase-aware growth rate calculations\n- Generates yield estimates and environmental tooltips for the UI\n\n### 4. Frontend UI Component\n\nLocation: `src/frontend/src/components/strain/StrainEnvironmentPanel.tsx`\n\nDisplays comprehensive strain environmental analysis including:\n- Overall stress level with color-coded indicators\n- Individual metric status (optimal, acceptable, stress, critical)\n- Yield estimates with breakdown of quality and CO2 multipliers\n- Method compatibility ratings\n- Environmental recommendations\n\n## Environmental Band System\n\n### Band Structure\n\n`typescript\ninterface EnvBand {\n  green: [number, number];    // Optimal range\n  yellowLow: number;          // Acceptable lower bound\n  yellowHigh: number;         // Acceptable upper bound\n}\n`\n\n### Phase Overrides\n\nStrains can define different environmental preferences for different growth phases:\n- **Default**: Base environmental preferences\n- **Veg**: Overrides for vegetative growth (often higher humidity, lower light)\n- **Flower**: Overrides for flowering phase (often lower humidity, higher light)\n\n### Evaluation Logic\n\n1. **Optimal (Green)**: Value falls within the green range\n2. **Acceptable (Yellow)**: Value falls between yellowLow and green[0], or between green[1] and yellowHigh\n3. **Stress (Orange)**: Value deviates moderately from acceptable range\n4. **Critical (Red)**: Value deviates severely from acceptable range\n\n### Stress Tolerance\n\nMature plants (>14 days) can apply stress tolerance, which widens the acceptable ranges:\n- Reduces yellowLow by tolerance amount\n- Increases yellowHigh by tolerance amount\n- Allows plants to better handle environmental fluctuations as they mature\n\n## Yield Modeling\n\n### Quality Factors\n\nEach environmental metric can contribute to yield quality:\n`typescript\nqualityFactors: {\n  temp: 0.3,     // Temperature contributes 30% to quality score\n  rh: 0.2,       // Humidity contributes 20%\n  ppfd: 0.4,     // Light contributes 40%\n  vpd: 0.1       // VPD contributes 10%\n}\n`\n\n### CO2 Response Curve\n\nModels diminishing returns for CO2 supplementation:\n- **halfMax_ppm**: CO2 level that gives 50% of maximum response\n- **saturation_ppm**: CO2 level beyond which no additional benefit occurs\n- Uses Michaelis-Menten kinetics for realistic CO2 response\n\n### Final Yield Calculation\n\n`\nEstimated Yield = Base Yield × Quality Multiplier × CO2 Multiplier\n`\n\n## Method Affinity System\n\n### Affinity Scores\n\nEach strain can define compatibility with cultivation methods:\n- **1.0**: Perfect compatibility\n- **0.8**: Good compatibility\n- **0.6**: Moderate compatibility\n- **0.4**: Poor compatibility\n- **0.2**: Very poor compatibility\n- **0.0**: Incompatible\n\n### Categories\n\n- **Excellent** (0.9+): Strain thrives with this method\n- **Good** (0.7-0.89): Strain performs well\n- **Neutral** (0.5-0.69): Strain is compatible but not optimal\n- **Poor** (0.3-0.49): Strain may struggle\n- **Incompatible** (<0.3): Not recommended\n\n## Example Usage\n\n### Backend Integration\n\n`typescript\n// In plant growth tick processing\nconst environmentResult = enhancedStrainService.evaluateEnvironment(\n  strain,\n  zoneEnvironment,\n  plant.stage,\n  plant.age_days > 14 // Apply stress tolerance for mature plants\n);\n\n// Calculate growth multipliers\nconst healthMultiplier = 1.0 - (environmentResult.overallStress * 0.3);\nconst growthRate = baseGrowthRate * healthMultiplier;\n\n// Emit monitoring events\nenhancedStrainService.emitEnvironmentalEvents(\n  plant.id,\n  plant.zone_id,\n  strain,\n  environmentResult,\n  currentTick,\n  eventCollector\n);\n`\n\n### Frontend Integration\n\n`tsx\n// Display strain environment analysis\n<StrainEnvironmentPanel\n  strainName=\"AK-47\"\n  environmentResult={environmentResult}\n  yieldEstimate={yieldEstimate}\n  methodCompatibility={methodCompatibility}\n  baseYield={120}\n/>\n`\n\n## Migration Path\n\n### Existing Strains\n\nStrains without enhanced fields will use fallback defaults:\n- Default environmental bands based on cannabis cultivation best practices\n- No stress tolerance (0 for all metrics)\n- No method affinity (assumes neutral compatibility)\n- Standard phase durations\n- Simple yield model without quality factors\n\n### Gradual Enhancement\n\nStrains can be enhanced incrementally:\n1. Add basic `envBands` with default values\n2. Add phase-specific overrides for `veg` and `flower`\n3. Configure `stressTolerance` based on strain resilience\n4. Define `methodAffinity` for cultivation methods\n5. Add `yieldModel` with quality factors and CO2 response\n\n## Benefits\n\n### Realism\n- Different strains now have unique environmental preferences\n- Phase-specific requirements (e.g., lower humidity in flower)\n- Realistic CO2 response curves\n- Method-specific compatibility\n\n### Gameplay\n- Strategic strain selection based on available equipment\n- Environmental optimization becomes strain-specific\n- Yield predictions become more accurate and meaningful\n- Player education about real cultivation practices\n\n### UI/UX\n- Rich environmental feedback with source attribution\n- Clear visual indicators for environmental status\n- Actionable recommendations for improvement\n- Detailed yield breakdowns showing impact of environment\n\n## Future Enhancements\n\n### Planned Features\n\n1. **Nutrient Affinity**: Strain preferences for different nutrient regimens\n2. **Training Response**: How well strains respond to LST, SCROG, etc.\n3. **Harvest Window**: Strain-specific ripening characteristics\n4. **Genetic Stability**: Phenotype variation modeling\n5. **Disease Resistance**: Environmental stress leading to pathogen susceptibility\n\n### Advanced Modeling\n\n1. **Multi-factor Interactions**: How temperature and humidity interact for VPD optimization\n2. **Seasonal Adaptation**: Strains that prefer different conditions at different times\n3. **Epigenetic Memory**: Plants \"remembering\" previous environmental stress\n4. **Breeding Integration**: Parent strain characteristics affecting offspring\n\nThis enhanced strain system provides a solid foundation for realistic, engaging, and educational cannabis cultivation simulation while maintaining backward compatibility with existing strain data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 2025-10-01T11:53:08.104111 | 9270         | [vision, data/schema, simulation loop, devices, UI, tests, ops]                        | pending |
| docs/intents.md                                             | Simulation Facade Intents                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 2025-10-01T11:53:08.104111 | 12373        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/releases/2025-02-si-blueprint-migration.md             | Blueprint Unit Migration (SI Base Units)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 2025-10-01T07:35:57.014946 | 3663         | [data/schema, simulation loop, devices, UI, tests, ops]                                | pending |
| docs/strain-alignment-summary.md                            | Strain Alignment Summary\n\nAll strain configurations have been successfully aligned with the enhanced strain blueprint schema.\n\n## Enhanced Fields Added to All Strains\n\n### ✅ Environmental Bands (`envBands`)\nEach strain now has phase-specific environmental preferences:\n- **Default bands**: Base environmental ranges for all metrics\n- **Veg phase overrides**: Modified preferences during vegetative growth\n- **Flower phase overrides**: Optimized settings for flowering\n\n**Metrics covered:**\n- Temperature (°C)\n- Relative Humidity (fraction)\n- CO2 (ppm)\n- Light Intensity - PPFD (μmol/m²/s)\n- Vapor Pressure Deficit - VPD (kPa)\n\n### ✅ Stress Tolerance (`stressTolerance`)\nTolerance values that widen acceptable environmental ranges for mature plants:\n- Different tolerance per environmental metric\n- Applied after plants reach 14+ days age\n- Allows better adaptation to environmental fluctuations\n\n### ✅ Method Affinity (`methodAffinity`)\nCompatibility scores (0.0-1.0) with cultivation methods:\n- **Basic Soil Pot** (`85cc0916-0e8a-495e-af8f-50291abe6855`)\n- **Sea of Green** (`659ba4d7-a5fc-482e-98d4-b614341883ac`) \n- **Screen of Green** (`41229377-ef2d-4723-931f-72eea87d7a62`)\n\n### ✅ Phase Durations (`phaseDurations`)\nStrain-specific growth phase lengths:\n- Seedling days\n- Vegetative days\n- Flowering days\n- Ripening days\n\n### ✅ Yield Model (`yieldModel`)\nAdvanced yield calculation with environmental factors:\n- Base grams per plant\n- Quality factors weighted by environmental conditions\n- CO2 response curves with diminishing returns\n\n## Strain-Specific Characteristics\n\n### Northern Lights\n- **Type**: Indica-dominant (65% Indica)\n- **Environment**: Lower light requirements, good resilience\n- **Method Affinity**: Excellent for Basic Soil (0.9), Good for SOG (0.8)\n- **Yield**: 35g base yield, balanced environmental factors\n- **Stress Tolerance**: High (2.0°C temp, 0.2 VPD)\n\n### Skunk #1\n- **Type**: Hybrid (65% Sativa, 35% Indica)\n- **Environment**: Moderate requirements, stable genetics\n- **Method Affinity**: Good for Basic Soil (0.8) and SCROG (0.8)\n- **Yield**: 48g base yield, light-focused quality factors\n- **Stress Tolerance**: Moderate (1.5°C temp, 0.18 VPD)\n\n### Sour Diesel\n- **Type**: Sativa-dominant (65% Sativa)\n- **Environment**: High light requirements, longer flowering\n- **Method Affinity**: Excellent for SCROG (0.9), challenging for SOG (0.5)\n- **Yield**: 55g base yield, high light dependency\n- **Stress Tolerance**: Lower (1.0°C temp, 0.15 VPD)\n\n### White Widow\n- **Type**: Balanced hybrid (50/50)\n- **Environment**: Moderate needs, good resilience\n- **Method Affinity**: Excellent for Basic Soil (0.9), good across methods\n- **Yield**: 42g base yield, temp/humidity focused\n- **Stress Tolerance**: Good (1.8°C temp, 0.18 VPD)\n\n### AK-47\n- **Type**: Sativa-dominant hybrid (65% Sativa)\n- **Environment**: Balanced requirements, humidity-sensitive in flower\n- **Method Affinity**: Excellent for SOG (0.9), good for Basic Soil (0.8)\n- **Yield**: 45g base yield, VPD and light focused\n- **Stress Tolerance**: Good (1.0°C temp, 0.15 VPD)\n\n## Validation Results\n\n✅ **All 5 strain files validated successfully**\n- All required enhanced fields present\n- Valid JSON structure\n- Consistent field naming and structure\n- Realistic environmental ranges and values\n\n## Integration Benefits\n\n### For Players\n- **Strategic depth**: Strain selection matters based on equipment\n- **Environmental optimization**: Each strain has unique sweet spots\n- **Method compatibility**: Clear guidance on cultivation approach\n- **Yield predictions**: More accurate forecasting\n\n### For Simulation\n- **Realistic growth**: Strain-specific environmental responses\n- **Dynamic yields**: Environment directly impacts harvest quality\n- **Educational value**: Learn real cannabis cultivation principles\n- **Balanced gameplay**: Different strains excel in different setups\n\n## Technical Implementation\n\nThe enhanced strain system is:\n- **Backward compatible**: Existing strains work with fallback defaults\n- **Extensible**: Easy to add new environmental metrics or methods\n- **Type-safe**: Zod schema validation ensures data integrity\n- **Performance optimized**: Efficient lookup and calculation algorithms\n\n## Files Updated\n\n1. `data/blueprints/strains/northern-lights.json` - Added all enhanced fields\n2. `data/blueprints/strains/skunk-1.json` - Added all enhanced fields\n3. `data/blueprints/strains/sour-diesel.json` - Added all enhanced fields\n4. `data/blueprints/strains/white-widow.json` - Added all enhanced fields\n5. `data/blueprints/strains/ak-47.json` - Already had enhanced fields\n\nAll strain configurations are now fully aligned with the enhanced strain blueprint schema and ready for integration with the simulation engine.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 2025-10-01T11:53:08.104111 | 4877         | [data/schema, simulation loop, devices, UI, tests, ops]                                | pending |
| docs/system/adr/0001-typescript-toolchain.md                | ADR 0001 — Backend TypeScript Toolchain Stabilization                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 2025-10-01T11:53:08.104111 | 4547         | [data/schema, simulation loop, UI, ops]                                                | pending |
| docs/system/adr/0002-frontend-realtime-stack.md             | ADR 0002 — Frontend Real-Time Dashboard Stack                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 2025-10-01T11:53:08.104111 | 3920         | [data/schema, simulation loop, UI, tests, ops]                                         | pending |
| docs/system/adr/0003-facade-messaging-overhaul.md           | ADR 0003 — Facade Messaging Overhaul                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 2025-10-01T11:53:08.108112 | 3951         | [data/schema, simulation loop, devices, agents/tasks, UI, tests, ops]                  | pending |
| docs/system/adr/0004-zone-setpoint-routing.md               | ADR 0004 — Zone Setpoint Routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 2025-10-01T11:53:08.108112 | 3203         | [data/schema, simulation loop, devices, agents/tasks, UI, ops]                         | pending |
| docs/system/adr/0005-snapshot-time-sync.md                  | ADR 0005 — Snapshot & Time Status Telemetry Contract                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 2025-10-01T11:53:08.108112 | 2393         | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/system/adr/0006-socket-transport-parity.md             | ADR 0006 — Socket Transport Version Parity                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 2025-10-01T11:53:08.108112 | 2637         | [data/schema, simulation loop, agents/tasks, UI, tests, ops]                           | pending |
| docs/system/adr/0007-physio-module-relocation.md            | ADR 0007 — Physiology Modules Collocate with the Engine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 2025-10-01T11:53:08.108112 | 3402         | [data/schema, simulation loop, agents/tasks, UI, tests, ops]                           | pending |
| docs/system/adr/0008-randomuser-provisioning.md             | ADR 0008 — Auto-Provision Personnel Directory from RandomUser                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 2025-10-01T11:53:08.108112 | 5574         | [vision, data/schema, simulation loop, economy, agents/tasks, UI, tests, ops]          | pending |
| docs/system/adr/0009-simulation-constants-governance.md     | ADR 0009 — Simulation Constant Governance & Documentation Loop                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2025-10-01T11:53:08.108112 | 2579         | [data/schema, simulation loop, devices, agents/tasks, UI, tests, ops]                  | pending |
| docs/system/adr/0010-blueprint-schema-naming.md             | ADR 0010 — Blueprint Schema Naming Alignment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 2025-10-01T11:53:08.108112 | 2200         | [data/schema, simulation loop, devices, UI, tests, ops]                                | pending |
| docs/system/adr/0011-cultivation-setup-sharing.md           | ADR 0011 — Cultivation Setup UI Consolidation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 2025-10-01T11:53:08.108112 | 2833         | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/system/adr/0012-refactoring-governance.md              | ADR 0012 — Refactoring Governance & Modularisation Thresholds                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 2025-10-01T11:53:08.108112 | 2298         | [vision, data/schema, simulation loop, agents/tasks, UI, ops]                          | pending |
| docs/system/audit.md                                        | Simulation Audit Runner                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 2025-10-01T07:35:57.014946 | 2816         | [data/schema, simulation loop, agents/tasks, UI, tests, ops]                           | pending |
| docs/system/data-validation.md                              | Blueprint Data Validation Workflow                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 2025-10-01T11:53:08.108112 | 4277         | [data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops]         | pending |
| docs/system/employees.md                                    | Weedbreed.AI — Employee System                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2025-10-01T11:53:08.108112 | 8295         | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, ops]        | pending |
| docs/system/facade.md                                       | Weedbreed.AI — System Facade                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 2025-10-01T11:53:08.108112 | 14177        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/system/job_market_population.md                        | Weedbreed.AI — Job Market Population                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 2025-10-01T11:53:08.108112 | 10901        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/system/logging.md                                      | Logging & Telemetry Configuration                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 2025-10-01T07:35:57.014946 | 2379         | [data/schema, simulation loop, UI, ops]                                                | pending |
| docs/system/personnel_roles_blueprint.md                    | Weedbreed.AI — Personnel Role Blueprint                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 2025-10-01T11:53:08.108112 | 5997         | [data/schema, simulation loop, devices, economy, UI, tests, ops]                       | pending |
| docs/system/runtime-event-bus-migration.md                  | Runtime Event Bus Migration Notes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 2025-10-01T11:53:08.108112 | 2045         | [vision, simulation loop, UI, ops]                                                     | pending |
| docs/system/simulation-engine.md                            | Weedbreed.AI — Simulation Engine Deep Dive                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 2025-10-01T11:53:08.108112 | 12880        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/system/simulation_philosophy.md                        | Weedbreed.AI — Simulation Philosophy Deep Dive                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2025-10-01T11:53:08.108112 | 5893         | [vision, simulation loop, devices, economy, agents/tasks, UI, tests, ops]              | pending |
| docs/system/socket_protocol.md                              | Socket Protocol — Simulation Gateway                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 2025-10-01T11:53:08.108112 | 26790        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/system/wb-physio.md                                    | Weed Breed Physiology Reference                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 2025-10-01T11:53:08.108112 | 3325         | [simulation loop, devices, tests, ops]                                                 | pending |
| docs/system/world-service-architecture.md                   | World Service Architecture                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 2025-10-01T11:53:08.108112 | 6639         | [vision, data/schema, devices, economy, agents/tasks, UI, tests, ops]                  | pending |
| docs/tasks/20250923-clickdummy-migration_steps.md           | Inventory                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 2025-10-01T11:53:08.108112 | 27185        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/tasks/20250923-todo-findings.md                        | Create tasks to fix the issues:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 2025-10-01T11:53:08.108112 | 5332         | [data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops]         | pending |
| docs/tasks/20250924-todo-findings.md                        | • Critical: config.update setpoint rejects UUID zoneIds (backend socketGateway.t                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 2025-10-01T11:53:08.108112 | 5896         | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/tasks/20250925-job-market-refresh.md                   | 2025-09-25 — Randomuser-backed job market refresh                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 2025-10-01T11:53:08.108112 | 1805         | [simulation loop, economy, agents/tasks, UI, tests, ops]                               | pending |
| docs/tasks/20250926-personnel-provisioning.md               | 2025-09-26 — Personnel directory provisioning follow-ups                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 2025-10-01T11:53:08.108112 | 1659         | [vision, agents/tasks, UI, tests, ops]                                                 | pending |
| docs/tasks/20250927-difficulty-presets-sync.md              | Task: Unify Difficulty Presets with JSON Source                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 2025-10-01T11:53:08.108112 | 1858         | [vision, data/schema, agents/tasks, UI, tests, ops]                                    | pending |
| docs/tasks/20250928-irrgitation-nutrient-overhaul.md        | Task Plan — Irrigation & Nutrient Overhaul (2025-09-28)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 2025-10-01T11:53:08.108112 | 20832        | [vision, data/schema, simulation loop, economy, agents/tasks, UI, tests, ops]          | pending |
| docs/tasks/20250928-replace-mock-data.md                    | Task: Replace Frontend Mock Data with Live Simulation Feeds                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 2025-10-01T11:53:08.108112 | 5663         | [vision, data/schema, simulation loop, agents/tasks, UI, tests, ops]                   | pending |
| docs/tasks/20250929-refactoring-roadmap.md                  | Refactoring Roadmap — Backend & Frontend Monolith Decomposition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 2025-10-01T11:53:08.108112 | 5345         | [vision, data/schema, economy, UI, tests, ops]                                         | pending |
| docs/tasks/difficulty-presets-analysis.md                   | Difficulty Presets Config Sync Analysis                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 2025-10-01T11:53:08.108112 | 2401         | [vision, data/schema, simulation loop, UI, tests, ops]                                 | pending |
| docs/ui-building_guide.backup.md                            | Weedbreed.AI UI Building Guide                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2025-10-01T11:53:08.108112 | 67318        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/ui-building_guide.md                                   | Weedbreed.AI UI Building Guide                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2025-10-01T11:53:08.108112 | 69902        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/ui/migration-notes.md                                  | Frontend Migration Notes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 2025-10-01T11:53:08.108112 | 3850         | [data/schema, simulation loop, economy, agents/tasks, UI, tests, ops]                  | pending |
| docs/ui/ui-components-desciption.md                         | Component Documentation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 2025-10-01T11:53:08.132112 | 63490        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/ui/ui-implementation-spec.md                           | Weedbreed.AI — Frontend Implementation Spec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 2025-10-01T11:53:08.132112 | 15603        | [vision, data/schema, simulation loop, devices, economy, UI, ops]                      | pending |
| docs/ui/ui-screenshot-insights.md                           | UI Screenshot Insights                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 2025-10-01T11:53:08.132112 | 5708         | [vision, simulation loop, devices, economy, UI, ops]                                   | pending |
| docs/ui/ui_archictecture.md                                 | Weedbreed.AI — UI Architecture                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2025-10-01T11:53:08.132112 | 9014         | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/ui/ui_elements.md                                      | Weedbreed.AI — UI Elements                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 2025-10-01T11:53:08.132112 | 8852         | [simulation loop, devices, economy, agents/tasks, UI, tests, ops]                      | pending |
| docs/ui/ui_interactions_spec.md                             | Weedbreed.AI — UI Interaction Spec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 2025-10-01T11:53:08.132112 | 11928        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/vision_scope.md                                        | Weedbreed.AI — Vision & Scope                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 2025-10-01T11:53:08.132112 | 17006        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/weedbreed-final-truth.backup.md                        | Weedbreed Final Truth                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 2025-10-01T11:53:08.132112 | 23211        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| docs/weedbreed-final-truth.md                               | Weedbreed Final Truth                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 2025-10-01T11:53:08.132112 | 35824        | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| sources_inventory.md                                        | Sources Inventory                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 2025-10-01T11:54:00.776183 | 1010841      | [vision, data/schema, simulation loop, devices, economy, agents/tasks, UI, tests, ops] | pending |
| src/backend/README.md                                       | Backend Development                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 2025-10-01T11:53:08.140112 | 1894         | [data/schema, simulation loop, UI, tests, ops]                                         | pending |

## Contributing to Weed Breed Reboot (CONTRIBUTING.md)

Source: [`CONTRIBUTING.md`](../CONTRIBUTING.md)

# Contributing to Weed Breed Reboot

Welcome! This document describes how to contribute changes to the Weed Breed Reboot monorepo. It complements the authoritative design and schema references tracked in [`docs/`](docs/).

## Before You Start

1. **Study the domain docs.** The blueprint and schema definitions in the [Data Dictionary](docs/DD.md), the extended JSON blueprint listings in [All JSON Blueprints](docs/addendum/all-json.md), and the simulation notes in the [Simulation Engine Overview](docs/system/simulation-engine.md) are the source of truth for content and engine behaviour. When working on blueprint data or engine logic, consult these first to avoid schema drift.
2. **Understand validation expectations.** The [Blueprint Data Validation Workflow](docs/addendum/data-validation.md) explains the reporting pipeline that backs `pnpm validate:data` and documents how CI enforces data quality gates.
3. **Install dependencies.** Use Node.js 20+ with [pnpm](https://pnpm.io/) and run `pnpm install` at the repository root to hydrate all workspace packages.

## Expected Workflow

1. Create a feature branch in your fork and sync with `main`.
2. Make focused changes while keeping the tick engine, schema contracts, and naming conventions aligned with the docs listed above.
3. Run targeted unit/integration tests for the packages you touched (`pnpm -r test` or package-specific scripts) and generate any necessary blueprint validation reports.
4. Review generated artifacts (e.g., under `reports/validation`) before committing.
5. Open a pull request that summarises the change, references the relevant docs, and links to any blueprint reports when applicable.

## Pull Request Checklist

Complete these steps before marking your pull request ready for review:

- [ ] Re-read the blueprint and schema references to confirm the change matches the documented contracts ([Data Dictionary](docs/DD.md), [All JSON Blueprints](docs/addendum/all-json.md), [Simulation Engine Overview](docs/system/simulation-engine.md)).
- [ ] Run the workspace lint task: `pnpm lint`.
- [ ] Validate blueprint data (required when any JSON blueprints or schema-driven code is touched): `pnpm validate:data`.
- [ ] Execute the dependency audit gate: `pnpm audit:run`.
- [ ] Run the relevant test suites (`pnpm -r test` or scoped package commands) and ensure they pass.
- [ ] Update or add documentation in [`docs/`](docs/) when behaviour or contracts change.

Following this workflow keeps contributions aligned with the deterministic simulation architecture and ensures CI gates remain green.

## Weedbreed.AI UI Building Guide (docs/ui-building_guide.backup.md)

Source: [`docs/ui-building_guide.backup.md`](../docs/ui-building_guide.backup.md)

# Weedbreed.AI UI Building Guide

The Weedbreed.AI dashboard renders read-only simulation snapshots and routes every user gesture through the System Facade so that the deterministic engine enforces geometry, biology, and economic rules.【F:docs/ui/ui_archictecture.md†L1-L74】【F:docs/ui/ui-implementation-spec.md†L1-L96】 This guide consolidates the architecture notes, interaction specs, component references, and screenshot insights into a single build manual for teams extending or rebuilding the frontend without introducing business logic to the UI layer.

The application follows a structure → room → zone drill-down supported by persistent dashboard controls, breadcrumb navigation, and modal workflows that pause gameplay until intents succeed, aligning macro management with per-zone cultivation flows.【F:docs/ui/ui-implementation-spec.md†L11-L220】【F:docs/ui/ui-screenshot-insights.md†L1-L52】 All requirements below reuse the existing terminology (UUID identifiers, facade intents, Tailwind tokens) and consolidate the latest architecture decisions so downstream teams can implement features without guessing at contract details.

## Table of Contents

- [Guiding Principles](#guiding-principles)
- [Layout & Navigation](#layout--navigation)
- [Core Views](#core-views)
- [UI Elements & Patterns](#ui-elements--patterns)
- [Interactions](#interactions)
- [States & Telemetry](#states--telemetry)
- [Accessibility & Performance](#accessibility--performance)
- [Visual Guardrails](#visual-guardrails)
- [Glossary](#glossary)
- [Changelog Note](#changelog-note)
- [Open Issues](#open-issues)

## Guiding Principles

- **Logic-free presentation.** The UI never computes harvest revenue, growth, or geometry; it renders snapshots and issues facade commands only.【F:docs/ui/ui_archictecture.md†L1-L74】【F:docs/ui/ui_interactions_spec.md†L1-L88】 Components remain "dumb" so the deterministic engine governs validation, costing, and state transitions.
- **Unidirectional dataflow.** Rendering always follows the Render → Intent → Facade Command → Engine Commit → Event Notify → Re-render cycle, ensuring predictable updates and debuggable behavior.【F:docs/ui/ui_archictecture.md†L16-L74】
- **Authoritative identities.** Every cross-reference uses `id` (UUID v4); UI elements may display names but never join on them, and events carry minimal UUID payloads that must be resolved against the latest snapshot.【F:docs/ui/ui_archictecture.md†L1-L140】【F:docs/ui/ui_interactions_spec.md†L1-L114】
- **Naming conventions.** Inputs and intents reuse the System Facade vocabulary (`world.createRoom`, `devices.installDevice`, `plants.addPlanting`, etc.) without introducing alternative spellings, keeping parity with backend docs.【F:docs/ui/ui_archictecture.md†L75-L140】【F:docs/ui/ui-implementation-spec.md†L260-L380】
- **Design-system primitives.** Teams must rely on the shared Button, IconButton, form field, and InlineEdit primitives instead of ad-hoc styling so that theme and focus states remain centralised.【F:docs/ui/ui_elements.md†L5-L24】
- **Modal discipline.** Opening a modal pauses the simulation, blurs background content, and focus is trapped until the modal closes, after which the prior run state is restored.【F:docs/ui/ui-implementation-spec.md†L96-L220】
- **Dark-first theming.** Tailwind tokens rooted in the stone palette with lime accents define the dark theme across cards, inputs, and overlays; the light theme pairs `#fafafa` surfaces and `#111827` text with lime-600 accents so both themes share semantic tokens and AA contrast.【F:docs/ui/ui-components-desciption.md†L551-L614】
- **Responsive-first layouts.** Desktop is the design baseline. Breakpoints align with Tailwind (`lg ≥1024px`, `xl ≥1440px`) while `md`/`sm` fall back to stacked single-column layouts: dashboards switch to `grid-template-columns: repeat(auto-fill, minmax(260px, 1fr))`, zone detail stacks below `md`, and header controls wrap under `sm` before rejoining on wider screens.【F:docs/ui/ui-implementation-spec.md†L160-L220】【F:docs/ui/ui-components-desciption.md†L407-L533】
- **Tick length controlled by backend.** The UI only exposes deterministic play/pause and speed presets; users cannot adjust tick duration directly so simulation cadence remains façade governed.

## Layout & Navigation

### Application Shell

- The single-page app keeps a persistent header (`DashboardHeader`), breadcrumb navigation, sidebar, and dynamic content area orchestrated by the navigation manager (`{ currentView, selectedStructureId?, selectedRoomId?, selectedZoneId? }`).【F:docs/ui/ui-implementation-spec.md†L11-L120】【F:docs/ui/ui_archictecture.md†L75-L140】【F:docs/ui/ui-components-desciption.md†L225-L360】
- The start screen centers the Weedbreed.AI title, subtitle, and primary actions (New, Load, Import) before transitioning to the main shell once a run is active.【F:docs/ui/ui_elements.md†L11-L44】【F:docs/ui/ui-components-desciption.md†L393-L420】 The "Quick Start" preset seeds `"WB-quickstart-default"`, rents one compact warehouse (≈600 m², 2.5 m height), provisions a growroom with three 20 m² zones configured for SOG, stocks 10 000 L water and 100 kg nutrients, equips each zone with 2× GrowLight (10–12 m² coverage), 1× ClimateUnit, 1× Dehumidifier, and 1× CO₂-Injector, and plants 40 `ak-47` strain starters with Auto-Replant disabled; simulation remains paused until the player explicitly starts it.
- Sidebar navigation lists rooms and zones for the selected structure, with nested toggles and CTA hooks (e.g., "Add Room") tied to modal flows.【F:docs/ui/ui-components-desciption.md†L225-L360】

### Responsive Breakpoints & Navigation Behaviour

- Breakpoints follow a desktop-first Tailwind scale: `xs <480px`, `sm 480–767px`, `md 768–1023px`, `lg 1024–1439px`, `xl ≥1440px`. Only `lg` and `xl` have bespoke layouts; smaller breakpoints reuse stacked single-column variants.
- Dashboard and grid surfaces use `grid-template-columns: repeat(auto-fill, minmax(260px, 1fr))` from `sm` upward, collapsing to a single stretched card column on `xs` widths.
- Zone detail presents two columns (`1.2fr / 1fr`) from `lg` upward; `md` and below stack content with the status column rendering before management panels to preserve reading order.
- Header controls wrap into two rows under `sm`, then collapse back to a single row from `md` upward so presets stay reachable without overflow.
- Sidebar becomes an off-canvas drawer below `md`, opened via hamburger button, locking body scroll, applying `.content-area.blurred`, and only closing via explicit controls; overlay clicks remain disabled to align with modal policy.

### Persistent Dashboard & Controls

```css
.dashboard {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
}
.dashboard-metrics,
.dashboard-controls {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}
.game-speed-controls .btn {
  padding: 0.4rem 0.6rem;
  border-radius: 0.5rem;
}
.game-speed-controls .btn.active {
  background: var(--color-primary);
  color: #fff;
}
```

- The left cluster surfaces Capital, Cumulative Yield, planned plant capacity (hidden when zero), and an animated tick progress ring tied to in-game time.【F:docs/ui/ui-implementation-spec.md†L37-L120】【F:docs/ui/ui_elements.md†L24-L84】
- The right cluster offers play/pause, multiple speed presets (0.5×–250×), quick links to Finances (`monitoring`) and Personnel (`groups`), notifications, and the game menu (`settings`).【F:docs/ui/ui-implementation-spec.md†L37-L142】【F:docs/ui/ui_elements.md†L62-L116】
- Notifications display an unread badge, and the game menu opens the shared modal to reach Save/Load/Export/Reset actions.【F:docs/ui/ui-implementation-spec.md†L37-L142】【F:docs/ui/ui-components-desciption.md†L323-L337】 The notification popover contains tabs for _All_, _Warnings_, and _Errors_ with 20-item lazy-loaded pages, renders items shaped as `{ id, ts, severity, title, message, entityId?, entityType?, actions?[] }`, and raises the header badge with the count of unopened warning/error events sourced from `sim.*`, `world.*`, `hr.*`, and `finance.*` streams.

### Breadcrumbs & States

```css
.breadcrumbs {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.breadcrumbs a {
  color: var(--color-link);
  text-decoration: none;
}
.breadcrumbs .sep {
  opacity: 0.6;
}
```

- Breadcrumbs mirror the hierarchy (Structures → Structure → Room → Zone) and expose a back arrow for stepping upward; each segment is clickable and updates the navigation state via `goTo`/`back` actions.【F:docs/ui/ui-implementation-spec.md†L120-L150】【F:docs/ui/ui_archictecture.md†L75-L140】
- The content area applies a blur and disables pointer events whenever any modal is active, reinforcing modal focus and the pause-first policy.【F:docs/ui/ui-implementation-spec.md†L80-L106】

```css
.content-area.blurred {
  filter: blur(3px);
  pointer-events: none;
}
```

### Panel Layouts & Responsive Breakpoints

- Zone detail screens render a two-column grid (`1.2fr / 1fr`) for status vs. list panels, collapsing to a single column below 900 px, which must be respected when designing responsive breakpoints.【F:docs/ui/ui-implementation-spec.md†L180-L220】
- Structure, room, and zone overviews rely on responsive card grids using `grid-template-columns: repeat(auto-fill, minmax(260px, 1fr))`, ensuring cards wrap gracefully on narrow screens.【F:docs/ui/ui-implementation-spec.md†L120-L180】
- The screenshot insights confirm that dashboard, structure, room, and zone compositions must preserve quick inline actions (rename, duplicate, delete) within these responsive layouts.【F:docs/ui/ui-screenshot-insights.md†L1-L64】
- Personnel and finance views use tabbed and collapsible panels while remaining accessible through the persistent header navigation.【F:docs/ui/ui-components-desciption.md†L470-L533】
- Below `md` widths the sidebar shifts to an off-canvas drawer opened via the header hamburger, locking body scroll and applying `.content-area.blurred`; modal stacking follows the single-modal queue outlined in [Responsive Breakpoints & Navigation Behaviour](#responsive-breakpoints--navigation-behaviour).

## Core Views

### Start Screen

- Displays "Weedbreed.AI - Reboot" with subtitle "Your AI-powered cannabis cultivation simulator." and three actions: New Game, Load Game, Import Game (Quick Start optional per StartScreen component).【F:docs/ui/ui_elements.md†L11-L44】【F:docs/ui/ui-components-desciption.md†L393-L420】
- The corresponding screenshot (`01-welcome-screen.png`) maps to `StartScreen` in `App.tsx`, invoking lifecycle intents (`newGame`, `load`, `importState`).【F:docs/ui/ui-components-desciption.md†L393-L420】
- Quick Start loads the deterministic seed `"WB-quickstart-default"`, rents a 600 m² warehouse with a growroom of three 20 m² SOG zones, preloads 10 000 L water and 100 kg nutrients, installs 2× GrowLight, 1× ClimateUnit, 1× Dehumidifier, and 1× CO₂-Injector per zone, and plants 40 `ak-47` starters with Auto-Replant disabled.

### Dashboard & Global Chrome

- Persistent header summarising Capital, Cumulative Yield, planned plant capacity, and an in-game clock with tick progress ring.【F:docs/ui/ui-implementation-spec.md†L37-L120】【F:docs/ui/ui_elements.md†L24-L84】
- Control cluster includes Play/Pause, speed presets, view switchers (Finances, Personnel), notifications popover, and settings flyout for Save/Load/Export/Reset.【F:docs/ui/ui-implementation-spec.md†L37-L142】【F:docs/ui/ui-components-desciption.md†L225-L360】
- `DashboardHeader` consumes stats, simulation state, and navigation callbacks; `EventLog` sits at the footer to surface recent telemetry color-coded by severity.【F:docs/ui/ui-components-desciption.md†L225-L360】
- Screenshot insights show inline actions within cards to encourage drill-down and highlight consistent dark theming across cards.【F:docs/ui/ui-screenshot-insights.md†L1-L64】
- Notification popover mirrors header alerts with tabs for _All_, _Warnings_, and _Errors_, paginates 20 items per lazy-loaded page, and surfaces severity icons consistent with toast/event log styling.

### Structures Overview

- `DashboardView` renders rented structures as cards inside a responsive grid, each showing name, floor area, room count, plant summary, and inline rename/duplicate actions via `InlineEdit` + `ActionIcons`.【F:docs/ui/ui-implementation-spec.md†L120-L180】【F:docs/ui/ui-components-desciption.md†L483-L487】【F:docs/ui/ui_elements.md†L84-L140】
- `+ Rent Structure` button launches the rent modal; duplication flows preview costs and device counts before dispatching intents.【F:docs/ui/ui-implementation-spec.md†L120-L180】【F:docs/ui/ui-components-desciption.md†L313-L360】
- Screenshot `03-structure-overview.png` confirms these cards and quick actions.【F:docs/ui/ui-screenshot-insights.md†L1-L64】

### Structure Detail View

- Header displays structure name with rename (`edit`) and delete (`delete`) icons, area usage, and CTA to `+ Add Room`. Cards for each room include area, purpose, zone counts, plant summaries, and inline rename/duplicate/delete actions.【F:docs/ui/ui-implementation-spec.md†L120-L200】【F:docs/ui/ui_elements.md†L116-L176】【F:docs/ui/ui-components-desciption.md†L521-L525】
- Duplicate flows use modals summarizing footprint, zone counts, and CapEx estimates before invoking `world.duplicateStructure`.【F:docs/ui/ui-components-desciption.md†L313-L360】
- Screenshot `09-structure-detailview.png` illustrates nested zone cards inside the structure detail.【F:docs/ui/ui-screenshot-insights.md†L21-L52】

### Room Detail View

- Header lists room name, purpose badge, rename/delete icons, and capacity usage; zone grids appear for grow rooms, while labs swap in the `BreedingStation` component.【F:docs/ui/ui-implementation-spec.md†L200-L260】【F:docs/ui/ui_elements.md†L140-L196】
- Zone cards show name, area, cultivation method, plant summaries, and inline rename/duplicate/delete actions; clicking navigates to zone detail.【F:docs/ui/ui-implementation-spec.md†L200-L240】【F:docs/ui/ui-components-desciption.md†L407-L420】
- Screenshot `10-room-overview-(growroom).png` captures the zone grid and inline actions.【F:docs/ui/ui-screenshot-insights.md†L21-L52】

#### BreedingStation (Lab Rooms)

- Lab-purpose rooms swap the standard zone grid for the `BreedingStation` workspace that manages deterministic breeding runs while keeping grow-room flows untouched.
- Primary run states drive the view hierarchy: `Idle` (history table with "Start Cross" CTA), `Configuring` (parent picker, trait targets, batch size, deterministic seed), `Running` (progress timeline with simulated days, ETA, cancel/abort controls), `Completed` (offspring table with keep/discard actions, promote/export flows), and `Archived` (read-only review with option to re-open).
- Core components include `ParentPicker` (multi-select by strain UUID with phenology/lighting hints), `TraitTargets` sliders (THC/CBD, vigor, stress resilience, growth duration), `CrossSummary` badges (F1/F2 label, batch size, seed, noise bounds), `RunProgress` (steps, elapsed ticks/days, logs), `OffspringTable` (sortable columns for id/genotype/chemotype/phenology/qualityScore/viability/notes with keep/promote actions), and `PromoteModal` (confirms new strain blueprint metadata and parent lineage).
- Data contract relies on `BreedingRun` snapshots providing metadata, parent IDs, batch size, seed, optional trait targets, run status timestamps, offspring previews, and notes. Each offspring exposes heuristic quality/chemotype/phenology/resilience/viability fields plus `keep` flags for client-side toggles.
- Facade intents routed through the bridge hook: `breeding.startRun`, `breeding.abortRun`, `breeding.finalizeRun`, and `breeding.promoteOffspring` (with blueprint naming + optional slug) — every action pauses the simulation like other modals and resumes after commit.

### Zone Detail View

- Header includes zone name with sibling navigation arrows (`arrow_back_ios`, `arrow_forward_ios`), rename/delete icons, and ensures zone-level actions remain accessible.【F:docs/ui/ui-implementation-spec.md†L220-L320】【F:docs/ui/ui_elements.md†L196-L260】
- Layout splits into two columns (status vs. management) above 900 px and stacks below; screenshot `11`–`13` illustrate collapsed vs. expanded environment controls and batch plant selection.【F:docs/ui/ui-implementation-spec.md†L220-L360】【F:docs/ui/ui-screenshot-insights.md†L33-L64】
- **Zone Info Panel (left column):**
  - General info for area, method, plant counts.
  - Supplies card with water/nutrient stocks plus buttons to add supply (modal).
  - Lighting card with cycle, coverage (color-coded classes), and DLI/PPFD metrics derived from backend `coverageRatio` and readings.【F:docs/ui/ui-implementation-spec.md†L240-L360】
  - Environment card showing temperature, humidity, CO₂ with out-of-range highlighting and VPD proxy as secondary metric.【F:docs/ui/ui-implementation-spec.md†L240-L360】【F:docs/ui/ui-components-desciption.md†L407-L462】 Thresholds: temperature 22–28 °C (green), 20–22/28–30 °C (yellow), <20/>30 °C (red with copy "Canopy warm → Transpiration ↑, Stress risk" when exceeding 30 °C); relative humidity 0.45–0.65 (green), 0.40–0.45/0.65–0.70 (yellow), <0.40/>0.70 (red with "Air too humid → Pathogen risk; increase dehumidification" at >0.70); CO₂ 800–1 200 ppm (green), 600–800/1 200–1 400 ppm (yellow), <600/>1 400 ppm (red, recommending safety shutdown above 1 800 ppm).
- **Management Panels (right column):**
  - Plantings list supports expand/collapse, per-plant harvest (`content_cut`), group delete (`delete`), and strain info tooltips; Harvest All CTA appears when plants ready.【F:docs/ui/ui-implementation-spec.md†L260-L360】
- Planting Plan panel manages auto-replant toggles, strain/quantity config, and edit/delete flows using modals.【F:docs/ui/ui-implementation-spec.md†L260-L360】
- Manual planting overrides Auto-Replant by applying a manual lock; the UI raises a banner "Auto-Replant paused (manual planting active)" with a "Resume Auto-Replant" CTA that clears the lock and emits `plants.autoReplantResumed`, while the pause event triggers `plants.autoReplantPaused`.
- Devices list groups by type with status indicator chips (`status-on/off/mixed/broken`), toggles all-on/off, exposes tuning, light cycle, install, update, move, and remove actions via modals.【F:docs/ui/ui-implementation-spec.md†L260-L360】【F:docs/ui/ui-components-desciption.md†L421-L533】
- Device group toggles confirm for safety-critical HVAC, CO₂, and dehumidifier groups with risk copy, while low-impact lighting and ventilation flips act immediately, showing "Group: ON/OFF" toasts and still awaiting façade acknowledgements.
  - ZonePlantPanel supports normal inspection (tooltips, direct actions) and batch-selection mode with BatchActionBar actions for Harvest/Trash/Treat across selected plants.【F:docs/ui/ui-components-desciption.md†L421-L533】
- Empty zone states include dedicated illustrations plus CTAs: "Install device" when device list empty, "Plant" when no plantings exist, and secondary "Configure Auto-Replant" when plans are absent; each tooltip explains prerequisites (e.g., method setup).
- Strain info tooltips (hover on `info` icon) display name, genotype percentages (sativa/indica/ruderalis when available), phenology (seedling/veg/flowering days), environmental targets (PPFD, temperature, RH corridors), NPK guidance for veg/flower, price hints (baseline harvest price when price maps resolve), and resolved lineage parent names pulled from strain blueprints and lineage lookups.
- Pest/disease badges expose name + category (`Pest`/`Disease`), severity (0–1 or % with color coding), environment risk bands (e.g., “favored at RH > 0.7, 22–26 °C”), up to three bullet symptoms, any active timers (PHI, re-entry) when treatments exist, and a CTA to open the `InfoModal` for full blueprint details with current zone health context.

### Finances View

- Presents high-level KPIs via `StatCard`s and collapsible panels for Revenue, OpEx, and CapEx, with time-range filters (1D/1W/1M/1Y).【F:docs/ui/ui-components-desciption.md†L470-L509】【F:docs/ui/ui_elements.md†L260-L300】
- Icons include `trending_up`, `receipt_long`, `account_balance`, and `DollarIcon` for quick comprehension.【F:docs/ui/ui-components-desciption.md†L470-L509】
- Screenshots `06` and `07` show collapsed vs. expanded states, confirming the toggle affordances.【F:docs/ui/ui-screenshot-insights.md†L41-L64】
- Missing finance figures render an em dash (`—`) with tooltip "No data in range"; negative numbers tint red and may optionally use parentheses `(–1 234,56)` to emphasise losses while preserving locale formatting.
- Currency and number formatting leverage `Intl.NumberFormat`, deriving locale from app language (DE/EN) and currency from configuration (default EUR) without storing currency codes in blueprints.

### Personnel View

- Tabbed interface toggling between "Job Market" (candidate cards with hire actions) and "Your Staff" (employee cards with fire/assignment controls and morale/energy bars).【F:docs/ui/ui_components-desciption.md†L504-L509】【F:docs/ui/ui_elements.md†L300-L360】
- Hiring uses `HireEmployeeModal`; firing uses global confirmation; refresh triggers `workforce.refreshCandidates`.【F:docs/ui/ui_components-desciption.md†L333-L337】【F:docs/ui/ui_interactions_spec.md†L58-L73】
- Screenshots `04` and `05` illustrate both tabs and their CTAs.【F:docs/ui/ui-screenshot-insights.md†L41-L64】
- Lists virtualize once they exceed 100 cards; pagination uses 50-card pages to keep keyboard navigation predictable while preserving infinite-scroll as an enhancement.
- Morale and energy scales both span 0–100: morale renders green ≥75, yellow 50–74, red <50; energy below 20 shows a lightning icon labelled "Overtime risk" with tooltips describing impact on task claiming utility.

### Event Log & Ancillary Panels

- `EventLog` sits at the footer, rendering `EventLogItem[]` with severity color coding to echo recent `sim.*`, `world.*`, `hr.*`, and `finance.*` events.【F:docs/ui/ui-components-desciption.md†L225-L360】
- `ToastContainer` anchors notifications in the top-right, with `Toast` entries styled by type (`success`, `error`, etc.) and optional auto-dismiss for non-error states.【F:docs/ui/ui-components-desciption.md†L95-L220】
- Footer event log retains the latest 200 entries, dropping oldest first; the toast queue renders at most three concurrent toasts, keeping errors sticky until dismissed while other severities auto-dismiss after 4 s.

## UI Elements & Patterns

### Screenshot Reference Map

| Screenshot                                          | View Context                                                            | Primary Components                                                                                                                                                                                       | Interaction Focus                                                                                                    |
| --------------------------------------------------- | ----------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| `01-welcome-screen.png`                             | Initial landing screen introducing simulation entry actions.            | `StartScreen` renders New/Quick/Import CTAs while `App.tsx` remains in `startScreen` state.【F:docs/ui/ui-components-desciption.md†L393-L420】                                                           | Launch points for `newGame`, `load`, and `importState` lifecycle flows.【F:docs/ui/ui_interactions_spec.md†L13-L23】 |
| `02-modal-new_game.png`                             | New game setup modal capturing company metadata and deterministic seed. | `NewGameModal` inside shared `Modal` shell with `FormInput` and `PrimaryButton` controls.【F:docs/ui/ui-components-desciption.md†L123-L178】【F:docs/ui/ui-components-desciption.md†L347-L353】          | Confirms start-of-run workflow before dispatching `facade.newGame`.【F:docs/ui/ui_interactions_spec.md†L13-L23】     |
| `03-structure-overview.png`                         | Portfolio overview of rented structures displayed as cards.             | `DashboardView` cards with `InlineEdit` and `ActionIcons` for rename/duplicate.【F:docs/ui/ui-components-desciption.md†L95-L165】【F:docs/ui/ui-components-desciption.md†L483-L487】                     | Supports rent/duplicate/drill-down navigation in the macro loop.【F:docs/ui/ui_interactions_spec.md†L27-L37】        |
| `04-personell-overview-(job-market).png`            | Personnel screen focusing on external candidates.                       | `PersonnelView` job-market tab listing `CandidateCard`s with hire modals.【F:docs/ui/ui-components-desciption.md†L333-L337】【F:docs/ui/ui-components-desciption.md†L504-L509】                          | Drives hiring and candidate refresh intents.【F:docs/ui/ui_interactions_spec.md†L58-L61】                            |
| `05-personell-overview-(my-employees).png`          | Personnel screen showing internal staff roster.                         | `PersonnelView` staff tab with `EmployeeCard`s exposing fire/assignment controls.【F:docs/ui/ui-components-desciption.md†L504-L509】                                                                     | Manages firing and reassignment per workforce spec.【F:docs/ui/ui_interactions_spec.md†L60-L65】                     |
| `06-finances-overview-(cards_closed).png`           | Finance dashboard with collapsed summaries.                             | `FinanceView` stacking KPI `StatCard`s above collapsible categories.【F:docs/ui/ui-components-desciption.md†L182-L193】【F:docs/ui/ui-components-desciption.md†L490-L500】                               | Provides at-a-glance CapEx/OpEx metrics.【F:docs/ui/ui_interactions_spec.md†L69-L73】                                |
| `07-finances-overview-(cards_opened).png`           | Finance dashboard with expanded detail panels.                          | Same `FinanceView` sections with expanded breakdowns.【F:docs/ui/ui-components-desciption.md†L490-L500】                                                                                                 | Supports deeper inspection of financial reports.【F:docs/ui/ui_interactions_spec.md†L69-L73】                        |
| `08-model-game_menu.png`                            | Game-level menu triggered from dashboard header.                        | `GameMenuModal` rendered by shared modal chassis.【F:docs/ui/ui-components-desciption.md†L167-L178】【F:docs/ui/ui-components-desciption.md†L323-L329】                                                  | Accesses Save/Load/Export/Reset lifecycle commands.【F:docs/ui/ui_interactions_spec.md†L18-L23】                     |
| `09-structure-detailview.png`                       | Detail page for a single structure with nested rooms/zones.             | `StructureDetailView` lists rooms via `ZoneCard` summaries and inline actions.【F:docs/ui/ui-components-desciption.md†L413-L420】【F:docs/ui/ui-components-desciption.md†L521-L525】                     | Enables room-level CRUD and duplicate flows.【F:docs/ui/ui_interactions_spec.md†L27-L36】                            |
| `10-room-overview-(growroom).png`                   | Room detail focusing on grow zones.                                     | `RoomDetailView` showing `ZoneCard`s with rename/duplicate controls.【F:docs/ui/ui-components-desciption.md†L407-L420】【F:docs/ui/ui-components-desciption.md†L513-L517】                               | Supports zone creation and duplication in macro management loop.【F:docs/ui/ui_interactions_spec.md†L31-L36】        |
| `11-zone-detailview-(setup-closed).png`             | Zone management view with environment panel collapsed.                  | `ZoneDetailView` with collapsed `EnvironmentPanel` summarizing KPIs alongside device/plant panels.【F:docs/ui/ui-components-desciption.md†L407-L417】【F:docs/ui/ui-components-desciption.md†L529-L533】 | Anchors climate monitoring and device status for cultivation loop.【F:docs/ui/ui_interactions_spec.md†L40-L50】      |
| `12-zone-detailview-(setup-opened).png`             | Zone management view with environment controls expanded.                | Expanded `EnvironmentPanel` plus adjacent `ZoneDeviceList` for equipment actions.【F:docs/ui/ui-components-desciption.md†L412-L429】                                                                     | Demonstrates runtime setpoint adjustments and device management.【F:docs/ui/ui_interactions_spec.md†L40-L48】        |
| `13-zone-detailview-(mass-selection-activated).png` | Zone plant grid in batch-selection mode.                                | `ZonePlantPanel` with `BatchActionBar` for multi-plant operations.【F:docs/ui/ui-components-desciption.md†L451-L462】                                                                                    | Executes Harvest/Trash/Treat batch actions and automation toggles.【F:docs/ui/ui_interactions_spec.md†L45-L54】      |

### Design-System Primitives

- **Buttons & IconButtons** replace ad-hoc CSS, covering primary/secondary, danger, link styles, and active states via props such as `variant`, `tone`, `size`, `isActive`.【F:docs/ui/ui_elements.md†L5-L24】
- **Form fields** (`FormInput`, `FormSelect`, `FormCheckbox`, `RangeInput`) encapsulate Tailwind styling and are composed via `FormField` and modal forms.【F:docs/ui/ui_elements.md†L5-L24】【F:docs/ui/ui-components-desciption.md†L95-L193】
- **InlineEdit** toggles between display and input modes with confirm/cancel interactions to support in-place renaming of structures, rooms, and zones.【F:docs/ui/ui_elements.md†L5-L24】【F:docs/ui/ui-components-desciption.md†L95-L140】
- **Modal shell** supplies overlay, title bar, close button, and content area while pausing the sim and restoring prior state on close.【F:docs/ui/ui-implementation-spec.md†L96-L152】【F:docs/ui/ui-components-desciption.md†L123-L193】

### Generic Components

- **ActionIcons** group Duplicate and Delete buttons for consistent placement; require `onDuplicate`/`onDelete` callbacks and optional `className`. Icons: `DuplicateIcon`, `DeleteIcon`.【F:docs/ui/ui-components-desciption.md†L95-L120】
- **Breadcrumbs** accept `BreadcrumbItem[]` and `onNavigate` to display hierarchical trail with `ChevronRightIcon`.【F:docs/ui/ui-components-desciption.md†L95-L140】
- **Buttons** supply Tailwind-styled `PrimaryButton` and `DangerButton` variants with disabled states.【F:docs/ui/ui-components-desciption.md†L95-L140】
- **Form components** standardize labeled inputs/selects/checkboxes across modals.【F:docs/ui/ui-components-desciption.md†L95-L167】
- **Icons** centralize Google Material icon wrappers, allowing consistent styling via optional `className`.【F:docs/ui/ui-components-desciption.md†L140-L150】
- **InlineEdit** (detailed above) listens for Enter/Escape/blur to commit or cancel edits.【F:docs/ui/ui-components-desciption.md†L140-L165】
- **Modal** component handles overlay, header, and children, using `XIcon` for close affordance.【F:docs/ui/ui-components-desciption.md†L165-L178】
- **StatCard** shows icon, title, value, optional unit, color; reused in header and finance view.【F:docs/ui/ui-components-desciption.md†L178-L193】
- **Toast/ToastContainer** render notifications with icons (`XIcon`, `CheckIcon`, `error`, `warning`, `info`), auto-dismiss for non-error types, and rely on `useToast` context.【F:docs/ui/ui-components-desciption.md†L193-L220】

### Layout Components

- **DashboardHeader** hosts controls, nav links, stats, and game menu (icons: `ClockIcon`, `DollarIcon`, `PauseIcon`, `PlayIcon`, `HomeIcon`, `BadgeIcon`, `CogIcon`, `paid`).【F:docs/ui/ui-components-desciption.md†L225-L260】
- **EventLog** displays `EventLogItem[]` with severity colors at the footer.【F:docs/ui/ui-components-desciption.md†L260-L280】
- **MainContent** routes based on selection state and renders breadcrumbs; passes data/callbacks to active view.【F:docs/ui/ui-components-desciption.md†L280-L313】
- **Sidebar** lists structures/rooms/zones with toggle icons (`ChevronDownIcon`, `PlusIcon`) and CTA integration for modal flows.【F:docs/ui/ui-components-desciption.md†L313-L360】

### Modal Components

- **AddDeviceModal**: install device form using `FormSelect`, `FormInput`, `PrimaryButton` for zone context.【F:docs/ui/ui-components-desciption.md†L360-L420】
- **CreateRoomModal**: collects name, purpose, area, height; enforces geometry; uses `useZoneStore.createRoom`; tested via `ModalHost`.【F:docs/ui/ui-components-desciption.md†L360-L420】
- **CreateZoneModal**: allocates footprint, selects method, optional plant count; dispatches `world.createZone`; validated in tests.【F:docs/ui/ui-components-desciption.md†L360-L420】
- **DuplicateStructureModal/DuplicateRoomModal/DuplicateZoneModal**: review footprint, device counts, names before cloning via respective intents; confirm actions handled through zone store helpers and regression tests.【F:docs/ui/ui-components-desciption.md†L360-L460】
- **GameMenuModal**: lists Save/Load/Reset options (currently placeholder); launched from header cog.【F:docs/ui/ui-components-desciption.md†L323-L337】
- **HireEmployeeModal**: assign structure on hire using dropdown; relies on `FormSelect` and `PrimaryButton`.【F:docs/ui/ui-components-desciption.md†L360-L440】
- **InfoModal**: surfaces pest/disease blueprint details (symptoms, controls).【F:docs/ui/ui-components-desciption.md†L440-L451】
- **NewGameModal**: collects company/CEO name and deterministic seed; uses `FormInput` + `PrimaryButton`.【F:docs/ui/ui-components-desciption.md†L333-L347】
- **PlantDetailModal**: shows plant stats with harvest/trash actions using `CutIcon` and `TrashIcon`; harvest disabled until ready.【F:docs/ui/ui-components-desciption.md†L440-L462】
- **PlantStrainModal**: plants new strain; populates options from snapshot; uses forms primitives.【F:docs/ui/ui-components-desciption.md†L440-L462】
- **InstallDeviceModal/UpdateDeviceModal/MoveDeviceModal**: manage device lifecycle (install JSON validation, patch existing settings, relocate hardware) through zone-store helpers and `SimulationFacade` intents.【F:docs/ui/ui-components-desciption.md†L440-L533】
- **Device removal confirmation**: reuses confirmation modal to call `devices.removeDevice` via zone store helper.【F:docs/ui/ui-components-desciption.md†L440-L533】
- **RentStructureModal**: rents new structure with affordability gating; uses forms primitives.【F:docs/ui/ui-components-desciption.md†L533-L540】
- **Duplicate flows** described above require inline cost previews and compliance with `allowedRoomPurposes` for devices.【F:docs/ui/ui-components-desciption.md†L360-L533】【F:docs/ui/ui_interactions_spec.md†L27-L54】 Cost tooltips break totals into Rooms, Zones, Devices (count × individual CapEx via `devicePrices.json`), Setup (method/container/substrate sourced from `cultivationMethodPrices.json` + `consumablePrices.json`), and Other, summing capital and setup costs while reminding players that maintenance remains separate.

### Simulation Components

- **EnvironmentPanel**: collapsed summary vs. expanded controls for temperature, humidity, CO₂ sliders, lighting toggles/cycle; disables controls when devices missing; displays VPD as derived metric.【F:docs/ui/ui-components-desciption.md†L407-L462】
- **ZoneCard**: compact zone summary with navigation click and `ActionIcons`; includes progress bars for plant growth.【F:docs/ui/ui-components-desciption.md†L420-L440】
- **ZoneDeviceList**: groups devices by name, aggregates counts, exposes install/update/move/remove actions; draws from zone store helpers.【F:docs/ui/ui-components-desciption.md†L421-L533】
- **ZonePlantPanel**: grid of plants with inspection mode (tooltips, direct actions) and selection mode enabling `BatchActionBar` for Harvest/Trash/Treat; integrates pest/disease info and automation toggles.【F:docs/ui/ui-components-desciption.md†L440-L462】

### View Components (Composition Level)

- **DashboardView**: default view listing structures; integrates InlineEdit and ActionIcons; default landing post-start.【F:docs/ui/ui-components-desciption.md†L470-L487】 Structure cards sort by most recently used (descending) with name (ascending) as fallback, persisting any user override in local storage or URL params so ordering remains stable across sessions.
- **FinanceView**: detailed financial breakdown with collapsible cards and timeframe filter; uses `StatCard` icons (`trending_up`, `receipt_long`, `account_balance`).【F:docs/ui/ui-components-desciption.md†L470-L509】
- **PersonnelView**: tabbed candidate/staff management with hire/fire actions and icon usage (e.g., `DeleteIcon`).【F:docs/ui/ui-components-desciption.md†L504-L509】
- **RoomDetailView** and **StructureDetailView**: compose zone cards, InlineEdit, and ActionIcons to manage nested rooms/zones.【F:docs/ui/ui-components-desciption.md†L513-L525】
- **ZoneDetailView**: orchestrates EnvironmentPanel, ZonePlantPanel, ZoneDeviceList, and device lifecycle CTAs with modals and zone store helpers.【F:docs/ui/ui-components-desciption.md†L407-L533】

### Context Providers

- **ToastContext/ToastProvider** exposes `addToast` for success/error notifications while `ToastContainer` renders them; follows producer/consumer pattern to decouple triggers from presentation.【F:docs/ui/ui-components-desciption.md†L509-L533】

### Contract Type Definitions

```ts
export type UUID = string;

export interface Selection {
  currentView: 'dashboard' | 'structure' | 'room' | 'zone' | 'finances' | 'personnel';
  selectedStructureId?: UUID;
  selectedRoomId?: UUID;
  selectedZoneId?: UUID;
}

export interface StructureSummary {
  id: UUID;
  name: string;
  area_m2: number | null;
  roomCount: number;
  plantCount: number;
}

export interface ZoneKpis {
  area_m2: number;
  methodId?: UUID;
  plantCount: number;
  env: {
    temperature_C?: number;
    relativeHumidity?: number;
    co2_ppm?: number;
    vpd_kPa?: number;
    ppfd?: number;
  };
  coverageRatio?: number;
}

export interface ZoneSummary {
  id: UUID;
  name: string;
  kpis: ZoneKpis;
  deviceGroups: Array<{
    kind: string;
    count: number;
    status: 'on' | 'off' | 'mixed' | 'broken';
  }>;
}

export interface EventLogItem {
  id: UUID;
  ts: number;
  severity: 'info' | 'success' | 'warning' | 'error';
  type: string;
  entityId?: UUID;
  message: string;
}

export interface OnNavigatePayload {
  target: 'dashboard' | 'structure' | 'room' | 'zone' | 'finances' | 'personnel';
  id?: UUID;
}

export interface OnPlantActionPayload {
  zoneId: UUID;
  action: 'harvest' | 'trash' | 'treat' | 'plant';
  plantIds?: UUID[];
  strainId?: UUID;
  quantity?: number;
}

export interface OnBatchActionPayload {
  zoneId: UUID;
  plantIds: UUID[];
  action: 'harvest' | 'trash' | 'treat';
}

export interface OnUpdatePayload {
  entity: 'zoneSetpoint' | 'deviceGroup' | 'inlineName';
  zoneId?: UUID;
  metric?: 'temperature' | 'relativeHumidity' | 'vpd' | 'co2' | 'ppfd';
  value?: number;
  kind?: string;
  toggle?: 'on' | 'off';
  targetId?: UUID;
  name?: string;
}
```

These interfaces mirror the façade intent contract and reinforce the intent-only, snapshot-read-only boundary.

### State Management & Backend Integration

- A lightweight Zustand store (`useGameStore`) is the single source of truth for connection status, latest snapshot, last tick, and event buffer. `connect(url)` instantiates a Socket.IO client (websocket transport), updates `connected` flags on connect/disconnect, and wires listeners for `simulationSnapshot` (full state) and `simulationUpdate` (diff + events) while capping the event buffer to the most recent 200 entries. The socket instance is exposed on `window.__wb_socket` for debugging.
- `disconnect()` delegates to the underlying socket disconnect, and `sendIntent(domain, action, payload?)` emits `facade.intent` over the socket, returning a promise that resolves with the façade response so callers can await `{ ok, warnings?, errors? }` without optimistic UI.
- Components use selectors to read the store, memoizing derived data (e.g., `selectSnapshot`, `selectEvents`) to avoid unnecessary renders; bridge hooks wrap `useGameStore` to expose typed façade commands to views.
- App bootstrap calls `useGameStore.getState().connect(SOCKET_URL)` on mount and ensures cleanup on unmount. Intent dispatchers always disable their originating controls and show `… applying` copy until the promise settles, matching the deterministic façade loop.

### Styling & Responsiveness Guardrails

- Tailwind spacing adheres to a 4 px baseline: `space-1 = 4px`, `space-2 = 8px`, `space-3 = 12px`, `space-4 = 16px`, `space-6 = 24px`, `space-8 = 32px`, `space-10 = 40px`, `space-12 = 48px`. Vertical rhythm guidelines: section headers `mt-8`, card title-to-body `mt-4`, form rows `gap-3`, dense lists `gap-2`.
- Card padding defaults to `px-6 py-5` on desktop and `px-4 py-4` on mobile; column layouts prefer `gap-4` with `gap-6` reserved for room/zone detail two-column layouts. Inline forms use `gap-3` with `min-w-[220px]` fields to maintain alignment.
- Icon sizing is standardized: 24 px for header controls, 20 px for card action clusters, 18 px for table/list rows, and 10 px for status dots. Hover affordances adjust opacity only—no scaling to prevent layout shift.

### Resilience Patterns

- Validation warnings returned from intents render as persistent inline banners within the originating modal, referencing `payload.path` when present. Hard errors (`level: error`) trigger sticky red toasts and log entries including `entityId` (if provided).
- Empty states ship bespoke illustrations and CTAs: zones without devices prompt “Install device,” plant-less zones show “Plant” plus “Configure Auto-Replant,” and finance panels render an em dash (`—`) with tooltip “No data in range.”
- Network resilience uses exponential backoff up to 30 s while reconnecting; the header shows a “Reconnecting…” badge and, upon reconnect, the client requests a fresh `simulationSnapshot`.
- Concurrency handling disables the initiating control while an intent is in flight and trusts the façade as the authority. If competing updates adjust a record, the client discards local assumptions and re-renders from the latest snapshot—no local merges.

## Interactions

### Game Lifecycle

- Start new games via modal capturing name/seed (`facade.newGame`), load/import snapshots (`facade.load`, `facade.importState`), and reset runs after confirmation.【F:docs/ui/ui_interactions_spec.md†L13-L35】【F:docs/ui/ui-components-desciption.md†L323-L353】
- Save/export from the game menu dispatches `facade.save()` and `facade.exportState()`; loading or deleting slots routes through the same menu flows.【F:docs/ui/ui_interactions_spec.md†L18-L35】
- Play/pause/step/fast-forward controls issue `simulationControl` intents (`play|pause|step|fastForward`, `setSetpoint`) through `useGameStore` and bridge hooks; tick length is fixed by the backend and never user-adjustable in the UI.【F:docs/ui/ui-implementation-spec.md†L260-L380】【F:docs/ui/ui-components-desciption.md†L225-L260】

### Infrastructure & Navigation

- Rent structures (`facade.world.rentStructure`), create rooms (`createRoom`), create zones (`createZone`), and duplicate structures/rooms/zones via dedicated intents that replicate geometry, cultivation methods, automation, and eligible devices (costed per blueprint).【F:docs/ui/ui_interactions_spec.md†L27-L54】【F:docs/ui/ui-implementation-spec.md†L260-L340】
- Rename/delete flows rely on inline edit (rooms/zones) or modals (structures) to dispatch updates and confirmations.【F:docs/ui/ui-implementation-spec.md†L120-L260】【F:docs/ui/ui-components-desciption.md†L407-L533】
- Breadcrumbs and sidebar navigation trigger `goTo`/`selectEntity` to update selection state without duplicating routing logic.【F:docs/ui/ui_archictecture.md†L75-L140】

### Cultivation & Zone Management

- Install devices (`facade.devices.installDevice`) with placement checks against `allowedRoomPurposes`, update device settings (`updateDevice`), move devices between zones (`moveDevice`), toggle groups, and remove devices via confirmation flows.【F:docs/ui/ui_interactions_spec.md†L40-L54】【F:docs/ui/ui-components-desciption.md†L421-L533】
- Apply irrigation (`facade.plants.applyIrrigation`) and fertilizer (`facade.plants.applyFertilizer`) from supplies card actions; add supplies triggers shared modal flows.【F:docs/ui/ui_interactions_spec.md†L40-L54】【F:docs/ui/ui-implementation-spec.md†L240-L320】
- Plant strains (`facade.plants.addPlanting`), harvest individual plants or groups (`facade.plants.harvestPlanting`), delete plantings, and manage automation via Planting Plan (create/edit/delete/toggle Auto-Replant).【F:docs/ui/ui_interactions_spec.md†L40-L54】【F:docs/ui/ui-implementation-spec.md†L260-L360】
- Zone navigation arrows allow stepping between sibling zones with wrap-around enabled at list boundaries; keyboard shortcuts mirror the behavior (Left/Right arrows) for quick cycling.【F:docs/ui/ui-implementation-spec.md†L220-L320】

### Environment & Telemetry Control

- EnvironmentPanel adjustments send zone setpoints (`temperature`, `relativeHumidity`, `vpd`, `co2`, `ppfd`) via `config.update` while reflecting backend clamp warnings and `env.setpointUpdated` events.【F:docs/ui/ui-implementation-spec.md†L260-L360】【F:docs/ui/ui-components-desciption.md†L407-L462】
- Lighting cards display coverage sufficiency using `.lighting-ok` and `.lighting-insufficient` classes and allow editing light cycles through modals (`schedule`).【F:docs/ui/ui-implementation-spec.md†L240-L360】
- Device status indicators (`status-on/off/mixed/broken`) toggle whole groups and open tuning modals using `tune`.【F:docs/ui/ui-implementation-spec.md†L260-L360】
- Zone layout editing supports drag-and-drop drawing/snapping of rectangles in 0.5 m increments (minimum 1.0 m × 1.0 m). Dropping proposals emits `world.createZone` or `world.resizeZone`, with the façade clamping invalid placements and returning adjustments via toast copy “Adjusted to valid placement.” Device tiles optionally support drag-and-drop within a zone to trigger ghost placement and `devices.moveDevice`; dropping confirms via façade intent. Plant management remains modal/batch-action only—no drag-and-drop to avoid complexity.

### Personnel & Finance

- Refresh candidates (`facade.workforce.refreshCandidates`), hire (`facade.workforce.hire`), assign structures, negotiate raises, and fire employees (`facade.workforce.fire`) via modal workflows; overtime policy adjustments use `setOvertimePolicy`.【F:docs/ui/ui_interactions_spec.md†L58-L73】【F:docs/ui/ui-components-desciption.md†L333-L337】
- Financial interactions include selling inventory lots (`facade.finance.sellInventory`), adjusting utility prices, and maintenance policy updates via façade commands surfaced in the finance view or modal dialogs.【F:docs/ui/ui_interactions_spec.md†L69-L88】

### Modals & Focus Management

- Modal controller tracks `wasRunningBeforeModal`; opening a modal pauses the simulation and blurs background content; closing resumes if previously running. Overlay clicks do not close modals—only explicit buttons (Cancel/Save/etc.).【F:docs/ui/ui-implementation-spec.md†L96-L152】
- Shared modal styles enforce dark overlay, bordered content, max width 720 px (or 92 vw), and rely on Tailwind for structure; focus remains trapped inside until closure.【F:docs/ui/ui-implementation-spec.md†L96-L152】
- Only one modal may be active at a time; additional modal requests queue FIFO and open once the active modal closes. The controller stores `wasRunningBeforeModal` only for the first modal and restores the prior simulation state after the last modal exits.

## States & Telemetry

- The Bridge Hook (`useGameState` analogue) is the single gateway to subscribe to snapshots and events (`sim.ready`, `sim.tickCompleted`, `sim.paused`, `sim.hotReloaded`) while memoizing command callbacks to prevent unnecessary re-renders.【F:docs/ui/ui_archictecture.md†L75-L120】
- Application orchestrator requests the initial snapshot (waiting for `sim.ready`), provides navigation, modal, and theme context, and feeds snapshots plus command callbacks down the tree.【F:docs/ui/ui_archictecture.md†L75-L120】
- Unidirectional flow ensures snapshots are read-only: render snapshot → dispatch facade intent → engine validates/applies → commit emits new snapshot and events → subscribers re-render.【F:docs/ui/ui_archictecture.md†L16-L74】
- Read models should remain lean; selectors derive subsets such as zone KPIs, device summaries, and cost aggregates for views to minimize diff surfaces.【F:docs/ui/ui_archictecture.md†L140-L180】
- Event consumption drives toasts, banners, and local updates across simulation (`sim.tickCompleted`, `sim.paused/resumed`, `sim.hotReloaded/reloadFailed`), world (`world.structureRented`, `world.roomCreated`, `world.zoneCreated`, `world.deviceInstalled`), plants (`plant.stageChanged`, `plant.harvested`, `pest.detected`, `treatment.applied`), HR/tasks (`task.created/claimed/completed`, `hr.hired/fired`, `hr.overtimeAccrued`), and finance (`finance.capex/opex`, `finance.saleCompleted`) channels.【F:docs/ui/ui_archictecture.md†L140-L200】
- Event payloads carry minimal fields + UUIDs; the UI resolves details via the latest snapshot, never from event payload alone.【F:docs/ui/ui_archictecture.md†L140-L200】
- Toast provider/context decouples producers from the UI, allowing components to emit notifications while `ToastContainer` renders them; event log component retains recent events for quick scanning.【F:docs/ui/ui-components-desciption.md†L193-L360】
- Modal controller pauses simulation state, storing `wasRunningBeforeModal` to resume after closing, which is critical for deterministic telemetry history.【F:docs/ui/ui-implementation-spec.md†L96-L152】
- Initial connection displays a full-screen skeleton (header bar, three stat cards, two-column placeholder) until the first snapshot arrives; long-running intents show inline button spinners with copy "… applying" beside the action.
- Facade responses surface validation warnings as persistent yellow banners inside the originating modal, while hard `ERR_*` failures trigger red toasts and Event Log entries including the failing `payload.path`.
- Telemetry retention follows three rings: per-tick series keep the last 15 minutes of real time, per-hour aggregates store the last seven in-game days, and per-day aggregates persist the last 90 in-game days. Keep total rendered points per series ≤ 5 000.
- Downsampling occurs on every `sim.tickCompleted`, rolling per-tick data into hourly buckets (avg/min/max) and promoting to daily aggregates as ranges grow. Charts automatically switch to hourly/daily series when the visible range exceeds one day to guard performance.

## Accessibility & Performance

- All actionable elements must be keyboard focusable; modals trap focus and restore it on close while using `role="dialog"` and descriptive labels for icons to meet WCAG AA contrast requirements.【F:docs/ui/ui-implementation-spec.md†L360-L420】
- Avoid conveying information through color alone—pair icons or labels with status hues (e.g., lighting coverage, device states).【F:docs/ui/ui-implementation-spec.md†L240-L360】
- Toasts, notifications, and badges should provide accessible text alternatives when icon-only controls are present (e.g., header icons).【F:docs/ui/ui-implementation-spec.md†L37-L142】
- Virtualize large lists (zones, tasks, employees) and memoize selectors to limit re-render scope; throttle chart updates and downsample telemetry where necessary.【F:docs/ui/ui_archictecture.md†L140-L200】【F:docs/ui/ui_interactions_spec.md†L88-L120】
- Use responsive layouts (column collapse below 900 px, grid auto-fill) and ensure controls wrap gracefully without overlap.【F:docs/ui/ui-implementation-spec.md†L160-L220】
- Avoid optimistic UI; wait for facade ACK or events before updating to maintain deterministic order.【F:docs/ui/ui_interactions_spec.md†L120-L150】
- Keyboard shortcuts: Space toggles Play/Pause (announced via SR-only live region), `ö`/`ä` adjust speed down/up, `g`/`f`/`p`/`s` jump to Dashboard/Finances/Personnel/Structures, and Left/Right arrows cycle zones with wrap-around.
- Provide a global ARIA live region (`role="status" aria-live="polite"`) that announces simulation pause/resume, throttled tick completions (≤ 1 announcement every 5 s), and warning/error titles so screen-reader users receive timely feedback. Icon-only controls require `aria-label` + `title`, and modal roots declare `role="dialog" aria-modal="true" aria-labelledby`.
- Performance budgets: virtualize lists ≥ 100 rows, cap concurrent toasts at 3, limit chart line series to ≤ 2 000 rendered points, and throttle streaming UI updates to ≥ 250 ms. CI/dev validation includes a Jest/Vitest smoke test rendering `FinanceView` with 5 000 rows (target ≥ 50 FPS on reference laptop) and a bridge-hook stress test pumping 1 000 `simulationUpdate` messages at 20 Hz without memory growth over 20 MB.

## Visual Guardrails

### Iconography

| Icon                | Usage                                                    |
| ------------------- | -------------------------------------------------------- |
| `play_circle`       | Start simulation.                                        |
| `pause_circle`      | Pause simulation.                                        |
| `monitoring`        | Switch to financial view.                                |
| `groups`            | Switch to personnel view.                                |
| `notifications`     | Open notifications.                                      |
| `settings`          | Open game menu (Save/Load/Export/Reset).                 |
| `edit`              | Rename structures/rooms/zones; edit planting plan.       |
| `delete`            | Delete structures/rooms/zones/devices/individual plants. |
| `delete_sweep`      | Delete an entire planting group.                         |
| `content_copy`      | Duplicate rooms or zones.                                |
| `info`              | Show strain info tooltip.                                |
| `content_cut`       | Harvest a single plant.                                  |
| `tune`              | Adjust settings for a device group (opens modal).        |
| `schedule`          | Edit light cycle for a zone (opens modal).               |
| `arrow_back_ios`    | Navigate to previous zone.                               |
| `arrow_forward_ios` | Navigate to next zone.                                   |
| `person_remove`     | Fire an employee.                                        |

### Spacing & Vertical Rhythm

- Base spacing units follow Tailwind’s 4 px grid: `space-1` (4 px), `space-2` (8 px), `space-3` (12 px), `space-4` (16 px), `space-6` (24 px), `space-8` (32 px), `space-10` (40 px), `space-12` (48 px).
- Section headers land at `mt-8` with `mb-3`, card title-to-body spacing uses `mt-4`, and vertical card stacks default to `gap-4` (upgrade to `gap-6` in two-column zone detail layouts).
- Form rows observe `gap-3`, dense lists `gap-2`, and inline form fields keep `min-w-[220px]` to align labels/inputs.
- Card padding defaults to `px-6 py-5` on desktop and `px-4 py-4` on mobile to respect touch targets without crowding.

### Icon Sizing Guidelines

| Context                    | Size  | Notes                                                       |
| -------------------------- | ----- | ----------------------------------------------------------- |
| Topbar/Header controls     | 24 px | Primary affordances (play/pause, menus); opacity hover only |
| Card action clusters       | 20 px | Inline rename/duplicate/delete icons                        |
| Table/List row leading     | 18 px | Row indicators, status glyphs                               |
| Status dots (device group) | 10 px | Filled dots for aggregated device state                     |

Maintain consistent icon weights (default Material weight) and avoid scaling on hover to prevent layout shifts; prefer opacity changes or background highlights for feedback.

### Dark Theme Tokens

- Background: `bg-stone-900`.
- Text: primary `text-stone-100/200`, secondary `text-stone-400/500`.
- Panels/cards: `bg-stone-800/30` with `border-stone-700`.
- Primary accent: `bg-lime-600`, `text-lime-400`; status colors include `text-green-400`, `text-yellow-400`, `text-red-400`, `text-blue-400`, `text-cyan-400` for success/warning/danger/info states.【F:docs/ui/ui-components-desciption.md†L551-L574】
- Typography: Inter font, headings styled via Tailwind utilities (`text-3xl font-bold`, etc.) instead of default heading tags.【F:docs/ui/ui-components-desciption.md†L551-L574】
- ### Light Theme Tokens

- Background: `#fafafa` base with cards at `#ffffff` bordered by `#e5e7eb`.
- Text: primary `#111827`, secondary `#6b7280` to mirror dark-theme contrast ratios.
- Accent: lime-600 (`#65a30d`) with hover at `#4d7c0f`; status hues reuse green/yellow/red/blue/cyan 600 shades to keep semantic parity.
- Buttons maintain AA contrast by pairing dark text with light fills and vice versa, sharing the same component tokens as the dark theme.

### Core CSS Snippets

```css
.tick-ring circle.progress {
  transition: stroke-dashoffset 0.3s linear;
}
.lighting-ok {
  color: #18a957;
}
.lighting-insufficient {
  color: #d8a400;
}
.device-status-indicator {
  width: 0.6rem;
  height: 0.6rem;
  border-radius: 50%;
}
.device-status-indicator.status-on {
  background: #19b56b;
}
.device-status-indicator.status-off {
  background: #8b8f97;
}
.device-status-indicator.status-mixed {
  background: #d8a400;
}
.device-status-indicator.status-broken {
  background: #d64545;
}
```

### Tailwind Building Blocks

```html
<div class="bg-stone-800/30 rounded-lg p-6">
  <!-- Card content -->
</div>

<button
  class="w-full bg-lime-600 hover:bg-lime-700 text-white font-semibold py-2 px-4 rounded-md transition-colors disabled:bg-stone-600 disabled:cursor-not-allowed"
>
  Action
</button>

<div>
  <label class="block text-sm font-medium text-stone-300 mb-1">Label</label>
  <input
    class="w-full bg-stone-900 border border-stone-700 rounded-md px-3 py-2 text-stone-100 focus:ring-2 focus:ring-lime-500 focus:border-lime-500 outline-none"
  />
</div>

<div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-stone-800 border border-stone-700 rounded-lg shadow-xl w-full max-w-md m-4">
    <header class="flex items-center justify-between p-4 border-b border-stone-700">
      <!-- Header content -->
    </header>
    <div class="p-6">
      <!-- Modal content -->
    </div>
  </div>
</div>
```

### Custom Scrollbar

```css
/* Custom scrollbar for a better dark-mode aesthetic */
::-webkit-scrollbar {
  width: 8px;
}
::-webkit-scrollbar-track {
  background: #1c1917; /* stone-900 */
}
::-webkit-scrollbar-thumb {
  background: #57534e; /* stone-600 */
  border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
  background: #78716c; /* stone-500 */
}
```

### Layout Reminders

- Card grids rely on `grid-template-columns: repeat(auto-fill, minmax(260px, 1fr))` with `gap: 1rem` to maintain consistent spacing across views.【F:docs/ui/ui-implementation-spec.md†L120-L200】
- Zone detail columns use `grid-template-columns: 1.2fr 1fr` with `gap: 1rem`, collapsing to one column below 900 px.【F:docs/ui/ui-implementation-spec.md†L200-L240】
- Modal overlay blur: apply `.content-area.blurred` (blur 3px, pointer-events none) to background when any modal is open.【F:docs/ui/ui-implementation-spec.md†L80-L106】
- Spacing and vertical rhythm follow the 4 px scale documented in [Styling & Responsiveness Guardrails](#styling--responsiveness-guardrails); custom CSS should align with those Tailwind utilities.
- Icon usage must adhere to the standardized sizes in [Icon Sizing Guidelines](#icon-sizing-guidelines) to keep density consistent across headers, cards, and tables.

## Glossary

- **System Facade**: Authoritative API that validates intents (`world.*`, `devices.*`, `plants.*`, `health.*`, `workforce.*`, `finance.*`, `time.*`) and emits snapshots/events for the UI; all mutations go through it.【F:docs/ui/ui_archictecture.md†L1-L140】【F:docs/ui/ui_interactions_spec.md†L13-L120】
- **Snapshot**: Read-only representation of the current game state (structures, rooms, zones, devices, plants, finance, personnel) consumed by views and selectors.【F:docs/ui/ui_archictecture.md†L16-L120】
- **Structure / Room / Zone**: Hierarchical containers forming the macro navigation path; structures hold rooms, rooms hold zones, and zones manage cultivation data/controls.【F:docs/ui/ui-implementation-spec.md†L120-L320】【F:docs/ui/ui_elements.md†L84-L220】
- **BreedingStation**: Specialized component replacing the zone grid in lab-purpose rooms to manage custom strains.【F:docs/ui/ui-implementation-spec.md†L200-L240】
- **ZonePlantPanel**: Interactive grid for plants supporting inspection mode and selection mode with batch actions.【F:docs/ui/ui-components-desciption.md†L440-L462】
- **BatchActionBar**: Toolbar appearing in ZonePlantPanel selection mode enabling Harvest/Trash/Treat operations across selected plants.【F:docs/ui/ui-components-desciption.md†L451-L462】
- **EnvironmentPanel**: Zone detail panel summarizing and controlling environmental metrics (temperature, humidity, CO₂, PPFD, VPD) with device-aware enablement logic.【F:docs/ui/ui-components-desciption.md†L407-L462】
- **Planting Plan**: Automation configuration specifying strain and quantity for auto-replant, with toggle/edit/delete flows in zone detail view.【F:docs/ui/ui-implementation-spec.md†L260-L360】
- **Device Group**: Aggregated view of devices of the same type within a zone, showing status indicator, count, and collective actions (toggle, tune, schedule).【F:docs/ui/ui-implementation-spec.md†L260-L360】
- **InlineEdit**: Component enabling in-place renaming with confirm/cancel semantics for structures, rooms, and zones.【F:docs/ui/ui-elements.md†L5-L24】【F:docs/ui/ui-components-desciption.md†L140-L165】
- **ModalHost**: Controller orchestrating modal rendering, pause/resume behavior, and tests ensuring intents dispatch correctly.【F:docs/ui/ui-components-desciption.md†L360-L420】
- **ToastProvider / ToastContainer**: Context + renderer for notifications triggered by events or intent results.【F:docs/ui/ui-components-desciption.md†L193-L220】【F:docs/ui/ui-components-desciption.md†L509-L533】
- **EventLogItem**: Entries displayed in footer event log summarizing recent domain events with severity coloring.【F:docs/ui/ui-components-desciption.md†L225-L313】
- **Auto-Replant**: Toggle within Planting Plan enabling automatic replant tasks after harvest/cleaning, based on configured strain/quantity.【F:docs/ui/ui-implementation-spec.md†L260-L360】
- **Navigation Manager**: State machine controlling `{ currentView, selectedStructureId?, selectedRoomId?, selectedZoneId? }` and exposing `goTo`, `back`, `home` helpers.【F:docs/ui/ui_archictecture.md†L75-L120】
- **Bridge Hook**: Single subscription layer connecting UI to snapshots/events and exposing memoized facade commands to components.【F:docs/ui/ui_archictecture.md†L75-L120】

## Changelog Note

Maintain this guide alongside facade, component, and screenshot updates: when new intents or components ship, extend the relevant interaction lists, screenshot map, and glossary so downstream teams stay aligned with the System Facade contract.【F:docs/ui/ui_archictecture.md†L1-L200】【F:docs/ui/ui-components-desciption.md†L393-L462】 Continue layering in type definitions, dataflow diagrams, and responsive specs as they mature, and ensure screenshot references remain current whenever the visual system or layout patterns change to keep this guide authoritative for rebuilds.【F:docs/ui/ui-components-desciption.md†L614-L688】【F:docs/ui/ui-screenshot-insights.md†L1-L64】

## Open Issues

- **Tick length control parity.** This guide and the backend contract both mandate that tick length is immutable from the client. Any remaining references to tick sliders or `time.setTickLength` in other docs must be removed so every source reflects the backend-only control.【F:docs/ui/ui-components-desciption.md†L31-L35】
- **Frontend state orchestration.** The state management section here asserts a socket-backed Zustand store as the single source of truth, with intent dispatchers merely bridging to the authoritative simulation.【F:docs/ui-building_guide.md†L366-L371】 Other documentation still suggests local UI data mutation (`App.tsx` `handle*` helpers).【F:docs/ui/ui-components-desciption.md†L76-L82】 We need to purge those outdated instructions and restate that UI code never mutates shadow copies of simulation data.
- **Workforce & finance interaction coverage.** These interaction notes document structure assignment, overtime policy updates, salary negotiations, and finance actions (selling inventory, adjusting utility/maintenance pricing) as live flows the UI must surface while remaining a dumb client that simply relays intents.【F:docs/ui/ui-building_guide.md†L416-L417】 Component tables still flag those intents as “not yet wired” and describe the finance view as read-only.【F:docs/ui/ui-components-desciption.md†L63-L69】 We must track work to wire those interactions end-to-end, keeping all simulation effects in the backend.

## Weedbreed.AI — Data Dictionary (DD) (docs/DD.md)

Source: [`docs/DD.md`](../docs/DD.md)

# Weedbreed.AI — Data Dictionary (DD)

## Conventions (apply to all files)

- **Primary key**: `id` (string, **UUID v4**). No `uuid` attribute is used anywhere.
- **Human identifiers**: `name` (display), `slug` (URL-friendly), optional; never authoritative.
- **Units** (SI, no unit suffixes in keys): RH `0–1`; temperature `°C`; power `kW`; airflow `m³/h`; PPFD `µmol·m⁻²·s⁻¹`; CO₂ `ppm`; area `m²`; volume `L`; costs/prices are currency-neutral numbers.
- **Booleans** are explicit `true/false`; no “truthy” strings.
- **Ranges**: show as inclusive unless stated otherwise.
- **Validation principles**:
- Required keys must exist with the right type.- Optional keys may be omitted; if omitted, default behavior is defined below.- Cross-references must use **`id` (UUID)**; never free text.
- **Formatting**: JSON with 2-space indentation; UTF-8; LF line endings.

---

## 1) Strains — `/data/blueprints/strains/*.json`

### Purpose

Defines cultivar genetics, physiology, environmental requirements, nutrition profile, phenology, resilience, and lineage.

### Schema (fields & meaning)

- `id: string (UUID v4)` — Primary key.
- `slug?: string` — URL-friendly slug (lowercase, `a–z0–9-`).
- `name: string` — Display name.

**Genetics & chemistry**

- `genotype?: { sativa?: number, indica?: number, ruderalis?: number }` — Fractions `0–1`; sum ≤ 1 (remainder = unspecified).
- `chemotype?: { thcContent?: number, cbdContent?: number }` — Dry matter fraction `0–1` at ideal harvest/curing.

**Resilience & traits**

- `generalResilience?: number (0–1)` — Aggregate resistance against stressors (used as a weight in stress/health models).
- `tolerances?: object` — Optional numeric tolerance multipliers by category (e.g., `temp`, `humidity`, `co2`, `underwatering`, `overnutrient`), `1.0` = neutral.
- `resistanceTraits?: object` — Optional disease/pest-specific resistances `0–1` (e.g., `"powderyMildew": 0.3`).

**Environment**

- `environment: {`
- `temperature: { optMin_C: number, optMax_C: number }` — Optimal canopy temperature.- `humidity: { optMin: number, optMax: number }` — RH `0–1`.- `co2?: { opt_ppm?: number }` — Target CO₂ concentration.- `light?: { ppfdTarget?: number }` — Target PPFD at canopy. `}` _Engine clamps deviations and converts distance to stress._

**Nutrition & water**

- `nutrients: {`
- `npkCurve: {`- `vegetative: { N: number|null, P: number|null, K: number|null },`- `flowering: { N: number|null, P: number|null, K: number|null }`- `} // Units for N/P/K: g/m²/day` `}`
- `water?: { dailyUsePerM2_L: number }` — Liters per m² per day at baseline conditions.

**Growth & morphology** _(project-specific keys allowed; examples below)_

- `morphology?: { leafAreaIndex?: number, yieldFactor?: number }`
- `growthModel?: {`
- `maxBiomassDry_g?: number` — Per plant.- `baseLUE_gPerMol?: number` — Light-use efficiency (g dry per mol photons).- `maintenanceFracPerDay?: number (0–1)` — Respiration cost.- `dryMatterFraction?: { vegetation?: number, flowering?: number }`- `harvestIndex?: { targetFlowering?: number }`- `phaseCapMultiplier?: { vegetation?: number, flowering?: number }`- `stressPenaltyCap?: number (0–1)` `}`

**Phenology & photoperiod**

- `phenology: { seedlingDays: number, vegetativeDays: number, floweringDays: number }`
- `photoperiod?: { vegHoursLight?: number, flowerHoursLight?: number }` _Defaults: if missing, engine policy may assume `18/6` veg, `12/12` flower._

**Harvest & post-harvest**

- `harvest?: { windowDays: number }` — Window around ideal ripeness.
- `postHarvest?: { storageHalfLifeDays: number }` — Quality half-life.

**Heuristics for UI/AI**

- `environmentalPreferences?: string[]` — Qualitative hints (e.g., `"highAirflow"`, `"lowNutrient"`). No direct physics effect unless mapped in rules.
- `noise?: number (0–1)` — **Breeding variability**; max fractional deviation for sampled offspring traits (e.g., `±noise × base`).

**Lineage**

- `lineage?: { parents: string[] }` — **List of parent `id` (UUID)**. If `parents` is empty or missing ⇒ **ur-plant** (foundational strain).

### Example (minimal)

```json
{
  "id": "3d6c5c0b-5b68-4c6a-8a2a-1c17f3f2a5a7",
  "slug": "ak-47",
  "name": "AK-47",
  "environment": {
    "temperature": { "optMin_C": 22, "optMax_C": 28 },
    "humidity": { "optMin": 0.45, "optMax": 0.65 },
    "light": { "ppfdTarget": 700 }
  },
  "nutrients": {
    "npkCurve": {
      "vegetative": { "N": 2.5, "P": 0.8, "K": 2.0 },
      "flowering": { "N": 1.3, "P": 1.2, "K": 2.5 }
    }
  },
  "phenology": { "seedlingDays": 10, "vegetativeDays": 28, "floweringDays": 63 },
  "lineage": { "parents": [] }
}
```

---

## 2) Devices — `/data/blueprints/devices/*.json`

### Purpose

Declares physical equipment (lights, HVAC, CO₂, dehumidifiers, fans, furniture, sensors…) with operating parameters and placement policy. **No economic fields here**.

### Schema

- `id: string (UUID v4)`
- `slug?: string`
- `name: string`
- `kind: string` — e.g., `GrowLight`, `ClimateUnit`, `Dehumidifier`, `Ventilation`, `ExhaustFan`, `CO2Injector`, `Shelf`, `Sensor`.
- `quality?: number (0–1)` — Reliability proxy.
- `complexity?: number (0–1)` — Maintenance difficulty proxy.
- `lifespanInHours?: number` — Technical lifetime horizon.
- `allowedRoomPurposes: string[]` — **Placement rule**. Defaults:
- **GrowLight, Climate/HVAC** ⇒ `["growroom"]`- Other devices ⇒ `["*"]` (allowed anywhere) unless otherwise specified.
- `settings: object` — Kind-specific parameters:

**GrowLight**

- `power?: number (kW)`
- `ppf_umol_s?: number` — Photon flux.
- `ppe_umol_J?: number` — Efficacy.
- `coverage_m2?: number` — Recommended coverage area.
- `dliTarget_mol_m2_day?: number` — Optional DLI target.

**Climate/HVAC (incl. AC, dehumidifier, ventilation/exhaust fan)**

- `power?: number (kW)`
- `coolingCapacity?: number (kW)`
- `moistureRemoval_Lph?: number` — Dehumidification rate.
- `airflow?: number (m³/h)`
- `targetTemperature?: number (°C)` — If used for thermostatic control.
- `targetTemperatureRange?: [number, number] (°C)` — Hysteresis; if missing and `targetTemperature` exists, default is `±1 °C`.
- `dutyCycle?: number (0–1)`

**CO2Injector**

- `injectionRate_ppmPerMin: number`
- `targetCO2_ppm: number`
- `maxSafeCO2_ppm: number`

### Example (Grow light)

```json
{
  "id": "e2e3b0af-f47e-4a2d-9c01-5cfc2a9ab0f6",
  "name": "Veg Light 01",
  "kind": "GrowLight",
  "allowedRoomPurposes": ["growroom"],
  "settings": { "power": 0.6, "ppf_umol_s": 1500, "ppe_umol_J": 2.5, "coverage_m2": 1.2 }
}
```

---

## 3) Cultivation Methods — `/data/blueprints/cultivationMethods/*.json`

### Purpose

Defines planting density, compatible substrate/container blueprints, setup costs, and phase suitability.

### Schema

- `id: string (UUID v4)`
- `slug?: string`
- `name: string`
- `areaPerPlant: number (m²)` — Max plant count = `floor(zoneArea / areaPerPlant)`.
- `minimumSpacing?: number (m)` — Optional geometric limit.
- `laborIntensity?: number (0–1)` — Affects labor time multipliers.
- `compatibleSubstrateTypes?: string[]` — Media categories (e.g., `"soil"`, `"coco"`) resolved against `/data/blueprints/substrates`.
- Loader cross-checks ensure each referenced type is defined and warns when no priced substrate slug exists for that type.
- `compatibleContainerTypes?: string[]` — Container categories (e.g., `"pot"`) resolved against `/data/blueprints/containers`. Loader cross-checks ensure each referenced type exists and warns when none of its slugs carry pricing.
- `compatibility?: { strainTags?: string[] }`
- `recommendedPhases?: string[]`
- `meta?: object`

> Pricing lives in `/data/prices/cultivationMethodPrices.json` (method `setupCost`) and `/data/prices/consumablePrices.json` (slug-keyed substrate entries expose `costPerLiter`, and containers use `costPerUnit`).【F:data/prices/cultivationMethodPrices.json†L1-L13】【F:data/prices/consumablePrices.json†L1-L21】

---

## 3a) Substrates — `/data/blueprints/substrates/*.json`

### Purpose

Declares reusable substrate/media options that cultivation methods can reference by slug.

Current library entries cover single-cycle soil, multi-cycle soil, and a reusable coco coir mix so designers can pick a medium aligned with their cultivation method’s reuse expectations.【F:data/blueprints/substrates/soil_single_cycle.json†L1-L7】【F:data/blueprints/substrates/soil_multi_cycle.json†L1-L7】【F:data/blueprints/substrates/coco_coir.json†L1-L7】

### Schema

- `id: string (UUID v4)`
- `slug: string` — Lowercase `a–z0–9-` slug, stable across releases.
- `kind?: string` — Defaults to `"Substrate"`.
- `name: string`
- `type: string` — Descriptive category (e.g., `"soil"`, `"coco"`, `"rockwool"`).
- `maxCycles?: number` — Number of reuse cycles before replacement.
- `meta?: { description?: string, advantages?: string[], disadvantages?: string[] }` — Optional designer notes. Advantages/disadvantages capture quick decision aids for the UI; additional keys allowed for future enrichment.

---

## 3b) Containers — `/data/blueprints/containers/*.json`

### Purpose

Captures reusable container geometries and limits referenced by cultivation methods.

### Schema

- `id: string (UUID v4)`
- `slug: string` — Lowercase `a–z0–9-` slug, stable across releases.
- `kind?: string` — Defaults to `"Container"`.
- `name: string`
- `type: string` — Container form (e.g., `"pot"`, `"tray"`).
- `volumeInLiters?: number`
- `footprintArea?: number (m²)`
- `reusableCycles?: number`
- `packingDensity?: number`
- `meta?: { description?: string, advantages?: string[], disadvantages?: string[] }` — Optional designer notes describing positioning guidance and trade-offs. Passthrough to allow future extensions.

---

## 4) Diseases — `/data/blueprints/diseases/*.json`

### Purpose

Data-driven pathogen behavior for infection/progression/damage, env & transmission risk, detection symptoms.

### Schema

- `id: string (UUID v4)`
- `slug?: string`
- `name: string`
- `kind: "Disease"`
- `pathogenType: "fungus" | "bacteria" | "virus" | "physiological"`
- `targets: string[]` — E.g., `"leaves"`, `"stems"`, `"buds"`, `"roots"`.
- `environmentalRisk?: {`
- `temperatureRange?: [number, number] (°C)`- `idealHumidityRange?: [number, number] (0–1)`- `leafWetnessRequired?: boolean`- `lowAirflowRisk?: number (0–1)`- `overwateringRisk?: number (0–1)`- `overfertilizationRisk?: number (0–1)` `}`
- `transmission?: { airborne?: boolean, contact?: boolean, tools?: boolean }`
- `model?: {`
- `dailyInfectionIncrement?: number` — Baseline infection growth/day (will be modulated by env/balancing).- `infectionThreshold?: number (0–1)` — Established infection point.- `degenerationRate?: number` — Symptom severity growth/day.- `recoveryRate?: number` — Passive recovery/day under good conditions.- `regenerationRate?: number` — Tissue repair/day if modeled separately.- `fatalityThreshold?: number (0–1)` `}`
- `detection?: { symptoms?: string[] }`

---

## 5) Pests — `/data/blueprints/pests/*.json`

### Purpose

Population models for pests, their damage mechanisms, environment preferences, and detection/monitoring hints.

### Schema

- `id: string (UUID v4)`
- `slug?: string`
- `name: string`
- `kind: "Pest"`
- `category: string` — E.g., `mites`, `sap-sucking`, `larvae`.
- `targets: string[]`
- `environmentalRisk?: { temperatureRange?: [°C,°C], humidityRange?: [0–1,0–1], lowAirflowRisk?: number, overwateringRisk?: number }`
- `populationModel?: { reproductionPerDay?: number, mortalityPerDay?: number, carryingCapacityFactor?: number }`
- `damageModel?: {`
- `photosynthesisReductionPerDay?: number (0–1)`- `rootUptakeReductionPerDay?: number (0–1)`- `budLossFractionPerDay?: number (0–1)`- `diseaseVectorRisk?: number (0–1)`- `honeydew?: boolean` `}`
- `detection?: { symptoms?: string[], monitoring?: string[] }`
- `controlOptions?: { cultural?: string[], biological?: string[], mechanical?: string[], chemical?: string[] }` _(descriptive; operational details are in treatment options)_

---

## 6) Treatment Options — `/data/configs/treatment_options.json`

### Purpose

Catalog of actionable treatments; global stacking/safety/cost rules; tick-based timing fields (engine converts from human-readable inputs if present).

### Schema

- `kind: "TreatmentOptions"`
- `version?: string`
- `notes?: string`
- `global?: {`
- `stackingRules?: {` - `maxConcurrentTreatmentsPerZone?: number` - `mechanicalAlwaysStacks?: boolean` - `chemicalAndBiologicalCantShareSameMoAWithin7Days?: boolean` - `cooldownDaysDefault?: number` `}` - `sideEffects?: { phytotoxicityRiskKeys?: string[], beneficialsHarmRiskKeys?: string[] }`- `costModel?: {` - `costBasis?: "perZone" | "perPlant" | "perSquareMeter"` — Default scaling base. - `totalCostFormula?: string` — Human description; engine computes actuals. `}` `}`
- `options: Array<{`
- `id: string (UUID v4)`- `name: string`- `category: "cultural" | "biological" | "chemical" | "mechanical" | "UV"`- `targets: Array<"disease" | "pest">`- `applicability?: string[]` — Growth phases where it’s allowed.- `materialsCost?: number` — Neutral cost per application; scaled by `costBasis`.- `laborMinutes?: number`- `energyPerHourKWh?: number`- `cooldownDays?: number`- `reentryIntervalTicks?: number` — Access restriction; engine can derive this from hours/days if present elsewhere.- `preHarvestIntervalTicks?: number` — PHI; same conversion rule.- `effects?: {` - `pest?: { reproductionMultiplier?: number, mortalityMultiplier?: number, damageMultiplier?: number }` - `disease?: { infectionMultiplier?: number, degenerationMultiplier?: number, recoveryMultiplier?: number }` `}` - `costBasis?: "perZone" | "perPlant" | "perSquareMeter"` — Overrides global default.- `notes?: string` `}>`

---

## 7) Prices — `/data/prices/*.json`

**Utilities** — `utilityPrices.json`

- `electricityCostPerKWh: number` — Default `0.30`.
- `waterCostPerM3: number` — Default `3.00`.
- `nutrientsCostPerKg: number` — Default `2.00`.

**Strains** — `strainPrices.json`

- `strainPrices: { [strainIdOrSlug: string]: {`
- `seedCost?: number` — Currency-neutral (alias for legacy `seedPrice`).- `harvestBasePricePerGram?: number` — Base sales price (alias for legacy `harvestPricePerGram`); runtime quality/market adjusters apply. `}}` _Keys MAY be UUID `id` or legacy slugs—engine should try UUID first, then slug fallback._

**Devices** — `devicePrices.json`

- `devicePrices: { [deviceIdOrSlug: string]: {`
- `capitalCost?: number` — Alias for legacy `capitalExpenditure`.- `baseMaintenanceCostPerTick?: number` — Hourly maintenance base rate (multiply by `tickLengthMinutes / 60`).- `costIncreasePer1000Ticks?: number` — Aging curve scalar. `}}`

---

## 8) Task Definitions — `/data/configs/task_definitions.json`

**Keys**: task codes (e.g., `repair_device`, `maintain_device`, `harvest_planting`, `health_scouting`, `treat_zone`, `refill_supplies_*`).

**Values** (template):

- `priority: number` — Higher = sooner.
- `requiredRole?: string` — e.g., `Gardener`, `Technician`, `IPMSpecialist`.
- `requiredSkill?: string` — Engine’s skill taxonomy (free-text name).
- `minSkillLevel?: number` — 0..n.
- `costModel?: { basis: "perAction" | "perMinute" | "perUnit", laborMinutes?: number }`
- `description?: string` — Template with placeholders, e.g., `{deviceName}`, `{zoneName}`.

---

## 9) Structures — `/data/blueprints/structures/*.json`

- `id: string (UUID v4)`
- `slug?: string`
- `name: string`
- `area_m2: number|null` — Usable floor area.
- `height_m: number|null` — Interior height (default project standard if null).
- `fixedCostsPerTick: number` — Default `0`.
- `meta?: object`

> **Normalization note:** The runtime/state field `StructureState.rentPerTick` retains its legacy
> name for save compatibility, but the value is an hourly rent base rate. Multiply by the
> current tick length in hours when booking per-tick rent so recurring costs stay consistent if the
> tick length changes.

---

## 10) Personnel Pools — `/data/personnel`

- `names/firstNamesMale.json: string[]`
- `names/firstNamesFemale.json: string[]`
- `names/lastNames.json: string[]`
- `randomSeeds.json: string[]`
- `traits.json: Array<{ id: string, name: string, description: string, type: "positive"|"negative"|string }>` _(HR roles/skills/wages can be separate or engine defaults.)_

## Enhanced Strain Blueprint System\n\nThis document describes the enhanced strain blueprint system that has been implemented to provide more realistic and detailed strain-specific environmental preferences, yield modeling, and cultivation method compatibility.\n\n## Overview\n\nThe enhanced strain system extends the basic strain blueprint with new fields that enable:\n- Phase-specific environmental preferences (seedling, veg, flower, ripening)\n- Stress tolerance modeling for environmental metrics\n- Cultivation method affinity scoring\n- Phase-specific durations for phenology\n- Advanced yield modeling with CO2 response curves\n\n## Core Components\n\n### 1. Enhanced Strain Blueprint\n\nLocation: `src/backend/src/engine/strains/enhancedStrainInterface.ts`\n\nThe enhanced strain blueprint includes these new fields:\n\n`typescript\ninterface EnhancedStrainBlueprint {\n  // ... existing fields (id, name, genetics, etc.)\n  \n  // Environmental bands per phase\n  envBands?: {\n    default: EnvBands;\n    veg?: Partial<EnvBands>;\n    flower?: Partial<EnvBands>;\n  };\n  \n  // Stress tolerance per metric\n  stressTolerance?: {\n    temp_C?: number;\n    rh_frac?: number;\n    co2_ppm?: number;\n    ppfd_umol_m2s?: number;\n    vpd_kPa?: number;\n  };\n  \n  // Method compatibility\n  methodAffinity?: Record<string, number>; // method ID -> affinity (0-1)\n  \n  // Growth phase durations\n  phaseDurations?: {\n    seedling?: number;\n    veg?: number;\n    flower?: number;\n    ripening?: number;\n  };\n  \n  // Enhanced yield model\n  yieldModel?: {\n    baseGmPerPlant?: number;\n    qualityFactors?: {\n      temp?: number;\n      rh?: number;\n      ppfd?: number;\n      vpd?: number;\n    };\n    co2Response?: {\n      halfMax_ppm: number;\n      saturation_ppm: number;\n    };\n  };\n}\n`\n\n### 2. Environmental Evaluation Service\n\nLocation: `src/backend/src/engine/strains/enhancedStrainService.ts`\n\nThe service provides methods for:\n- Evaluating zone environment against strain preferences\n- Calculating yield estimates based on environmental conditions\n- Determining cultivation method compatibility\n- Emitting environmental events for monitoring\n\n#### Key Methods:\n\n`typescript\n// Evaluate environment against strain bands\nevaluateEnvironment(\n  strain: EnhancedStrainBlueprint,\n  environment: ZoneEnvironmentState,\n  stage: PlantStage,\n  applyStressTolerance?: boolean\n): StrainEnvironmentResult\n\n// Calculate enhanced yield estimate\ncalculateYield(context: YieldCalculationContext): CalculatedYield\n\n// Get method compatibility rating\ngetMethodCompatibility(\n  strain: EnhancedStrainBlueprint,\n  methodId: string\n): MethodCompatibility\n`\n\n### 3. Plant Growth Integration\n\nLocation: `src/backend/src/engine/strains/plantGrowthIntegration.ts`\n\nIntegrates the enhanced strain evaluation with the plant growth engine:\n- Calculates health and growth multipliers based on environmental stress\n- Provides phase-aware growth rate calculations\n- Generates yield estimates and environmental tooltips for the UI\n\n### 4. Frontend UI Component\n\nLocation: `src/frontend/src/components/strain/StrainEnvironmentPanel.tsx`\n\nDisplays comprehensive strain environmental analysis including:\n- Overall stress level with color-coded indicators\n- Individual metric status (optimal, acceptable, stress, critical)\n- Yield estimates with breakdown of quality and CO2 multipliers\n- Method compatibility ratings\n- Environmental recommendations\n\n## Environmental Band System\n\n### Band Structure\n\n`typescript\ninterface EnvBand {\n  green: [number, number];    // Optimal range\n  yellowLow: number;          // Acceptable lower bound\n  yellowHigh: number;         // Acceptable upper bound\n}\n`\n\n### Phase Overrides\n\nStrains can define different environmental preferences for different growth phases:\n- **Default**: Base environmental preferences\n- **Veg**: Overrides for vegetative growth (often higher humidity, lower light)\n- **Flower**: Overrides for flowering phase (often lower humidity, higher light)\n\n### Evaluation Logic\n\n1. **Optimal (Green)**: Value falls within the green range\n2. **Acceptable (Yellow)**: Value falls between yellowLow and green[0], or between green[1] and yellowHigh\n3. **Stress (Orange)**: Value deviates moderately from acceptable range\n4. **Critical (Red)**: Value deviates severely from acceptable range\n\n### Stress Tolerance\n\nMature plants (>14 days) can apply stress tolerance, which widens the acceptable ranges:\n- Reduces yellowLow by tolerance amount\n- Increases yellowHigh by tolerance amount\n- Allows plants to better handle environmental fluctuations as they mature\n\n## Yield Modeling\n\n### Quality Factors\n\nEach environmental metric can contribute to yield quality:\n`typescript\nqualityFactors: {\n  temp: 0.3,     // Temperature contributes 30% to quality score\n  rh: 0.2,       // Humidity contributes 20%\n  ppfd: 0.4,     // Light contributes 40%\n  vpd: 0.1       // VPD contributes 10%\n}\n`\n\n### CO2 Response Curve\n\nModels diminishing returns for CO2 supplementation:\n- **halfMax_ppm**: CO2 level that gives 50% of maximum response\n- **saturation_ppm**: CO2 level beyond which no additional benefit occurs\n- Uses Michaelis-Menten kinetics for realistic CO2 response\n\n### Final Yield Calculation\n\n`\nEstimated Yield = Base Yield × Quality Multiplier × CO2 Multiplier\n`\n\n## Method Affinity System\n\n### Affinity Scores\n\nEach strain can define compatibility with cultivation methods:\n- **1.0**: Perfect compatibility\n- **0.8**: Good compatibility\n- **0.6**: Moderate compatibility\n- **0.4**: Poor compatibility\n- **0.2**: Very poor compatibility\n- **0.0**: Incompatible\n\n### Categories\n\n- **Excellent** (0.9+): Strain thrives with this method\n- **Good** (0.7-0.89): Strain performs well\n- **Neutral** (0.5-0.69): Strain is compatible but not optimal\n- **Poor** (0.3-0.49): Strain may struggle\n- **Incompatible** (<0.3): Not recommended\n\n## Example Usage\n\n### Backend Integration\n\n`typescript\n// In plant growth tick processing\nconst environmentResult = enhancedStrainService.evaluateEnvironment(\n  strain,\n  zoneEnvironment,\n  plant.stage,\n  plant.age_days > 14 // Apply stress tolerance for mature plants\n);\n\n// Calculate growth multipliers\nconst healthMultiplier = 1.0 - (environmentResult.overallStress * 0.3);\nconst growthRate = baseGrowthRate * healthMultiplier;\n\n// Emit monitoring events\nenhancedStrainService.emitEnvironmentalEvents(\n  plant.id,\n  plant.zone_id,\n  strain,\n  environmentResult,\n  currentTick,\n  eventCollector\n);\n`\n\n### Frontend Integration\n\n`tsx\n// Display strain environment analysis\n<StrainEnvironmentPanel\n  strainName=\"AK-47\"\n  environmentResult={environmentResult}\n  yieldEstimate={yieldEstimate}\n  methodCompatibility={methodCompatibility}\n  baseYield={120}\n/>\n`\n\n## Migration Path\n\n### Existing Strains\n\nStrains without enhanced fields will use fallback defaults:\n- Default environmental bands based on cannabis cultivation best practices\n- No stress tolerance (0 for all metrics)\n- No method affinity (assumes neutral compatibility)\n- Standard phase durations\n- Simple yield model without quality factors\n\n### Gradual Enhancement\n\nStrains can be enhanced incrementally:\n1. Add basic `envBands` with default values\n2. Add phase-specific overrides for `veg` and `flower`\n3. Configure `stressTolerance` based on strain resilience\n4. Define `methodAffinity` for cultivation methods\n5. Add `yieldModel` with quality factors and CO2 response\n\n## Benefits\n\n### Realism\n- Different strains now have unique environmental preferences\n- Phase-specific requirements (e.g., lower humidity in flower)\n- Realistic CO2 response curves\n- Method-specific compatibility\n\n### Gameplay\n- Strategic strain selection based on available equipment\n- Environmental optimization becomes strain-specific\n- Yield predictions become more accurate and meaningful\n- Player education about real cultivation practices\n\n### UI/UX\n- Rich environmental feedback with source attribution\n- Clear visual indicators for environmental status\n- Actionable recommendations for improvement\n- Detailed yield breakdowns showing impact of environment\n\n## Future Enhancements\n\n### Planned Features\n\n1. **Nutrient Affinity**: Strain preferences for different nutrient regimens\n2. **Training Response**: How well strains respond to LST, SCROG, etc.\n3. **Harvest Window**: Strain-specific ripening characteristics\n4. **Genetic Stability**: Phenotype variation modeling\n5. **Disease Resistance**: Environmental stress leading to pathogen susceptibility\n\n### Advanced Modeling\n\n1. **Multi-factor Interactions**: How temperature and humidity interact for VPD optimization\n2. **Seasonal Adaptation**: Strains that prefer different conditions at different times\n3. **Epigenetic Memory**: Plants \"remembering\" previous environmental stress\n4. **Breeding Integration**: Parent strain characteristics affecting offspring\n\nThis enhanced strain system provides a solid foundation for realistic, engaging, and educational cannabis cultivation simulation while maintaining backward compatibility with existing strain data. (docs/enhanced-strain-system.md)

Source: [`docs/enhanced-strain-system.md`](../docs/enhanced-strain-system.md)

# Enhanced Strain Blueprint System\n\nThis document describes the enhanced strain blueprint system that has been implemented to provide more realistic and detailed strain-specific environmental preferences, yield modeling, and cultivation method compatibility.\n\n## Overview\n\nThe enhanced strain system extends the basic strain blueprint with new fields that enable:\n- Phase-specific environmental preferences (seedling, veg, flower, ripening)\n- Stress tolerance modeling for environmental metrics\n- Cultivation method affinity scoring\n- Phase-specific durations for phenology\n- Advanced yield modeling with CO2 response curves\n\n## Core Components\n\n### 1. Enhanced Strain Blueprint\n\nLocation: `src/backend/src/engine/strains/enhancedStrainInterface.ts`\n\nThe enhanced strain blueprint includes these new fields:\n\n`typescript\ninterface EnhancedStrainBlueprint {\n  // ... existing fields (id, name, genetics, etc.)\n  \n  // Environmental bands per phase\n  envBands?: {\n    default: EnvBands;\n    veg?: Partial<EnvBands>;\n    flower?: Partial<EnvBands>;\n  };\n  \n  // Stress tolerance per metric\n  stressTolerance?: {\n    temp_C?: number;\n    rh_frac?: number;\n    co2_ppm?: number;\n    ppfd_umol_m2s?: number;\n    vpd_kPa?: number;\n  };\n  \n  // Method compatibility\n  methodAffinity?: Record<string, number>; // method ID -> affinity (0-1)\n  \n  // Growth phase durations\n  phaseDurations?: {\n    seedling?: number;\n    veg?: number;\n    flower?: number;\n    ripening?: number;\n  };\n  \n  // Enhanced yield model\n  yieldModel?: {\n    baseGmPerPlant?: number;\n    qualityFactors?: {\n      temp?: number;\n      rh?: number;\n      ppfd?: number;\n      vpd?: number;\n    };\n    co2Response?: {\n      halfMax_ppm: number;\n      saturation_ppm: number;\n    };\n  };\n}\n`\n\n### 2. Environmental Evaluation Service\n\nLocation: `src/backend/src/engine/strains/enhancedStrainService.ts`\n\nThe service provides methods for:\n- Evaluating zone environment against strain preferences\n- Calculating yield estimates based on environmental conditions\n- Determining cultivation method compatibility\n- Emitting environmental events for monitoring\n\n#### Key Methods:\n\n`typescript\n// Evaluate environment against strain bands\nevaluateEnvironment(\n  strain: EnhancedStrainBlueprint,\n  environment: ZoneEnvironmentState,\n  stage: PlantStage,\n  applyStressTolerance?: boolean\n): StrainEnvironmentResult\n\n// Calculate enhanced yield estimate\ncalculateYield(context: YieldCalculationContext): CalculatedYield\n\n// Get method compatibility rating\ngetMethodCompatibility(\n  strain: EnhancedStrainBlueprint,\n  methodId: string\n): MethodCompatibility\n`\n\n### 3. Plant Growth Integration\n\nLocation: `src/backend/src/engine/strains/plantGrowthIntegration.ts`\n\nIntegrates the enhanced strain evaluation with the plant growth engine:\n- Calculates health and growth multipliers based on environmental stress\n- Provides phase-aware growth rate calculations\n- Generates yield estimates and environmental tooltips for the UI\n\n### 4. Frontend UI Component\n\nLocation: `src/frontend/src/components/strain/StrainEnvironmentPanel.tsx`\n\nDisplays comprehensive strain environmental analysis including:\n- Overall stress level with color-coded indicators\n- Individual metric status (optimal, acceptable, stress, critical)\n- Yield estimates with breakdown of quality and CO2 multipliers\n- Method compatibility ratings\n- Environmental recommendations\n\n## Environmental Band System\n\n### Band Structure\n\n`typescript\ninterface EnvBand {\n  green: [number, number];    // Optimal range\n  yellowLow: number;          // Acceptable lower bound\n  yellowHigh: number;         // Acceptable upper bound\n}\n`\n\n### Phase Overrides\n\nStrains can define different environmental preferences for different growth phases:\n- **Default**: Base environmental preferences\n- **Veg**: Overrides for vegetative growth (often higher humidity, lower light)\n- **Flower**: Overrides for flowering phase (often lower humidity, higher light)\n\n### Evaluation Logic\n\n1. **Optimal (Green)**: Value falls within the green range\n2. **Acceptable (Yellow)**: Value falls between yellowLow and green[0], or between green[1] and yellowHigh\n3. **Stress (Orange)**: Value deviates moderately from acceptable range\n4. **Critical (Red)**: Value deviates severely from acceptable range\n\n### Stress Tolerance\n\nMature plants (>14 days) can apply stress tolerance, which widens the acceptable ranges:\n- Reduces yellowLow by tolerance amount\n- Increases yellowHigh by tolerance amount\n- Allows plants to better handle environmental fluctuations as they mature\n\n## Yield Modeling\n\n### Quality Factors\n\nEach environmental metric can contribute to yield quality:\n`typescript\nqualityFactors: {\n  temp: 0.3,     // Temperature contributes 30% to quality score\n  rh: 0.2,       // Humidity contributes 20%\n  ppfd: 0.4,     // Light contributes 40%\n  vpd: 0.1       // VPD contributes 10%\n}\n`\n\n### CO2 Response Curve\n\nModels diminishing returns for CO2 supplementation:\n- **halfMax_ppm**: CO2 level that gives 50% of maximum response\n- **saturation_ppm**: CO2 level beyond which no additional benefit occurs\n- Uses Michaelis-Menten kinetics for realistic CO2 response\n\n### Final Yield Calculation\n\n`\nEstimated Yield = Base Yield × Quality Multiplier × CO2 Multiplier\n`\n\n## Method Affinity System\n\n### Affinity Scores\n\nEach strain can define compatibility with cultivation methods:\n- **1.0**: Perfect compatibility\n- **0.8**: Good compatibility\n- **0.6**: Moderate compatibility\n- **0.4**: Poor compatibility\n- **0.2**: Very poor compatibility\n- **0.0**: Incompatible\n\n### Categories\n\n- **Excellent** (0.9+): Strain thrives with this method\n- **Good** (0.7-0.89): Strain performs well\n- **Neutral** (0.5-0.69): Strain is compatible but not optimal\n- **Poor** (0.3-0.49): Strain may struggle\n- **Incompatible** (<0.3): Not recommended\n\n## Example Usage\n\n### Backend Integration\n\n`typescript\n// In plant growth tick processing\nconst environmentResult = enhancedStrainService.evaluateEnvironment(\n  strain,\n  zoneEnvironment,\n  plant.stage,\n  plant.age_days > 14 // Apply stress tolerance for mature plants\n);\n\n// Calculate growth multipliers\nconst healthMultiplier = 1.0 - (environmentResult.overallStress * 0.3);\nconst growthRate = baseGrowthRate * healthMultiplier;\n\n// Emit monitoring events\nenhancedStrainService.emitEnvironmentalEvents(\n  plant.id,\n  plant.zone_id,\n  strain,\n  environmentResult,\n  currentTick,\n  eventCollector\n);\n`\n\n### Frontend Integration\n\n`tsx\n// Display strain environment analysis\n<StrainEnvironmentPanel\n  strainName=\"AK-47\"\n  environmentResult={environmentResult}\n  yieldEstimate={yieldEstimate}\n  methodCompatibility={methodCompatibility}\n  baseYield={120}\n/>\n`\n\n## Migration Path\n\n### Existing Strains\n\nStrains without enhanced fields will use fallback defaults:\n- Default environmental bands based on cannabis cultivation best practices\n- No stress tolerance (0 for all metrics)\n- No method affinity (assumes neutral compatibility)\n- Standard phase durations\n- Simple yield model without quality factors\n\n### Gradual Enhancement\n\nStrains can be enhanced incrementally:\n1. Add basic `envBands` with default values\n2. Add phase-specific overrides for `veg` and `flower`\n3. Configure `stressTolerance` based on strain resilience\n4. Define `methodAffinity` for cultivation methods\n5. Add `yieldModel` with quality factors and CO2 response\n\n## Benefits\n\n### Realism\n- Different strains now have unique environmental preferences\n- Phase-specific requirements (e.g., lower humidity in flower)\n- Realistic CO2 response curves\n- Method-specific compatibility\n\n### Gameplay\n- Strategic strain selection based on available equipment\n- Environmental optimization becomes strain-specific\n- Yield predictions become more accurate and meaningful\n- Player education about real cultivation practices\n\n### UI/UX\n- Rich environmental feedback with source attribution\n- Clear visual indicators for environmental status\n- Actionable recommendations for improvement\n- Detailed yield breakdowns showing impact of environment\n\n## Future Enhancements\n\n### Planned Features\n\n1. **Nutrient Affinity**: Strain preferences for different nutrient regimens\n2. **Training Response**: How well strains respond to LST, SCROG, etc.\n3. **Harvest Window**: Strain-specific ripening characteristics\n4. **Genetic Stability**: Phenotype variation modeling\n5. **Disease Resistance**: Environmental stress leading to pathogen susceptibility\n\n### Advanced Modeling\n\n1. **Multi-factor Interactions**: How temperature and humidity interact for VPD optimization\n2. **Seasonal Adaptation**: Strains that prefer different conditions at different times\n3. **Epigenetic Memory**: Plants \"remembering\" previous environmental stress\n4. **Breeding Integration**: Parent strain characteristics affecting offspring\n\nThis enhanced strain system provides a solid foundation for realistic, engaging, and educational cannabis cultivation simulation while maintaining backward compatibility with existing strain data.

## Weedbreed.AI — Vision & Scope (docs/vision_scope.md)

Source: [`docs/vision_scope.md`](../docs/vision_scope.md)

# Weedbreed.AI — Vision & Scope

---

## 1. Vision

**Elevator Pitch.** _Weed Breed_ is a modular, deterministic plant/grow simulation as a game. Players plan structures (Buildings → Rooms → Zones → Plants), control climate and devices, balance cost and yield, and experience complete cultivation cycles—from seeding to harvest and post-harvest. The system is open, extensible, and content-driven (blueprint JSONs) so that community, modders, and researchers can easily contribute content.

**Why now?** There are plenty of “tycoon” games, but few that combine **physically plausible climate & plant physiology** with **economic gameplay** and **determinism**. _Weed Breed_ fills this gap.

**Guiding Principles.**

1. **Determinism over visuals.** Reproducible runs beat visual effects.
2. **Playability over realism.** Plausible rather than strictly scientific—with explicit simplifications where needed.
3. **Open architecture.** Data/modding first, clear interfaces, stable formats.
4. **Transparency.** Visible metrics, explainable decisions (logs, audits, replays).
5. **Tight feedback loops.** Fun comes from meaningful micro-decisions in day-to-day operations.

**Non-Goals (Anti-Scope).**

- No political/regulatory simulation; legal aspects remain abstracted.
- No shooter/action mechanics.
- No exact lab-grade growth models; the focus remains “plausible & playable.”

**Experience Pillars.**

- **Planning & Optimization:** Climate, light, CO₂, device upgrades.
- **Risk Management:** Pests/diseases, resource bottlenecks, device wear.
- **Economy:** OpEx/CapEx, cash flow, break-even, price/quality.

---

## 2. Target Audiences & Stakeholders

**Primary Personas.**

- **The Optimizer** — loves spreadsheets, wants to improve KPIs (PPFD, VPD, €/g).
- **The Builder** — creates beautiful, efficient setups; enjoys upgrades & layout.
- **The Learner** — wants to understand the relationship between climate, plant, and yield.

**Stakeholders & Decision Authority (RACI-light).**

- **Product/Design:** Vision, priorities, balancing guardrails.
- **Engineering:** Architecture, quality, deterministic simulation foundation.
- **Content:** Blueprints (strains/devices/methods), data quality, sources.

**Usage Context.** Solo play, optional sandbox/editor mode. Streaming-friendly (clear visuals, readable KPIs).

---

## 3. Success Criteria

**Outcome KPIs (Goals).**

- **First Harvest Time:** First harvest in **< 30 minutes** of play (MVP default setup). _(OPEN: validate)_
- **Retention Proxy:** 70% of players reach day 7 of a sandbox save. _(OPEN: measure)_
- **Determinism Score:** Reference run (200 days) reproducible within **±0.5%** on core metrics.

**Quality Goals/SLOs.**

- **Performance:** Reference scenario (see below) runs at **1× speed** with **≥ 1 tick/s** (1 in-game day in ≤ 4.8 min at the 5 min tick default). Per-tick CPU budget ≤ **50 ms**.
- **Stability:** No sim deadlocks; crash recovery without data loss (< 1 tick).
- **Memory Target:** Reference scenario uses < **1.0 GB RAM**. _(OPEN: finalize)_

**Reference Scenario (Performance Benchmark & Balancing Baseline).**

- **Structure:** 1 medium warehouse.
- **Rooms 1:** 2 grow rooms
  - **Zones:** 5 zones with different **cultivationMethods** and **MAX** plants per zone. 10,000 L water and 100 kg nutrients.

- **Rooms 2:** 1 break room for 8 employees
  - **Zones:** none required for the break room

- **Staff:** 8 employees (at least 4× Gardener, 2× Technician, 2× Janitor).
- **Starting Capital:** 100,000,000.
- **Goal:** Fixed load profile for performance measurements (≥ 1 tick/s at 1×) and baseline for balancing passes.

---

## 4. Canonical Domain Model

**Core Entities & Relationships.**

- **Structure → Room → Zone → Plant** (hierarchical).
- **Devices** (e.g., Lamp, ClimateUnit, CO₂ Injector, Dehumidifier) are assigned to **zones**.
- **Strains** (JSON blueprints) define photoperiod, DLI/PPFD ranges, NPK/water curves, stress tolerances.
- **CultivationMethods** (e.g., SOG/SCROG) set topology, plant density, and labor requirements.
- **Pests/Diseases** as events/states with incidence probability, progression, effects & treatments.

**Lifecycles.**

- **Plant:** Seed → Vegetative → Flowering → Harvest → Post-harvest (drying/curing).
- **Device:** Efficiency degradation, maintenance, replacement triggers (OpEx vs CapEx tipping points).

**Time Scale.** Tick-based with fixed tick duration: **default tick length = 5 in-game minutes**; **12 ticks = 1 in-game hour**, **288 ticks = 1 in-game day**, **7×288 ticks = 1 in-game week**. Ticks are aggregated into day/week summaries; replays/logs reference tick IDs. _(OPEN: standard wall-clock tick duration, e.g., 1 min)_

**Glossary (Excerpt).**

- **PPFD** (µmol·m⁻²·s⁻¹), **DLI** (mol·m⁻²·d⁻¹), **VPD** (kPa), **Photoperiod**, **Stress**, **Biomass**, **Bud Yield**.

---

## 5. Simulation Philosophy

- **Realism Levels:** Climate \[plausible], growth \[semi-empirical], economy \[playfully plausible].
- **Determinism & RNG:** Global seed; all randomness is seedable; deterministic ordering.
- **Calibration:** Literature values + expert plausibility checks; golden runs as reference.
- **Balancing:** Curves/blueprint parameters; editor-assisted fine-tuning; automated smokes (daily audits).

---

## 6. Progression & Economy

**Macro Loop (Expansion/CapEx).** Rent/expand structures, purchase/replace devices, unlock methods.
**Micro Loop (Daily Ops/OpEx).** Control climate, irrigation/NPK, pest control, staffing/tasks.

**Cost Logic.**

- **CapEx:** Device purchase price, depreciation/residual value.
- **OpEx:** Energy, water, nutrients, maintenance (**increasing**), consumables.
- **Replacement Tipping Point:** If maintenance + efficiency loss > savings from upgrade → **agent proposes replacement**.

**Revenue.** Quality × quantity × market price (balancing matrix).

---

## 6a. Quality Grades & Price Functions

**Numeric Quality Concept.**

- Quality is tracked **numerically** on a **0–100** integer scale, where **70** is the market **baseline** (list price without premium/discount).
- **Device quality (blueprint field `quality`)** affects **initial durability** and **initial efficiency** of a device.

**Device Quality → Durability/Efficiency.**

- _Durability:_ `baseMTBF = spec.MTBF * (1 + (quality - 70) / 100)`
- _Efficiency:_ `baseEfficiency = spec.efficiency * (1 + (quality - 70) / 200)`
  (Both are placeholder curves and may be differentiated per device type.)

**Harvest Quality (Pseudocode).**

```pseudo
function calculateHarvestQuality(finalHealth /*0..1*/, avgStress /*0..1*/, geneticQuality /*0..100*/, methodModifier /*~0.9..1.1*/): int {
  // Normalize base components
  let healthScore   = clamp01(finalHealth)
  let stressPenalty = clamp01(avgStress)

  // Weights (sum ≈ 1.0)
  const W_HEALTH = 0.55
  const W_STRESS = 0.25
  const W_GENET  = 0.20

  // Raw quality 0..100
  let q = 100 * (
      W_HEALTH * healthScore
    + W_GENET  * (geneticQuality / 100)
    + W_STRESS * (1 - stressPenalty)
  )

  // Method (SOG/SCROG etc.) acts mildly multiplicatively
  q = q * methodModifier

  // Soft caps and clamps
  if (q > 95) q = 95 + 0.5 * (q - 95)   // flatten near maximum
  return round(clamp(q, 0, 100))
}
```

**Price Function (Non-linear, Pseudocode).**

```pseudo
function calculateSalePrice(basePrice, quality /*0..100*/): number {
  const BASELINE = 70
  const q = clamp(quality, 0, 100)

  if (q >= BASELINE) {
    // Above-average quality is rewarded disproportionately
    // Exponent > 1 amplifies the bonus
    const alpha = 1.25
    const factor = Math.pow(q / BASELINE, alpha)
    return basePrice * factor
  } else {
    // Below-average quality receives a strong discount (convex)
    const beta = 1.5
    const factor = Math.pow(q / BASELINE, beta) // 0..1
    // Additional penalty kink below 50
    const kink = (q < 50) ? 0.85 : 1.0
    return basePrice * factor * kink
  }
}
```

**Design Intent.**

- **Excellence pays off strongly** (exponential bonus), **average is neutral**, **poor quality is penalized hard**. This creates a clear incentive to optimize climate/methods/staff and device quality.

---

## 7. Automation & Agents

**Agent Roles (Examples).**

- **Auto-Replant Agent:** Trigger “zone ready” → plant seedling; priority _high_; fallback: manual task queue.
- **Harvest Scheduler:** Ripeness detection, slot planning, buffer for post-harvest capacity.
- **Climate Controller:** Keep target corridor (temp/RH/CO₂/PPFD), cost-sensitive (energy prices).
- **Maintenance Advisor:** Monitor degradation/MTBF, plan maintenance windows, recommend replacement.
- **Pest/Disease Manager:** Risk assessment, plan treatments (cost/benefit/quality impact).

**Conflict Resolution & Priorities.** Central **task arbiter** allocates slots by importance (plant protection > harvest > replant > comfort).
**Failure States.** Resource shortage → degrade mode (safe defaults); dead device → emergency shutdown & alarm.

---

## 8. Content & Data Strategy

- **v1 Scope (Targets):** \~8–12 strains, \~10–15 devices, 2–3 cultivation methods, basic pests/diseases, treatments. _(OPEN: finalize list)_
- **Sources/Licenses:** Document data provenance, attribution, OSS-friendly licenses.
- **Modding/Editors:** JSON formats stable (SemVer); in-game editors for strains/devices/methods planned.

---

## 9. UX & Presentation Vision (Technology-Agnostic)

- **Key Screens:** Start (New/Load/Import), Dashboard (time/tick, energy/water/€), Structure Explorer (Structure → Room → Zone → Plant), detail pane with KPIs & stress breakdown, Shop/Research, Logs/Audits.
- **Information Hierarchy:** Top: tick/time, daily costs, energy/water, balance; middle: active zone/plant KPIs; bottom: events/tasks.
- **Accessibility:** Strict SI units, clear tooltips, color-vision-friendly palettes, scalable typography.

---

## 10. Persistence & Compatibility

- **Save/Load Promise:** Forward migrations with schema versions (SemVer), migration scripts; crash-safe saves.
- **Export/Replay:** JSONL logs per day/harvest; deterministic replays from seed + input stream.

---

## 11. Telemetry, Validation & Tests

- **Sim Audits:** Daily summaries (biomass, water, NPK, energy, costs, stress), harvest summaries (yield, quality, €/g).
- **Deterministic Test Runs:** Reference seeds (e.g., `WB_SEED=golden-200d`), golden files, tolerances.
- **Observability:** Event bus probes, tick latency, dropped tasks, OOM guard.

---

## 12. Non-Functional Requirements (NFR)

- **Performance:** Target ticks/s per reference scenario (see §3); linear scaling per zone/plant with upper bounds.
- **Robustness:** Safe defaults on parameter errors; validate all blueprints at load time (schema).
- **Security/Privacy:** Local saves by default; no personal data.
- **Internationalization:** Languages DE/EN, SI units; configurable decimal/date formats.

---

## 13. Legal & Ethics

- **Portrayal:** Neutral, factual representation; no glorification; respect age ratings.
- **Open-Source Strategy:** License model (e.g., AGPL/Polyform?); contributions via PR policy, CLA. _(OPEN: decide)_

---

## 14. Roadmap & Release Criteria

**Milestones.**

1. **MVP:** One structure, basic climate control, 1–2 strains, 1 method, basic economy, save/load, deterministic 30-day run.
2. **Alpha:** Pests/diseases + treatments, device degradation/maintenance, shop/research loop, editor v1.
3. **Beta:** Balancing pass, golden runs (200 days), stability SLOs met, localization EN/DE.
4. **1.0:** Content polish, modding docs, replay exporter, performance tuning.

**Definition of Done (MVP).**

- First harvest < 30 min in the default scenario.
- Reproducible reference run (±0.5%).
- Schema versioning & migrations present.
- Crash-safe saves & restart.

---

## 15. Risks & Assumptions

**Top Risks.**

- **Balancing complexity:** Multiplicative effects from climate × strain × devices.
- **Agent standoffs:** “No one feels responsible” → deadlocks.
- **Data quality:** Incomplete/inconsistent blueprints.

**Mitigations.**

- Strict audit metrics, phased system enablement (feature flags).
- Central task arbiter, deadlock detector, fallback tasks.
- Schema validation, content reviews, test seeds.

**Assumptions.**

- The community wants modding; deterministic replays are core value; SI units are acceptable.

---

## 16. Binding Rules & Technical Guardrails (Coding‑Ready)

> These rules are **technology‑agnostic** and intended to be consumed verbatim by a Coding‑AI. They define deterministic behavior, validation, and acceptance thresholds for the simulation.

### 16.1 Units & Numerics (SI policy, rounding, tolerances)

- Store **all physical quantities in SI units**.
- Display formats are **UI‑only**.
- Internal representation: **float64**.
- Persistence: **JSON number** with **max 6 decimal places**.
- Audit comparisons use tolerances **ε_rel = 1e‑6** and **ε_abs = 1e‑9**.

### 16.2 Seed policy & RNG sources

- **All randomness** must go through **RNG(seed, streamId)**.
- **No** use of `Math.random` or system RNG in the sim core.
- Each subsystem (Pests, Events, Loot, Market, …) uses a **fixed `streamId`**.

### 16.3 Time scaling & pause semantics

- Time acceleration changes **only** the UI scheduler / loop frequency, **not** tick semantics.
- **One tick equals exactly one in‑game hour**.
- Pause = **stop ticking**. No half‑ticks or sub‑ticks (for now).

### 16.4 Task arbiter – deterministic priorities & fairness

- Priority order: **Plant‑Protection (100) > Harvest (90) > Replant (80) > Climate‑Comfort (70) > Maintenance (60) > Housekeeping (30)**.
- Within the same priority: **stable round‑robin**.
- Hard deadline classes (e.g., harvest windows) may **boost once** by **+10**.

### 16.5 Device degradation & maintenance

- Efficiency decay over runtime hours:
  - **Efficiency(t) = baseEfficiency × (1 – λ_deg × runtime_hours^k)**
  - Defaults: **λ_deg = 1e‑5**, **k = 0.9** (sub‑linear).

- Maintenance resets efficiency to **min(0.98, 1 – wear_residual)**.
- Maintenance costs increase **linearly** with the number of maintenances × device maintenance factor.

### 16.6 Market / price baseline

- `basePrice` originates from **`strainPrices.json`** (quality baseline **70**).
- Optional market modifier **`marketIndex(t)` ∈ \[0.85, 1.15]**, deterministic via RNG stream **"market"**.

### 16.7 Storage & post‑harvest quality decay

- Post‑harvest quality decays **starting on day 7**:
  - **Q(t) = Q0 × exp(–ρ × daysOver7)**
  - Default **ρ = 0.02 / day** without cooling; **cold storage halves ρ**.

### 16.8 Pest/disease treatments – side effects

- Each treatment option specifies **efficacy**, a **stress spike** (+ΔStress for **24–72 h**), and a **quality penalty** (**0–3 points**).
- The arbiter schedules treatments only if **net benefit > 0**.

### 16.9 Savegame schema & migrations

- Every savegame carries **`schemaVersion` (SemVer)**.
- Migrations are **pure functions** from v → v+1.
- Golden‑replay validates **Load → Run → Export** equality within **±ε**.

### 16.10 Audit metrics – definitions & thresholds

- Daily audit must record: **energy_kWh, water_L, npk_g, biomass_kg, stress_avg, quality_avg, opex_eur, capex_eur, tasks_dropped**.
- Golden‑run thresholds in the reference scenario: **tasks_dropped = 0**, **stress_avg ≤ 0.35**, **quality_avg ≥ 72**.

### 16.11 Maximum plants per zone – binding formula

- **`maxPlants = floor(zone.area_m2 / method.plantArea_m2)`**.
- Additional constraints must hold: **PPFD_uniformity ≥ 0.7 (min/avg)** and minimum spacing of the cultivation method.

### 16.12 Climate controller – control strategy

- Use a **PI controller per variable** (Temperature / RH / CO₂) with **anti‑windup**.
- Actuators are **discrete device power levels (0–100%)**.
- Cost‑aware objective: **J = w_err · Σ|e| + w_cost · energy_kWh** with **w_err = 1.0**, **w_cost = 0.1**.

### 16.13 Staff shift model

- **8 staff** members in a **2×12 h** shift system with **1 h overlap**.
- Task time: **`setup_time + per_plant_time × N`**.
- Tasks may be **preempted**, except **Harvest** (atomic).

### 16.14 Device conflict / capacity rules

- Exactly **one active climate controller per zone** controls devices.
- Conflicting actuators (heating vs cooling) must **not** run simultaneously **> 10%**; apply **0.5 K hysteresis**.

### 16.15 Failure & degrade‑mode matrix

- **Sensor failure:** use **last‑known‑good** for **6 h**, then **safe defaults**.
- **OOM** or **tick overrun (> 50 ms for 60 consecutive ticks):** engage **slow‑mode (0.5× UI speed)** and raise a warning; audit marks **`throttled = true`**.

---

> **Note:** This document is **technology-agnostic**. Concrete technology choices (engine, UI stack, etc.) are ore have to be documented separately in “Architecture & Implementation Choices.”

## Enhanced Strain Blueprint System\n\nThis document describes the enhanced strain blueprint system that provides more realistic and detailed strain-specific environmental preferences, yield modeling, and cultivation method compatibility.\n\n## Overview\n\nThe enhanced strain system extends the basic strain blueprint with new fields that enable:\n- Phase-specific environmental preferences (seedling, veg, flower, ripening)\n- Stress tolerance modeling for environmental metrics\n- Cultivation method affinity scoring\n- Phase-specific durations for phenology\n- Advanced yield modeling with CO2 response curves\n\n## Core Components\n\n### 1. Enhanced Strain Blueprint\n\n**Location**: `src/backend/src/engine/strains/enhancedStrainInterface.ts`\n\nThe enhanced strain blueprint includes these new fields:\n\n`typescript\ninterface EnhancedStrainBlueprint {\n  // ... existing fields (id, name, genetics, etc.)\n  \n  // Environmental bands per phase\n  envBands?: {\n    default: EnvBands;\n    veg?: Partial<EnvBands>;\n    flower?: Partial<EnvBands>;\n  };\n  \n  // Stress tolerance per metric\n  stressTolerance?: {\n    temp_C?: number;\n    rh_frac?: number;\n    co2_ppm?: number;\n    ppfd_umol_m2s?: number;\n    vpd_kPa?: number;\n  };\n  \n  // Method compatibility\n  methodAffinity?: Record<string, number>; // method ID -> affinity (0-1)\n  \n  // Growth phase durations\n  phaseDurations?: {\n    seedling?: number;\n    veg?: number;\n    flower?: number;\n    ripening?: number;\n  };\n  \n  // Enhanced yield model\n  yieldModel?: {\n    baseGmPerPlant?: number;\n    qualityFactors?: {\n      temp?: number;\n      rh?: number;\n      ppfd?: number;\n      vpd?: number;\n    };\n    co2Response?: {\n      halfMax_ppm: number;\n      saturation_ppm: number;\n    };\n  };\n}\n`\n\n### 2. Environmental Evaluation Service\n\n**Location**: `src/backend/src/engine/strains/enhancedStrainService.ts`\n\nThe service provides methods for:\n- Evaluating zone environment against strain preferences\n- Calculating yield estimates based on environmental conditions\n- Determining cultivation method compatibility\n- Emitting environmental events for monitoring\n\n#### Key Methods:\n\n`typescript\n// Evaluate environment against strain bands\nevaluateEnvironment(\n  strain: EnhancedStrainBlueprint,\n  environment: ZoneEnvironmentState,\n  stage: PlantStage,\n  applyStressTolerance?: boolean\n): StrainEnvironmentResult\n\n// Calculate enhanced yield estimate\ncalculateYield(context: YieldCalculationContext): CalculatedYield\n\n// Get method compatibility rating\ngetMethodCompatibility(\n  strain: EnhancedStrainBlueprint,\n  methodId: string\n): MethodCompatibility\n`\n\n### 3. Plant Growth Integration\n\n**Location**: `src/backend/src/engine/strains/plantGrowthIntegration.ts`\n\nIntegrates the enhanced strain evaluation with the plant growth engine:\n- Calculates health and growth multipliers based on environmental stress\n- Provides phase-aware growth rate calculations\n- Generates yield estimates and environmental tooltips for the UI\n\n### 4. Frontend UI Component\n\n**Location**: `src/frontend/src/components/strain/StrainEnvironmentPanel.tsx`\n\nDisplays comprehensive strain environmental analysis including:\n- Overall stress level with color-coded indicators\n- Individual metric status (optimal, acceptable, stress, critical)\n- Yield estimates with breakdown of quality and CO2 multipliers\n- Method compatibility ratings\n- Environmental recommendations\n\n## Environmental Band System\n\n### Band Structure\n\n`typescript\ninterface EnvBand {\n  green: [number, number];    // Optimal range\n  yellowLow: number;          // Acceptable lower bound\n  yellowHigh: number;         // Acceptable upper bound\n}\n`\n\n### Phase Overrides\n\nStrains can define different environmental preferences for different growth phases:\n- **Default**: Base environmental preferences\n- **Veg**: Overrides for vegetative growth (often higher humidity, lower light)\n- **Flower**: Overrides for flowering phase (often lower humidity, higher light)\n\n### Evaluation Logic\n\n1. **Optimal (Green)**: Value falls within the green range\n2. **Acceptable (Yellow)**: Value falls between yellowLow and green[0], or between green[1] and yellowHigh\n3. **Stress (Orange)**: Value deviates moderately from acceptable range\n4. **Critical (Red)**: Value deviates severely from acceptable range\n\n### Stress Tolerance\n\nMature plants (>14 days) can apply stress tolerance, which widens the acceptable ranges:\n- Reduces yellowLow by tolerance amount\n- Increases yellowHigh by tolerance amount\n- Allows plants to better handle environmental fluctuations as they mature\n\n## Yield Modeling\n\n### Quality Factors\n\nEach environmental metric can contribute to yield quality:\n`typescript\nqualityFactors: {\n  temp: 0.3,     // Temperature contributes 30% to quality score\n  rh: 0.2,       // Humidity contributes 20%\n  ppfd: 0.4,     // Light contributes 40%\n  vpd: 0.1       // VPD contributes 10%\n}\n`\n\n### CO2 Response Curve\n\nModels diminishing returns for CO2 supplementation:\n- **halfMax_ppm**: CO2 level that gives 50% of maximum response\n- **saturation_ppm**: CO2 level beyond which no additional benefit occurs\n- Uses Michaelis-Menten kinetics for realistic CO2 response\n\n### Final Yield Calculation\n\n`\nEstimated Yield = Base Yield × Quality Multiplier × CO2 Multiplier\n`\n\n## Method Affinity System\n\n### Affinity Scores\n\nEach strain can define compatibility with cultivation methods:\n- **1.0**: Perfect compatibility\n- **0.8**: Good compatibility\n- **0.6**: Moderate compatibility\n- **0.4**: Poor compatibility\n- **0.2**: Very poor compatibility\n- **0.0**: Incompatible\n\n### Categories\n\n- **Excellent** (0.9+): Strain thrives with this method\n- **Good** (0.7-0.89): Strain performs well\n- **Neutral** (0.5-0.69): Strain is compatible but not optimal\n- **Poor** (0.3-0.49): Strain may struggle\n- **Incompatible** (<0.3): Not recommended\n\n## Example Usage\n\n### Backend Integration\n\n`typescript\n// In plant growth tick processing\nconst environmentResult = enhancedStrainService.evaluateEnvironment(\n  strain,\n  zoneEnvironment,\n  plant.stage,\n  plant.age_days > 14 // Apply stress tolerance for mature plants\n);\n\n// Calculate growth multipliers\nconst healthMultiplier = 1.0 - (environmentResult.overallStress * 0.3);\nconst growthRate = baseGrowthRate * healthMultiplier;\n\n// Emit monitoring events\nenhancedStrainService.emitEnvironmentalEvents(\n  plant.id,\n  plant.zone_id,\n  strain,\n  environmentResult,\n  currentTick,\n  eventCollector\n);\n`\n\n### Frontend Integration\n\n`tsx\n// Display strain environment analysis\n<StrainEnvironmentPanel\n  strainName=\"AK-47\"\n  environmentResult={environmentResult}\n  yieldEstimate={yieldEstimate}\n  methodCompatibility={methodCompatibility}\n  baseYield={120}\n/>\n`\n\n## Migration Path\n\n### Existing Strains\n\nStrains without enhanced fields will use fallback defaults:\n- Default environmental bands based on cannabis cultivation best practices\n- No stress tolerance (0 for all metrics)\n- No method affinity (assumes neutral compatibility)\n- Standard phase durations\n- Simple yield model without quality factors\n\n### Gradual Enhancement\n\nStrains can be enhanced incrementally:\n1. Add basic `envBands` with default values\n2. Add phase-specific overrides for `veg` and `flower`\n3. Configure `stressTolerance` based on strain resilience\n4. Define `methodAffinity` for cultivation methods\n5. Add `yieldModel` with quality factors and CO2 response\n\n## Benefits\n\n### Realism\n- Different strains now have unique environmental preferences\n- Phase-specific requirements (e.g., lower humidity in flower)\n- Realistic CO2 response curves\n- Method-specific compatibility\n\n### Gameplay\n- Strategic strain selection based on available equipment\n- Environmental optimization becomes strain-specific\n- Yield predictions become more accurate and meaningful\n- Player education about real cultivation practices\n\n### UI/UX\n- Rich environmental feedback with source attribution\n- Clear visual indicators for environmental status\n- Actionable recommendations for improvement\n- Detailed yield breakdowns showing impact of environment\n\n## Future Enhancements\n\n### Planned Features\n\n1. **Nutrient Affinity**: Strain preferences for different nutrient regimens\n2. **Training Response**: How well strains respond to LST, SCROG, etc.\n3. **Harvest Window**: Strain-specific ripening characteristics\n4. **Genetic Stability**: Phenotype variation modeling\n5. **Disease Resistance**: Environmental stress leading to pathogen susceptibility\n\n### Advanced Modeling\n\n1. **Multi-factor Interactions**: How temperature and humidity interact for VPD optimization\n2. **Seasonal Adaptation**: Strains that prefer different conditions at different times\n3. **Epigenetic Memory**: Plants \"remembering\" previous environmental stress\n4. **Breeding Integration**: Parent strain characteristics affecting offspring\n\nThis enhanced strain system provides a solid foundation for realistic, engaging, and educational cannabis cultivation simulation while maintaining backward compatibility with existing strain data.\n\n## Implementation Summary\n\n### Files Created\n\n1. **Enhanced AK-47 Blueprint**: `data/strains/ak-47-enhanced.json`\n - Complete strain blueprint with all new fields populated\n - Phase-specific environmental preferences\n - Stress tolerance configuration\n - Method affinity scores\n - Advanced yield model\n\n2. **Backend Schema**: `src/backend/src/schemas/strainsSchema.ts`\n - Zod validation schema for enhanced strain fields\n - Type-safe validation and parsing\n\n3. **Strain Interface**: `src/backend/src/engine/strains/enhancedStrainInterface.ts`\n - TypeScript interfaces and utility functions\n - Environmental evaluation logic\n - Phase mapping functions\n\n4. **Strain Service**: `src/backend/src/engine/strains/enhancedStrainService.ts`\n - Environmental evaluation service\n - Yield calculation engine\n - Method compatibility assessment\n - Event emission for monitoring\n\n5. **Growth Integration**: `src/backend/src/engine/strains/plantGrowthIntegration.ts`\n - Integration with plant growth engine\n - Health and growth multiplier calculations\n - UI tooltip generation\n\n6. **UI Component**: `src/frontend/src/components/strain/StrainEnvironmentPanel.tsx`\n - React component for environmental analysis display\n - Color-coded status indicators\n - Yield breakdown visualization\n - Environmental recommendations\n\nThe system is designed to be backward compatible, extensible, and provides a rich foundation for realistic cannabis cultivation simulation. (docs/enhanced-strain-blueprint-system.md)

Source: [`docs/enhanced-strain-blueprint-system.md`](../docs/enhanced-strain-blueprint-system.md)

# Enhanced Strain Blueprint System\n\nThis document describes the enhanced strain blueprint system that provides more realistic and detailed strain-specific environmental preferences, yield modeling, and cultivation method compatibility.\n\n## Overview\n\nThe enhanced strain system extends the basic strain blueprint with new fields that enable:\n- Phase-specific environmental preferences (seedling, veg, flower, ripening)\n- Stress tolerance modeling for environmental metrics\n- Cultivation method affinity scoring\n- Phase-specific durations for phenology\n- Advanced yield modeling with CO2 response curves\n\n## Core Components\n\n### 1. Enhanced Strain Blueprint\n\n**Location**: `src/backend/src/engine/strains/enhancedStrainInterface.ts`\n\nThe enhanced strain blueprint includes these new fields:\n\n`typescript\ninterface EnhancedStrainBlueprint {\n  // ... existing fields (id, name, genetics, etc.)\n  \n  // Environmental bands per phase\n  envBands?: {\n    default: EnvBands;\n    veg?: Partial<EnvBands>;\n    flower?: Partial<EnvBands>;\n  };\n  \n  // Stress tolerance per metric\n  stressTolerance?: {\n    temp_C?: number;\n    rh_frac?: number;\n    co2_ppm?: number;\n    ppfd_umol_m2s?: number;\n    vpd_kPa?: number;\n  };\n  \n  // Method compatibility\n  methodAffinity?: Record<string, number>; // method ID -> affinity (0-1)\n  \n  // Growth phase durations\n  phaseDurations?: {\n    seedling?: number;\n    veg?: number;\n    flower?: number;\n    ripening?: number;\n  };\n  \n  // Enhanced yield model\n  yieldModel?: {\n    baseGmPerPlant?: number;\n    qualityFactors?: {\n      temp?: number;\n      rh?: number;\n      ppfd?: number;\n      vpd?: number;\n    };\n    co2Response?: {\n      halfMax_ppm: number;\n      saturation_ppm: number;\n    };\n  };\n}\n`\n\n### 2. Environmental Evaluation Service\n\n**Location**: `src/backend/src/engine/strains/enhancedStrainService.ts`\n\nThe service provides methods for:\n- Evaluating zone environment against strain preferences\n- Calculating yield estimates based on environmental conditions\n- Determining cultivation method compatibility\n- Emitting environmental events for monitoring\n\n#### Key Methods:\n\n`typescript\n// Evaluate environment against strain bands\nevaluateEnvironment(\n  strain: EnhancedStrainBlueprint,\n  environment: ZoneEnvironmentState,\n  stage: PlantStage,\n  applyStressTolerance?: boolean\n): StrainEnvironmentResult\n\n// Calculate enhanced yield estimate\ncalculateYield(context: YieldCalculationContext): CalculatedYield\n\n// Get method compatibility rating\ngetMethodCompatibility(\n  strain: EnhancedStrainBlueprint,\n  methodId: string\n): MethodCompatibility\n`\n\n### 3. Plant Growth Integration\n\n**Location**: `src/backend/src/engine/strains/plantGrowthIntegration.ts`\n\nIntegrates the enhanced strain evaluation with the plant growth engine:\n- Calculates health and growth multipliers based on environmental stress\n- Provides phase-aware growth rate calculations\n- Generates yield estimates and environmental tooltips for the UI\n\n### 4. Frontend UI Component\n\n**Location**: `src/frontend/src/components/strain/StrainEnvironmentPanel.tsx`\n\nDisplays comprehensive strain environmental analysis including:\n- Overall stress level with color-coded indicators\n- Individual metric status (optimal, acceptable, stress, critical)\n- Yield estimates with breakdown of quality and CO2 multipliers\n- Method compatibility ratings\n- Environmental recommendations\n\n## Environmental Band System\n\n### Band Structure\n\n`typescript\ninterface EnvBand {\n  green: [number, number];    // Optimal range\n  yellowLow: number;          // Acceptable lower bound\n  yellowHigh: number;         // Acceptable upper bound\n}\n`\n\n### Phase Overrides\n\nStrains can define different environmental preferences for different growth phases:\n- **Default**: Base environmental preferences\n- **Veg**: Overrides for vegetative growth (often higher humidity, lower light)\n- **Flower**: Overrides for flowering phase (often lower humidity, higher light)\n\n### Evaluation Logic\n\n1. **Optimal (Green)**: Value falls within the green range\n2. **Acceptable (Yellow)**: Value falls between yellowLow and green[0], or between green[1] and yellowHigh\n3. **Stress (Orange)**: Value deviates moderately from acceptable range\n4. **Critical (Red)**: Value deviates severely from acceptable range\n\n### Stress Tolerance\n\nMature plants (>14 days) can apply stress tolerance, which widens the acceptable ranges:\n- Reduces yellowLow by tolerance amount\n- Increases yellowHigh by tolerance amount\n- Allows plants to better handle environmental fluctuations as they mature\n\n## Yield Modeling\n\n### Quality Factors\n\nEach environmental metric can contribute to yield quality:\n`typescript\nqualityFactors: {\n  temp: 0.3,     // Temperature contributes 30% to quality score\n  rh: 0.2,       // Humidity contributes 20%\n  ppfd: 0.4,     // Light contributes 40%\n  vpd: 0.1       // VPD contributes 10%\n}\n`\n\n### CO2 Response Curve\n\nModels diminishing returns for CO2 supplementation:\n- **halfMax_ppm**: CO2 level that gives 50% of maximum response\n- **saturation_ppm**: CO2 level beyond which no additional benefit occurs\n- Uses Michaelis-Menten kinetics for realistic CO2 response\n\n### Final Yield Calculation\n\n`\nEstimated Yield = Base Yield × Quality Multiplier × CO2 Multiplier\n`\n\n## Method Affinity System\n\n### Affinity Scores\n\nEach strain can define compatibility with cultivation methods:\n- **1.0**: Perfect compatibility\n- **0.8**: Good compatibility\n- **0.6**: Moderate compatibility\n- **0.4**: Poor compatibility\n- **0.2**: Very poor compatibility\n- **0.0**: Incompatible\n\n### Categories\n\n- **Excellent** (0.9+): Strain thrives with this method\n- **Good** (0.7-0.89): Strain performs well\n- **Neutral** (0.5-0.69): Strain is compatible but not optimal\n- **Poor** (0.3-0.49): Strain may struggle\n- **Incompatible** (<0.3): Not recommended\n\n## Example Usage\n\n### Backend Integration\n\n`typescript\n// In plant growth tick processing\nconst environmentResult = enhancedStrainService.evaluateEnvironment(\n  strain,\n  zoneEnvironment,\n  plant.stage,\n  plant.age_days > 14 // Apply stress tolerance for mature plants\n);\n\n// Calculate growth multipliers\nconst healthMultiplier = 1.0 - (environmentResult.overallStress * 0.3);\nconst growthRate = baseGrowthRate * healthMultiplier;\n\n// Emit monitoring events\nenhancedStrainService.emitEnvironmentalEvents(\n  plant.id,\n  plant.zone_id,\n  strain,\n  environmentResult,\n  currentTick,\n  eventCollector\n);\n`\n\n### Frontend Integration\n\n`tsx\n// Display strain environment analysis\n<StrainEnvironmentPanel\n  strainName=\"AK-47\"\n  environmentResult={environmentResult}\n  yieldEstimate={yieldEstimate}\n  methodCompatibility={methodCompatibility}\n  baseYield={120}\n/>\n`\n\n## Migration Path\n\n### Existing Strains\n\nStrains without enhanced fields will use fallback defaults:\n- Default environmental bands based on cannabis cultivation best practices\n- No stress tolerance (0 for all metrics)\n- No method affinity (assumes neutral compatibility)\n- Standard phase durations\n- Simple yield model without quality factors\n\n### Gradual Enhancement\n\nStrains can be enhanced incrementally:\n1. Add basic `envBands` with default values\n2. Add phase-specific overrides for `veg` and `flower`\n3. Configure `stressTolerance` based on strain resilience\n4. Define `methodAffinity` for cultivation methods\n5. Add `yieldModel` with quality factors and CO2 response\n\n## Benefits\n\n### Realism\n- Different strains now have unique environmental preferences\n- Phase-specific requirements (e.g., lower humidity in flower)\n- Realistic CO2 response curves\n- Method-specific compatibility\n\n### Gameplay\n- Strategic strain selection based on available equipment\n- Environmental optimization becomes strain-specific\n- Yield predictions become more accurate and meaningful\n- Player education about real cultivation practices\n\n### UI/UX\n- Rich environmental feedback with source attribution\n- Clear visual indicators for environmental status\n- Actionable recommendations for improvement\n- Detailed yield breakdowns showing impact of environment\n\n## Future Enhancements\n\n### Planned Features\n\n1. **Nutrient Affinity**: Strain preferences for different nutrient regimens\n2. **Training Response**: How well strains respond to LST, SCROG, etc.\n3. **Harvest Window**: Strain-specific ripening characteristics\n4. **Genetic Stability**: Phenotype variation modeling\n5. **Disease Resistance**: Environmental stress leading to pathogen susceptibility\n\n### Advanced Modeling\n\n1. **Multi-factor Interactions**: How temperature and humidity interact for VPD optimization\n2. **Seasonal Adaptation**: Strains that prefer different conditions at different times\n3. **Epigenetic Memory**: Plants \"remembering\" previous environmental stress\n4. **Breeding Integration**: Parent strain characteristics affecting offspring\n\nThis enhanced strain system provides a solid foundation for realistic, engaging, and educational cannabis cultivation simulation while maintaining backward compatibility with existing strain data.\n\n## Implementation Summary\n\n### Files Created\n\n1. **Enhanced AK-47 Blueprint**: `data/strains/ak-47-enhanced.json`\n - Complete strain blueprint with all new fields populated\n - Phase-specific environmental preferences\n - Stress tolerance configuration\n - Method affinity scores\n - Advanced yield model\n\n2. **Backend Schema**: `src/backend/src/schemas/strainsSchema.ts`\n - Zod validation schema for enhanced strain fields\n - Type-safe validation and parsing\n\n3. **Strain Interface**: `src/backend/src/engine/strains/enhancedStrainInterface.ts`\n - TypeScript interfaces and utility functions\n - Environmental evaluation logic\n - Phase mapping functions\n\n4. **Strain Service**: `src/backend/src/engine/strains/enhancedStrainService.ts`\n - Environmental evaluation service\n - Yield calculation engine\n - Method compatibility assessment\n - Event emission for monitoring\n\n5. **Growth Integration**: `src/backend/src/engine/strains/plantGrowthIntegration.ts`\n - Integration with plant growth engine\n - Health and growth multiplier calculations\n - UI tooltip generation\n\n6. **UI Component**: `src/frontend/src/components/strain/StrainEnvironmentPanel.tsx`\n - React component for environmental analysis display\n - Color-coded status indicators\n - Yield breakdown visualization\n - Environmental recommendations\n\nThe system is designed to be backward compatible, extensible, and provides a rich foundation for realistic cannabis cultivation simulation.

## Weedbreed Final Truth (docs/weedbreed-final-truth.backup.md)

Source: [`docs/weedbreed-final-truth.backup.md`](../docs/weedbreed-final-truth.backup.md)

# Weedbreed Final Truth

## Table of Contents

- [Title & Scope](#title--scope)
- [Core Principles](#core-principles)
- [Domain Model](#domain-model)
- [Simulation Lifecycle](#simulation-lifecycle)
- [Math Formulas Overview](#math-formulas-overview)
- [Devices and Effects](#devices-and-effects)
- [Economy and Costs](#economy-and-costs)
- [Data and Blueprints](#data-and-blueprints)
- [Telemetry and UI Views](#telemetry-and-ui-views)
- [Assumptions and Constraints](#assumptions-and-constraints)
- [Open Questions](#open-questions)
- [Provenance Index](#provenance-index)

## Title & Scope

**Sources:** docs/vision_scope.md § 1. Vision; docs/backend-overview.md § 1. Purpose & Non-Goals

- **Weedbreed.AI** is positioned as a modular, deterministic cultivation simulation that spans structures, climate control, and plant lifecycles while remaining open and extensible through data-driven content contributions.【F:docs/vision_scope.md†L5-L17】
- The simulation core’s mandate is to deliver reproducible cultivation and economy modelling with structured telemetry and validated intent handling, keeping internal coupling hidden from clients.【F:docs/backend-overview.md†L3-L11】
- Experience pillars emphasise planning and optimisation of climate and lighting, risk management around pests and devices, and an economy loop that balances OpEx/CapEx, cash flow, and quality-driven pricing.【F:docs/vision_scope.md†L25-L29】
- Anti-scope guardrails exclude political or regulatory modelling, shooter-style mechanics, and lab-grade growth modelling so the project can favour plausible, playable systems over exhaustive realism.【F:docs/vision_scope.md†L19-L23】

## Core Principles

**Sources:** docs/vision_scope.md § 1. Vision; docs/system/simulation_philosophy.md §§ 1–5; docs/backend-overview.md § 3. Blueprints Provided & How to Use Them

- **Determinism first.** The simulation favours reproducibility over spectacle: every run uses seeded randomness, a fixed one-hour tick, and catch-up rules that prioritise fairness and responsiveness over raw step throughput.【F:docs/vision_scope.md†L13-L17】【F:docs/system/simulation_philosophy.md†L5-L8】
- **Emergent systems over monoliths.** Environment control is modelled as composable deltas (each device or plant contributes its own change), enabling extensibility and transparent root-cause analysis for players and developers alike.【F:docs/system/simulation_philosophy.md†L10-L12】
- **Stress → health → growth clarity.** Cultivation gameplay hinges on the player managing stressors so that health multiplies potential growth, making the optimisation loop explicit instead of opaque.【F:docs/system/simulation_philosophy.md†L14-L21】
- **Managerial control surface.** Autonomous employees claim tasks via utility scores so players focus on strategic decisions rather than micromanagement, aligning with the project’s indirect-control philosophy.【F:docs/system/simulation_philosophy.md†L23-L26】
- **Economic pressure with rewards.** Per-tick costs maintain constant tension while non-linear pricing amplifies high-quality harvests, rewarding mastery without relaxing deterministic accounting.【F:docs/system/simulation_philosophy.md†L27-L31】
- **Blueprint Doctrine.** Blueprints are delivered with the new repo as a validated set covering structures, room purposes, cultivation methods, strains, devices, pests, diseases, personnel roles, and price maps; they are immutable templates and are never instantiated directly, because runtime instances are created by copying a blueprint before the engine consumes them, which enables many simultaneous instances from a single template such as multiple small warehouses, rooms, or zones.【F:docs/backend-overview.md†L40-L52】

## Domain Model

**Sources:** docs/vision_scope.md § 4. Canonical Domain Model; docs/DD.md §§ 1–3

- **Spatial hierarchy.** Structures contain rooms that contain zones; zones host plantings and the devices that condition their microclimate, mirroring the gameplay drill-down from buildings to individual plants.【F:docs/vision_scope.md†L84-L89】
- **Lifecycle coverage.** Plant entities progress from seed through vegetative and flowering stages into harvest and post-harvest handling, while devices degrade over time, requiring maintenance and replacement decisions.【F:docs/vision_scope.md†L90-L94】
- **Tick scale.** The simulation advances in fixed one-hour ticks (24 ticks per in-game day, 7×24 per week), anchoring telemetry aggregation, audits, and replays to tick identifiers.【F:docs/vision_scope.md†L95-L99】
- **Blueprint-backed entities.** Strains define genetics, environmental preferences, nutrient and water demand, phenology, resilience, and lineage; cultivation methods govern area per plant, spacing, labour intensity, and compatible traits; devices declare type-specific settings such as power, PPFD, airflow, temperature targets, and dehumidification rates.【F:docs/DD.md†L12-L115】【F:docs/DD.md†L203-L331】

## Simulation Lifecycle

**Sources:** docs/system/simulation-engine.md §§ Timebase & Core Loop, Environment Model, Plant Growth, Stress, Health, Tasks & Agentic Employees, Economics

- **Fixed-step scheduler.** Wall-time deltas accumulate until they exceed `tickIntervalMs / gameSpeed`; each loop consumes the budget, runs one full tick, reduces the accumulator, and then publishes committed snapshots and batched events, ensuring deterministic pacing even when catch-up frames occur.【F:docs/system/simulation-engine.md†L12-L25】
- **Environment phase.** Every tick starts from the previous zone state, applies device deltas (lighting heat and PPFD, HVAC cooling/heating, humidity control, CO₂ injection), folds in plant-driven transpiration and photosynthesis, normalises toward ambient with airflow-scaled exponential pull, clamps to safety limits, and emits environmental anomaly events as needed.【F:docs/system/simulation-engine.md†L35-L66】
- **Plant phase.** Phenology advances by tick, resource requirements convert NPK and water curves to per-plant, per-tick demand, stress aggregates weighted penalties across climate and resource drivers, health adjusts via stress thresholds, potential growth factors (light, temperature, CO₂) combine with health to yield actual biomass gains, and quality tracking respects harvest windows.【F:docs/system/simulation-engine.md†L80-L105】
- **Health and workforce phases.** Pests and diseases progress through detect → progress → spread → treat steps with blueprint-driven risk and safety gates, while employees pull tasks by maximising utility functions, execute until `progressTicks ≥ durationTicks`, and accrue overtime per policy when energy dips below zero.【F:docs/system/simulation-engine.md†L115-L170】
- **Accounting phase.** CapEx posts immediately, OpEx aggregates maintenance, energy, and inputs using tick-hour scaling, rent multiplies hourly rates by tick length, labour costs respect overtime policies, and revenue applies quality-modified harvest pricing before finance events are emitted.【F:docs/system/simulation-engine.md†L173-L190】

## Math Formulas Overview

**Source:** docs/\_extraction/formulas.md § Extracted Formulas

### Breeding

- `T_gen = veg + flower + tail + post`【F:docs/\_extraction/formulas.md†L3-L12】
- `veg   = avg(vegetationDays[A], vegetationDays[B])`【F:docs/\_extraction/formulas.md†L14-L23】
- `flower= avg(floweringDays[A],  floweringDays[B])`【F:docs/\_extraction/formulas.md†L25-L34】
- `tail  = max(0, seedMaturationDays - (flower - pollinationDayInFlower))`【F:docs/\_extraction/formulas.md†L36-L45】
- `post  = postProcessingDays`【F:docs/\_extraction/formulas.md†L47-L56】
- `effectiveDays ≈ ceil(T_gen / parallelBatches)`【F:docs/\_extraction/formulas.md†L58-L67】
- `±noise × base`【F:docs/\_extraction/formulas.md†L113-L122】

### Terpenes

- `w_t = mg_g_t / total_mg_g`【F:docs/\_extraction/formulas.md†L69-L78】
- `axis = Σ (share_terpene × weight_terpene→axis) → clamp \[0..1]`【F:docs/\_extraction/formulas.md†L80-L89】

### Genetics & Resilience

- `sum ≤ 1`【F:docs/\_extraction/formulas.md†L91-L100】
- `1.0 = neutral`【F:docs/\_extraction/formulas.md†L102-L111】

### Capacity

- `Max plant count = floor(zoneArea / areaPerPlant)`【F:docs/\_extraction/formulas.md†L123-L133】

### Time Scaling

- `tickLengthMinutes / 60`【F:docs/\_extraction/formulas.md†L135-L144】
- `tickHours = tickLengthMinutes / 60`【F:docs/\_extraction/formulas.md†L366-L375】

### Tasks & Workforce

- `progressTicks >= durationTicks`【F:docs/\_extraction/formulas.md†L146-L155】
- `U = w1*priority + w2*skillMatch + w3*roleAffinity + w4*urgency`【F:docs/\_extraction/formulas.md†L421-L430】
- `w5*distance - w6*fatigue + w7*morale + w8*toolAvailability ± traitMods`【F:docs/\_extraction/formulas.md†L432-L440】

### Economics

- `revenue = harvestBasePricePerGram × modifiers`【F:docs/\_extraction/formulas.md†L157-L166】
- `device.power_kW × tickHours × electricityCostPerKWh`【F:docs/\_extraction/formulas.md†L355-L364】

### Scheduler & Seeding

- `Math.floor(tick / 2016)`【F:docs/\_extraction/formulas.md†L168-L177】
- `apiSeed = override ?? "<gameSeed>-<weekIndex>"`【F:docs/\_extraction/formulas.md†L179-L188】
- `accumulatedMs += now - lastNow`【F:docs/\_extraction/formulas.md†L212-L221】
- `accumulatedMs ≥ tickIntervalMs / gameSpeed`【F:docs/\_extraction/formulas.md†L223-L232】
- `accumulatedMs -= tickIntervalMs / gameSpeed`【F:docs/\_extraction/formulas.md†L234-L243】

### Probability

- `P(other) = pDiverse`【F:docs/\_extraction/formulas.md†L190-L199】
- `P(male) = P(female) = (1 - pDiverse) / 2`【F:docs/\_extraction/formulas.md†L201-L210】

### Environment & Humidity

- `ΔRH = (mass_kg ÷ (volume_m3 × SATURATION_VAPOR_DENSITY_KG_PER_M3)) × efficiency × powerMod`【F:docs/\_extraction/formulas.md†L245-L254】
- `Δ = k_mix * (ambient − current)`【F:docs/\_extraction/formulas.md†L256-L265】
- `Tₜ = Tₐ + (T₀ − Tₐ) · exp(−k · Δt)`【F:docs/\_extraction/formulas.md†L377-L386】

### Nutrition & Growth

- `req_phase = curve[phase]`【F:docs/\_extraction/formulas.md†L267-L276】
- `req_tick_plant = req_phase * (zoneArea / plantCount) * (tickHours / 24)`【F:docs/\_extraction/formulas.md†L278-L287】
- `stress_raw = Σ w_D * penalty_D`【F:docs/\_extraction/formulas.md†L289-L298】
- `stress = clamp01(stress_raw * (1 − generalResilience))`【F:docs/\_extraction/formulas.md†L300-L309】
- `stress > θ_stress`【F:docs/\_extraction/formulas.md†L311-L320】
- `health -= α * stress`【F:docs/\_extraction/formulas.md†L322-L331】
- `health += β_recovery`【F:docs/\_extraction/formulas.md†L333-L342】
- `actualGrowth = potentialGrowth * health * (1 − γ * stress)`【F:docs/\_extraction/formulas.md†L344-L353】

### Temperature & Transpiration

- `g_c = g₀ · clamp(LAI / 3, 0.3, 2)`【F:docs/\_extraction/formulas.md†L388-L397】
- `E = g_c · VPD · f_stomatal`【F:docs/\_extraction/formulas.md†L400-L408】
- `litres = E · area · Δt ÷ 3600 · 0.018`【F:docs/\_extraction/formulas.md†L410-L419】

## Devices and Effects

**Sources:** docs/system/simulation-engine.md § Environment Model; docs/DD.md § 2) Devices — `/data/blueprints/devices/*.json`; docs/backend-overview.md § 3.2 Blueprint–to–Subsystem Mapping

- **Device deltas.** Grow lights contribute heat proportional to power and map photon flux over coverage area to canopy PPFD, HVAC units steer temperature toward setpoints within hysteresis bands, dehumidifiers and humidifiers translate mass flow into relative humidity deltas, and CO₂ injectors push concentration toward targets capped by safety limits.【F:docs/system/simulation-engine.md†L35-L55】
- **Ambient normalisation.** After device and plant deltas, zones apply an exponential pull (`Δ = k_mix * (ambient − current)`) with airflow-dependent gain so ventilation hardware accelerates the return to ambient conditions.【F:docs/system/simulation-engine.md†L57-L59】
- **Blueprint parameters.** Device templates declare kind-specific settings (e.g., power, PPFD, coverage area, cooling capacity, airflow, targetTemperature, latent removal), quality and lifespan metadata, and allowed room purposes, giving the engine enough data to evaluate placement rules and runtime behaviour.【F:docs/DD.md†L203-L331】

## Economy and Costs

**Sources:** docs/vision_scope.md §§ 6–6a; docs/system/simulation-engine.md § Economics (currency-neutral); docs/system/simulation_philosophy.md § 5. Economic Model: Constant Pressure and Rewarding Mastery

- **Dual loops.** Expansion decisions manage CapEx—renting structures, purchasing or replacing devices, unlocking cultivation methods—while daily operations juggle OpEx via climate control, irrigation, pest mitigation, staffing, and consumables.【F:docs/vision_scope.md†L112-L123】
- **Cost mechanics.** Maintenance costs rise with device wear, energy spend is derived from power draw per tick hour, water and nutrient purchases follow per-m²/day demand curves, rent multiplies hourly base rates by tick length, and labour costs respect overtime policies, ensuring all recurring charges scale with the current tick duration.【F:docs/system/simulation-engine.md†L173-L190】
- **Quality-driven revenue.** Harvest sales multiply base price by quality modifiers, with the quality model rewarding high health and low stress while a non-linear price function amplifies above-baseline quality and penalises poor output.【F:docs/vision_scope.md†L129-L195】
- **Design intent.** Persistent per-tick expenses maintain financial pressure so passive play is unviable, whereas mastering the systems to raise quality yields outsized rewards, reinforcing the tycoon-style tension.【F:docs/system/simulation_philosophy.md†L27-L31】

## Data and Blueprints

**Sources:** docs/backend-overview.md § 3. Blueprints Provided & How to Use Them; docs/system/data-validation.md § Blueprint Data Validation Workflow; docs/DD.md § Conventions (apply to all files)

- **Blueprint Doctrine.** Blueprints are delivered with the new repo as a validated collection spanning structures, room purposes, cultivation methods, strains, devices, pests, diseases, personnel roles, and price maps; they are immutable templates, never instantiated directly, because runtime systems always materialise instances by copying a blueprint, which enables multiple simultaneous instances—such as many small warehouses, rooms, or zones—from the same template without mutating the source data.【F:docs/backend-overview.md†L40-L52】
- **Schema conventions.** All blueprints follow shared rules: UUID `id` keys, camelCase naming without unit suffixes, SI units for physical quantities, inclusive ranges, and validation that enforces required fields, numeric bounds, and cross-references before runtime use.【F:docs/DD.md†L1-L41】【F:docs/backend-overview.md†L46-L52】【F:docs/backend-overview.md†L123-L139】
- **Validation workflow.** The `pnpm validate:data` command parses each blueprint family, enforces casing-sensitive control setpoints, emits machine- and human-readable reports, and fails CI when errors appear, ensuring data drift is caught before integration.【F:docs/system/data-validation.md†L1-L53】
- **Materialisation pipeline.** Loading blueprints involves validation, copying template values into runtime records, resolving cross-map identifiers (e.g., price tables), and exposing read-only instances to subsystems so deterministic state changes never mutate source JSON.【F:docs/backend-overview.md†L123-L129】

## Telemetry and UI Views

**Sources:** docs/system/socket_protocol.md §§ UI Stream, Connection & Handshake; docs/ui-building_guide.md §§ Guiding Principles, Layout & Navigation, Dashboard & Global Chrome

- **Shared UI stream.** The backend exposes a hot observable that batches simulation updates, tick-completion notices, and domain events with bounded buffers; all transports subscribe to the same stream so Socket.IO and SSE clients receive identical JSON payloads in SI units.【F:docs/system/socket_protocol.md†L3-L31】
- **Handshake cadence.** On connect the gateway emits protocol metadata, current time status (tick, speed, pause state), and an initial `simulationUpdate` snapshot before continuing with batched updates that include phase timings, telemetry, and UUID-referenced entities.【F:docs/system/socket_protocol.md†L33-L145】
- **UI contract.** The dashboard renders read-only snapshots, routes every intent through the System Facade, and keeps unidirectional dataflow (render → intent → commit → event → re-render) so the engine remains authoritative.【F:docs/ui-building_guide.md†L1-L27】
- **Navigation model.** The application shells persist header controls, breadcrumbs, sidebar, and content area, supporting a structure → room → zone drill-down with responsive layouts, modal pauses, and consistent design-system primitives across breakpoints.【F:docs/ui-building_guide.md†L5-L111】
- **Global controls.** The dashboard header surfaces capital, cumulative yield, plant capacity, and tick progress, with play/pause, multi-speed presets, finance and personnel shortcuts, notification popovers, and menu actions that mirror telemetry events.【F:docs/ui-building_guide.md†L49-L127】

## Assumptions and Constraints

**Sources:** docs/vision_scope.md §§ 3, 12, 15, 16

- **Performance envelope.** The reference scenario must sustain at least one tick per second at 1× speed with a per-tick CPU budget under 50 ms, aligning balancing and benchmark work around that baseline.【F:docs/vision_scope.md†L61-L77】
- **Deterministic numerics.** All randomness flows through seeded generators, SI units underpin every quantity, persistence uses JSON numbers with up to six decimal places, and audit comparisons apply tight relative and absolute tolerances, constraining both engine and content design.【F:docs/vision_scope.md†L305-L315】
- **Validation and safety.** Safe defaults on parameter errors, strict schema validation at load, and prohibition of `Math.random` in the core guard against drift and ensure deterministic recovery.【F:docs/vision_scope.md†L245-L249】【F:docs/vision_scope.md†L311-L315】
- **Community expectations.** The roadmap assumes modding demand, deterministic replays as a core value proposition, and broad acceptance of SI units, guiding documentation and tooling priorities.【F:docs/vision_scope.md†L293-L296】
- **Localization and privacy.** Out-of-the-box support targets German and English with SI units and configurable formatting, while saves remain local and avoid personal data, bounding compliance scope.【F:docs/vision_scope.md†L247-L250】

## Open Questions

**Sources:** docs/vision_scope.md §§ 3, 4, 8, 13

- **First Harvest Time:** First harvest in **< 30 minutes** of play (MVP default setup). _(OPEN: validate)_【F:docs/vision_scope.md†L55-L56】
- **Retention Proxy:** 70% of players reach day 7 of a sandbox save. _(OPEN: measure)_【F:docs/vision_scope.md†L55-L57】
- **Memory Target:** Reference scenario uses < **1.0 GB RAM**. _(OPEN: finalize)_【F:docs/vision_scope.md†L61-L64】
- **Time Scale.** Tick-based with fixed tick duration: **default tick length = 5 in-game minutes**; **12 ticks = 1 in-game hour**, **288 ticks = 1 in-game day**, **7×288 ticks = 1 in-game week**. Ticks are aggregated into day/week summaries; replays/logs reference tick IDs. _(OPEN: standard wall-clock tick duration, e.g., 1 min)_【F:docs/vision_scope.md†L95-L96】
- **v1 Scope (Targets):** \~8–12 strains, \~10–15 devices, 2–3 cultivation methods, basic pests/diseases, treatments. _(OPEN: finalize list)_【F:docs/vision_scope.md†L214-L218】
- **Open-Source Strategy:** License model (e.g., AGPL/Polyform?); contributions via PR policy, CLA. _(OPEN: decide)_【F:docs/vision_scope.md†L254-L257】

## Provenance Index

**Sources:** docs/vision_scope.md § 1. Vision; docs/backend-overview.md § 3. Blueprints Provided & How to Use Them; docs/system/simulation-engine.md §§ Timebase & Core Loop, Environment Model, Plant Growth, Tasks, Economics; docs/\_extraction/formulas.md § Extracted Formulas; docs/system/socket_protocol.md § UI Stream (`uiStream$`); docs/ui-building_guide.md § Guiding Principles; docs/system/data-validation.md § Blueprint Data Validation Workflow; docs/DD.md § Conventions (apply to all files); docs/system/simulation_philosophy.md § 1. Time & Simulation Loop: Stability and Fairness

<!-- prettier-ignore-start -->
| Final Section | Primary Sources |
| --- | --- |
| 01-title-scope | `docs/vision_scope.md § 1. Vision`, `docs/backend-overview.md § 1. Purpose & Non-Goals`【F:docs/vision_scope.md†L5-L29】【F:docs/backend-overview.md†L3-L11】 |
| 02-core-principles | `docs/vision_scope.md § 1. Vision`, `docs/system/simulation_philosophy.md §§ 1–5`, `docs/backend-overview.md § 3.1 Operating Principles`【F:docs/vision_scope.md†L13-L17】【F:docs/system/simulation_philosophy.md†L5-L31】【F:docs/backend-overview.md†L40-L52】 |
| 03-domain-model | `docs/vision_scope.md § 4. Canonical Domain Model`, `docs/DD.md §§ 1–3`【F:docs/vision_scope.md†L84-L99】【F:docs/DD.md†L12-L331】 |
| 04-simulation-lifecycle | `docs/system/simulation-engine.md §§ Timebase & Core Loop, Environment Model, Plant Growth, Health, Tasks, Economics`【F:docs/system/simulation-engine.md†L12-L190】 |
| 05-math-formulas-overview | `docs/_extraction/formulas.md § Extracted Formulas`【F:docs/_extraction/formulas.md†L3-L440】 |
| 06-devices-and-effects | `docs/system/simulation-engine.md § Environment Model`, `docs/DD.md § 2) Devices`, `docs/backend-overview.md § 3.2 Blueprint–to–Subsystem Mapping`【F:docs/system/simulation-engine.md†L35-L59】【F:docs/DD.md†L203-L331】【F:docs/backend-overview.md†L54-L64】 |
| 07-economy-and-costs | `docs/vision_scope.md §§ 6–6a`, `docs/system/simulation-engine.md § Economics`, `docs/system/simulation_philosophy.md § 5`【F:docs/vision_scope.md†L112-L195】【F:docs/system/simulation-engine.md†L173-L190】【F:docs/system/simulation_philosophy.md†L27-L31】 |
| 08-data-and-blueprints | `docs/backend-overview.md § 3`, `docs/system/data-validation.md`, `docs/DD.md § Conventions`【F:docs/backend-overview.md†L40-L139】【F:docs/system/data-validation.md†L1-L53】【F:docs/DD.md†L1-L41】 |
| 09-telemetry-and-ui-views | `docs/system/socket_protocol.md §§ UI Stream, Connection & Handshake`, `docs/ui-building_guide.md §§ Guiding Principles, Layout & Navigation, Dashboard & Global Chrome`【F:docs/system/socket_protocol.md†L3-L145】【F:docs/ui-building_guide.md†L1-L127】 |
| 10-assumptions-constraints | `docs/vision_scope.md §§ 3, 12, 15, 16`【F:docs/vision_scope.md†L61-L315】 |
| 11-open-questions | `docs/vision_scope.md §§ 3, 4, 8, 13`【F:docs/vision_scope.md†L55-L257】 |
<!-- prettier-ignore-end -->

## Weedbreed Final Truth (docs/weedbreed-final-truth.md)

Source: [`docs/weedbreed-final-truth.md`](../docs/weedbreed-final-truth.md)

# Weedbreed Final Truth

## Table of Contents

- [Title & Scope](#title--scope)
- [Core Principles](#core-principles)
- [Domain Model](#domain-model)
- [Simulation Lifecycle](#simulation-lifecycle)
- [Math Formulas Overview](#math-formulas-overview)
- [Devices and Effects](#devices-and-effects)
- [Economy and Costs](#economy-and-costs)
- [Data and Blueprints](#data-and-blueprints)
- [Telemetry and UI Views](#telemetry-and-ui-views)
- [Assumptions and Constraints](#assumptions-and-constraints)
- [Open Questions](#open-questions)
- [Provenance Index](#provenance-index)

## Title & Scope

**Sources:** docs/vision_scope.md § 1. Vision; docs/backend-overview.md § 1. Purpose & Non-Goals

- **Weedbreed.AI** is positioned as a modular, deterministic cultivation simulation that spans structures, climate control, and plant lifecycles while remaining open and extensible through data-driven content contributions.【F:docs/vision_scope.md†L5-L17】
- The simulation core’s mandate is to deliver reproducible cultivation and economy modelling with structured telemetry and validated intent handling, keeping internal coupling hidden from clients.【F:docs/backend-overview.md†L3-L11】
- Experience pillars emphasise planning and optimisation of climate and lighting, risk management around pests and devices, and an economy loop that balances OpEx/CapEx, cash flow, and quality-driven pricing.【F:docs/vision_scope.md†L25-L29】
- Anti-scope guardrails exclude political or regulatory modelling, shooter-style mechanics, and lab-grade growth modelling so the project can favour plausible, playable systems over exhaustive realism.【F:docs/vision_scope.md†L19-L23】

## Core Principles

**Sources:** docs/vision_scope.md § 1. Vision; docs/system/simulation_philosophy.md §§ 1–5; docs/backend-overview.md § 3. Blueprints Provided & How to Use Them

- **Determinism first.** The simulation favours reproducibility over spectacle: every run uses seeded randomness, a fixed one-hour tick, and catch-up rules that prioritise fairness and responsiveness over raw step throughput.【F:docs/vision_scope.md†L13-L17】【F:docs/system/simulation_philosophy.md†L5-L8】
- **Emergent systems over monoliths.** Environment control is modelled as composable deltas (each device or plant contributes its own change), enabling extensibility and transparent root-cause analysis for players and developers alike.【F:docs/system/simulation_philosophy.md†L10-L12】
- **Stress → health → growth clarity.** Cultivation gameplay hinges on the player managing stressors so that health multiplies potential growth, making the optimisation loop explicit instead of opaque.【F:docs/system/simulation_philosophy.md†L14-L21】
- **Managerial control surface.** Autonomous employees claim tasks via utility scores so players focus on strategic decisions rather than micromanagement, aligning with the project’s indirect-control philosophy.【F:docs/system/simulation_philosophy.md†L23-L26】
- **Economic pressure with rewards.** Per-tick costs maintain constant tension while non-linear pricing amplifies high-quality harvests, rewarding mastery without relaxing deterministic accounting.【F:docs/system/simulation_philosophy.md†L27-L31】
- **Blueprint Doctrine.** Blueprints are delivered with the new repo as a validated set covering structures, room purposes, cultivation methods, strains, devices, pests, diseases, personnel roles, and price maps; they are immutable templates and are never instantiated directly, because runtime instances are created by copying a blueprint before the engine consumes them, which enables many simultaneous instances from a single template such as multiple small warehouses, rooms, or zones.【F:docs/backend-overview.md†L40-L52】

## Domain Model

**Sources:** docs/vision_scope.md § 4. Canonical Domain Model; docs/DD.md §§ 1–3

- **Spatial hierarchy.** Structures contain rooms that contain zones; zones host plantings and the devices that condition their microclimate, mirroring the gameplay drill-down from buildings to individual plants.【F:docs/vision_scope.md†L84-L89】
- **Lifecycle coverage.** Plant entities progress from seed through vegetative and flowering stages into harvest and post-harvest handling, while devices degrade over time, requiring maintenance and replacement decisions.【F:docs/vision_scope.md†L90-L94】
- **Tick scale.** The simulation advances in fixed one-hour ticks (24 ticks per in-game day, 7×24 per week), anchoring telemetry aggregation, audits, and replays to tick identifiers.【F:docs/vision_scope.md†L95-L99】
- **Blueprint-backed entities.** Strains define genetics, environmental preferences, nutrient and water demand, phenology, resilience, and lineage; cultivation methods govern area per plant, spacing, labour intensity, and compatible traits; devices declare type-specific settings such as power, PPFD, airflow, temperature targets, and dehumidification rates.【F:docs/DD.md†L12-L115】【F:docs/DD.md†L203-L331】

## Simulation Lifecycle

**Sources:** docs/system/simulation-engine.md §§ Timebase & Core Loop, Environment Model, Plant Growth, Stress, Health, Tasks & Agentic Employees, Economics

- **Fixed-step scheduler.** Wall-time deltas accumulate until they exceed `tickIntervalMs / gameSpeed`; each loop consumes the budget, runs one full tick, reduces the accumulator, and then publishes committed snapshots and batched events, ensuring deterministic pacing even when catch-up frames occur.【F:docs/system/simulation-engine.md†L12-L25】
- **Environment phase.** Every tick starts from the previous zone state, applies device deltas (lighting heat and PPFD, HVAC cooling/heating, humidity control, CO₂ injection), folds in plant-driven transpiration and photosynthesis, normalises toward ambient with airflow-scaled exponential pull, clamps to safety limits, and emits environmental anomaly events as needed.【F:docs/system/simulation-engine.md†L35-L66】
- **Plant phase.** Phenology advances by tick, resource requirements convert NPK and water curves to per-plant, per-tick demand, stress aggregates weighted penalties across climate and resource drivers, health adjusts via stress thresholds, potential growth factors (light, temperature, CO₂) combine with health to yield actual biomass gains, and quality tracking respects harvest windows.【F:docs/system/simulation-engine.md†L80-L105】
- **Health and workforce phases.** Pests and diseases progress through detect → progress → spread → treat steps with blueprint-driven risk and safety gates, while employees pull tasks by maximising utility functions, execute until `progressTicks ≥ durationTicks`, and accrue overtime per policy when energy dips below zero.【F:docs/system/simulation-engine.md†L115-L170】
- **Accounting phase.** CapEx posts immediately, OpEx aggregates maintenance, energy, and inputs using tick-hour scaling, rent multiplies hourly rates by tick length, labour costs respect overtime policies, and revenue applies quality-modified harvest pricing before finance events are emitted.【F:docs/system/simulation-engine.md†L173-L190】

## Math Formulas Overview

**Source:** docs/\_extraction/formulas.md § Extracted Formulas

### Breeding

- `T_gen = veg + flower + tail + post`【F:docs/\_extraction/formulas.md†L3-L12】
- `veg   = avg(vegetationDays[A], vegetationDays[B])`【F:docs/\_extraction/formulas.md†L14-L23】
- `flower= avg(floweringDays[A],  floweringDays[B])`【F:docs/\_extraction/formulas.md†L25-L34】
- `tail  = max(0, seedMaturationDays - (flower - pollinationDayInFlower))`【F:docs/\_extraction/formulas.md†L36-L45】
- `post  = postProcessingDays`【F:docs/\_extraction/formulas.md†L47-L56】
- `effectiveDays ≈ ceil(T_gen / parallelBatches)`【F:docs/\_extraction/formulas.md†L58-L67】
- `±noise × base`【F:docs/\_extraction/formulas.md†L113-L122】

### Terpenes

- `w_t = mg_g_t / total_mg_g`【F:docs/\_extraction/formulas.md†L69-L78】
- `axis = Σ (share_terpene × weight_terpene→axis) → clamp \[0..1]`【F:docs/\_extraction/formulas.md†L80-L89】

### Genetics & Resilience

- `sum ≤ 1`【F:docs/\_extraction/formulas.md†L91-L100】
- `1.0 = neutral`【F:docs/\_extraction/formulas.md†L102-L111】

### Capacity

- `Max plant count = floor(zoneArea / areaPerPlant)`【F:docs/\_extraction/formulas.md†L123-L133】

### Time Scaling

- `tickLengthMinutes / 60`【F:docs/\_extraction/formulas.md†L135-L144】
- `tickHours = tickLengthMinutes / 60`【F:docs/\_extraction/formulas.md†L366-L375】

### Tasks & Workforce

- `progressTicks >= durationTicks`【F:docs/\_extraction/formulas.md†L146-L155】
- `U = w1*priority + w2*skillMatch + w3*roleAffinity + w4*urgency`【F:docs/\_extraction/formulas.md†L421-L430】
- `w5*distance - w6*fatigue + w7*morale + w8*toolAvailability ± traitMods`【F:docs/\_extraction/formulas.md†L432-L440】

### Economics

- `revenue = harvestBasePricePerGram × modifiers`【F:docs/\_extraction/formulas.md†L157-L166】
- `device.power_kW × tickHours × electricityCostPerKWh`【F:docs/\_extraction/formulas.md†L355-L364】

### Scheduler & Seeding

- `Math.floor(tick / 2016)`【F:docs/\_extraction/formulas.md†L168-L177】
- `apiSeed = override ?? "<gameSeed>-<weekIndex>"`【F:docs/\_extraction/formulas.md†L179-L188】
- `accumulatedMs += now - lastNow`【F:docs/\_extraction/formulas.md†L212-L221】
- `accumulatedMs ≥ tickIntervalMs / gameSpeed`【F:docs/\_extraction/formulas.md†L223-L232】
- `accumulatedMs -= tickIntervalMs / gameSpeed`【F:docs/\_extraction/formulas.md†L234-L243】

### Probability

- `P(other) = pDiverse`【F:docs/\_extraction/formulas.md†L190-L199】
- `P(male) = P(female) = (1 - pDiverse) / 2`【F:docs/\_extraction/formulas.md†L201-L210】

### Environment & Humidity

- `ΔRH = (mass_kg ÷ (volume_m3 × SATURATION_VAPOR_DENSITY_KG_PER_M3)) × efficiency × powerMod`【F:docs/\_extraction/formulas.md†L245-L254】
- `Δ = k_mix * (ambient − current)`【F:docs/\_extraction/formulas.md†L256-L265】
- `Tₜ = Tₐ + (T₀ − Tₐ) · exp(−k · Δt)`【F:docs/\_extraction/formulas.md†L377-L386】

### Nutrition & Growth

- `req_phase = curve[phase]`【F:docs/\_extraction/formulas.md†L267-L276】
- `req_tick_plant = req_phase * (zoneArea / plantCount) * (tickHours / 24)`【F:docs/\_extraction/formulas.md†L278-L287】
- `stress_raw = Σ w_D * penalty_D`【F:docs/\_extraction/formulas.md†L289-L298】
- `stress = clamp01(stress_raw * (1 − generalResilience))`【F:docs/\_extraction/formulas.md†L300-L309】
- `stress > θ_stress`【F:docs/\_extraction/formulas.md†L311-L320】
- `health -= α * stress`【F:docs/\_extraction/formulas.md†L322-L331】
- `health += β_recovery`【F:docs/\_extraction/formulas.md†L333-L342】
- `actualGrowth = potentialGrowth * health * (1 − γ * stress)`【F:docs/\_extraction/formulas.md†L344-L353】

### Temperature & Transpiration

- `g_c = g₀ · clamp(LAI / 3, 0.3, 2)`【F:docs/\_extraction/formulas.md†L388-L397】
- `E = g_c · VPD · f_stomatal`【F:docs/\_extraction/formulas.md†L400-L408】
- `litres = E · area · Δt ÷ 3600 · 0.018`【F:docs/\_extraction/formulas.md†L410-L419】

## Devices and Effects

**Sources:** docs/system/simulation-engine.md § Environment Model; docs/DD.md § 2) Devices — `/data/blueprints/devices/*.json`; docs/backend-overview.md § 3.2 Blueprint–to–Subsystem Mapping

- **Device deltas.** Grow lights contribute heat proportional to power and map photon flux over coverage area to canopy PPFD, HVAC units steer temperature toward setpoints within hysteresis bands, dehumidifiers and humidifiers translate mass flow into relative humidity deltas, and CO₂ injectors push concentration toward targets capped by safety limits.【F:docs/system/simulation-engine.md†L35-L55】
- **Ambient normalisation.** After device and plant deltas, zones apply an exponential pull (`Δ = k_mix * (ambient − current)`) with airflow-dependent gain so ventilation hardware accelerates the return to ambient conditions.【F:docs/system/simulation-engine.md†L57-L59】
- **Blueprint parameters.** Device templates declare kind-specific settings (e.g., power, PPFD, coverage area, cooling capacity, airflow, targetTemperature, latent removal), quality and lifespan metadata, and allowed room purposes, giving the engine enough data to evaluate placement rules and runtime behaviour.【F:docs/DD.md†L203-L331】

## Economy and Costs

**Sources:** docs/vision_scope.md §§ 6–6a; docs/system/simulation-engine.md § Economics (currency-neutral); docs/system/simulation_philosophy.md § 5. Economic Model: Constant Pressure and Rewarding Mastery

- **Dual loops.** Expansion decisions manage CapEx—renting structures, purchasing or replacing devices, unlocking cultivation methods—while daily operations juggle OpEx via climate control, irrigation, pest mitigation, staffing, and consumables.【F:docs/vision_scope.md†L112-L123】
- **Cost mechanics.** Maintenance costs rise with device wear, energy spend is derived from power draw per tick hour, water and nutrient purchases follow per-m²/day demand curves, rent multiplies hourly base rates by tick length, and labour costs respect overtime policies, ensuring all recurring charges scale with the current tick duration.【F:docs/system/simulation-engine.md†L173-L190】
- **Quality-driven revenue.** Harvest sales multiply base price by quality modifiers, with the quality model rewarding high health and low stress while a non-linear price function amplifies above-baseline quality and penalises poor output.【F:docs/vision_scope.md†L129-L195】
- **Design intent.** Persistent per-tick expenses maintain financial pressure so passive play is unviable, whereas mastering the systems to raise quality yields outsized rewards, reinforcing the tycoon-style tension.【F:docs/system/simulation_philosophy.md†L27-L31】

## Data and Blueprints

**Sources:** docs/backend-overview.md § 3. Blueprints Provided & How to Use Them; docs/system/data-validation.md § Blueprint Data Validation Workflow; docs/DD.md § Conventions (apply to all files)

- **Blueprint Doctrine.** Blueprints are delivered with the new repo as a validated collection spanning structures, room purposes, cultivation methods, strains, devices, pests, diseases, personnel roles, and price maps; they are immutable templates, never instantiated directly, because runtime systems always materialise instances by copying a blueprint, which enables multiple simultaneous instances—such as many small warehouses, rooms, or zones—from the same template without mutating the source data.【F:docs/backend-overview.md†L40-L52】
- **Schema conventions.** All blueprints follow shared rules: UUID `id` keys, camelCase naming without unit suffixes, SI units for physical quantities, inclusive ranges, and validation that enforces required fields, numeric bounds, and cross-references before runtime use.【F:docs/DD.md†L1-L41】【F:docs/backend-overview.md†L46-L52】【F:docs/backend-overview.md†L123-L139】
- **Validation workflow.** The `pnpm validate:data` command parses each blueprint family, enforces casing-sensitive control setpoints, emits machine- and human-readable reports, and fails CI when errors appear, ensuring data drift is caught before integration.【F:docs/system/data-validation.md†L1-L53】
- **Materialisation pipeline.** Loading blueprints involves validation, copying template values into runtime records, resolving cross-map identifiers (e.g., price tables), and exposing read-only instances to subsystems so deterministic state changes never mutate source JSON.【F:docs/backend-overview.md†L123-L129】

## Telemetry and UI Views

# User-provided custom instructions

# Product Requirements Document (PRD)

## Modular Plant Growth Simulation (Open Architecture)

### Document Status

- **Owner:** Björn Ahlers
- **Audience:** Backend (Node.js) & Frontend (React) engineers, QA, DevOps
- **Version:** v1.0 (Initial)
- **References:** Architecture & naming conventions and domain schemas from the Weed Breed project are authoritative for units, tick semantics, and data blueprints. &#x20;

---

## 1) Goals & Non-Goals

### 1.1 Goals

- Deliver a **modular, extensible** simulation of plant physiology and climate that runs on Node.js and streams real-time telemetry to a web dashboard.
- Favor **proven libraries** (math/units, schema validation, charts, state management) over bespoke implementations.
- Ensure **determinism and replaceability** of the biology/physics module: drop-in upgrade of formulas without ripple effects.
- Provide **save/load** (JSON) with schema validation and versioning.

### 1.2 Non-Goals (v1)

- No 3D rendering or heavy CFD/psychrometrics (advanced models may be introduced later).&#x20;
- No multiplayer game logic (prepare event stream but keep single-user focus).&#x20;
- No persistence layer beyond file-based saves (DB offloading can be evaluated later).

---

## 2) Users, Personas & Use Cases

### 2.1 Personas

- **Simulation Engineer:** Develops & calibrates env/plant models; needs fast iteration and testability.
- **Gameplay/UX Engineer:** Builds dashboards and controls; needs stable event API and compact payloads.
- **Tuner/Designer:** Adjusts parameters (light setpoints, schedules, strain/method blueprints) without code changes.

### 2.2 Primary Use Cases

1. **Run a tick-based simulation** with configurable tick length (e.g., 1–10 minutes of sim time per tick).
2. **Adjust conditions at runtime** (pause/resume, tick rate, setpoints for light/temperature/CO₂).
3. **Visualize telemetry** (time-series charts for T, RH, VPD, PPFD; tables for plants/devices).
4. **Save & load** full state with schema validation and versioning.

---

## 3) System Overview

### 3.1 Architecture Summary

- **Backend (Node.js, ESM):** Simulation core (physics & plant model), scheduler/loop, event bus, save/load, Socket.IO gateway. Event-driven and deterministic.&#x20;
- **Frontend (React + Vite):** Real-time dashboard using Socket.IO, Zustand store, Recharts, TanStack Table.
- **Contracts:** JSON event payloads & schemas; SI units & naming conventions uniform across modules.&#x20;

### 3.2 World Model (v1)

- Hierarchy: **Building → Rooms → Zones → Plants**; zone-scoped environment state feeds plant model each tick.&#x20;
- Geometry utilities: room volumes, zone areas; coverage/limits of devices (lamp coverage m², HVAC airflow m³/h). &#x20;

---

## 4) Functional Requirements

### 4.1 Plant Physiology & Bioclimatics Module

- **Inputs per tick:** temperature (°C), relative humidity (0–1), CO₂ (ppm), PPFD (µmol·m⁻²·s⁻¹), zone volume (m³), leaf area index (LAI), water/nutrient status.
- **Outputs per tick:** VPD proxy, transpiration, photosynthesis rate, biomass increment, health/stress indicators.
- **Implementation Guidance:**
  - Provide a lightweight closed-form **VPD proxy, transpiration, and photosynthesis** (“arcade” model) with tunables and clamps.&#x20;
  - Keep all formulas in one module (e.g., `src/engine/plantModel.js` + `src/engine/envPhysics.js`) to allow **drop-in replacement** with more advanced models (e.g., Penman-Monteith) later.&#x20;
  - Use **Math.js** for unit handling/expressions where helpful; base units SI (implicit).&#x20;

- **Acceptance Examples (physics sanity):**
  - If **PPFD = 0**, photosynthesis increment must be ~0 (respiration ignored in v1).
  - If **RH decreases** (other factors constant), **VPD increases**, raising transpiration until clamped.
  - If **T deviates** strongly from `T_opt`, growth/stress functions reflect penalties.&#x20;

### 4.2 Simulation Loop & Scheduler

- Fixed or adjustable **tick length** (default minutes of sim time per tick), **pause/resume**, **step**, **fast-forward**.
- After each tick, emit an event `sim.tickCompleted` with snapshot/diff payloads for UI.&#x20;
- Provide optional discrete-event lib evaluation later; v1: Node timers + state machine orchestration.
- **Tick phase order (must):**
  1. `applyDevices` → 2) `deriveEnvironment` → 3) `irrigationAndNutrients` → 4) `updatePlants` → 5) `harvestAndInventory` → 6) `accounting` → 7) `commit`.&#x20;

### 4.3 Geometry & Environment Model

- **Room/Zone data:** area (m²), height (m), volume (m³), environmental state (T, RH, CO₂, PPFD).
- **Utilities:** `getVolume(room)`, lamp **coverageArea** checks, HVAC airflow → temperature delta via capacity model. &#x20;
- **Extensibility:** Prepared for later 2D/3D grid and more accurate psychrometrics (Magnus/psychrolib).&#x20;

### 4.4 Formula Evaluation & Units

- **Units:** SI throughout; **no unit suffixes** in keys. Convert at edges if needed.&#x20;
- **Dynamic formulas:** Concentrate tunables (e.g., `L50`, `C50`, `T_opt`) in config so designers can calibrate without code.&#x20;
- **Validation:** On load, verify formulas/parameters; surface precise errors.

### 4.5 Data Serialization (Save/Load) & Schema

- **Savegames:** Serialize full simulation state to **JSON** with `version`, timestamp, and deterministic RNG seed.
- **Schema Validation:** Use JSON Schema (Ajv) or Zod to validate saves & blueprints; include **versioning** for migration.
- **Blueprint Inputs:**
  - **Strains:** genotype, chemotype, morphology, environment prefs, photoperiod, disease & harvest windows.&#x20;
  - **Cultivation Methods:** area per plant, substrate, containerSpec, compatibility.&#x20;
  - **Devices:** kind, settings (power, airflow, cooling…), meta; prices/maintenance externalized.&#x20;
  - **Strain Prices:** `seedPrice`, `harvestPricePerGram` (max at quality=1; runtime modifiers apply).&#x20;

### 4.6 WebSocket Communication (Socket.IO)

- **Events (server → client):**
  - `simulationUpdate` (batched diff/min snapshot per tick),
  - `sim.tickCompleted`, domain events (`plant.stageChanged`, `plant.harvested`, `device.degraded`, `zone.thresholdCrossed`, `market.saleCompleted`).&#x20;

- **Events (client → server):**
  - `simulationControl` (`play|pause|step|fastForward`, `setTickLength`, `setSetpoint`),
  - `config.update` (optional gated: update tunables).

- **Payloads:** JSON, compact, with SI units implied; include `tick` and monotonic millisecond `ts`.

### 4.7 Client Application (React)

- **State:** Zustand global store; normalized slices for env time-series, plant/device tables.
- **Visualization:** Recharts (line for T/RH/PPFD/CO₂, small multiples), TanStack Table for inventory & events.
- **Controls:** Play/pause/step, tick rate slider, setpoint inputs (T, RH/target VPD, CO₂, light).
- **Performance:** Throttle chart updates (e.g., last N points), virtualize tables if needed.

### 4.8 Testing & Validation

- **Unit tests:** VPD, growth/stress clamps, device coverage checks, unit conversions.
- **Integration tests:** Multi-tick scenarios (e.g., lights off → zero growth; humidity drop → VPD↑ → transpiration↑).&#x20;
- **Schema tests:** Round-trip save/load; validate blueprints (strain/device/method/price).
- **Benchmarks:** Target per-tick compute **≤ 100 ms** at 10 ticks/sec on a dev laptop.

---

## 5) Non-Functional Requirements

- **Determinism:** Given same seed and inputs, state must be identical across runs.
- **Extensibility:** Hot-swappable plant/physics modules without touching loop, UI, or schemas.
- **Observability:** Structured logs (pino); event bus mirrors key domain events for UI and debugging.&#x20;
- **Resilience:** Graceful error handling at phase boundaries; no partial commits (commit-at-end per tick).&#x20;
- **Config:** `.env` for tick length, log level, seed; JSON for tunables & blueprints.

---

## 6) Detailed Design

### 6.1 Tick Orchestration

- Implement the tick order as a small **state machine** (XState) for clarity and testability; transitions on success/failure; **commit** at end.&#x20;

### 6.2 Event Bus

- Internal bus (RxJS Subject) with `emit(type, payload, tick, level)`, UI stream is buffered/throttled and forwarded to Socket.IO.&#x20;
- Event types use dotted namespaces (`plant.*`, `device.*`, `sim.*`, `market.*`).

### 6.3 Devices & Physical Limits

- Device blueprints define **settings**; runtime instantiation accounts for **coverageArea** (lamps), **airflow** and **coolingCapacity** (HVAC). Multiple devices may be needed for larger zones. &#x20;

### 6.4 Data & Naming Rules

- Use camelCase, **no unit suffixes**, SI implied, time in **hours/days**, prices in EUR (implicit), as per conventions.&#x20;

---

## 7) Interfaces & Payloads (Examples)

### 7.1 `simulationUpdate` (server → client)

```json
{
  "type": "simulationUpdate",
  "tick": 124,
  "ts": 1725712345678,
  "env": {
    "zoneId": "zone-a1",
    "temperature": 25.3,
    "humidity": 0.62,
    "co2": 980,
    "ppfd": 540,
    "vpd": 1.3
  },
  "plants": [{ "id": "p-01", "stage": "vegetation", "biomass_g": 142.1, "health": 0.93 }],
  "events": [{ "type": "device.degraded", "deviceId": "lamp-01", "severity": "info" }]
}
```

### 7.2 `simulationControl` (client → server)

```json
{ "type": "simulationControl", "action": "pause" }
```

```json
{ "type": "simulationControl", "action": "setTickLength", "minutes": 3 }
```

```json
{ "type": "simulationControl", "action": "setSetpoint", "target": "temperature", "value": 24 }
```

### 7.3 Savegame Header

```json
{
  "kind": "WeedBreedSave",
  "version": "1.0.0",
  "createdAt": "2025-09-07T08:00:00Z",
  "tickLengthMinutes": 3,
  "rngSeed": "wb-42-abc",
  "state": {
    /* ... */
  }
}
```

---

## 8) Data Blueprints (Authoritative)

- **Strain schema** (genetics, morphology, environment prefs, photoperiod, disease, harvest): used by plant factory.&#x20;
- **Cultivation method schema** (substrate, containerSpec, areaPerPlant, compatibility): drives capacity & plausibility checks.&#x20;
- **Device schema** (settings & meta; prices & maintenance externalized): per-tick effects derived from settings.&#x20;
- **Strain prices schema** (seed & harvest base price, runtime modifiers apply via market engine).&#x20;

---

## 9) Validation & QA

### 9.1 Unit Tests (Jest)

- **Physics:** VPD proxy monotonicity; temperature update with power/heat capacity; PPFD → photosynthesis saturation curve.&#x20;
- **Data:** Ajv/Zod validation for saves and blueprints (strain/device/method/price).
- **Naming:** Lint test to forbid unit suffixes in keys per conventions.&#x20;

### 9.2 Integration Scenarios

- **Dark Run:** PPFD=0 for 24h → biomass increment ~0; transpiration minimal (bounded by floor).
- **Dry Air:** Lower RH by 10% with constant T → VPD↑, transpiration↑, water store ↓ with irrigation controller reacting.
- **Coverage Limit:** Oversized zone with one lamp → PPFD cap; adding second lamp raises PPFD within geometric bounds.

### 9.3 Performance

- **Target:** ≤ 100 ms per tick at 10 tps with 1 room, 2 zones, 50 plants, 4 devices.
- Provide a `npm run bench` script with fixed seed and fixture data.

---

## 10) Security, Logging & Telemetry

- **Logging:** pino JSON logs (level from ENV), include `{ tick, zoneId, plantId? }` in context.&#x20;
- **Socket:** Namespaces/rooms (future-proof); in v1 single client namespace.
- **Config:** `dotenv` for tick length, seeds, log levels; hot reload of blueprint files with chokidar (dev only).&#x20;

---

## 11) Milestones & Deliverables

1. **M1 – Core Loop & Bus (Backend)**
   - Tick state machine with ordered phases; RxJS event bus; Socket.IO gateway; dummy zone & single plant.
   - Unit tests for tick order and `sim.tickCompleted`.

2. **M2 – Physics & Plant Model**
   - Env physics + arcade plant model; tunables in JSON; tests for VPD/photosynthesis/transpiration; coverage checks.

3. **M3 – Save/Load & Schemas**
   - Ajv/Zod validation for savegames; versioned saves; blueprint loaders (strain/device/method/prices).

4. **M4 – Dashboard (Frontend)**
   - Zustand store; charts & tables; controls (play/pause/step/rate/setpoints); basic theming.

5. **M5 – Benchmarks & Hardening**
   - Bench suite; error handling; graceful shutdown; docs & examples.

---

## 12) Risks & Mitigations

- **Over-complex models** slow ticks → **Mitigation:** start with simplified formulas; keep upgrade path documented.&#x20;
- **Payload bloat** over WebSocket → **Mitigation:** diffs or downsampling; UI throttling.
- **Schema drift** in blueprints → **Mitigation:** strict validation and version gates; migration scripts.

---

## 13) Open Questions

- Do we require **psychrometric coupling** (T↔RH via saturation vapor pressure) in v1 or v1.1?&#x20;
- Should **market/price modifiers** (quality, brand, demand) ship in v1 or remain stubbed?&#x20;
- How many **zones/plants** are the default stress test targets for CI?

---

## 14) Definition of Done (DoD)

- All functional requirements implemented with passing unit/integration tests.
- Dashboard reflects `simulationUpdate` in real time and controls work (pause/step/rate/setpoints).
- Save/load round-trips validated; blueprint schemas locked with version headers.
- Benchmarks meet performance target on reference hardware.

---

## 15) Appendix: Tick Physics (Reference)

Core formula references used for v1 arcade model (transpiration, photosynthesis, temperature, humidity pool, device control hysteresis) are documented in **WB-Formeln.md** and MUST remain encapsulated behind the physics module boundary for future model swaps.&#x20;

---

### Implementation Notes for Codex

- **Node:** ESM only; modules under `src/engine`, `src/sim`, `src/lib`.
- **Events:** Mirror the ADR’s event taxonomy; forward UI-safe stream over Socket.IO.&#x20;
- **Schemas:** Load & validate blueprints per their schema docs before runtime use. &#x20;
- **Naming & Units:** Enforce conventions (lint/CI check).&#x20;

> This PRD is designed to be “open architecture”: physics and plant models are boxed behind a single module boundary; devices, strains, and methods are pure JSON blueprints; the loop and event bus are stable contracts for UI and future systems. &#x20;

## Assumptions and Constraints

**Sources:** docs/vision_scope.md §§ 3, 12, 15, 16

- **Performance envelope.** The reference scenario must sustain at least one tick per second at 1× speed with a per-tick CPU budget under 50 ms, aligning balancing and benchmark work around that baseline.【F:docs/vision_scope.md†L61-L77】
- **Deterministic numerics.** All randomness flows through seeded generators, SI units underpin every quantity, persistence uses JSON numbers with up to six decimal places, and audit comparisons apply tight relative and absolute tolerances, constraining both engine and content design.【F:docs/vision_scope.md†L305-L315】
- **Validation and safety.** Safe defaults on parameter errors, strict schema validation at load, and prohibition of `Math.random` in the core guard against drift and ensure deterministic recovery.【F:docs/vision_scope.md†L245-L249】【F:docs/vision_scope.md†L311-L315】
- **Community expectations.** The roadmap assumes modding demand, deterministic replays as a core value proposition, and broad acceptance of SI units, guiding documentation and tooling priorities.【F:docs/vision_scope.md†L293-L296】
- **Localization and privacy.** Out-of-the-box support targets German and English with SI units and configurable formatting, while saves remain local and avoid personal data, bounding compliance scope.【F:docs/vision_scope.md†L247-L250】

## Open Questions

**Sources:** docs/vision_scope.md §§ 3, 4, 8, 13

- **First Harvest Time:** First harvest in **< 30 minutes** of play (MVP default setup). _(OPEN: validate)_【F:docs/vision_scope.md†L55-L56】
- **Retention Proxy:** 70% of players reach day 7 of a sandbox save. _(OPEN: measure)_【F:docs/vision_scope.md†L55-L57】
- **Memory Target:** Reference scenario uses < **1.0 GB RAM**. _(OPEN: finalize)_【F:docs/vision_scope.md†L61-L64】
- **Time Scale.** Tick-based with fixed tick duration: **default tick length = 5 in-game minutes**; **12 ticks = 1 in-game hour**, **288 ticks = 1 in-game day**, **7×288 ticks = 1 in-game week**. Ticks are aggregated into day/week summaries; replays/logs reference tick IDs. _(OPEN: standard wall-clock tick duration, e.g., 1 min)_【F:docs/vision_scope.md†L95-L96】
- **v1 Scope (Targets):** \~8–12 strains, \~10–15 devices, 2–3 cultivation methods, basic pests/diseases, treatments. _(OPEN: finalize list)_【F:docs/vision_scope.md†L214-L218】
- **Open-Source Strategy:** License model (e.g., AGPL/Polyform?); contributions via PR policy, CLA. _(OPEN: decide)_【F:docs/vision_scope.md†L254-L257】

## Provenance Index

**Sources:** docs/vision_scope.md § 1. Vision; docs/backend-overview.md § 3. Blueprints Provided & How to Use Them; docs/system/simulation-engine.md §§ Timebase & Core Loop, Environment Model, Plant Growth, Tasks, Economics; docs/\_extraction/formulas.md § Extracted Formulas; docs/system/socket_protocol.md § UI Stream (`uiStream$`); docs/ui-building_guide.md § Guiding Principles; docs/system/data-validation.md § Blueprint Data Validation Workflow; docs/DD.md § Conventions (apply to all files); docs/system/simulation_philosophy.md § 1. Time & Simulation Loop: Stability and Fairness

<!-- prettier-ignore-start -->
| Final Section | Primary Sources |
| --- | --- |
| 01-title-scope | `docs/vision_scope.md § 1. Vision`, `docs/backend-overview.md § 1. Purpose & Non-Goals`【F:docs/vision_scope.md†L5-L29】【F:docs/backend-overview.md†L3-L11】 |
| 02-core-principles | `docs/vision_scope.md § 1. Vision`, `docs/system/simulation_philosophy.md §§ 1–5`, `docs/backend-overview.md § 3.1 Operating Principles`【F:docs/vision_scope.md†L13-L17】【F:docs/system/simulation_philosophy.md†L5-L31】【F:docs/backend-overview.md†L40-L52】 |
| 03-domain-model | `docs/vision_scope.md § 4. Canonical Domain Model`, `docs/DD.md §§ 1–3`【F:docs/vision_scope.md†L84-L99】【F:docs/DD.md†L12-L331】 |
| 04-simulation-lifecycle | `docs/system/simulation-engine.md §§ Timebase & Core Loop, Environment Model, Plant Growth, Health, Tasks, Economics`【F:docs/system/simulation-engine.md†L12-L190】 |
| 05-math-formulas-overview | `docs/_extraction/formulas.md § Extracted Formulas`【F:docs/_extraction/formulas.md†L3-L440】 |
| 06-devices-and-effects | `docs/system/simulation-engine.md § Environment Model`, `docs/DD.md § 2) Devices`, `docs/backend-overview.md § 3.2 Blueprint–to–Subsystem Mapping`【F:docs/system/simulation-engine.md†L35-L59】【F:docs/DD.md†L203-L331】【F:docs/backend-overview.md†L54-L64】 |
| 07-economy-and-costs | `docs/vision_scope.md §§ 6–6a`, `docs/system/simulation-engine.md § Economics`, `docs/system/simulation_philosophy.md § 5`【F:docs/vision_scope.md†L112-L195】【F:docs/system/simulation-engine.md†L173-L190】【F:docs/system/simulation_philosophy.md†L27-L31】 |
| 08-data-and-blueprints | `docs/backend-overview.md § 3`, `docs/system/data-validation.md`, `docs/DD.md § Conventions`【F:docs/backend-overview.md†L40-L139】【F:docs/system/data-validation.md†L1-L53】【F:docs/DD.md†L1-L41】 |
| 09-telemetry-and-ui-views | `docs/system/socket_protocol.md §§ UI Stream, Connection & Handshake`, `docs/ui-building_guide.md §§ Guiding Principles, Layout & Navigation, Dashboard & Global Chrome`【F:docs/system/socket_protocol.md†L3-L145】【F:docs/ui-building_guide.md†L1-L127】 |
| 10-assumptions-constraints | `docs/vision_scope.md §§ 3, 12, 15, 16`【F:docs/vision_scope.md†L61-L315】 |
| 11-open-questions | `docs/vision_scope.md §§ 3, 4, 8, 13`【F:docs/vision_scope.md†L55-L257】 |
<!-- prettier-ignore-end -->

## Weedbreed.AI UI Building Guide (docs/ui-building_guide.md)

Source: [`docs/ui-building_guide.md`](../docs/ui-building_guide.md)

# Weedbreed.AI UI Building Guide

The Weedbreed.AI dashboard renders read-only simulation snapshots and routes every user gesture through the System Facade so that the deterministic engine enforces geometry, biology, and economic rules.【F:docs/ui/ui_archictecture.md†L1-L74】【F:docs/ui/ui-implementation-spec.md†L1-L96】 This guide consolidates the architecture notes, interaction specs, component references, and screenshot insights into a single build manual for teams extending or rebuilding the frontend without introducing business logic to the UI layer.

The application follows a structure → room → zone drill-down supported by persistent dashboard controls, breadcrumb navigation, and modal workflows that pause gameplay until intents succeed, aligning macro management with per-zone cultivation flows.【F:docs/ui/ui-implementation-spec.md†L11-L220】【F:docs/ui/ui-screenshot-insights.md†L1-L52】 All requirements below reuse the existing terminology (UUID identifiers, facade intents, Tailwind tokens) and consolidate the latest architecture decisions so downstream teams can implement features without guessing at contract details.

## Table of Contents

- [Guiding Principles](#guiding-principles)
- [Layout & Navigation](#layout--navigation)
- [Core Views](#core-views)
- [UI Elements & Patterns](#ui-elements--patterns)
- [Interactions](#interactions)
- [States & Telemetry](#states--telemetry)
- [Accessibility & Performance](#accessibility--performance)
- [Visual Guardrails](#visual-guardrails)
- [Glossary](#glossary)
- [Changelog Note](#changelog-note)
- [Open Issues](#open-issues)

## Guiding Principles

- **Logic-free presentation.** The UI never computes harvest revenue, growth, or geometry; it renders snapshots and issues facade commands only.【F:docs/ui/ui_archictecture.md†L1-L74】【F:docs/ui/ui_interactions_spec.md†L1-L88】 Components remain "dumb" so the deterministic engine governs validation, costing, and state transitions.
- **Unidirectional dataflow.** Rendering always follows the Render → Intent → Facade Command → Engine Commit → Event Notify → Re-render cycle, ensuring predictable updates and debuggable behavior.【F:docs/ui/ui_archictecture.md†L16-L74】
- **Authoritative identities.** Every cross-reference uses `id` (UUID v4); UI elements may display names but never join on them, and events carry minimal UUID payloads that must be resolved against the latest snapshot.【F:docs/ui/ui_archictecture.md†L1-L140】【F:docs/ui/ui_interactions_spec.md†L1-L114】
- **Naming conventions.** Inputs and intents reuse the System Facade vocabulary (`world.createRoom`, `devices.installDevice`, `plants.addPlanting`, etc.) without introducing alternative spellings, keeping parity with backend docs.【F:docs/ui/ui_archictecture.md†L75-L140】【F:docs/ui/ui-implementation-spec.md†L260-L380】
- **Design-system primitives.** Teams must rely on the shared Button, IconButton, form field, and InlineEdit primitives instead of ad-hoc styling so that theme and focus states remain centralised.【F:docs/ui/ui_elements.md†L5-L24】
- **Modal discipline.** Opening a modal pauses the simulation, blurs background content, and focus is trapped until the modal closes, after which the prior run state is restored.【F:docs/ui/ui-implementation-spec.md†L96-L220】
- **Dark-first theming.** Tailwind tokens rooted in the stone palette with lime accents define the dark theme across cards, inputs, and overlays; the light theme pairs `#fafafa` surfaces and `#111827` text with lime-600 accents so both themes share semantic tokens and AA contrast.【F:docs/ui/ui-components-desciption.md†L551-L614】
- **Responsive-first layouts.** Desktop is the design baseline. Breakpoints align with Tailwind (`lg ≥1024px`, `xl ≥1440px`) while `md`/`sm` fall back to stacked single-column layouts: dashboards switch to `grid-template-columns: repeat(auto-fill, minmax(260px, 1fr))`, zone detail stacks below `md`, and header controls wrap under `sm` before rejoining on wider screens.【F:docs/ui/ui-implementation-spec.md†L160-L220】【F:docs/ui/ui-components-desciption.md†L407-L533】
- **Tick length controlled by backend.** The UI only exposes deterministic play/pause and speed presets; users cannot adjust tick duration directly so simulation cadence remains façade governed.

## Layout & Navigation

### Application Shell

- The single-page app keeps a persistent header (`DashboardHeader`), breadcrumb navigation, sidebar, and dynamic content area orchestrated by the navigation manager (`{ currentView, selectedStructureId?, selectedRoomId?, selectedZoneId? }`).【F:docs/ui/ui-implementation-spec.md†L11-L120】【F:docs/ui/ui_archictecture.md†L75-L140】【F:docs/ui/ui-components-desciption.md†L225-L360】
- The start screen centers the Weedbreed.AI title, subtitle, and primary actions (New, Load, Import) before transitioning to the main shell once a run is active.【F:docs/ui/ui_elements.md†L11-L44】【F:docs/ui/ui-components-desciption.md†L393-L420】 The "Quick Start" preset seeds `"WB-quickstart-default"`, rents one compact warehouse (≈600 m², 2.5 m height), provisions a growroom with three 20 m² zones configured for SOG, stocks 10 000 L water and 100 kg nutrients, equips each zone with 2× GrowLight (10–12 m² coverage), 1× ClimateUnit, 1× Dehumidifier, and 1× CO₂-Injector, and plants 40 `ak-47` strain starters with Auto-Replant disabled; simulation remains paused until the player explicitly starts it.
- Sidebar navigation lists rooms and zones for the selected structure, with nested toggles and CTA hooks (e.g., "Add Room") tied to modal flows.【F:docs/ui/ui-components-desciption.md†L225-L360】

### Responsive Breakpoints & Navigation Behaviour

- Breakpoints follow a desktop-first Tailwind scale: `xs <480px`, `sm 480–767px`, `md 768–1023px`, `lg 1024–1439px`, `xl ≥1440px`. Only `lg` and `xl` have bespoke layouts; smaller breakpoints reuse stacked single-column variants.
- Dashboard and grid surfaces use `grid-template-columns: repeat(auto-fill, minmax(260px, 1fr))` from `sm` upward, collapsing to a single stretched card column on `xs` widths.
- Zone detail presents two columns (`1.2fr / 1fr`) from `lg` upward; `md` and below stack content with the status column rendering before management panels to preserve reading order.
- Header controls wrap into two rows under `sm`, then collapse back to a single row from `md` upward so presets stay reachable without overflow.
- Sidebar becomes an off-canvas drawer below `md`, opened via hamburger button, locking body scroll, applying `.content-area.blurred`, and only closing via explicit controls; overlay clicks remain disabled to align with modal policy.

### Persistent Dashboard & Controls

```css
.dashboard {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
}
.dashboard-metrics,
.dashboard-controls {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}
.game-speed-controls .btn {
  padding: 0.4rem 0.6rem;
  border-radius: 0.5rem;
}
.game-speed-controls .btn.active {
  background: var(--color-primary);
  color: #fff;
}
```

- The left cluster renders StatCards for the global KPIs and time display:
  - **Capital:** shows the current balance with currency-neutral formatting applied by the UI layer.【F:docs/ui/ui-implementation-spec.md†L56-L58】【F:docs/ui/ui_elements.md†L31-L33】
  - **Cumulative Yield:** totals harvested output in grams.【F:docs/ui/ui-implementation-spec.md†L56-L58】【F:docs/ui/ui_elements.md†L33-L34】
  - **Planned plant capacity:** sums `zones[].plantingPlan.count` for enabled plans and hides when the aggregate is zero to avoid early-run clutter.【F:docs/ui/ui-implementation-spec.md†L56-L58】
  - **Time display:** combines the in-game date/time (e.g., `Y1, D30, 14:00`) with an SVG tick-progress ring that animates toward the next tick via `stroke-dashoffset` transitions.【F:docs/ui/ui-implementation-spec.md†L59-L66】【F:docs/ui/ui_elements.md†L31-L34】
- The right cluster groups the deterministic controls and shortcuts:
  - **Play/Pause** toggle using `play_circle` / `pause_circle` icons.【F:docs/ui/ui-implementation-spec.md†L69-L71】【F:docs/ui/ui_elements.md†L36-L40】
  - **Game speed presets** for `0.5x`, `1x`, `10x`, `25x`, `50x`, `100x`, and `250x`, with the active button styled via the `.active` class and the primary color token.【F:docs/ui/ui-implementation-spec.md†L69-L81】【F:docs/ui/ui_elements.md†L36-L41】
  - **View switchers** for Finances (`monitoring`) and Personnel (`groups`).【F:docs/ui/ui-implementation-spec.md†L84-L86】【F:docs/ui/ui_elements.md†L41-L44】
  - **Notifications** button with an unread badge plus the **Game Menu** (`settings`) flyout exposing Save, Load, Export, and Reset actions.【F:docs/ui/ui-implementation-spec.md†L88-L89】【F:docs/ui/ui_elements.md†L44-L46】
- Notifications display an unread badge, and the game menu opens the shared modal to reach Save/Load/Export/Reset actions.【F:docs/ui/ui-implementation-spec.md†L37-L142】【F:docs/ui/ui-components-desciption.md†L323-L337】 The notification popover contains tabs for _All_, _Warnings_, and _Errors_ with 20-item lazy-loaded pages, renders items shaped as `{ id, ts, severity, title, message, entityId?, entityType?, actions?[] }`, and raises the header badge with the count of unopened warning/error events sourced from `sim.*`, `world.*`, `hr.*`, and `finance.*` streams.

### Breadcrumbs & States

```css
.breadcrumbs {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.breadcrumbs a {
  color: var(--color-link);
  text-decoration: none;
}
.breadcrumbs .sep {
  opacity: 0.6;
}
```

- Breadcrumbs mirror the hierarchy (Structures → Structure → Room → Zone) and expose a back arrow for stepping upward; each segment is clickable and updates the navigation state via `goTo`/`back` actions.【F:docs/ui/ui-implementation-spec.md†L120-L150】【F:docs/ui/ui_archictecture.md†L75-L140】
- The content area applies a blur and disables pointer events whenever any modal is active, reinforcing modal focus and the pause-first policy.【F:docs/ui/ui-implementation-spec.md†L80-L106】

```css
.content-area.blurred {
  filter: blur(3px);
  pointer-events: none;
}
```

### Panel Layouts & Responsive Breakpoints

- Zone detail screens render a two-column grid (`1.2fr / 1fr`) for status vs. list panels, collapsing to a single column below 900 px, which must be respected when designing responsive breakpoints.【F:docs/ui/ui-implementation-spec.md†L180-L220】
- Structure, room, and zone overviews rely on responsive card grids using `grid-template-columns: repeat(auto-fill, minmax(260px, 1fr))`, ensuring cards wrap gracefully on narrow screens.【F:docs/ui/ui-implementation-spec.md†L120-L180】
- The screenshot insights confirm that dashboard, structure, room, and zone compositions must preserve quick inline actions (rename, duplicate, delete) within these responsive layouts.【F:docs/ui/ui-screenshot-insights.md†L1-L64】
- Personnel and finance views use tabbed and collapsible panels while remaining accessible through the persistent header navigation.【F:docs/ui/ui-components-desciption.md†L470-L533】
- Below `md` widths the sidebar shifts to an off-canvas drawer opened via the header hamburger, locking body scroll and applying `.content-area.blurred`; modal stacking follows the single-modal queue outlined in [Responsive Breakpoints & Navigation Behaviour](#responsive-breakpoints--navigation-behaviour).

## Core Views

### Start Screen

- Displays "Weedbreed.AI - Reboot" with subtitle "Your AI-powered cannabis cultivation simulator." and three actions: New Game, Load Game, Import Game (Quick Start optional per StartScreen component).【F:docs/ui/ui_elements.md†L11-L44】【F:docs/ui/ui-components-desciption.md†L393-L420】
- The corresponding screenshot (`01-welcome-screen.png`) maps to `StartScreen` in `App.tsx`, invoking lifecycle intents (`newGame`, `load`, `importState`).【F:docs/ui/ui-components-desciption.md†L393-L420】
- Quick Start loads the deterministic seed `"WB-quickstart-default"`, rents a 600 m² warehouse with a growroom of three 20 m² SOG zones, preloads 10 000 L water and 100 kg nutrients, installs 2× GrowLight, 1× ClimateUnit, 1× Dehumidifier, and 1× CO₂-Injector per zone, and plants 40 `ak-47` starters with Auto-Replant disabled.

### Dashboard & Global Chrome

- Persistent header presents StatCards for **Capital**, **Cumulative Yield**, and **Planned plant capacity**, plus the in-game **Time display** with its SVG tick-progress ring to visualize the march toward the next tick.【F:docs/ui/ui-implementation-spec.md†L56-L66】【F:docs/ui/ui_elements.md†L31-L34】
- Control cluster covers the **Play/Pause** toggle, the `0.5x`/`1x`/`10x`/`25x`/`50x`/`100x`/`250x` game-speed presets with `.active` styling, Finances and Personnel view switchers, the notifications popover, and the `settings` flyout for Save/Load/Export/Reset.【F:docs/ui/ui-implementation-spec.md†L69-L89】【F:docs/ui/ui-components-desciption.md†L223-L360】【F:docs/ui/ui_elements.md†L36-L46】
- `DashboardHeader` consumes stats, simulation state, and navigation callbacks; `EventLog` sits at the footer to surface recent telemetry color-coded by severity.【F:docs/ui/ui-components-desciption.md†L225-L360】
- Screenshot insights show inline actions within cards to encourage drill-down and highlight consistent dark theming across cards.【F:docs/ui/ui-screenshot-insights.md†L1-L64】
- Notification popover mirrors header alerts with tabs for _All_, _Warnings_, and _Errors_, paginates 20 items per lazy-loaded page, and surfaces severity icons consistent with toast/event log styling.

### Structures Overview

- `DashboardView` renders rented structures as cards inside a responsive grid, each showing name, floor area, room count, plant summary, and inline rename/duplicate actions via `InlineEdit` + `ActionIcons`.【F:docs/ui/ui-implementation-spec.md†L120-L180】【F:docs/ui/ui-components-desciption.md†L483-L487】【F:docs/ui/ui_elements.md†L84-L140】
- `+ Rent Structure` button launches the rent modal; duplication flows preview costs and device counts before dispatching intents.【F:docs/ui/ui-implementation-spec.md†L120-L180】【F:docs/ui/ui-components-desciption.md†L313-L360】
- Screenshot `03-structure-overview.png` confirms these cards and quick actions.【F:docs/ui/ui-screenshot-insights.md†L1-L64】

### Structure Detail View

- Header displays structure name with rename (`edit`) and delete (`delete`) icons, area usage, and CTA to `+ Add Room`. Cards for each room include area, purpose, zone counts, plant summaries, and inline rename/duplicate/delete actions.【F:docs/ui/ui-implementation-spec.md†L120-L200】【F:docs/ui/ui_elements.md†L116-L176】【F:docs/ui/ui-components-desciption.md†L521-L525】
- Duplicate flows use modals summarizing footprint, zone counts, and CapEx estimates before invoking `world.duplicateStructure`.【F:docs/ui/ui-components-desciption.md†L313-L360】
- Screenshot `09-structure-detailview.png` illustrates nested zone cards inside the structure detail.【F:docs/ui/ui-screenshot-insights.md†L21-L52】

### Room Detail View

- Header lists room name, purpose badge, rename/delete icons, and capacity usage; zone grids appear for grow rooms, while labs swap in the `BreedingStation` component.【F:docs/ui/ui-implementation-spec.md†L200-L260】【F:docs/ui/ui_elements.md†L140-L196】
- Zone cards show name, area, cultivation method, plant summaries, and inline rename/duplicate/delete actions; clicking navigates to zone detail.【F:docs/ui/ui-implementation-spec.md†L200-L240】【F:docs/ui/ui-components-desciption.md†L407-L420】
- Screenshot `10-room-overview-(growroom).png` captures the zone grid and inline actions.【F:docs/ui/ui-screenshot-insights.md†L21-L52】

#### BreedingStation (Lab Rooms)

- Lab-purpose rooms swap the standard zone grid for the `BreedingStation` workspace that manages deterministic breeding runs while keeping grow-room flows untouched.
- Primary run states drive the view hierarchy: `Idle` (history table with "Start Cross" CTA), `Configuring` (parent picker, trait targets, batch size, deterministic seed), `Running` (progress timeline with simulated days, ETA, cancel/abort controls), `Completed` (offspring table with keep/discard actions, promote/export flows), and `Archived` (read-only review with option to re-open).
- Core components include `ParentPicker` (multi-select by strain UUID with phenology/lighting hints), `TraitTargets` sliders (THC/CBD, vigor, stress resilience, growth duration), `CrossSummary` badges (F1/F2 label, batch size, seed, noise bounds), `RunProgress` (steps, elapsed ticks/days, logs), `OffspringTable` (sortable columns for id/genotype/chemotype/phenology/qualityScore/viability/notes with keep/promote actions), and `PromoteModal` (confirms new strain blueprint metadata and parent lineage).
- Data contract relies on `BreedingRun` snapshots providing metadata, parent IDs, batch size, seed, optional trait targets, run status timestamps, offspring previews, and notes. Each offspring exposes heuristic quality/chemotype/phenology/resilience/viability fields plus `keep` flags for client-side toggles.
- Facade intents routed through the bridge hook: `breeding.startRun`, `breeding.abortRun`, `breeding.finalizeRun`, and `breeding.promoteOffspring` (with blueprint naming + optional slug) — every action pauses the simulation like other modals and resumes after commit.

### Zone Detail View

- Header includes zone name with sibling navigation arrows (`arrow_back_ios`, `arrow_forward_ios`), rename/delete icons, and ensures zone-level actions remain accessible.【F:docs/ui/ui-implementation-spec.md†L220-L320】【F:docs/ui/ui_elements.md†L196-L260】
- Layout splits into two columns (status vs. management) above 900 px and stacks below; screenshot `11`–`13` illustrate collapsed vs. expanded environment controls and batch plant selection.【F:docs/ui/ui-implementation-spec.md†L220-L360】【F:docs/ui/ui-screenshot-insights.md†L33-L64】
- **Zone Info Panel (left column):**
  - General info for area, method, plant counts.
  - Supplies card with water/nutrient stocks plus buttons to add supply (modal).
  - Lighting card with cycle, coverage (color-coded classes), and DLI/PPFD metrics derived from backend `coverageRatio` and readings.【F:docs/ui/ui-implementation-spec.md†L240-L360】
  - Environment card showing temperature, humidity, CO₂ with out-of-range highlighting and VPD proxy as secondary metric.【F:docs/ui/ui-implementation-spec.md†L240-L360】【F:docs/ui/ui-components-desciption.md†L407-L462】 Thresholds: temperature 22–28 °C (green), 20–22/28–30 °C (yellow), <20/>30 °C (red with copy "Canopy warm → Transpiration ↑, Stress risk" when exceeding 30 °C); relative humidity 0.45–0.65 (green), 0.40–0.45/0.65–0.70 (yellow), <0.40/>0.70 (red with "Air too humid → Pathogen risk; increase dehumidification" at >0.70); CO₂ 800–1 200 ppm (green), 600–800/1 200–1 400 ppm (yellow), <600/>1 400 ppm (red, recommending safety shutdown above 1 800 ppm).
- **Management Panels (right column):**
  - Plantings list supports expand/collapse, per-plant harvest (`content_cut`), group delete (`delete`), and strain info tooltips; Harvest All CTA appears when plants ready.【F:docs/ui/ui-implementation-spec.md†L260-L360】
- Planting Plan panel manages auto-replant toggles, strain/quantity config, and edit/delete flows using modals.【F:docs/ui/ui-implementation-spec.md†L260-L360】
- Manual planting overrides Auto-Replant by applying a manual lock; the UI raises a banner "Auto-Replant paused (manual planting active)" with a "Resume Auto-Replant" CTA that clears the lock and emits `plants.autoReplantResumed`, while the pause event triggers `plants.autoReplantPaused`.
- Devices list groups by type with status indicator chips (`status-on/off/mixed/broken`), toggles all-on/off, exposes tuning, light cycle, install, update, move, and remove actions via modals.【F:docs/ui/ui-implementation-spec.md†L260-L360】【F:docs/ui/ui-components-desciption.md†L421-L533】
- Device group toggles confirm for safety-critical HVAC, CO₂, and dehumidifier groups with risk copy, while low-impact lighting and ventilation flips act immediately, showing "Group: ON/OFF" toasts and still awaiting façade acknowledgements.
  - ZonePlantPanel supports normal inspection (tooltips, direct actions) and batch-selection mode with BatchActionBar actions for Harvest/Trash/Treat across selected plants.【F:docs/ui/ui-components-desciption.md†L421-L533】
- Empty zone states include dedicated illustrations plus CTAs: "Install device" when device list empty, "Plant" when no plantings exist, and secondary "Configure Auto-Replant" when plans are absent; each tooltip explains prerequisites (e.g., method setup).
- Strain info tooltips (hover on `info` icon) display name, genotype percentages (sativa/indica/ruderalis when available), phenology (seedling/veg/flowering days), environmental targets (PPFD, temperature, RH corridors), NPK guidance for veg/flower, price hints (baseline harvest price when price maps resolve), and resolved lineage parent names pulled from strain blueprints and lineage lookups.
- Pest/disease badges expose name + category (`Pest`/`Disease`), severity (0–1 or % with color coding), environment risk bands (e.g., “favored at RH > 0.7, 22–26 °C”), up to three bullet symptoms, any active timers (PHI, re-entry) when treatments exist, and a CTA to open the `InfoModal` for full blueprint details with current zone health context.

### Finances View

- Presents high-level KPIs via `StatCard`s and collapsible panels for Revenue, OpEx, and CapEx, with time-range filters (1D/1W/1M/1Y).【F:docs/ui/ui-components-desciption.md†L470-L509】【F:docs/ui/ui_elements.md†L260-L300】
- Icons include `trending_up`, `receipt_long`, `account_balance`, and `DollarIcon` for quick comprehension.【F:docs/ui/ui-components-desciption.md†L470-L509】
- Screenshots `06` and `07` show collapsed vs. expanded states, confirming the toggle affordances.【F:docs/ui/ui-screenshot-insights.md†L41-L64】
- Missing finance figures render an em dash (`—`) with tooltip "No data in range"; negative numbers tint red and may optionally use parentheses `(–1 234,56)` to emphasise losses while preserving locale formatting.
- Currency and number formatting leverage `Intl.NumberFormat`, deriving locale from app language (DE/EN) and currency from configuration (default EUR) without storing currency codes in blueprints.

### Personnel View

- Tabbed interface toggling between "Job Market" (candidate cards with hire actions) and "Your Staff" (employee cards with fire/assignment controls and morale/energy bars).【F:docs/ui/ui_components-desciption.md†L504-L509】【F:docs/ui/ui_elements.md†L300-L360】
- Hiring uses `HireEmployeeModal`; firing uses global confirmation; refresh triggers `workforce.refreshCandidates`.【F:docs/ui/ui_components-desciption.md†L333-L337】【F:docs/ui/ui_interactions_spec.md†L58-L73】
- Screenshots `04` and `05` illustrate both tabs and their CTAs.【F:docs/ui/ui-screenshot-insights.md†L41-L64】
- Lists virtualize once they exceed 100 cards; pagination uses 50-card pages to keep keyboard navigation predictable while preserving infinite-scroll as an enhancement.
- Morale and energy scales both span 0–100: morale renders green ≥75, yellow 50–74, red <50; energy below 20 shows a lightning icon labelled "Overtime risk" with tooltips describing impact on task claiming utility.

### Event Log & Ancillary Panels

- `EventLog` sits at the footer, rendering `EventLogItem[]` with severity color coding to echo recent `sim.*`, `world.*`, `hr.*`, and `finance.*` events.【F:docs/ui/ui-components-desciption.md†L225-L360】
- `ToastContainer` anchors notifications in the top-right, with `Toast` entries styled by type (`success`, `error`, etc.) and optional auto-dismiss for non-error states.【F:docs/ui/ui-components-desciption.md†L95-L220】
- Footer event log retains the latest 200 entries, dropping oldest first; the toast queue renders at most three concurrent toasts, keeping errors sticky until dismissed while other severities auto-dismiss after 4 s.

## UI Elements & Patterns

### Screenshot Reference Map

| Screenshot                                          | View Context                                                            | Primary Components                                                                                                                                                                                       | Interaction Focus                                                                                                    |
| --------------------------------------------------- | ----------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| `01-welcome-screen.png`                             | Initial landing screen introducing simulation entry actions.            | `StartScreen` renders New/Quick/Import CTAs while `App.tsx` remains in `startScreen` state.【F:docs/ui/ui-components-desciption.md†L393-L420】                                                           | Launch points for `newGame`, `load`, and `importState` lifecycle flows.【F:docs/ui/ui_interactions_spec.md†L13-L23】 |
| `02-modal-new_game.png`                             | New game setup modal capturing company metadata and deterministic seed. | `NewGameModal` inside shared `Modal` shell with `FormInput` and `PrimaryButton` controls.【F:docs/ui/ui-components-desciption.md†L123-L178】【F:docs/ui/ui-components-desciption.md†L347-L353】          | Confirms start-of-run workflow before dispatching `facade.newGame`.【F:docs/ui/ui_interactions_spec.md†L13-L23】     |
| `03-structure-overview.png`                         | Portfolio overview of rented structures displayed as cards.             | `DashboardView` cards with `InlineEdit` and `ActionIcons` for rename/duplicate.【F:docs/ui/ui-components-desciption.md†L95-L165】【F:docs/ui/ui-components-desciption.md†L483-L487】                     | Supports rent/duplicate/drill-down navigation in the macro loop.【F:docs/ui/ui_interactions_spec.md†L27-L37】        |
| `04-personell-overview-(job-market).png`            | Personnel screen focusing on external candidates.                       | `PersonnelView` job-market tab listing `CandidateCard`s with hire modals.【F:docs/ui/ui-components-desciption.md†L333-L337】【F:docs/ui/ui-components-desciption.md†L504-L509】                          | Drives hiring and candidate refresh intents.【F:docs/ui/ui_interactions_spec.md†L58-L61】                            |
| `05-personell-overview-(my-employees).png`          | Personnel screen showing internal staff roster.                         | `PersonnelView` staff tab with `EmployeeCard`s exposing fire/assignment controls.【F:docs/ui/ui-components-desciption.md†L504-L509】                                                                     | Manages firing and reassignment per workforce spec.【F:docs/ui/ui_interactions_spec.md†L60-L65】                     |
| `06-finances-overview-(cards_closed).png`           | Finance dashboard with collapsed summaries.                             | `FinanceView` stacking KPI `StatCard`s above collapsible categories.【F:docs/ui/ui-components-desciption.md†L182-L193】【F:docs/ui/ui-components-desciption.md†L490-L500】                               | Provides at-a-glance CapEx/OpEx metrics.【F:docs/ui/ui_interactions_spec.md†L69-L73】                                |
| `07-finances-overview-(cards_opened).png`           | Finance dashboard with expanded detail panels.                          | Same `FinanceView` sections with expanded breakdowns.【F:docs/ui/ui-components-desciption.md†L490-L500】                                                                                                 | Supports deeper inspection of financial reports.【F:docs/ui/ui_interactions_spec.md†L69-L73】                        |
| `08-model-game_menu.png`                            | Game-level menu triggered from dashboard header.                        | `GameMenuModal` rendered by shared modal chassis.【F:docs/ui/ui-components-desciption.md†L167-L178】【F:docs/ui/ui-components-desciption.md†L323-L329】                                                  | Accesses Save/Load/Export/Reset lifecycle commands.【F:docs/ui/ui_interactions_spec.md†L18-L23】                     |
| `09-structure-detailview.png`                       | Detail page for a single structure with nested rooms/zones.             | `StructureDetailView` lists rooms via `ZoneCard` summaries and inline actions.【F:docs/ui/ui-components-desciption.md†L413-L420】【F:docs/ui/ui-components-desciption.md†L521-L525】                     | Enables room-level CRUD and duplicate flows.【F:docs/ui/ui_interactions_spec.md†L27-L36】                            |
| `10-room-overview-(growroom).png`                   | Room detail focusing on grow zones.                                     | `RoomDetailView` showing `ZoneCard`s with rename/duplicate controls.【F:docs/ui/ui-components-desciption.md†L407-L420】【F:docs/ui/ui-components-desciption.md†L513-L517】                               | Supports zone creation and duplication in macro management loop.【F:docs/ui/ui_interactions_spec.md†L31-L36】        |
| `11-zone-detailview-(setup-closed).png`             | Zone management view with environment panel collapsed.                  | `ZoneDetailView` with collapsed `EnvironmentPanel` summarizing KPIs alongside device/plant panels.【F:docs/ui/ui-components-desciption.md†L407-L417】【F:docs/ui/ui-components-desciption.md†L529-L533】 | Anchors climate monitoring and device status for cultivation loop.【F:docs/ui/ui_interactions_spec.md†L40-L50】      |
| `12-zone-detailview-(setup-opened).png`             | Zone management view with environment controls expanded.                | Expanded `EnvironmentPanel` plus adjacent `ZoneDeviceList` for equipment actions.【F:docs/ui/ui-components-desciption.md†L412-L429】                                                                     | Demonstrates runtime setpoint adjustments and device management.【F:docs/ui/ui_interactions_spec.md†L40-L48】        |
| `13-zone-detailview-(mass-selection-activated).png` | Zone plant grid in batch-selection mode.                                | `ZonePlantPanel` with `BatchActionBar` for multi-plant operations.【F:docs/ui/ui-components-desciption.md†L451-L462】                                                                                    | Executes Harvest/Trash/Treat batch actions and automation toggles.【F:docs/ui/ui_interactions_spec.md†L45-L54】      |

### Design-System Primitives

- **Buttons & IconButtons** replace ad-hoc CSS, covering primary/secondary, danger, link styles, and active states via props such as `variant`, `tone`, `size`, `isActive`.【F:docs/ui/ui_elements.md†L5-L24】
- **Form fields** (`FormInput`, `FormSelect`, `FormCheckbox`, `RangeInput`) encapsulate Tailwind styling and are composed via `FormField` and modal forms.【F:docs/ui/ui_elements.md†L5-L24】【F:docs/ui/ui-components-desciption.md†L95-L193】
- **InlineEdit** toggles between display and input modes with confirm/cancel interactions to support in-place renaming of structures, rooms, and zones.【F:docs/ui/ui_elements.md†L5-L24】【F:docs/ui/ui-components-desciption.md†L95-L140】
- **Modal shell** supplies overlay, title bar, close button, and content area while pausing the sim and restoring prior state on close.【F:docs/ui/ui-implementation-spec.md†L96-L152】【F:docs/ui/ui-components-desciption.md†L123-L193】

### Generic Components

- **ActionIcons** group Duplicate and Delete buttons for consistent placement; require `onDuplicate`/`onDelete` callbacks and optional `className`. Icons: `DuplicateIcon`, `DeleteIcon`.【F:docs/ui/ui-components-desciption.md†L95-L120】
- **Breadcrumbs** accept `BreadcrumbItem[]` and `onNavigate` to display hierarchical trail with `ChevronRightIcon`.【F:docs/ui/ui-components-desciption.md†L95-L140】
- **Buttons** supply Tailwind-styled `PrimaryButton` and `DangerButton` variants with disabled states.【F:docs/ui/ui-components-desciption.md†L95-L140】
- **Form components** standardize labeled inputs/selects/checkboxes across modals.【F:docs/ui/ui-components-desciption.md†L95-L167】
- **Icons** centralize Google Material icon wrappers, allowing consistent styling via optional `className`.【F:docs/ui/ui-components-desciption.md†L140-L150】
- **InlineEdit** (detailed above) listens for Enter/Escape/blur to commit or cancel edits.【F:docs/ui/ui-components-desciption.md†L140-L165】
- **Modal** component handles overlay, header, and children, using `XIcon` for close affordance.【F:docs/ui/ui-components-desciption.md†L165-L178】
- **StatCard** shows icon, title, value, optional unit, color; reused in header and finance view.【F:docs/ui/ui-components-desciption.md†L178-L193】
- **Toast/ToastContainer** render notifications with icons (`XIcon`, `CheckIcon`, `error`, `warning`, `info`), auto-dismiss for non-error types, and rely on `useToast` context.【F:docs/ui/ui-components-desciption.md†L193-L220】

### Layout Components

- **DashboardHeader** hosts controls, nav links, stats, and game menu (icons: `ClockIcon`, `DollarIcon`, `PauseIcon`, `PlayIcon`, `HomeIcon`, `BadgeIcon`, `CogIcon`, `paid`).【F:docs/ui/ui-components-desciption.md†L225-L260】
- **EventLog** displays `EventLogItem[]` with severity colors at the footer.【F:docs/ui/ui-components-desciption.md†L260-L280】
- **MainContent** routes based on selection state and renders breadcrumbs; passes data/callbacks to active view.【F:docs/ui/ui-components-desciption.md†L280-L313】
- **Sidebar** lists structures/rooms/zones with toggle icons (`ChevronDownIcon`, `PlusIcon`) and CTA integration for modal flows.【F:docs/ui/ui-components-desciption.md†L313-L360】

### Modal Components

- **InstallDeviceModal**: loads device blueprints via the facade, validates JSON overrides, and emits `devices.installDevice` with compatibility hints.【F:src/frontend/src/components/modals/ModalHost.tsx†L325-L470】【F:src/frontend/src/components/modals/**tests**/PlantAndDeviceModals.test.tsx†L104-L149】
- **CreateRoomModal**: collects name, purpose, area, height; enforces geometry; uses `useZoneStore.createRoom`; tested via `ModalHost`.【F:docs/ui/ui-components-desciption.md†L360-L420】
- **CreateZoneModal**: allocates footprint, selects method, optional plant count; dispatches `world.createZone`; validated in tests.【F:docs/ui/ui-components-desciption.md†L360-L420】
- **DuplicateStructureModal/DuplicateRoomModal/DuplicateZoneModal**: review footprint, device counts, names before cloning via respective intents; confirm actions handled through zone store helpers and regression tests.【F:docs/ui/ui-components-desciption.md†L360-L460】
- **GameMenuModal**: lists Save/Load/Reset options (currently placeholder); launched from header cog.【F:docs/ui/ui-components-desciption.md†L323-L337】
- **HireEmployeeModal**: assign structure on hire using dropdown; relies on `FormSelect` and `PrimaryButton`.【F:docs/ui/ui-components-desciption.md†L360-L440】
- **InfoModal**: surfaces pest/disease blueprint details (symptoms, controls).【F:docs/ui/ui-components-desciption.md†L440-L451】
- **NewGameModal**: collects company/CEO name and deterministic seed; uses `FormInput` + `PrimaryButton`.【F:docs/ui/ui-components-desciption.md†L333-L347】
- **PlantDetailModal**: shows plant stats with harvest/trash actions using `CutIcon` and `TrashIcon`; harvest disabled until ready.【F:docs/ui/ui-components-desciption.md†L440-L462】
- **PlantZoneModal**: fetches strain catalogs, projects capacity from cultivation methods, and dispatches `plants.addPlanting` with surfaced warnings.【F:src/frontend/src/components/modals/ModalHost.tsx†L104-L323】【F:src/frontend/src/components/modals/**tests**/PlantAndDeviceModals.test.tsx†L64-L103】
- **InstallDeviceModal/UpdateDeviceModal/MoveDeviceModal**: manage device lifecycle (install JSON validation, patch existing settings, relocate hardware) through zone-store helpers and `SimulationFacade` intents.【F:docs/ui/ui-components-desciption.md†L440-L533】
- **Device removal confirmation**: reuses confirmation modal to call `devices.removeDevice` via zone store helper.【F:docs/ui/ui-components-desciption.md†L440-L533】
- **RentStructureModal**: rents new structure with affordability gating; uses forms primitives.【F:docs/ui/ui-components-desciption.md†L533-L540】
- **Duplicate flows** described above require inline cost previews and compliance with `allowedRoomPurposes` for devices.【F:docs/ui/ui-components-desciption.md†L360-L533】【F:docs/ui/ui_interactions_spec.md†L27-L54】 Cost tooltips break totals into Rooms, Zones, Devices (count × individual CapEx via `devicePrices.json`), Setup (method/container/substrate sourced from `cultivationMethodPrices.json` + `consumablePrices.json`), and Other, summing capital and setup costs while reminding players that maintenance remains separate.

### Simulation Components

- **EnvironmentPanel**: collapsed summary renders KPI chips for temperature, humidity, VPD, CO₂, PPFD, and the active light cycle (see `11-zone-detailview-(setup-closed).png`). Expanding the panel (see `12-zone-detailview-(setup-opened).png`) reveals range inputs for temperature, humidity, VPD, CO₂, and PPFD plus a lighting on/off toggle tied to the PPFD target. Sliders clamp to backend corridors — Temperature `[10, 35]` °C, Relative Humidity `[0, 1]`, VPD `[0, 2.5]` kPa, CO₂ `[0, 1800]` ppm, and PPFD `[0, 1500]` µmol·m⁻²·s⁻¹ — and surface clamp warnings inline so operators know when adjustments hit safety limits. Controls dispatch `config.update { type: 'setpoint' }` commands and disable automatically when the required devices are absent.【F:docs/ui/ui-components-desciption.md†L407-L462】
- **ZoneCard**: compact zone summary with navigation click and `ActionIcons`; includes progress bars for plant growth.【F:docs/ui/ui-components-desciption.md†L420-L440】
- **ZoneDeviceList**: groups devices by name, aggregates counts, exposes install/update/move/remove actions; draws from zone store helpers.【F:docs/ui/ui-components-desciption.md†L421-L533】
- **ZonePlantPanel**: grid of plants with inspection mode (tooltips, direct actions) and selection mode enabling `BatchActionBar` for Harvest/Trash/Treat; integrates pest/disease info and automation toggles.【F:docs/ui/ui-components-desciption.md†L440-L462】
- **ZoneView**: renders device and plant CTAs that open the install/plant modals with the active zone context, reinforcing empty-state guidance when lists are empty.【F:src/frontend/src/views/ZoneView.tsx†L286-L398】

### View Components (Composition Level)

- **DashboardView**: default view listing structures; integrates InlineEdit and ActionIcons; default landing post-start.【F:docs/ui/ui-components-desciption.md†L470-L487】 Structure cards sort by most recently used (descending) with name (ascending) as fallback, persisting any user override in local storage or URL params so ordering remains stable across sessions.
- **FinanceView**: detailed financial breakdown with collapsible cards and timeframe filter; uses `StatCard` icons (`trending_up`, `receipt_long`, `account_balance`).【F:docs/ui/ui-components-desciption.md†L470-L509】
- **PersonnelView**: tabbed candidate/staff management with hire/fire actions and icon usage (e.g., `DeleteIcon`).【F:docs/ui/ui-components-desciption.md†L504-L509】
- **RoomDetailView** and **StructureDetailView**: compose zone cards, InlineEdit, and ActionIcons to manage nested rooms/zones.【F:docs/ui/ui-components-desciption.md†L513-L525】
- **ZoneDetailView**: orchestrates EnvironmentPanel, ZonePlantPanel, ZoneDeviceList, and device lifecycle CTAs with modals and zone store helpers.【F:docs/ui/ui-components-desciption.md†L407-L533】

### Context Providers

- **ToastContext/ToastProvider** exposes `addToast` for success/error notifications while `ToastContainer` renders them; follows producer/consumer pattern to decouple triggers from presentation.【F:docs/ui/ui-components-desciption.md†L509-L533】

### Contract Type Definitions

```ts
export type UUID = string;

export interface Selection {
  currentView: 'dashboard' | 'structure' | 'room' | 'zone' | 'finances' | 'personnel';
  selectedStructureId?: UUID;
  selectedRoomId?: UUID;
  selectedZoneId?: UUID;
}

export interface StructureSummary {
  id: UUID;
  name: string;
  area_m2: number | null;
  roomCount: number;
  plantCount: number;
}

export interface ZoneKpis {
  area_m2: number;
  methodId?: UUID;
  plantCount: number;
  env: {
    temperature_C?: number;
    relativeHumidity?: number;
    co2_ppm?: number;
    vpd_kPa?: number;
    ppfd?: number;
  };
  coverageRatio?: number;
}

export interface ZoneSummary {
  id: UUID;
  name: string;
  kpis: ZoneKpis;
  deviceGroups: Array<{
    kind: string;
    count: number;
    status: 'on' | 'off' | 'mixed' | 'broken';
  }>;
}

export interface EventLogItem {
  id: UUID;
  ts: number;
  severity: 'info' | 'success' | 'warning' | 'error';
  type: string;
  entityId?: UUID;
  message: string;
}

export interface OnNavigatePayload {
  target: 'dashboard' | 'structure' | 'room' | 'zone' | 'finances' | 'personnel';
  id?: UUID;
}

export interface OnPlantActionPayload {
  zoneId: UUID;
  action: 'harvest' | 'trash' | 'treat' | 'plant';
  plantIds?: UUID[];
  strainId?: UUID;
  quantity?: number;
}

export interface OnBatchActionPayload {
  zoneId: UUID;
  plantIds: UUID[];
  action: 'harvest' | 'trash' | 'treat';
}

export interface OnUpdatePayload {
  entity: 'zoneSetpoint' | 'deviceGroup' | 'inlineName';
  zoneId?: UUID;
  metric?: 'temperature' | 'relativeHumidity' | 'vpd' | 'co2' | 'ppfd';
  value?: number;
  kind?: string;
  toggle?: 'on' | 'off';
  targetId?: UUID;
  name?: string;
}
```

These interfaces mirror the façade intent contract and reinforce the intent-only, snapshot-read-only boundary.

### State Management & Backend Integration

- A lightweight Zustand store (`useGameStore`) is the single source of truth for connection status, latest snapshot, last tick, and event buffer. `connect(url)` instantiates a Socket.IO client (websocket transport), updates `connected` flags on connect/disconnect, and wires listeners for `simulationSnapshot` (full state) and `simulationUpdate` (diff + events) while capping the event buffer to the most recent 200 entries. The socket instance is exposed on `window.__wb_socket` for debugging.
- `disconnect()` delegates to the underlying socket disconnect, and `sendIntent(domain, action, payload?)` emits `facade.intent` over the socket, returning a promise that resolves with the façade response so callers can await `{ ok, warnings?, errors? }` without optimistic UI.
- Components use selectors to read the store, memoizing derived data (e.g., `selectSnapshot`, `selectEvents`) to avoid unnecessary renders; bridge hooks wrap `useGameStore` to expose typed façade commands to views.
- App bootstrap calls `useGameStore.getState().connect(SOCKET_URL)` on mount and ensures cleanup on unmount. Intent dispatchers always disable their originating controls and show `… applying` copy until the promise settles, matching the deterministic façade loop.

### Styling & Responsiveness Guardrails

- Tailwind spacing adheres to a 4 px baseline: `space-1 = 4px`, `space-2 = 8px`, `space-3 = 12px`, `space-4 = 16px`, `space-6 = 24px`, `space-8 = 32px`, `space-10 = 40px`, `space-12 = 48px`. Vertical rhythm guidelines: section headers `mt-8`, card title-to-body `mt-4`, form rows `gap-3`, dense lists `gap-2`.
- Card padding defaults to `px-6 py-5` on desktop and `px-4 py-4` on mobile; column layouts prefer `gap-4` with `gap-6` reserved for room/zone detail two-column layouts. Inline forms use `gap-3` with `min-w-[220px]` fields to maintain alignment.
- Icon sizing is standardized: 24 px for header controls, 20 px for card action clusters, 18 px for table/list rows, and 10 px for status dots. Hover affordances adjust opacity only—no scaling to prevent layout shift.

### Resilience Patterns

- Validation warnings returned from intents render as persistent inline banners within the originating modal, referencing `payload.path` when present. Hard errors (`level: error`) trigger sticky red toasts and log entries including `entityId` (if provided).
- Empty states ship bespoke illustrations and CTAs: zones without devices prompt “Install device,” plant-less zones show “Plant” plus “Configure Auto-Replant,” and finance panels render an em dash (`—`) with tooltip “No data in range.”
- Network resilience uses exponential backoff up to 30 s while reconnecting; the header shows a “Reconnecting…” badge and, upon reconnect, the client requests a fresh `simulationSnapshot`.
- Concurrency handling disables the initiating control while an intent is in flight and trusts the façade as the authority. If competing updates adjust a record, the client discards local assumptions and re-renders from the latest snapshot—no local merges.

## Interactions

### Game Lifecycle

- Start new games via modal capturing name/seed (`facade.newGame`), load/import snapshots (`facade.load`, `facade.importState`), and reset runs after confirmation.【F:docs/ui/ui_interactions_spec.md†L13-L35】【F:docs/ui/ui-components-desciption.md†L323-L353】
- Save/export from the game menu dispatches `facade.save()` and `facade.exportState()`; loading or deleting slots routes through the same menu flows.【F:docs/ui/ui_interactions_spec.md†L18-L35】
- Play/pause/step/fast-forward controls issue `simulationControl` intents (`play|pause|step|fastForward`, `setSetpoint`) through `useGameStore` and bridge hooks; tick length is fixed by the backend and never user-adjustable in the UI.【F:docs/ui/ui-implementation-spec.md†L260-L380】【F:docs/ui/ui-components-desciption.md†L225-L260】

### Infrastructure & Navigation

- Rent structures (`facade.world.rentStructure`), create rooms (`createRoom`), create zones (`createZone`), and duplicate structures/rooms/zones via dedicated intents that replicate geometry, cultivation methods, automation, and eligible devices (costed per blueprint).【F:docs/ui/ui_interactions_spec.md†L27-L54】【F:docs/ui/ui-implementation-spec.md†L260-L340】
- Rename/delete flows rely on inline edit (rooms/zones) or modals (structures) to dispatch updates and confirmations.【F:docs/ui/ui-implementation-spec.md†L120-L260】【F:docs/ui/ui-components-desciption.md†L407-L533】
- Breadcrumbs and sidebar navigation trigger `goTo`/`selectEntity` to update selection state without duplicating routing logic.【F:docs/ui/ui_archictecture.md†L75-L140】

### Cultivation & Zone Management

- Install devices (`facade.devices.installDevice`) with placement checks against `allowedRoomPurposes`, update device settings (`updateDevice`), move devices between zones (`moveDevice`), toggle groups, and remove devices via confirmation flows.【F:docs/ui/ui_interactions_spec.md†L40-L54】【F:docs/ui/ui-components-desciption.md†L421-L533】
- Apply irrigation (`facade.plants.applyIrrigation`) and fertilizer (`facade.plants.applyFertilizer`) from supplies card actions; add supplies triggers shared modal flows.【F:docs/ui/ui_interactions_spec.md†L40-L54】【F:docs/ui/ui-implementation-spec.md†L240-L320】
- Plant strains (`facade.plants.addPlanting`), harvest individual plants or groups (`facade.plants.harvestPlanting`), delete plantings, and manage automation via Planting Plan (create/edit/delete/toggle Auto-Replant).【F:docs/ui/ui_interactions_spec.md†L40-L54】【F:docs/ui/ui-implementation-spec.md†L260-L360】
- Zone navigation arrows allow stepping between sibling zones with wrap-around enabled at list boundaries; keyboard shortcuts mirror the behavior (Left/Right arrows) for quick cycling.【F:docs/ui/ui-implementation-spec.md†L220-L320】

### Environment & Telemetry Control

- EnvironmentPanel adjustments send zone setpoints (`temperature`, `relativeHumidity`, `vpd`, `co2`, `ppfd`) via `config.update` while reflecting backend clamp warnings and `env.setpointUpdated` events.【F:docs/ui/ui-implementation-spec.md†L260-L360】【F:docs/ui/ui-components-desciption.md†L407-L462】
- Lighting cards display coverage sufficiency using `.lighting-ok` and `.lighting-insufficient` classes and allow editing light cycles through modals (`schedule`).【F:docs/ui/ui-implementation-spec.md†L240-L360】
- Device status indicators (`status-on/off/mixed/broken`) toggle whole groups and open tuning modals using `tune`.【F:docs/ui/ui-implementation-spec.md†L260-L360】
- Zone layout editing supports drag-and-drop drawing/snapping of rectangles in 0.5 m increments (minimum 1.0 m × 1.0 m). Dropping proposals emits `world.createZone` or `world.resizeZone`, with the façade clamping invalid placements and returning adjustments via toast copy “Adjusted to valid placement.” Device tiles optionally support drag-and-drop within a zone to trigger ghost placement and `devices.moveDevice`; dropping confirms via façade intent. Plant management remains modal/batch-action only—no drag-and-drop to avoid complexity.

### Personnel & Finance

- Refresh candidates (`facade.workforce.refreshCandidates`), hire (`facade.workforce.hire`), assign structures, negotiate raises, and fire employees (`facade.workforce.fire`) via modal workflows; overtime policy adjustments use `setOvertimePolicy`.【F:docs/ui/ui_interactions_spec.md†L58-L73】【F:docs/ui/ui-components-desciption.md†L333-L337】
- Financial interactions include selling inventory lots (`facade.finance.sellInventory`), adjusting utility prices, and maintenance policy updates via façade commands surfaced in the finance view or modal dialogs.【F:docs/ui/ui_interactions_spec.md†L69-L88】

### Modals & Focus Management

- Modal controller tracks `wasRunningBeforeModal`; opening a modal pauses the simulation and blurs background content; closing resumes if previously running. Overlay clicks do not close modals—only explicit buttons (Cancel/Save/etc.).【F:docs/ui/ui-implementation-spec.md†L96-L152】
- Shared modal styles enforce dark overlay, bordered content, max width 720 px (or 92 vw), and rely on Tailwind for structure; focus remains trapped inside until closure.【F:docs/ui/ui-implementation-spec.md†L96-L152】
- Only one modal may be active at a time; additional modal requests queue FIFO and open once the active modal closes. The controller stores `wasRunningBeforeModal` only for the first modal and restores the prior simulation state after the last modal exits.

## States & Telemetry

- The Bridge Hook (`useGameState` analogue) is the single gateway to subscribe to snapshots and events (`sim.ready`, `sim.tickCompleted`, `sim.paused`, `sim.hotReloaded`) while memoizing command callbacks to prevent unnecessary re-renders.【F:docs/ui/ui_archictecture.md†L75-L120】
- Application orchestrator requests the initial snapshot (waiting for `sim.ready`), provides navigation, modal, and theme context, and feeds snapshots plus command callbacks down the tree.【F:docs/ui/ui_archictecture.md†L75-L120】
- Unidirectional flow ensures snapshots are read-only: render snapshot → dispatch facade intent → engine validates/applies → commit emits new snapshot and events → subscribers re-render.【F:docs/ui/ui_archictecture.md†L16-L74】
- Read models should remain lean; selectors derive subsets such as zone KPIs, device summaries, and cost aggregates for views to minimize diff surfaces.【F:docs/ui/ui_archictecture.md†L140-L180】
- Event consumption drives toasts, banners, and local updates across simulation (`sim.tickCompleted`, `sim.paused/resumed`, `sim.hotReloaded/reloadFailed`), world (`world.structureRented`, `world.roomCreated`, `world.zoneCreated`, `world.deviceInstalled`), plants (`plant.stageChanged`, `plant.harvested`, `pest.detected`, `treatment.applied`), HR/tasks (`task.created/claimed/completed`, `hr.hired/fired`, `hr.overtimeAccrued`), and finance (`finance.capex/opex`, `finance.saleCompleted`) channels.【F:docs/ui/ui_archictecture.md†L140-L200】
- Event payloads carry minimal fields + UUIDs; the UI resolves details via the latest snapshot, never from event payload alone.【F:docs/ui/ui_archictecture.md†L140-L200】
- Toast provider/context decouples producers from the UI, allowing components to emit notifications while `ToastContainer` renders them; event log component retains recent events for quick scanning.【F:docs/ui/ui-components-desciption.md†L193-L360】
- Modal controller pauses simulation state, storing `wasRunningBeforeModal` to resume after closing, which is critical for deterministic telemetry history.【F:docs/ui/ui-implementation-spec.md†L96-L152】
- Initial connection displays a full-screen skeleton (header bar, three stat cards, two-column placeholder) until the first snapshot arrives; long-running intents show inline button spinners with copy "… applying" beside the action.
- Facade responses surface validation warnings as persistent yellow banners inside the originating modal, while hard `ERR_*` failures trigger red toasts and Event Log entries including the failing `payload.path`.
- Telemetry retention follows three rings: per-tick series keep the last 15 minutes of real time, per-hour aggregates store the last seven in-game days, and per-day aggregates persist the last 90 in-game days. Keep total rendered points per series ≤ 5 000.
- Downsampling occurs on every `sim.tickCompleted`, rolling per-tick data into hourly buckets (avg/min/max) and promoting to daily aggregates as ranges grow. Charts automatically switch to hourly/daily series when the visible range exceeds one day to guard performance.

## Accessibility & Performance

- All actionable elements must be keyboard focusable; modals trap focus and restore it on close while using `role="dialog"` and descriptive labels for icons to meet WCAG AA contrast requirements.【F:docs/ui/ui-implementation-spec.md†L360-L420】
- Avoid conveying information through color alone—pair icons or labels with status hues (e.g., lighting coverage, device states).【F:docs/ui/ui-implementation-spec.md†L240-L360】
- Toasts, notifications, and badges should provide accessible text alternatives when icon-only controls are present (e.g., header icons).【F:docs/ui/ui-implementation-spec.md†L37-L142】
- Virtualize large lists (zones, tasks, employees) and memoize selectors to limit re-render scope; throttle chart updates and downsample telemetry where necessary.【F:docs/ui/ui_archictecture.md†L140-L200】【F:docs/ui/ui_interactions_spec.md†L88-L120】
- Use responsive layouts (column collapse below 900 px, grid auto-fill) and ensure controls wrap gracefully without overlap.【F:docs/ui/ui-implementation-spec.md†L160-L220】
- Avoid optimistic UI; wait for facade ACK or events before updating to maintain deterministic order.【F:docs/ui/ui_interactions_spec.md†L120-L150】
- Keyboard shortcuts: Space toggles Play/Pause (announced via SR-only live region), `ö`/`ä` adjust speed down/up, `g`/`f`/`p`/`s` jump to Dashboard/Finances/Personnel/Structures, and Left/Right arrows cycle zones with wrap-around.
- Provide a global ARIA live region (`role="status" aria-live="polite"`) that announces simulation pause/resume, throttled tick completions (≤ 1 announcement every 5 s), and warning/error titles so screen-reader users receive timely feedback. Icon-only controls require `aria-label` + `title`, and modal roots declare `role="dialog" aria-modal="true" aria-labelledby`.
- Performance budgets: virtualize lists ≥ 100 rows, cap concurrent toasts at 3, limit chart line series to ≤ 2 000 rendered points, and throttle streaming UI updates to ≥ 250 ms. CI/dev validation includes a Jest/Vitest smoke test rendering `FinanceView` with 5 000 rows (target ≥ 50 FPS on reference laptop) and a bridge-hook stress test pumping 1 000 `simulationUpdate` messages at 20 Hz without memory growth over 20 MB.

## Visual Guardrails

### Iconography

| Icon                | Usage                                                    |
| ------------------- | -------------------------------------------------------- |
| `play_circle`       | Start simulation.                                        |
| `pause_circle`      | Pause simulation.                                        |
| `monitoring`        | Switch to financial view.                                |
| `groups`            | Switch to personnel view.                                |
| `notifications`     | Open notifications.                                      |
| `settings`          | Open game menu (Save/Load/Export/Reset).                 |
| `edit`              | Rename structures/rooms/zones; edit planting plan.       |
| `delete`            | Delete structures/rooms/zones/devices/individual plants. |
| `delete_sweep`      | Delete an entire planting group.                         |
| `content_copy`      | Duplicate rooms or zones.                                |
| `info`              | Show strain info tooltip.                                |
| `content_cut`       | Harvest a single plant.                                  |
| `tune`              | Adjust settings for a device group (opens modal).        |
| `schedule`          | Edit light cycle for a zone (opens modal).               |
| `arrow_back_ios`    | Navigate to previous zone.                               |
| `arrow_forward_ios` | Navigate to next zone.                                   |
| `person_remove`     | Fire an employee.                                        |

### Spacing & Vertical Rhythm

- Base spacing units follow Tailwind’s 4 px grid: `space-1` (4 px), `space-2` (8 px), `space-3` (12 px), `space-4` (16 px), `space-6` (24 px), `space-8` (32 px), `space-10` (40 px), `space-12` (48 px).
- Section headers land at `mt-8` with `mb-3`, card title-to-body spacing uses `mt-4`, and vertical card stacks default to `gap-4` (upgrade to `gap-6` in two-column zone detail layouts).
- Form rows observe `gap-3`, dense lists `gap-2`, and inline form fields keep `min-w-[220px]` to align labels/inputs.
- Card padding defaults to `px-6 py-5` on desktop and `px-4 py-4` on mobile to respect touch targets without crowding.

### Icon Sizing Guidelines

| Context                    | Size  | Notes                                                       |
| -------------------------- | ----- | ----------------------------------------------------------- |
| Topbar/Header controls     | 24 px | Primary affordances (play/pause, menus); opacity hover only |
| Card action clusters       | 20 px | Inline rename/duplicate/delete icons                        |
| Table/List row leading     | 18 px | Row indicators, status glyphs                               |
| Status dots (device group) | 10 px | Filled dots for aggregated device state                     |

Maintain consistent icon weights (default Material weight) and avoid scaling on hover to prevent layout shifts; prefer opacity changes or background highlights for feedback.

### Dark Theme Tokens

- Background: `bg-stone-900`.
- Text: primary `text-stone-100/200`, secondary `text-stone-400/500`.
- Panels/cards: `bg-stone-800/30` with `border-stone-700`.
- Primary accent: `bg-lime-600`, `text-lime-400`; status colors include `text-green-400`, `text-yellow-400`, `text-red-400`, `text-blue-400`, `text-cyan-400` for success/warning/danger/info states.【F:docs/ui/ui-components-desciption.md†L551-L574】
- Typography: Inter font, headings styled via Tailwind utilities (`text-3xl font-bold`, etc.) instead of default heading tags.【F:docs/ui/ui-components-desciption.md†L551-L574】
- ### Light Theme Tokens

- Background: `#fafafa` base with cards at `#ffffff` bordered by `#e5e7eb`.
- Text: primary `#111827`, secondary `#6b7280` to mirror dark-theme contrast ratios.
- Accent: lime-600 (`#65a30d`) with hover at `#4d7c0f`; status hues reuse green/yellow/red/blue/cyan 600 shades to keep semantic parity.
- Buttons maintain AA contrast by pairing dark text with light fills and vice versa, sharing the same component tokens as the dark theme.

### Core CSS Snippets

```css
.tick-ring circle.progress {
  transition: stroke-dashoffset 0.3s linear;
}
.lighting-ok {
  color: #18a957;
}
.lighting-insufficient {
  color: #d8a400;
}
.device-status-indicator {
  width: 0.6rem;
  height: 0.6rem;
  border-radius: 50%;
}
.device-status-indicator.status-on {
  background: #19b56b;
}
.device-status-indicator.status-off {
  background: #8b8f97;
}
.device-status-indicator.status-mixed {
  background: #d8a400;
}
.device-status-indicator.status-broken {
  background: #d64545;
}
```

### Tailwind Building Blocks

```html
<div class="bg-stone-800/30 rounded-lg p-6">
  <!-- Card content -->
</div>

<button
  class="w-full bg-lime-600 hover:bg-lime-700 text-white font-semibold py-2 px-4 rounded-md transition-colors disabled:bg-stone-600 disabled:cursor-not-allowed"
>
  Action
</button>

<div>
  <label class="block text-sm font-medium text-stone-300 mb-1">Label</label>
  <input
    class="w-full bg-stone-900 border border-stone-700 rounded-md px-3 py-2 text-stone-100 focus:ring-2 focus:ring-lime-500 focus:border-lime-500 outline-none"
  />
</div>

<div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-stone-800 border border-stone-700 rounded-lg shadow-xl w-full max-w-md m-4">
    <header class="flex items-center justify-between p-4 border-b border-stone-700">
      <!-- Header content -->
    </header>
    <div class="p-6">
      <!-- Modal content -->
    </div>
  </div>
</div>
```

### Custom Scrollbar

```css
/* Custom scrollbar for a better dark-mode aesthetic */
::-webkit-scrollbar {
  width: 8px;
}
::-webkit-scrollbar-track {
  background: #1c1917; /* stone-900 */
}
::-webkit-scrollbar-thumb {
  background: #57534e; /* stone-600 */
  border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
  background: #78716c; /* stone-500 */
}
```

### Layout Reminders

- Card grids rely on `grid-template-columns: repeat(auto-fill, minmax(260px, 1fr))` with `gap: 1rem` to maintain consistent spacing across views.【F:docs/ui/ui-implementation-spec.md†L120-L200】
- Zone detail columns use `grid-template-columns: 1.2fr 1fr` with `gap: 1rem`, collapsing to one column below 900 px.【F:docs/ui/ui-implementation-spec.md†L200-L240】
- Modal overlay blur: apply `.content-area.blurred` (blur 3px, pointer-events none) to background when any modal is open.【F:docs/ui/ui-implementation-spec.md†L80-L106】
- Spacing and vertical rhythm follow the 4 px scale documented in [Styling & Responsiveness Guardrails](#styling--responsiveness-guardrails); custom CSS should align with those Tailwind utilities.
- Icon usage must adhere to the standardized sizes in [Icon Sizing Guidelines](#icon-sizing-guidelines) to keep density consistent across headers, cards, and tables.

## Glossary

- **System Facade**: Authoritative API that validates intents (`world.*`, `devices.*`, `plants.*`, `health.*`, `workforce.*`, `finance.*`, `time.*`) and emits snapshots/events for the UI; all mutations go through it.【F:docs/ui/ui_archictecture.md†L1-L140】【F:docs/ui/ui_interactions_spec.md†L13-L120】
- **Snapshot**: Read-only representation of the current game state (structures, rooms, zones, devices, plants, finance, personnel) consumed by views and selectors.【F:docs/ui/ui_archictecture.md†L16-L120】
- **Structure / Room / Zone**: Hierarchical containers forming the macro navigation path; structures hold rooms, rooms hold zones, and zones manage cultivation data/controls.【F:docs/ui/ui-implementation-spec.md†L120-L320】【F:docs/ui/ui_elements.md†L84-L220】
- **BreedingStation**: Specialized component replacing the zone grid in lab-purpose rooms to manage custom strains.【F:docs/ui/ui-implementation-spec.md†L200-L240】
- **ZonePlantPanel**: Interactive grid for plants supporting inspection mode and selection mode with batch actions.【F:docs/ui/ui-components-desciption.md†L440-L462】
- **BatchActionBar**: Toolbar appearing in ZonePlantPanel selection mode enabling Harvest/Trash/Treat operations across selected plants.【F:docs/ui/ui-components-desciption.md†L451-L462】
- **EnvironmentPanel**: Zone detail panel summarizing and controlling environmental metrics (temperature, humidity, CO₂, PPFD, VPD) with device-aware enablement logic.【F:docs/ui/ui-components-desciption.md†L407-L462】
- **Planting Plan**: Automation configuration specifying strain and quantity for auto-replant, with toggle/edit/delete flows in zone detail view.【F:docs/ui/ui-implementation-spec.md†L260-L360】
- **Device Group**: Aggregated view of devices of the same type within a zone, showing status indicator, count, and collective actions (toggle, tune, schedule).【F:docs/ui/ui-implementation-spec.md†L260-L360】
- **InlineEdit**: Component enabling in-place renaming with confirm/cancel semantics for structures, rooms, and zones.【F:docs/ui/ui-elements.md†L5-L24】【F:docs/ui/ui-components-desciption.md†L140-L165】
- **ModalHost**: Controller orchestrating modal rendering, pause/resume behavior, and tests ensuring intents dispatch correctly.【F:docs/ui/ui-components-desciption.md†L360-L420】
- **ToastProvider / ToastContainer**: Context + renderer for notifications triggered by events or intent results.【F:docs/ui/ui-components-desciption.md†L193-L220】【F:docs/ui/ui-components-desciption.md†L509-L533】
- **EventLogItem**: Entries displayed in footer event log summarizing recent domain events with severity coloring.【F:docs/ui/ui-components-desciption.md†L225-L313】
- **Auto-Replant**: Toggle within Planting Plan enabling automatic replant tasks after harvest/cleaning, based on configured strain/quantity.【F:docs/ui/ui-implementation-spec.md†L260-L360】
- **Navigation Manager**: State machine controlling `{ currentView, selectedStructureId?, selectedRoomId?, selectedZoneId? }` and exposing `goTo`, `back`, `home` helpers.【F:docs/ui/ui_archictecture.md†L75-L120】
- **Bridge Hook**: Single subscription layer connecting UI to snapshots/events and exposing memoized facade commands to components.【F:docs/ui/ui_archictecture.md†L75-L120】

## Changelog Note

Maintain this guide alongside facade, component, and screenshot updates: when new intents or components ship, extend the relevant interaction lists, screenshot map, and glossary so downstream teams stay aligned with the System Facade contract.【F:docs/ui/ui_archictecture.md†L1-L200】【F:docs/ui/ui-components-desciption.md†L393-L462】 Continue layering in type definitions, dataflow diagrams, and responsive specs as they mature, and ensure screenshot references remain current whenever the visual system or layout patterns change to keep this guide authoritative for rebuilds.【F:docs/ui/ui-components-desciption.md†L614-L688】【F:docs/ui/ui-screenshot-insights.md†L1-L64】

## Open Issues

- **Tick length control parity.** This guide and the backend contract both mandate that tick length is immutable from the client. Any remaining references to tick sliders or `time.setTickLength` in other docs must be removed so every source reflects the backend-only control.【F:docs/ui/ui-components-desciption.md†L31-L35】
- **Frontend state orchestration.** The state management section here asserts a socket-backed Zustand store as the single source of truth, with intent dispatchers merely bridging to the authoritative simulation.【F:docs/ui-building_guide.md†L366-L371】 Other documentation still suggests local UI data mutation (`App.tsx` `handle*` helpers).【F:docs/ui/ui-components-desciption.md†L76-L82】 We need to purge those outdated instructions and restate that UI code never mutates shadow copies of simulation data.
- **Workforce & finance interaction coverage.** These interaction notes document structure assignment, overtime policy updates, salary negotiations, and finance actions (selling inventory, adjusting utility/maintenance pricing) as live flows the UI must surface while remaining a dumb client that simply relays intents.【F:docs/ui/ui-building_guide.md†L416-L417】 Component tables still flag those intents as “not yet wired” and describe the finance view as read-only.【F:docs/ui/ui-components-desciption.md†L63-L69】 We must track work to wire those interactions end-to-end, keeping all simulation effects in the backend.

## Simulation Facade Intents (docs/intents.md)

Source: [`docs/intents.md`](../docs/intents.md)

# Simulation Facade Intents

The simulation exposes a small number of validated intent domains. Each domain groups related commands that are available both through the in-process API and the Socket.IO `facade.intent` envelope. All commands return the shared `CommandResult` contract (`{ ok, data?, warnings?, errors? }`) where each error item includes `{ code, message, path?, category }` so callers can distinguish user mistakes from internal faults.【F:src/backend/src/facade/commands/commandRegistry.ts†L20-L114】【F:src/backend/src/server/socketGateway.ts†L518-L568】

## Domain Overview

| Domain      | Key actions                                                                                                   | Result data (when applicable)                        |
| ----------- | ------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------- |
| `time`      | `start`, `pause`, `resume`, `step`, `setSpeed`                                                                | Updated `TimeStatus` snapshot                        |
| `world`     | `rentStructure`, blueprint queries, room/zone CRUD, duplication, `renameStructure`, `newGame`, `resetSession` | IDs or catalog data depending on command             |
| `devices`   | `installDevice`, `updateDevice`, `moveDevice`, `removeDevice`, `toggleDeviceGroup`                            | Toggle returns affected device IDs                   |
| `plants`    | `addPlanting`, `cullPlanting`, `harvestPlanting`, `applyIrrigation`, `applyFertilizer`, `togglePlantingPlan`  | Toggle returns automation state                      |
| `health`    | `scheduleScouting`, `applyTreatment`, `quarantineZone`                                                        | –                                                    |
| `workforce` | `refreshCandidates`, `hire`, `fire`, `setOvertimePolicy`, `assignStructure`, `enqueueTask`                    | Candidate refresh/enqueue return contextual payloads |
| `finance`   | `sellInventory`, `setUtilityPrices`, `setMaintenancePolicy`                                                   | –                                                    |
| `config`    | `getDifficultyConfig`                                                                                         | Active difficulty configuration                      |

## Domain Details

### Time (`time.*`)

| Action     | Payload highlights                | Result data  |
| ---------- | --------------------------------- | ------------ |
| `start`    | `gameSpeed?`, `maxTicksPerFrame?` | `TimeStatus` |
| `pause`    | –                                 | `TimeStatus` |
| `resume`   | –                                 | `TimeStatus` |
| `step`     | `ticks?` (defaults to 1)          | `TimeStatus` |
| `setSpeed` | `multiplier` (positive)           | `TimeStatus` |

Definitions live in `commands/time.ts`, and the façade registers the domain automatically during construction.【F:src/backend/src/facade/commands/time.ts†L17-L67】【F:src/backend/src/facade/index.ts†L409-L463】

### World (`world.*`)

| Action                   | Payload highlights                                                           | Result data                                       |
| ------------------------ | ---------------------------------------------------------------------------- | ------------------------------------------------- |
| `rentStructure`          | `structureId`                                                                | Duplicate result with new structure identifiers   |
| `getStructureBlueprints` | –                                                                            | `StructureBlueprint[]`                            |
| `getStrainBlueprints`    | –                                                                            | `StrainBlueprintCatalogEntry[]`                   |
| `getDeviceBlueprints`    | –                                                                            | `DeviceBlueprintCatalogEntry[]`                   |
| `createRoom`             | `structureId`, `room { name, purpose, area, height? }`                       | –                                                 |
| `updateRoom`             | `roomId`, `patch` with any mutable field                                     | –                                                 |
| `deleteRoom`             | `roomId`                                                                     | –                                                 |
| `createZone`             | `roomId`, `zone { name, area, methodId, targetPlantCount? }`                 | Created zone result                               |
| `updateZone`             | `zoneId`, `patch` with name/area/method/targetPlantCount                     | –                                                 |
| `deleteZone`             | `zoneId`                                                                     | –                                                 |
| `renameStructure`        | `structureId`, `name`                                                        | –                                                 |
| `deleteStructure`        | `structureId`                                                                | –                                                 |
| `duplicateStructure`     | `structureId`, optional `name` override                                      | Duplicate structure result                        |
| `duplicateRoom`          | `roomId`, optional `name`                                                    | Duplicate room result                             |
| `duplicateZone`          | `zoneId`, optional `name`                                                    | Duplicate zone result                             |
| `resetSession`           | Optional payload (`{}` by default) to wipe current run while keeping rentals | Duplicate structure result reflecting fresh state |
| `newGame`                | Optional `{ difficulty?, seed?, modifiers? }`                                | –                                                 |

Schemas and handler bindings are defined in `commands/world.ts` and wired into the façade registry.【F:src/backend/src/facade/commands/world.ts†L24-L220】【F:src/backend/src/facade/index.ts†L439-L476】

### Devices (`devices.*`)

| Action              | Payload highlights                          | Result data               |
| ------------------- | ------------------------------------------- | ------------------------- |
| `installDevice`     | `targetId`, `deviceId`, optional `settings` | –                         |
| `updateDevice`      | `instanceId`, non-empty `settings` patch    | –                         |
| `moveDevice`        | `instanceId`, `targetZoneId`                | –                         |
| `removeDevice`      | `instanceId`                                | –                         |
| `toggleDeviceGroup` | `zoneId`, `kind`, `enabled`                 | `{ deviceIds: string[] }` |

Defined in `commands/devices.ts` and registered under the `devices` domain.【F:src/backend/src/facade/commands/devices.ts†L12-L86】【F:src/backend/src/facade/index.ts†L451-L478】

### Plants (`plants.*`)

| Action               | Payload highlights                                  | Result data                                |
| -------------------- | --------------------------------------------------- | ------------------------------------------ |
| `addPlanting`        | `zoneId`, `strainId`, `count`, optional `startTick` | –                                          |
| `cullPlanting`       | `plantingId`, optional `count`                      | –                                          |
| `harvestPlanting`    | `plantingId`                                        | –                                          |
| `harvestPlant`       | `plantId`                                           | `{ harvestBatchId, weightGrams, quality }` |
| `cullPlant`          | `plantId`                                           | `{ plantId, stage }`                       |
| `applyIrrigation`    | `zoneId`, `liters`                                  | –                                          |
| `applyFertilizer`    | `zoneId`, `nutrients { n, p, k }`                   | –                                          |
| `togglePlantingPlan` | `zoneId`, `enabled`                                 | `{ enabled: boolean }` result              |

Configured in `commands/plants.ts` and exposed through the façade registry.【F:src/backend/src/facade/commands/plants.ts†L12-L104】【F:src/backend/src/facade/index.ts†L451-L479】

### Health (`health.*`)

| Action             | Payload highlights   | Result data |
| ------------------ | -------------------- | ----------- |
| `scheduleScouting` | `zoneId`             | –           |
| `applyTreatment`   | `zoneId`, `optionId` | –           |
| `quarantineZone`   | `zoneId`, `enabled`  | –           |

Specified in `commands/health.ts` and wired into the façade registry.【F:src/backend/src/facade/commands/health.ts†L12-L72】【F:src/backend/src/facade/index.ts†L452-L480】

### Workforce (`workforce.*`)

| Action              | Payload highlights                                          | Result data |
| ------------------- | ----------------------------------------------------------- | ----------- |
| `refreshCandidates` | Optional `{ seed?, policyId?, force? }`                     | –           |
| `hire`              | `candidateId`, `role`, optional `wage`                      | –           |
| `fire`              | `employeeId`                                                | –           |
| `setOvertimePolicy` | `policy` (`"payout"` \| `"timeOff"`), optional `multiplier` | –           |
| `assignStructure`   | `employeeId`, optional `structureId`                        | –           |
| `enqueueTask`       | `taskKind`, optional `payload` (defaults to `{}`)           | –           |

Schemas live in `commands/workforce.ts`; the façade preprocesses optional payloads before routing to services.【F:src/backend/src/facade/commands/workforce.ts†L12-L112】【F:src/backend/src/facade/index.ts†L452-L481】

### Finance (`finance.*`)

| Action                 | Payload highlights                                                            | Result data |
| ---------------------- | ----------------------------------------------------------------------------- | ----------- |
| `sellInventory`        | `lotId`, `grams`                                                              | –           |
| `setUtilityPrices`     | Any subset of `electricityCostPerKWh`, `waterCostPerM3`, `nutrientsCostPerKg` | –           |
| `setMaintenancePolicy` | Optional `strategy`, optional `multiplier` (at least one)                     | –           |

Defined in `commands/finance.ts` and registered as the `finance` domain.【F:src/backend/src/facade/commands/finance.ts†L12-L78】【F:src/backend/src/facade/index.ts†L452-L482】

### Config (`config.*`)

| Action                | Payload highlights   | Result data        |
| --------------------- | -------------------- | ------------------ |
| `getDifficultyConfig` | – (defaults to `{}`) | `DifficultyConfig` |

Provided by `commands/config.ts` and exposed as `config.getDifficultyConfig` on the façade.【F:src/backend/src/facade/commands/config.ts†L12-L44】【F:src/backend/src/facade/index.ts†L452-L484】

## Accessing the Catalog at Runtime

- `SimulationFacade.listIntentDomains()` returns the available domains (useful for tooling or health checks).【F:src/backend/src/facade/index.ts†L776-L805】
- `SimulationFacade.getIntentHandler(domain, action)` resolves the runtime invoker that Socket clients ultimately call through `facade.intent`. Unknown domains/actions receive validation errors before execution.【F:src/backend/src/facade/index.ts†L776-L820】【F:src/backend/src/server/socketGateway.ts†L358-L403】

Use this document as the canonical reference for keeping UI workflows, integration tests, and documentation in sync with the currently implemented command surface.

## Weedbreed.AI — Technical Design Document (TDD) (docs/TDD.md)

Source: [`docs/TDD.md`](../docs/TDD.md)

# Weedbreed.AI — Technical Design Document (TDD)

## 0) Goals & Principles

- **Data-driven simulation**: All gameplay is configured by JSON files described in the DD.
- **Separation of concerns**: Headless simulation engine; any UI consumes snapshots/events.
- **Determinism**: Given same seed and inputs, outcomes are reproducible.
- **Performance**: Fixed-step simulation with catch-up and per-phase budgets.
- **Extensibility**: Add new devices/strains/treatments/pests/diseases via data without code changes.

---

## 1) Authoritative State & Public API

- **Single authoritative state**: Composite object covering Company → Structures → Rooms → Zones → Plantings/Plants; Devices; Inventory; Personnel; Tasks; Finance; Health; Clocks; RNG seed.
- **Mutation constraints**:
  - Only via **tick processing** and **explicit actions** (player / AI).- All external consumers get read-only snapshots (immutable from the UI perspective).
- **Event stream** (pub/sub): `sim.tickCompleted`, `plant.stageChanged`, `device.failed`, `market.saleCompleted`, `pest.detected`, `treatment.applied`, `employee.taskPicked`, `task.completed`, etc.
- **Persistence**: Load/save full state; load/merge blueprints; support hot-reload with validation and atomic swap.

---

## 2) Simulation Loop (fixed-step)

- **Scheduler-agnostic**: The loop may run on a server timer, a worker, or a frame callback. The contract is fixed-step:
  1. Accumulate real time.
  2. Execute ticks when `accumulated ≥ tickInterval / gameSpeed`.
  3. **Catch-up**: Process up to `maxTicksPerFrame` to avoid long stalls.
- **Recommended tick phases (order)**:
  1. **Device control** (evaluate setpoints, on/off, hysteresis).
  2. **Apply device effects** (to zone environment: ΔT, ΔRH, PPFD, CO₂).
  3. **Environment mixing/normalization** (ambient exchange scaled by airflow/enclosure).
  4. **Irrigation/Nutrients** (compute per-tick water/N/P/K demands from phase-based curves; update stocks, log deficits).
  5. **Plants** (growth, phenology, stress from temp/RH/CO₂/light & resource status; stage changes).
  6. **Health** (detect → progress → spread → treatments; apply PHI/re-entry).
  7. **Tasks & Agents** (generate tasks; employees seek/claim/execute respecting skills/tools/locks).
  8. **Harvest/Inventory/Market** (lot creation, timestamps, quality decay).
  9. **Accounting** (OPEX: maintenance/energy/water/nutrients/labor/rent; CapEx events).
  10. **Commit** (snapshot + batched events).

---

## 3) Environment & Device Models

- **Devices** act as sources/sinks per tick:
  - **GrowLight**: Heat + PPFD to covered area. Use `ppf_umol_s` & geometry factor to translate to canopy PPFD; cap by `coverage_m2`.
  - **Climate/HVAC**: `coolingCapacity` and `airflow` drive ΔT; dehumidifiers reduce RH using `moistureRemoval_Lph`; fans mix air (faster normalization).
  - **CO₂Injector**: Pulsed injection towards `targetCO2_ppm` capped by `maxSafeCO2_ppm`.
- **Normalization**: Exponential decay towards ambient for T/RH/CO₂, scaled by ventilation (`airflow`) and enclosure leakage.

**Implementation note**: Start with a simplified “well-mixed bucket” model. Permit future upgrades (Magnus formula for saturation vapor pressure, Penman–Monteith for ET0) behind the same API.

---

## 4) Plants & Growth

- **Plantings**: Group of same-strain plants started together. Each Plant tracks `biomass`, `health`, `stress`, `stage`, `age`.
- **Phenology**: Stage transitions by elapsed days & photoperiod rules; events emitted on transitions.
- **Growth model**:
  - Potential growth from light/CO₂/temperature response curves (saturating light response, Gaussian temperature response, CO₂ half-saturation).
  - Modulate by health, stress, and resource fulfillment (water, NPK).
  - Enforce caps (e.g., `maxBiomassDry_g` × `phaseCapMultiplier`).
- **Resources**:
  - Convert **NPK g/m²/day** to per-tick, per-plant requirement using zone area and plant count from cultivation method.
  - Under-supply increments stress and reduces growth; over-supply may raise disease risk via `overfertilizationRisk`.

---

## 5) Health System (Pests & Diseases)

- **Data-first**: Diseases and pests are fully described in JSON blueprints; operational treatments in `treatment_options.json`.
- **Tick logic**:
  1. **Detect**: Visibility increases over time; **scouting tasks** and traps add detection rolls.
  2. **Progress**: Severity grows with favorable environment and balancing multipliers.
  3. **Spread**: Probabilistic transmission within zone and to neighbors; influenced by airflow/sanitation/tools.
  4. **Treatments**: Apply efficacy to severity/infection; respect `cooldownDays`, **`reentryIntervalTicks`**, **`preHarvestIntervalTicks`**.
  5. **Events**: `pest.detected`, `disease.confirmed`, `health.spread`, `treatment.applied`, `outbreak.contained`.
- **IPM**: Cultural/biological first, chemical last; PHI enforced; sanitation score reduces background risk and tool-borne transmission.

---

## 6) Personnel as Agents

- **Model**: Employees have `skills`, `traits`, `certifications`, `hourlyWage`, state (`Idle`, `Working`, `Resting`, `OffDuty`), `energy`, `morale`.
- **Task generation**: Each tick, scan world → produce tasks with `priority`, `requiredSkills`, `location`, `estimatedDuration`, `deadline`, `toolsRequired`, `safetyConstraints`.
- **Utility-based claiming** (per Idle employee):
  U = w1*priority + w2*skillMatch + w3*roleAffinity + w4*urgency
  w5*distance - w6*fatigue + w7*morale + w8*toolAvailability ± traitMods
- **Locks**: Tools/resources are exclusive; tasks can be `blocking` or `splittable`.
- **Safety**: Treatments set PHI/re-entry timers; employees without certification or before re-entry may not claim.
- **Progress & learning**: Time accrues; completion mutates state & emits events; optional skill XP.

### Personnel & Labor Market

- **Weekly refresh** of the candidate pool (e.g., every 2202f016 ticks).
- **Seeded external name [provider][username.me]** (results & `inc=name` only) to generate **deterministic** candidate names from `apiSeed = "{gameSeed}-week-{weekIndex}"`.
- **Fallback** to `/data/personnel/` when offline/unavailable.
- **Profile synthesis**: for each candidate, generate `skills`, `traits`, and `hourlyWage` from balancing rules (deterministic when seeded).
- **Privacy constraint**: requests must be name-only (no additional PII).
- **Events**: `hr.candidatesRefreshed`, `hr.candidateHired`, `hr.candidateRejected`.

### Task Engine (augment)

- **Generation**: Every tick, scan world state to create tasks; read base parameters from `task_definitions.json`.
- **Scaling**: Support `perAction`, `perPlant`, `perSquareMeter` to compute `durationTicks`.
- **Lifecycle**: `durationTicks`, `progressTicks`, completion triggers state mutation and event emission.
- **Safety/Access**: Tasks honor zone locks (quarantine/PHI); include `toolsRequired` and `safetyConstraints`.
- **Decomposition**: Allow `splitable` tasks for batch labor (optional multi-agent).
- **Events**: `task.created`, `task.claimed`, `task.completed`, `task.failed`, `task.abandoned`.

### Agentic Employees (augment)

- **Utility scoring** per Idle agent: priority, skill match, role affinity, urgency, distance/travel cost, fatigue (energy), morale, tool availability; trait modifiers apply.
- **Claiming**: Highest utility claims; implement backoff to avoid thrash; aging to prevent starvation.
- **Status transitions**: Idle → Working → Resting/OffDuty; interruptions permitted for emergencies.
- **Learning**: Optional skill XP on completion; trait-based learning rates.

### Overtime Mechanics

- **Energy coupling**: Each tick of work reduces energy; employees finish the **current task** even if energy dips below 0.
- **Overtime calculation**: convert negative energy at completion into **overtime hours**.
- **Compensation policy**:
  - `payout`: pay **overtimeMultiplier × hourlyWage** instantly; proceed to standard rest.
  - `timeOff`: credit overtime to `leaveHours`; the next OffDuty window is extended accordingly.
- **Events**: `hr.overtimeAccrued`, `hr.overtimePaid`, `hr.timeOffScheduled`.

### Data & Validation Hooks (augment)

- **Personnel schema** must include: `id (UUID)`, `name`, `role`, `skills`, `traits`, `hourlyWage`, `energy`, `morale`, `status`, optional `leaveHours`, optional `certifications`, optional `assignedStructureId`.
- **Task records** must include IDs, location, scaling basis, and progress fields.
- **Policies** must define `overtimePolicy` and `overtimeMultiplier`; provide defaults.

---

## 7) Economy & Inventory

- **CapEx**: Purchases (devices, setup); tracked in device price map (`capitalCost`).
- **OpEx**: Maintenance (base + aging), energy, water, nutrients, labor, rent per tick.
- **Revenue**: `harvestBasePricePerGram` × (quality × market modifiers).
- **Inventory**: Lots are timestamped; shelf-life decay uses half-life; quarantines can block moves.

---

## 8) Device Placement Rules

- Enforce `allowedRoomPurposes` on device install/move.
  - Lights & HVAC default to `["growroom"]`.
  - Neutral items (shelves/furniture/sensors) default to `["*"]`.
- Validation emits warnings/errors with actionable messages.

---

## 9) Data Loading, Validation, & Hot Reload

- **Loading order**: (a) schemas/manifest, (b) blueprints, (c) configs/prices, (d) balancing.
- **Validation**:
  - Types, ranges, required keys.
  - Cross-file references by **`id` (UUID)**. Try slug fallback only in price maps if needed.
- **Hot reload**:
  - Load → validate → stage → swap at phase boundary to avoid partial state.
  - Emit `data.reloaded` with a summary of diffs.

---

## 10) Identifier Policy (final)

- **Primary key everywhere**: `id` (UUID v4).
- **No `uuid` field**.
- **Migration rules**:
  - If old `id` is already a UUID → keep.
  - If old `id` is not a UUID:
    - If `name` exists → create a new UUID for `id` (keep `name`).
    - If `name` missing → derive a readable `name` from the old id/filename, then assign new UUID to `id`.
- **Strain lineage**:
  - `lineage.parents` must list parent `id` (UUID). Empty or missing ⇒ ur-plant.
  - During migration, map parents by prior `name`, `slug`, or old `id`. Unresolved → leave empty and report.

---

## 11) Events & Telemetry (examples)

- **Simulation**: `sim.tickCompleted`, `sim.phaseChanged`
- **Plants**: `plant.stageChanged`, `plant.harvested`, `plant.healthAlert`
- **Devices**: `device.degraded`, `device.failed`, `device.repaired`
- **Health**: `pest.detected`, `disease.confirmed`, `health.spread`, `treatment.applied`
- **Personnel/Tasks**: `employee.taskPicked`, `task.completed`, `task.failed`
- **Economy**: `finance.tick`, `market.saleCompleted`, `inventory.lotExpired`
- Implement batching/throttling for UI streams.

---

## 12) Determinism, Performance, Testing

- **Determinism**: All stochastic draws come from an injected RNG (seeded). `noise` in strains modulates breeding variance.
- **Performance targets**: Document max zones × plants × devices × agents × health checks per tick; measure and enforce budgets per phase.
- **Testing**:
  - Schema tests (JSON validation).
  - Deterministic scenario tests (fixed seed, golden outputs).
  - Health/treatment scenarios (efficacy, PHI/re-entry).
  - Performance regression tests (tick time under target loads).

---

## 13) Security & Safety

- **Data acceptance**: Validate external JSON before merge; reject on critical errors.
- **Sandbox**: No dynamic code execution from data.
- **Boundaries**: Enforce max values (e.g., `maxSafeCO2_ppm`) and sensible clamps to avoid runaway states.

---

## 14) Extensibility & Roadmap

- **Physics**: Optional upgrade to psychrometrics (Magnus), evapotranspiration (Penman–Monteith), canopy light models (multi-layer LAI).
- **Agents**: Multi-actor coordination for large tasks; shift planning; training/XP curves.
- **Market**: Dynamic demand/prices; contracts; reputation systems.
- **Editor UX**: Schema-driven validators and wizards for strains/devices/treatments.

---

## 15) Example Public API (shape-only, stack-neutral)

- `loadBlueprints(blueprintDbOrPaths) -> ValidationReport`
- `newGame(options) -> GameState`
- `loadGame(snapshot) -> GameState`
- `tick(n=1) -> GameState`
- `actions.*` (e.g., `rentStructure`, `createRoom`, `addZone`, `installDevice`, `addPlanting`, `hireEmployee`, `applyTreatment`, `sellLot`)
- `events.subscribe(type|filter, handler) -> unsubscribe`
- `save() -> Snapshot`
- `getState() -> Readonly<GameState>`

(Exact signatures/types are left open by design.)

## Backend Overview (docs/backend-overview.md)

Source: [`docs/backend-overview.md`](../docs/backend-overview.md)

# Backend Overview

## 1. Purpose & Non-Goals

**Purpose.** Deliver a deterministic cultivation and economy simulation core that exposes structured telemetry and accepts validated intents without leaking internal coupling.

**Non-Goals.**

- Ship user interface code or rendering assets.
- Introduce non-deterministic randomness; every stochastic source must be seeded.
- Bind the engine to a specific persistence layer; storage adapters remain optional.

## 2. Architecture Overview

```mermaid
flowchart LR
    subgraph Engine Core
        Scheduler[Tick Scheduler]
        StateStore[Runtime State Store]
        Physio[Simulation Subsystems]
    end
    BlueprintRegistry[Blueprint Registry]
    ScenarioLoader[Scenario Loader]
    IntentRouter[Intent Router]
    EventBus[Event & Telemetry Bus]
    PersistenceAdapter[[Persistence Adapter (optional)]]
    APIAdapter[[API Adapter (optional)]]

    BlueprintRegistry --> ScenarioLoader
    ScenarioLoader --> Scheduler
    IntentRouter --> Scheduler
    Scheduler --> StateStore
    Scheduler --> Physio
    Physio --> StateStore
    StateStore --> EventBus
    EventBus --> APIAdapter
    StateStore --> PersistenceAdapter
```

The engine core owns the tick scheduler, orchestrates subsystem execution, and keeps authoritative runtime state. Blueprints are stored in a read-only registry; a scenario loader materializes them into runtime instances. Intents are validated and sequenced before they reach the scheduler. Event telemetry is append-only; adapters consume snapshots without mutating state. Persistence and external API layers integrate through explicit ports.

## 3. Blueprints Provided & How to Use Them

### 3.1 Operating Principles

- **Validated blueprint set.** The repository ships canonical JSON blueprints covering structures, room purposes, cultivation methods, strains, devices, pests, diseases, personnel roles/skills, and price maps for seeds, devices, and utilities.【F:data/blueprints/structures/small_warehouse.json†L1-L11】【F:data/blueprints/roomPurposes/growroom.json†L1-L13】【F:data/blueprints/cultivationMethods/scrog.json†L1-L47】【F:data/blueprints/strains/ak-47.json†L1-L132】【F:data/blueprints/devices/veg_light_01.json†L1-L21】【F:data/blueprints/pests/spider_mites.json†L1-L44】【F:data/blueprints/diseases/powdery_mildew.json†L1-L44】【F:data/blueprints/personnel/roles/Gardener.json†L1-L32】【F:data/prices/devicePrices.json†L1-L11】
- **Template → instance.** Blueprints are immutable templates; they are never executed directly. A materializer copies values, applies defaults, and assigns runtime identifiers before the engine can use them.
- **Runtime reads from instances.** Environment, plant growth, device control, and economic subsystems must consume only the materialized runtime objects so that validation, overrides, and seed-controlled randomness are centralized.
- **Analyse before implementing.** Inspect the relevant blueprint fields (names, units, value ranges, and constraints) before writing a subsystem formula. Designs must match the delivered data, especially when translating arrays (e.g., phase ranges) or nested settings blocks.
- **Units & naming.** Values use SI units; keys are camelCase without unit suffixes. Convert at the edges if an external adapter requires alternative units.
- **Validation gate.** Every blueprint passes schema validation before the engine starts. Files that fail validation must be rejected or migrated explicitly; do not coerce data silently.
- **Change protocol.** When a formula needs a field that the current blueprints do not supply, document a “Proposed Blueprint Extension” in the docs with key name, type, SI unit, and rationale before implementation. Never introduce ad-hoc fields at runtime.

### 3.2 Blueprint–to–Subsystem Mapping

| Subsystem          | Required blueprint fields (name + SI units)                                                                                                                                                                                                        | Derived runtime parameters (per tick)                                  | Validation rules                                                                                            |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| Lighting           | `devices.settings.ppfd` (µmol·m⁻²·s⁻¹)<br>`devices.settings.coverageArea` (m²)<br>`devices.settings.power` (kW)<br>`strains.environmentalPreferences.lightCycle` (h·day⁻¹)                                                                         | Zone PPFD<br>Daily light integral<br>Lamp heat load                    | `ppfd > 0` and coverageArea > 0<br>Power within rated range<br>Light-cycle arrays length 2                  |
| Climate / VPD      | `devices.settings.coolingCapacity` (kW)<br>`devices.settings.airflow` (m³·h⁻¹)<br>`devices.settings.targetTemperature` (°C)<br>`strains.environmentalPreferences.idealTemperature` (°C)<br>`strains.environmentalPreferences.idealHumidity` (0..1) | Temperature deltas<br>Air-mixing factor<br>VPD targets                 | Cooling capacity ≥ 0<br>Airflow ≥ 0<br>Target temperature within declared range<br>Humidity bounds in [0,1] |
| Plant Growth       | `strains.growthModel.baseLightUseEfficiency` (light-use coefficient)<br>`strains.growthModel.maxBiomassDry` (kg)<br>`strains.morphology.leafAreaIndex` (m²·m⁻²)<br>`strains.environmentalPreferences.lightIntensity` (µmol·m⁻²·s⁻¹)                | Biomass increment<br>Stress indices<br>Canopy scaling                  | Values ≥ 0<br>Phase dictionaries include vegetation & flowering keys<br>Arrays sorted ascending             |
| Water / NPK        | `strains.waterDemand.dailyWaterUsagePerSquareMeter` (L·m⁻²·day⁻¹)<br>`strains.nutrientDemand.dailyNutrientDemand` (g·plant⁻¹·day⁻¹)<br>`cultivationMethods.areaPerPlant` (m²·plant⁻¹)<br>`cultivationMethods.minimumSpacing` (m)                   | Irrigation volume<br>Nutrient delivery targets<br>Plant density checks | Non-negative volumes<br>Nutrient objects contain N/P/K keys<br>Spacing ≥ 0                                  |
| Devices / Energy   | `devices.settings.power` (kW)<br>`devices.lifespan` (s)<br>`devices.quality` (0..1)<br>`devicePrices.*.capitalExpenditure` (EUR)<br>`utilityPrices.pricePerKwh` (EUR·kWh⁻¹)                                                                        | Device runtime health<br>Replacement horizon<br>Energy cost per tick   | Power ≥ 0<br>Lifespan > 0<br>Quality within [0,1]<br>Price entries ≥ 0                                      |
| Economics / OPEX   | `roomPurposes.economy.baseRentPerTick` (EUR·tick⁻¹)<br>`roomPurposes.economy.areaCost` (EUR·m⁻²)<br>`devicePrices.*.baseMaintenanceCostPerTick` (EUR·tick⁻¹)<br>`strainPrices.*` (EUR)                                                             | Rent accrual<br>Maintenance charges<br>Revenue projections             | Monetary fields ≥ 0<br>Cross-map ids resolve                                                                |
| Employees / Skills | `personnel.roles.salary.basePerTick` (EUR·tick⁻¹)<br>`personnel.roles.maxMinutesPerTick` (min)<br>`personnel.roles.skillProfile` (levels)<br>`personnel.skills.*` definitions                                                                      | Wage budgets<br>Shift capacity<br>Skill distribution                   | Salary ranges ≥ 0<br>Minutes per tick ≤ 1440<br>Skill ids referenced exist                                  |

## 4. Blueprint Inventory

### 4.1 Structures & Room Purposes

- **Structures.** Each structure blueprint defines an `id`, `name`, and a `footprint` block with `length_m`, `width_m`, and `height_m` in metres, alongside `rentalCostPerSqmPerMonth` and `upfrontFee` in euros.【F:data/blueprints/structures/small_warehouse.json†L1-L11】
- **Room purposes.** Room purpose files provide `id`, `kind`, `name`, a human-readable `description`, boolean `flags` (e.g., `supportsCultivation`, `requiresControlledEnvironment`), and an `economy` block with `areaCost` (EUR·m⁻²) and `baseRentPerTick` (EUR·tick⁻¹).【F:data/blueprints/roomPurposes/growroom.json†L1-L13】
- There is no dedicated room or zone blueprint; zones are derived by combining structure geometry with selected room purposes during materialization.

### 4.2 Cultivation Methods

Cultivation method templates include `id`, `kind`, `name`, `laborIntensity` (0..1), `areaPerPlant` (m²·plant⁻¹), `minimumSpacing` (m), and optional `maxCycles`. Media options are declared via `compatibleSubstrateTypes` (category names such as `"soil"` and `"coco"`, resolved against the substrate library) and container options point to category names via `compatibleContainerTypes`. Compatibility rules appear under `strainTraitCompatibility`, and `idealConditions` specify `idealTemperature` (°C) and `idealHumidity` (0..1) ranges. Optional `meta` text documents trade-offs.【F:data/blueprints/cultivationMethods/scrog.json†L1-L47】
The baseline cultivation methods (`basic_soil_pot`, `scrog`, `sog`) each enumerate both substrate types so either soil mixes or coco coir consumables can be paired with their shared `pot` container category.【F:data/blueprints/cultivationMethods/basic_soil_pot.json†L1-L29】【F:data/blueprints/cultivationMethods/scrog.json†L1-L47】【F:data/blueprints/cultivationMethods/sog.json†L1-L46】

Upfront economics are externalized: `data/prices/cultivationMethodPrices.json` maps method ids to `{ "setupCost" }`, while `data/prices/consumablePrices.json` exposes nested `substrates` and `containers` price tables keyed by slug. Substrate entries now declare `costPerLiter`, and containers track `costPerUnit`.【F:data/prices/cultivationMethodPrices.json†L1-L13】【F:data/prices/consumablePrices.json†L1-L21】 Designers select compatible consumables in the blueprint and tune the actual ledger entries centrally, keeping balancing data separate from structural definitions.

#### Substrate Blueprints

`/data/blueprints/substrates` holds reusable media definitions with stable `id`/`slug` pairs, media `type`, and optional `maxCycles`. Cultivation methods now reference these by type, while the loader builds a type index to validate compatibility lists and flag missing priced options. Each substrate blueprint also exposes a `meta` block with `description`, `advantages`, and `disadvantages` so UI tooling can surface qualitative trade-offs alongside numeric specs. The catalog currently offers single-cycle soil, multi-cycle soil, and coco coir blueprints for reuse-friendly grow plans.【F:data/blueprints/substrates/soil_single_cycle.json†L1-L19】【F:data/blueprints/substrates/soil_multi_cycle.json†L1-L19】【F:data/blueprints/substrates/coco_coir.json†L1-L19】

#### Container Blueprints

`/data/blueprints/containers` captures reusable vessel geometries (`volumeInLiters`, `footprintArea`, `reusableCycles`, `packingDensity`) with slug identifiers and a `type` category so cultivation methods can reference compatible families via `compatibleContainerTypes`. Each container blueprint mirrors cultivation-method metadata with a `meta` block for descriptive copy and advantage/disadvantage lists, and the loader builds a `containersByType` index while warning when a referenced type lacks priced slugs.【F:data/blueprints/containers/pot_25l.json†L1-L19】

### 4.3 Strain Blueprints

Strain blueprints capture:

- Identity (`id`, `slug`, `name`) and lineage metadata.【F:data/blueprints/strains/ak-47.json†L1-L12】
- Composition: `genotype` fractions, `chemotype` THC/CBD ratios, `generalResilience`, and `germinationRate`. Values are unitless ratios within `[0,1]`.【F:data/blueprints/strains/ak-47.json†L5-L24】
- Morphology (`growthRate`, `yieldFactor`, `leafAreaIndex`) and a `growthModel` with `maxBiomassDry` (kg), `baseLightUseEfficiency` (kg·µmol⁻¹ scaled by seconds), `maintenanceFracPerDay`, `dryMatterFraction` by phase, `harvestIndex`, `phaseCapMultiplier`, and temperature response parameters (`Q10`, `T_ref_C`).【F:data/blueprints/strains/ak-47.json†L24-L54】
- Optional noise controls (`noise.enabled`, `noise.pct`) to modulate deterministic variance.【F:data/blueprints/strains/ak-47.json†L55-L58】
- Environmental preferences: spectrum ranges in nanometres, light intensity bands (µmol·m⁻²·s⁻¹), light cycles (hour pairs per phase), temperature ranges (°C), humidity ranges (0..1), and `phRange`.【F:data/blueprints/strains/ak-47.json†L59-L88】
- Nutrient demand: `dailyNutrientDemand` per phase with `nitrogen`, `phosphorus`, and `potassium` in grams per plant per day, plus `npkTolerance` and `npkStressIncrement`.【F:data/blueprints/strains/ak-47.json†L89-L110】
- Water demand: `dailyWaterUsagePerSquareMeter` per phase (litres per square metre per day) and `minimumFractionRequired`.【F:data/blueprints/strains/ak-47.json†L111-L118】
- Disease resistance: infection and recovery parameters, expressed as fractions per day.【F:data/blueprints/strains/ak-47.json†L119-L124】
- Phenology: `photoperiod` timings in seconds, `stageChangeThresholds`, `harvestWindow` (seconds), and `harvestProperties` with ripening and storage timings plus `qualityDecayRate`.【F:data/blueprints/strains/ak-47.json†L125-L140】
- Descriptive `meta` text for designers.【F:data/blueprints/strains/ak-47.json†L141-L150】

All numeric arrays are ordered `[min, max]`. Missing phases must be handled gracefully (e.g., if a strain omits flowering adjustments).

### 4.4 Device Blueprints

Device templates share `id`, `kind`, `name`, `quality` (0..1), `complexity` (0..1), `lifespan` (seconds of rated operation), `roomPurposes`, nested `settings`, and optional `meta` text.【F:data/blueprints/devices/veg_light_01.json†L1-L21】 Settings are device-class specific:

- **Lamp:** `power` (kW), `ppfd` (µmol·m⁻²·s⁻¹), `coverageArea` (m²), `spectralRange` (nm), `heatFraction` (0..1).【F:data/blueprints/devices/veg_light_01.json†L9-L17】
- **ClimateUnit:** `power` (kW), `coolingCapacity` (kW), `airflow` (m³·h⁻¹), `targetTemperature` (°C), `targetTemperatureRange` (°C), `cop`, `hysteresisK`, and `fullPowerAtDeltaK` (°C).【F:data/blueprints/devices/climate_unit_01.json†L9-L22】
- **Dehumidifier:** `latentRemovalKgPerTick` (kg·tick⁻¹) and `power` (kW).【F:data/blueprints/devices/dehumidifier-01.json†L9-L16】

Additional device kinds (e.g., CO₂ injectors, exhaust fans) follow the same pattern with their own setting keys. Engines must branch on `kind` and validate the expected settings block.

### 4.5 Pest & Disease Blueprints

Pest blueprints define `id`, `kind`, `name`, `category`, `targets`, `environmentalRisk` (temperature and humidity ranges plus qualitative risk factors), `populationDynamics`, `damageModel`, `detection` guidance, and `controlOptions`. Values are ratios per day or boolean flags as indicated.【F:data/blueprints/pests/spider_mites.json†L1-L44】

Disease blueprints mirror this structure with `pathogenType`, `environmentalRisk`, a `model` of infection parameters, `detection` hints, and `treatments` grouped by approach.【F:data/blueprints/diseases/powdery_mildew.json†L1-L44】

### 4.6 Personnel Roles & Skills

Personnel role files specify `id`, `name`, a `salary` block (`basePerTick` in EUR·tick⁻¹, `skillFactor` weights, optional `randomRange`), `maxMinutesPerTick`, `roleWeight`, and a structured `skillProfile` describing primary, secondary, and optional tertiary skills with level rolls. Values are deterministic ranges for procedural generation.【F:data/blueprints/personnel/roles/Gardener.json†L1-L32】

Skill definitions list `id`, `name`, `description`, and optional `tags` for classification.【F:data/blueprints/personnel/skills/Gardening.json†L1-L6】

### 4.7 Price & Cost Blueprints

- **Device prices.** Map device `id` to `capitalExpenditure`, `baseMaintenanceCostPerTick`, and `costIncreasePer1000Ticks`, all in euros.【F:data/prices/devicePrices.json†L1-L11】
- **Strain prices.** Map strain `id` to `seedPrice` and `harvestPricePerGram` in euros.【F:data/prices/strainPrices.json†L1-L13】
- **Utility prices.** Provide `pricePerKwh`, `pricePerLiterWater`, and `pricePerGramNutrients` in euros for operating cost calculations.【F:data/prices/utilityPrices.json†L1-L4】

## 5. Materialization & Runtime State

1. **Load & validate.** Parse blueprints, run schema validation, and reject or migrate files that fall outside required ranges.
2. **Materialize instances.** Copy template values into runtime records, apply scenario overrides, derive geometric aggregates (e.g., structure volume), and attach deterministic identifiers.
3. **Link cross-references.** Resolve ids across maps (e.g., device prices, strain prices) before the first tick. Missing references are fatal until documented and added to the blueprint set.
4. **Runtime usage.** Engine subsystems read only from materialized instances, ensuring tick execution cannot mutate shared template data. Derived telemetry must include source blueprint ids for auditability.

- **Zone updates.** `world.updateZone` validates geometry edits and cultivation-method patches against the existing container/substrate setup, applies default consumables when methods declare them, and emits `world.zoneUpdated` telemetry with storage warnings so the UI can prompt for handoffs.【F:src/backend/src/engine/world/worldService.ts†L779-L934】【F:src/backend/src/engine/world/worldService.updateZone.test.ts†L290-L360】

## 6. Identifier Strategy

Prefer hierarchical addresses for static assets (structure/room/device) built from blueprint slugs or ids to keep telemetry readable. Use UUIDs for mobile entities (plants, employees) where collisions or reassignment are likely. Record remapping events at tick boundaries if identifiers change so downstream consumers can reconcile history.

## 7. Quality Gates & Validation

- Enforce numeric bounds indicated by the blueprints (e.g., humidity `[0,1]`, probability weights `[0,1]`, non-negative costs). Violations block scenario load.
- Maintain schema definitions alongside blueprints to guard against drift. When extending a schema, version the document and migrate existing JSON explicitly.
- Unit tests should cover blueprint ingestion, ensuring every `kind` branch is exercised with fixture data taken from the shipped files.

---

Reviewed against current blueprint set on 2025-09-25; removed unsupported claims; added proposals where fields are missing.

## World Service Architecture (docs/system/world-service-architecture.md)

Source: [`docs/system/world-service-architecture.md`](../docs/system/world-service-architecture.md)

# World Service Architecture

## 1. Façade Composition & Design Intent

The backend `WorldService` implements the façade pattern required by the system façade ADR, concentrating command handling while delegating domain logic to focused collaborators. It accepts all external dependencies (state, RNG, accounting, blueprints, difficulty presets) and wires purpose-specific services for structures, rooms, and zones. Each collaborator exposes a narrow command surface and uses shared failure factories so façade-level error handling and telemetry stay consistent.【F:src/backend/src/engine/world/worldService.ts†L65-L135】

## 2. Module Responsibilities

### 2.1 `worldService.ts`

- Owns façade entrypoints for structural lifecycle commands (`rentStructure`, `duplicateStructure`, etc.) and delegates to the specialised services to keep orchestration thin.【F:src/backend/src/engine/world/worldService.ts†L170-L229】
- Normalises difficulty metadata by cloning modifiers from configuration into state, guaranteeing deterministic runs regardless of presets supplied at startup.【F:src/backend/src/engine/world/worldService.ts†L137-L161】
- Bridges RNG via a dedicated stream so cloned entities receive deterministic IDs while collaborators stay stateless with respect to randomness.【F:src/backend/src/engine/world/worldService.ts†L96-L113】

### 2.2 `structureService.ts`

- Guards structure-level workflows: rename, rent (with upfront cost & rent ledgering), deletion, duplication, and purchase bookkeeping.【F:src/backend/src/engine/world/structureService.ts†L31-L52】【F:src/backend/src/engine/world/structureService.ts†L124-L200】
- Applies accounting accumulators to cashflow summaries and records device purchases using the shared cost accounting service, ensuring finance totals stay in sync with façade events.【F:src/backend/src/engine/world/structureService.ts†L61-L97】
- Reuses room cloning support so full-structure duplication remains cohesive while respecting geometry validation helpers and duplicate-naming defaults.【F:src/backend/src/engine/world/structureService.ts†L54-L59】【F:src/backend/src/engine/world/structureService.ts†L61-L71】

### 2.3 `roomService.ts`

- Validates geometry, purpose registrations, and emits lifecycle events when rooms are created, enforcing footprint limits before mutating world state.【F:src/backend/src/engine/world/roomService.ts†L66-L133】
- Provides cloning/duplication utilities that cascade into the zone service, consolidating device purchase tallies so higher-level services can account for capital expenditures.【F:src/backend/src/engine/world/roomService.ts†L135-L176】
- Shares the common failure factory interface to surface consistent error codes through the façade command responses.【F:src/backend/src/engine/world/roomService.ts†L25-L55】

### 2.4 `zoneService.ts`

- Orchestrates zone creation, updates, duplication, and cloning, enforcing compatibility between cultivation methods, containers, and substrates using repository lookups.【F:src/backend/src/engine/world/zoneService.ts†L95-L239】
- Computes capacity limits from blueprint footprints and records cost accounting impacts (method setup, container/substrate purchases) via injected services and accumulators.【F:src/backend/src/engine/world/zoneService.ts†L188-L211】【F:src/backend/src/engine/world/zoneService.ts†L56-L63】
- Clones operational state—environment, metrics, control, cultivation metadata—by composing shared default helpers so duplicated zones preserve telemetry history correctly.【F:src/backend/src/engine/world/zoneService.ts†L835-L901】

### 2.5 Shared Utilities

- `worldDefaults.ts` standardises cloning (environment, cultivation, metrics, control), duplicate naming, and preset creation for resources and modifiers, keeping deterministic defaults centralised for all services.【F:src/backend/src/engine/world/worldDefaults.ts†L16-L109】
- `stateSelectors.ts` offers indexed lookups for structures, rooms, and zones, returning both entities and their positional indices so services can mutate state safely without re-scanning the tree.【F:src/backend/src/engine/world/stateSelectors.ts†L1-L40】

## 3. Dependency Injection & Cross-Service Collaboration

`WorldService` instantiates collaborators by passing the shared game state, accounting interface, blueprint repository, RNG-derived ID factory, and a bound failure factory. This keeps the collaborators stateless aside from the shared state reference and allows tests to swap dependencies easily. Room and structure services receive handles to downstream clone operations (`zoneService.cloneZone`, `roomService.cloneRoom`) so duplication logic flows through the same validation and accounting hooks used by direct commands.【F:src/backend/src/engine/world/worldService.ts†L96-L134】【F:src/backend/src/engine/world/roomService.ts†L135-L176】【F:src/backend/src/engine/world/structureService.ts†L21-L59】

## 4. Testing Strategy

- **Unit coverage.** Each service has a dedicated Vitest suite targeting its surface: structure workflows (rename, rent, delete, duplicate, purchase accounting), room geometry and duplication, and zone creation/duplication/clone behaviours. The tests assert geometry validation, repository lookups, and accounting hooks fire as expected.【F:src/backend/src/engine/world/structureService.test.ts†L303-L719】【F:src/backend/src/engine/world/roomService.test.ts†L293-L538】【F:src/backend/src/engine/world/zoneService.test.ts†L334-L687】
- **Selector coverage.** `stateSelectors.test.ts` verifies hierarchical lookups, ensuring services operate on consistent snapshots of structures, rooms, and zones before applying mutations.【F:src/backend/src/engine/world/stateSelectors.test.ts†L1-L198】
- **Integration flows.** `worldService.updateZone.test.ts` exercises façade-level zone updates against the concrete repository, RNG, and accounting implementations, validating that injected services collaborate correctly when commands traverse the full stack.【F:src/backend/src/engine/world/worldService.updateZone.test.ts†L1-L120】

## 5. Related References

- ADR 0012 documents the refactoring governance that led to this modular split and should be consulted for future decomposition thresholds.【F:docs/system/adr/0012-refactoring-governance.md†L1-L28】
- The refactoring roadmap captures the completed extraction of world sub-services and associated test coverage, providing historical context for maintenance and follow-up tasks.【F:docs/tasks/20250929-refactoring-roadmap.md†L1-L64】

## Weedbreed.AI — Simulation Engine Deep Dive (docs/system/simulation-engine.md)

Source: [`docs/system/simulation-engine.md`](../docs/system/simulation-engine.md)

# Weedbreed.AI — Simulation Engine Deep Dive

This document details the engine’s core calculations, tick ordering, and control strategies. It is **stack-neutral** and uses **Data Dictionary** terminology.

## Timebase & Core Loop (fixed-step, scheduler-agnostic)

### Goals

- **Stability** (no drift), **determinism** (seeded RNG), **decoupled rendering**.
- **Catch-up** without UI stalls; **atomic** state commits per tick.

### Process

1. **Wall-time accumulation**: keep `accumulatedMs += now - lastNow`.
2. **Tick threshold**: while `accumulatedMs ≥ tickIntervalMs / gameSpeed`, do:
   - Run **one full tick** (see _Environment_, _Plant_, _Health_, and _Tasks & Agentic Employees_ below).
   - `accumulatedMs -= tickIntervalMs / gameSpeed`.
   - Cap iterations with `maxTicksPerFrame` to prevent long catch-ups.
3. **Snapshot & events**: publish a read-only snapshot and batched events after each committed tick.

**Notes**

- `gameSpeed` > 0 scales progression without changing equations.
- In headless runtimes, replace “frame” with the host scheduler; the contract is the same.
- Determinism: **all stochastic draws** (breeding variance, failure chances, etc.) come from seeded RNG streams.

---

## Environment Model (per Zone; well-mixed, delta-based)

Each **Zone** maintains `temperature_C`, `humidity` (0–1), `co2_ppm`, and optionally canopy **PPFD**. The engine aggregates **deltas**; devices contribute their own changes rather than setting absolutes.

See [WB Physiology Reference](./wb-physio.md) for the concrete formulas and unit conventions used in the physio helpers.

### Tick Order (environment phase)

1. **Start** from last values: `T`, `RH`, `CO2`, (optional `PPFD`).
2. **Device deltas**
   - **GrowLight**
     - Heat gain ∝ `power (kW)` and inefficiency → `+ΔT`.
     - Light: map `ppf_umol_s` over `coverage_m2` to canopy PPFD.
     - Optional `dliTarget_mol_m2_day` → duty suggestions (advisory).
   - **Climate/HVAC**
     - Cooling/heating: proportional approach to `targetTemperature` within `targetTemperatureRange`.
     - **Dehumidifier**: `moistureRemoval_Lph` ⇒ `−ΔRH` via moisture balance.
     - **Exhaust/Fan**: boosts mixing/exchange factor (see normalization).
   - **Humidifier/Dehumidifier**
     - Water mass flow (`humidifyRateKgPerTick`, `dehumidifyRateKgPerTick` or `latentRemovalKgPerTick`) converts to relative humidity deltas with `ΔRH = (mass_kg ÷ (volume_m3 × SATURATION_VAPOR_DENSITY_KG_PER_M3)) × efficiency × powerMod`.
     - `SATURATION_VAPOR_DENSITY_KG_PER_M3 ≈ 0.0173 kg·m⁻³` (20 °C reference) anchors the simple moisture balance; outputs are clamped to `[0,1]` after device hysteresis and controller modulation (`humidityHumidify` / `humidityDehumidify`).
   - **CO2Injector**: move `CO2` toward `targetCO2_ppm`, capped by `maxSafeCO2_ppm`.
3. **Plant deltas** (coarse canopy physiology)
   - **Transpiration**: convert the zone’s aggregated `transpirationLiters` into a humidity delta using
     `SATURATION_VAPOR_DENSITY_KG_PER_M3` and the zone volume. The same liter quantity is removed from the
     zone’s water/nutrient reservoirs, lowering `reservoirLevel` and weakening `nutrientStrength` before
     clamps are applied.
   - **Photosynthesis**: `−ΔCO2` (scaled by PPFD and saturation curve).
4. **Normalization toward ambient**
   - Exponential pull: `Δ = k_mix * (ambient − current)`.
   - `k_mix` scales with **airflow** (fans/exhaust) and enclosure leakage; higher airflow → faster return to ambient.
5. **Clamp & commit**
   - Clamp **RH to [0,1]**, safety-clamp `CO2 ≤ maxSafeCO2_ppm`, bound `T` to reasonable limits.
6. **Events**
   - Emit anomalies (e.g., `env.safetyExceeded`) for downstream policy (alarms, auto-shutdowns).

**Why delta-based?** Extensible and composable: new device types add a delta without changing the solver.

---

## Plant Growth, Stress, Health (per Planting/Plant)

Plants respond to environment and resources; **stress** reduces **health**; **health** and resources limit **growth** and yield.

### Inputs from DD

- Strain `environment.*` (optima), `nutrients.npkCurve` **(g/m²/day)** for `vegetative` and `flowering`.
- Phenology (days per stage), optional photoperiod hints (`vegHoursLight`, `flowerHoursLight`).
- Strain `generalResilience`, optional `resistanceTraits`.
- **Breeding variance**: `noise (0–1)` affects offspring trait sampling (breeding handled elsewhere).

### Tick Order (plant phase)

1. **Phenology update**  
   Advance age; evaluate transitions (seedling → vegetative → flowering) by elapsed days and photoperiod policy; emit `plant.stageChanged`.
2. **Resource requirement**  
   Convert **NPK (g/m²/day)** → **per-tick, per-plant**:
   `req_phase = curve[phase]          // g/m²/day`
   `req_tick_plant = req_phase * (zoneArea / plantCount) * (tickHours / 24)`
   Water demand analogously from `water.dailyUsePerM2_L`.
3. **Stress computation (0–1)**  
   For each driver D ∈ {T, RH/VPD, CO₂, Light, Water, N, P, K} compute a **distance function** from strain optima (e.g., quadratic or Gaussian penalty).  
   Combine: `stress_raw = Σ w_D * penalty_D`.  
   Resilience mitigation: `stress = clamp01(stress_raw * (1 − generalResilience))`.
4. **Health update (0–1)**  
   If `stress > θ_stress`: `health -= α * stress`; otherwise passive recovery `health += β_recovery`.  
   Additional penalties from **active diseases/pests** and **resource deficits**.
5. **Potential growth**
   - **Light response** (rectangular hyperbola/saturation over PPFD), **temperature response** (Gaussian), **CO₂ factor** (half-saturation).
   - **Canopy interception** applies the Beer–Lambert law using only the leaf-area index: `interception = 1 − exp(−k × LAI)`.
     The interception fraction is dimensionless; total absorbed photons are computed as `incidentMol_m2 × canopyArea × interception`
     and explicitly capped so they never exceed the photons delivered to that canopy area.
   - Apply phase caps and **LUE** to get `potentialGrowth_g_dry_per_tick`.
   - Apply health & stress: `actualGrowth = potentialGrowth * health * (1 − γ * stress)`.
   - Accrue `biomassDry_g`; enforce `maxBiomassDry_g` and phase harvest index.
6. **Quality & harvest window**  
   Accumulate quality within `harvest.windowDays`; outside this window, quality decays faster.

**Outputs**: plant metrics (biomass, health, stress), resource consumption, warnings.

During the same `updatePlants` phase the engine now aggregates the returned
`transpirationLiters` per zone and immediately applies the irrigation feedback:
humidity is increased according to the zone volume while the corresponding water
and nutrient solution volumes are depleted (`reservoirLevel` and
`nutrientStrength` drop accordingly). This keeps the environment and resource
state in lockstep with plant transpiration before the tick commits.

---

## Health: Pests & Diseases (detect → progress → spread → treat)

Integrates **data-driven** pests/diseases with **operational** treatments.

### Tick Order (health phase)

1. **Detect**  
   Visibility rises with time/conditions; **scouting tasks** improve detection; traps add passive checks.  
   Emit `pest.detected` / `disease.confirmed` on threshold.
2. **Progress**  
   Advance **severity/infection** using blueprint daily increments (scaled to ticks) × environmental risk × phase multipliers.  
   Apply **damage** to plant processes (growth, transpiration, mortality risk) per blueprint. 3. **Spread**  
   Stochastic spread within zone and to neighbors; modulated by **airflow (mixing)**, **sanitation**, and **tool transmission**.  
   Quarantine/locks reduce adjacency graph edges.
3. **Treat**  
   Apply active **treatments** from `configs/treatment_options.json`: efficacy multipliers to infection/degeneration/recovery.  
   Enforce **cooldowns**, **reentryIntervalTicks**, **preHarvestIntervalTicks**; set **safety constraints** that block task claiming. 5. **Emit events**  
   `health.spread`, `treatment.applied`, `outbreak.contained`, `treatment.failed`.

---

## Tasks & Agentic Employees (utility-based; overtime-aware)

The hiring side of this system—including weekly candidate refresh mechanics—is
documented in [Job Market Population](./job_market_population.md).

### Task generation (per tick)

Scan world state → create **Task** objects (see DD §Tasks) from `task_definitions.json`.  
Compute `durationTicks` via `costBasis`:

- `perAction` fixed
- `perPlant × plantCount`
- `perSquareMeter × area`

### Claiming (pull model with utility)

**Idle** employees compute a **utility** for visible tasks:  
`U = w1*priority + w2*skillMatch + w3*roleAffinity + w4*urgency − w5*distance − w6*fatigue + w7*morale + w8*toolAvailability ± traitMods`  
Highest utility claims; use **backoff** to avoid thrash; **aging** to prevent starvation.  
Honor **safety constraints** (e.g., no entry before `reentryIntervalTicks`).

### Execution & completion

While Working: increment `progressTicks` each tick; when `progressTicks ≥ durationTicks`, resolve effects (repair, harvest, clean…), emit `task.completed`.

### Overtime (energy-linked)

Energy `0..100` decreases per working tick. Employees **finish the current task** even if **energy < 0**.  
At completion: convert negative energy to **overtime hours** (ticks).  
**Company policy**:

- `payout`: pay `overtimeMultiplier × hourlyWage` immediately; employee rests normally.
- `timeOff`: credit overtime to `leaveHours`; next OffDuty extends accordingly.  
   Emit `hr.overtimeAccrued`, `hr.overtimePaid` / `hr.timeOffScheduled`.

---

## Economics (currency-neutral)

**Event-based** and **per-tick** accounting; figures are currency-neutral (UI chooses symbol).

- **CapEx**: device purchases (`capitalCost`), structure setup; log & deduct immediately.
- **OpEx (per tick)**:
  - **Maintenance**: `baseMaintenanceCostPerTick` (hourly base rate) × tickHours, with aging via `costIncreasePer1000Ticks`.
  - **Energy**: sum `(device.power_kW × tickHours × electricityCostPerKWh)` for active devices.
  - **Water/Nutrients**: from zone demand using **g/m²/day** curves → per-tick spend via `waterCostPerM3`, `nutrientsCostPerKg`.
- **Rent**: structure fixed costs or `area_m2 × rentalRate`; the value lives in `StructureState.rentPerTick`, but that field is a legacy name for the hourly base rate and must be multiplied by tickHours when charging rent.

Recurring OpEx entries should always derive their per-tick charge from the current tick length
(`tickHours = tickLengthMinutes / 60`) so that changing the tick length at runtime does not drift
total rent or maintenance over real-time hours.

- **Labor**: daily sweep (every 24 ticks) or continuous accrual; overtime per policy.
- **Revenue**: `harvestBasePricePerGram × quality × market modifiers` on sales.
- **Reports**: emit `finance.tick` summaries; categorize by device/structure/zone.

---

## Persistence, Validation, and Hot-Reload

- **Persistence**: serialize full authoritative state + RNG streams; loading restores determinism.
- **Validation** on data load & hot-reload:
  - Types/ranges; **IDs are UUID** (`id`) in all blueprints; cross-refs by `id`.
  - Strain **`lineage.parents`** must be UUIDs; empty/missing ⇒ **ur-plant**.
  - Devices must honor **`allowedRoomPurposes`**.
  - Treatment options must carry **`reentryIntervalTicks` / `preHarvestIntervalTicks`** (or convert from human-readable inputs).
- **Hot-reload**: validate → stage → swap at a tick boundary; emit `data.reloaded` with a diff summary.

---

## Determinism & RNG Streams

- A **global seed** initializes named streams: `"breeding"`, `"environment.noise"`, `"device.failure"`, `"task.random"`, etc.
- **Breeding variance** uses strain `noise` to set max deviation envelopes around inherited means; clamp to biological bounds.
- Store stream positions in snapshots to guarantee **exact replay**.

---

## Error Handling & Safety

- **Hard clamps**: RH `[0,1]`, `CO2 ≤ maxSafeCO2_ppm`, reasonable temperature bounds, non-negative inventories.
- **Graceful degradation**: if hot-reload data fails, keep last good set and emit `data.reloadFailed`.
- **Task invalidation**: if a referenced object disappears (sold device, culled planting), cancel with `task.abandoned`.

---

## Future Enhancements (compatible with current contracts)

- **Event-driven task creation**: replace polling with device/plant events (e.g., `device.maintenanceRequired`) to cut scan cost.
- **Multi-agent tasking**: coordinated work gangs for large harvests; pre-emption rules.
- **Finer environment**: optional cell/CFD hotspot model; keep well-mixed default.
- **Market dynamics**: demand-driven price curves and contracts.
- **Control policies**: PID / model-predictive controllers behind the same “setpoint → deltas” interface.

## Weedbreed.AI — Simulation Philosophy Deep Dive (docs/system/simulation_philosophy.md)

Source: [`docs/system/simulation_philosophy.md`](../docs/system/simulation_philosophy.md)

# Weedbreed.AI — Simulation Philosophy Deep Dive

This section details the core design philosophies that underpin each major subsystem of the simulation. It focuses on the "why" behind the mechanics, providing insight into the intended player experience and architectural goals.

## 1. Time & Simulation Loop: Stability and Fairness

- **Philosophy**: The game world must be predictable and fair, progressing at a constant rate regardless of the user's hardware. A simulation's integrity depends on its timekeeping.
- **Implementation Rationale**: It is important to decouple the simulation's "tick rate" from the UI's "frame rate". A tick represents a fixed unit of game time (default 5 minutes), ensuring that a player on a 144Hz monitor experiences the same game progression as a player on a 60Hz monitor. The "catch-up" mechanism, which limits ticks per frame, embodies a user-centric philosophy: **responsiveness is more important than perfect simulation.** The game will never freeze the UI to catch up; it will instead fast-forward gracefully, maintaining a fluid player experience.
- **Example**: In a browser-based tech-stack we probably would use a `requestAnimationFrame` loop with a time accumulator instead of `setInterval`.

## 2. Environmental Model: Emergent Complexity from Simple Rules

- **Philosophy**: A believable and engaging environment should arise from the interaction of simple, understandable rules, rather than a complex, monolithic formula. The goal is emergent complexity.
- **Implementation Rationale**: The delta-based system is the cornerstone of this philosophy. Each object in a zone—a lamp, a plant, the outside air—contributes a small, simple "delta" (a positive or negative change) to the environment each tick. A lamp adds heat; an AC unit removes it. The complex, dynamic behavior of the zone's climate is the _emergent result_ of summing these simple deltas. This makes the system transparent to the player ("My room is hot because I have too many lamps") and highly extensible for developers (adding a new device just requires defining its delta).

## 3. Plant Growth Model: The Core Feedback Loop

- **Philosophy**: The central challenge and reward of the game should be the player's mastery of the cultivation process. The relationship between player action, environmental quality, and plant outcome must be direct, transparent, and meaningful.
- **Implementation Rationale**: The `Stress -> Health -> Growth` cascade is the mechanical expression of this philosophy. It's a clear feedback loop:
  1.  **Input**: The player manages the environment.
  2.  **Problem**: The environment's deviation from the plant's ideal conditions creates `Stress`.
  3.  **State**: `Stress` negatively impacts the plant's `Health`.
  4.  **Output**: `Health` directly multiplies the plant's potential `Growth`.
      This design turns cultivation into an optimization puzzle, not a black box. The player is empowered to diagnose problems (high stress) and see a direct correlation between their solutions and the rewards (better health and yield).

## 4. Personnel & AI: Autonomous Agents and Indirect Control

- **Philosophy**: The player is a manager, not a micromanager. The gameplay should focus on high-level strategic decisions, with the simulation's agents (employees) intelligently handling the low-level execution. This is a game of indirect control.
- **Implementation Rationale**: The Task & AI system embodies this. The `taskEngine` acts like a "manager" that observes the state of the world and creates a "to-do list" (the task queue). The employees are autonomous agents who "pull" tasks from this list based on their role and skills. The player doesn't tell a specific employee to harvest a plant; they ensure they have hired enough skilled gardeners, and the system handles the rest. This shifts the player's focus from tedious clicking to strategic questions like "Is my workforce balanced?" and "Do I have enough breakrooms to keep my staff energized?".

## 5. Economic Model: Constant Pressure and Rewarding Mastery

- **Philosophy**: A compelling tycoon game needs both persistent challenges and strong incentives for skillful play. The economy is designed to create a gentle but constant financial pressure, forcing players to be efficient, while simultaneously offering outsized rewards for true mastery of the game's systems.
- **Implementation Rationale**:
  - **Constant Pressure**: Operating costs (rent, salaries, power) are calculated _per tick_. This constant drain prevents a passive "sit and wait" strategy and forces the player to build an operation that is consistently profitable.
  - **Rewarding Mastery**: The price function for harvested goods is deliberately non-linear. A harvest of average quality might sell for the base price, but a high-quality harvest—achieved only by mastering the environmental and plant health systems—receives an exponential price bonus. This creates a powerful incentive to go beyond "good enough" and strive for perfection.

## 6. Genetics & Breeding: Player-Driven Discovery

- **Philosophy**: The long-term replayability and "end-game" of a simulation often lie in creative expression and player-driven goals. The breeding system is designed to be this creative outlet.
- **Implementation Rationale**: The system of averaging parental traits with a slight, deterministic mutation provides a perfect balance of predictability and discovery. Players can strategically combine parents to aim for a specific outcome (e.g., higher THC), but the random mutation factor means there's always a chance for a surprisingly good (or bad) result. This encourages experimentation and gives the player a powerful tool to create their own "ultimate strain," a goal that is defined and pursued entirely by them. It transforms the player from a consumer of pre-defined strains into a creator of new ones.

## Weedbreed.AI — Job Market Population (docs/system/job_market_population.md)

Source: [`docs/system/job_market_population.md`](../docs/system/job_market_population.md)

# Weedbreed.AI — Job Market Population

This page documents how the simulation keeps the applicant pool fresh while
preserving determinism and offline resilience. It covers the weekly refresh
trigger, remote API contract, RNG seeding, profile synthesis pipeline, fallback
strategy, and operator-facing configuration levers.

---

## Weekly Refresh Lifecycle

- **Commit hook integration.** `JobMarketService.createCommitHook()` is registered
  on the simulation loop’s `commit` phase so the job market refresh runs right
  after a tick is committed.
- **Tick-based cadence.** The service derives the in-game week with
  `Math.floor(tick / 2016)` (2 016 ticks ≈ 1 simulated week at the 5-minute default cadence).
  A refresh is attempted whenever the derived week changes or the applicant pool
  is empty.
- **Idempotence guard.** Within the same week the service short-circuits if the
  computed seed matches the last successful refresh, avoiding double-fetches on
  manual retries.
- **Event emission.** Every successful refresh raises `hr.candidatesRefreshed`
  with `{ week, seed, count, retries, source, policyId?, candidateIds[] }` so
  dashboards and audit tooling can react.

Manual refreshes (`facade.workforce.refreshCandidates`) reuse the same path and
force regeneration when `force` is set. Applicant composition (role mix, skill
rolls, salaries) is data-driven via the
[`data/blueprints/personnel/roles/*.json`](./personnel_roles_blueprint.md) files; the
service hot-loads updated blueprints on demand and falls back to the shipped
defaults when the file is missing.

---

## Remote Provider Contract (randomuser.me)

- **Endpoint:** `https://randomuser.me/api/`
- **Query parameters:**
  - `results=<batchSize>` — number of profiles requested (defaults to 12).
  - `inc=name,gender,login` — request only the fields needed for synthesis.
  - `seed=<apiSeed>` — deterministic seed composed from the game seed and week.
- **Response handling:** the service accepts only array payloads under
  `results`; any malformed body throws and counts toward the retry budget.
- **Retries:** up to `maxRetries` attempts (default 2). Failures fall back to the
  offline generator after the last attempt and log a warning with the seed and
  error details.

The API call is optional—see the feature toggle below—and is skipped entirely if
HTTP support is disabled or `fetch` is unavailable.

---

## Startup Provisioning Service

- **Responsibility.** `provisionPersonnelDirectory()` runs during backend
  startup (before the initial game state is created). It verifies the presence of
  the personnel directory assets and, when files are missing, bootstraps them by
  calling RandomUser with deterministic seeds derived from the simulation seed.
- **Generated files.** When provisioning succeeds the following files are
  written under `/data/personnel/` (existing entries are merged and
  de-duplicated):
  - `names/firstNamesFemale.json`
  - `names/firstNamesMale.json`
  - `names/lastNames.json`
  - `randomSeeds.json`
    Each file is JSON formatted with sorted entries and a trailing newline so the
    repo-friendly form matches runtime output.
- **Deterministic batches.** The provisioner requests batches of 60 profiles by
  default and iterates through 240 total profiles (configurable) using seeds of
  the form `<gameSeed>-<batchIndex>`. This produces stable gendered name sets and
  a reusable pool of `login.salt` values.
- **Failure policy.** Provisioning is skipped entirely when all four files are
  already present. If HTTP integrations are disabled (env var
  `WEEBBREED_DISABLE_JOB_MARKET_HTTP=true`) or no `fetch` implementation is
  available, startup aborts with an error because offline generations would lack
  parity data. RandomUser payloads that do not contain usable first or last
  names also trigger a fatal startup error.
- **Operator workflow.** Production deployments should either bundle the
  provisioned directory with the release artifact or allow outbound HTTPS during
  the first boot so the service can populate the files. Provisioning logs include
  counts of generated male names, female names, last names, and stored seeds.

---

## Deterministic Seeding Strategy

1. **Weekly API seed.** `apiSeed = override ?? "<gameSeed>-<weekIndex>"` keeps
   remote responses stable across runs and allows forced reseeding via command
   overrides.
2. **Profile-specific personal seeds.**
   - Remote profiles reuse `login.salt` when present.
   - Offline/generated profiles synthesize `offline-<week>-<rngString>`.
3. **RNG stream isolation.** Each personal seed is hashed and fed into
   `createSeededStreamGenerator` for the dedicated
   `job-market.candidates` stream, ensuring the attribute rolls for one
   candidate never perturb another stream (e.g., tasks or physics). Gender
   selection uses a separate `job-market.gender` stream so probability tuning
   stays deterministic regardless of name availability.
4. **ID generation.** Applicant IDs come from the stable `job-market` RNG stream
   so list ordering and references stay deterministic between refreshes.

---

## Candidate Synthesis Pipeline

1. **Profile collection.** Fetch remote profiles (or synthesize offline names)
   to produce `{ firstName, lastName, gender?, personalSeed? }` bases.
2. **Normalization.** Names are trimmed and title-cased; missing entries fall
   back to `Candidate<N>` / `Applicant` placeholders.
3. **Personal seed resolution.** Missing seeds are replaced with an offline seed
   tied to the week; all seeds are hashed before RNG usage.
4. **Gender draw.** Seeded RNG selects gender with `P(other) = pDiverse` and
   `P(male) = P(female) = (1 - pDiverse) / 2`, unless the profile forces a
   specific value.
5. **Role selection.** Weighted draw using each blueprint’s `roleWeight`
   (defaults baked into the fallback data mirror the historical 35/20/18/15/12
   distribution). Custom roles inherit the same logic once added to the
   blueprint file.
6. **Skill roll.** Apply the blueprint `skillProfile` for primary/secondary
   skills and the optional tertiary pool using bounded random draws (levels
   clamp between 0–5). Missing rolls inherit the fallback defaults.
7. **Trait roll.** Sample distinct trait IDs from the personnel directory (if
   available) with a 60% chance to assign at least one trait.
8. **Salary computation.** Start from the role blueprint’s `salary.basePerTick`,
   scale by the weighted skill score (`salary.skillWeights`), apply the
   `salary.skillFactor` curve, blend in trait modifiers, sprinkle bounded
   randomness (`salary.randomRange`), and clamp to ≥ 12.
9. **Assembly.** Produce `ApplicantState` records with `id`, `name`,
   `desiredRole`, `expectedSalary`, `skills`, `traits`, and `personalSeed`, plus
   `gender` when known.

---

## Fallback Strategy (Offline Mode)

- **Name directory usage.** When a `PersonnelNameDirectory` is bundled, the
  offline generator draws first names from the combined female/male lists,
  random last names, trait IDs, and pre-stored personal seeds from that
  directory. Gender draws happen independently so probability tuning does not
  depend on which name lists are populated.
- **Synthetic names.** If the directory is missing or empty, the generator
  fabricates deterministic placeholders (`Candidate<week>-<n>`, `Applicant`).
- **Parity with remote flow.** Offline candidates reuse the same RNG streams,
  trait logic, and salary computation so balancing remains identical across
  remote/offline runs.
- **Stored seeds.** The generator consumes `randomSeeds.json` entries before
  synthesising new seeds. This preserves RandomUser-provided `login.salt`
  entropy for offline runs and keeps personal seeds stable between refreshes.
- **Retry reuse.** When a remote call partially succeeds (fewer profiles than
  requested), offline synthesis tops up the batch to maintain the configured
  count.

---

## Configuration & Operations

| Knob             | Default          | Description                                                                                                                           |
| ---------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| `batchSize`      | 12               | Number of candidates requested per refresh (`results` query param).                                                                   |
| `maxRetries`     | 2                | Maximum remote fetch attempts before falling back to offline generation.                                                              |
| `httpEnabled`    | `true`           | Feature toggle; disabled automatically when `fetch` is unavailable or the environment flag below is set.                              |
| `TICKS_PER_WEEK` | 2 016            | Interval between automatic refreshes (commit hook compares `tick / 2016`).                                                            |
| `fetchImpl`      | global `fetch`   | Injectable fetch implementation for tests or alternative transports.                                                                  |
| `dataDirectory`  | resolved at boot | Source for personnel names/traits used during offline fallback.                                                                       |
| `pDiverse`       | 0.1              | Probability that a candidate is assigned the `other` gender; the remaining probability is split evenly between male and female draws. |

**Environment variables**

- `WEEBBREED_DISABLE_JOB_MARKET_HTTP=true` — hard-disables remote calls even if
  `fetch` is present. Useful for fully-offline deployments or deterministic CI.

**Timeouts**

- The service does **not** currently apply an explicit HTTP timeout. Hosting
  environments that require stricter guarantees should wrap the provided
  `fetchImpl` with an `AbortController` or gateway-level timeout.

---

## Monitoring & Observability

- Logs include `{ component: "engine.jobMarket", seed, attempts, source }` on
  refresh and warn on remote failures or fallback directory load issues.
- The refresh summary is emitted to command callers and telemetry consumers,
  enabling UI surfaces and audit scripts to display the source (`remote` vs.
  `local`) and retry count for each population run.

---

## Operational Checklist

1. Ensure the backend has network access to `randomuser.me` **or** ship the
   `/data/personnel` directory with rich name/trait lists.
2. Optionally set `WEEBBREED_DISABLE_JOB_MARKET_HTTP=true` when running in
   air-gapped environments.
3. Monitor `hr.candidatesRefreshed` events and job market logs to confirm weekly
   refreshes are succeeding.
4. Use the façade command `refreshCandidates` with `force=true` or a custom
   `seed` when QA requires deterministic rerolls for a particular week.

## Runtime Event Bus Migration Notes (docs/system/runtime-event-bus-migration.md)

Source: [`docs/system/runtime-event-bus-migration.md`](../docs/system/runtime-event-bus-migration.md)

# Runtime Event Bus Migration Notes

## Overview

The telemetry event bus now lives in `src/runtime/eventBus.ts`. The module exposes a
singleton `eventBus`, a convenience `emit(type, payload?, tick?, level?)` helper, and
observable accessors (`events`, `bufferedEvents`, `events$`). Downstream packages should
consume this runtime module rather than instantiating their own telemetry bus. The
underlying contracts and implementation reside in `src/runtime/eventBusCore.ts`, which is
also re-exported by the backend package for compatibility.

Key behavioural tweaks:

- `EventBus.emit` supports both the original object form and the new signature
  `emit(type, payload?, tick?, level?)`. Timestamps continue to default to `Date.now()`
  when not provided.
- `createEventCollector` exposes a `queue` function with the same signature to ease
  refactors inside tick handlers. Passing an explicit `tick` overrides the collector’s
  default; otherwise the current tick is applied automatically.

## Migration Guidance

1. Replace imports of `../src/lib/eventBus.js` (or equivalent) for runtime telemetry with
   `../../runtime/eventBus.js`. The runtime module re-exports `EventBus`,
   `createEventCollector`, and the relevant types.
2. Update `eventBus.emit({ ... })` calls to use the helper signature where convenient:

   ```ts
   emit('plant.stageChanged', { plantId }, currentTick, 'info');
   ```

3. When queuing events during tick processing, prefer `collector.queue('type', payload,
tick, level)` to benefit from the default tick handling.

### Suggested Codemod

For simple cases, a jscodeshift transform that visits `CallExpression`s on `emit` or
`queue` can convert literal object calls to the new signature. The transform should:

- Turn `bus.emit({ type: 'x', payload, tick, level })` into `bus.emit('x', payload, tick,
level)`.
- Turn `collector.queue({ type: 'x', payload, tick })` into
  `collector.queue('x', payload, tick)`.

Always verify transformed files and ensure custom event structures (e.g., tags) are
handled manually.

## Socket Protocol — Simulation Gateway (docs/system/socket_protocol.md)

Source: [`docs/system/socket_protocol.md`](../docs/system/socket_protocol.md)

# Socket Protocol — Simulation Gateway

The backend exposes a shared UI event stream (`uiStream$`) that aggregates
simulation telemetry and domain events with bounded buffers for downstream UI
adapters. Both the Socket.IO gateway and the server-sent events (SSE) gateway
subscribe to the same observable, ensuring identical payloads regardless of
transport. All payloads are JSON and use SI units unless stated otherwise.

> **Version parity.** The Socket.IO server (`socket.io`) and browser client
> (`socket.io-client`) **must** stay on the same minor version. See ADR 0006 for
> the rationale and upgrade checklist.

## UI Stream (`uiStream$`)

- `createUiStream` (from `runtime/eventBus.ts`) returns an observable of
  `UiStreamPacket` objects. Adapter authors supply:
  - `snapshotProvider`: typically `facade.select((state) =>
buildSimulationSnapshot(state, repository))`.
  - `timeStatusProvider`: usually `() => facade.getTimeStatus()`.
- Default backpressure:
  - Simulation batches: **120 ms** window, max **5** ticks.
  - Domain events: **250 ms** window, max **25** events.
- Events are sanitised to `{ type, payload, tick, ts, level?, tags? }` before
  leaving the runtime.
- Subscribers receive four packet kinds:
  1. `{ channel: 'simulationUpdate', payload: SimulationUpdateMessage }`
  2. `{ channel: 'sim.tickCompleted', payload: UiSimulationTickEvent }`
  3. `{ channel: 'domainEvents', payload: UiDomainEventsMessage }`
  4. `{ channel: <event.type>, payload: event.payload ?? null }`
- The observable is hot (`share({ resetOnRefCountZero: false, … })`). Provide the
  **same** instance to every transport adapter to reuse buffers and ordering.

## Connection & Handshake

1. The client connects to the single Socket.IO namespace (`/`).
2. Immediately after the connection the gateway emits:
   - `gateway.protocol` – `{ version: 1 }` to allow clients to negotiate
     breaking changes.
   - `time.status` – `{ status: TimeStatus }`, mirroring the façade scheduler
     state (running/paused, tick, speed, targetTickRate). This event is sent as
     part of the handshake so dashboards can boot their clock, but ongoing time
     deltas are conveyed inside every `simulationUpdate` payload (see `time`
     below). There is no separate heartbeat event for the scheduler.
   - `simulationUpdate` – a seed payload containing the latest snapshot. The
     structure is identical to the regular update batches documented below and
     always contains exactly one entry.

### Frontend Configuration

- `src/frontend/src/config/socket.ts` centralises the browser endpoint lookup
  and exports a `SOCKET_URL` constant for hooks/components to consume.
- `SOCKET_URL` inspects `import.meta.env.VITE_SOCKET_URL`; create a `.env` file
  next to the frontend package (see `.env.example`) to point the UI at a
  different host/port during development or when the app is served separately
  from the backend.
- When `VITE_SOCKET_URL` is omitted the helper falls back to
  `http://localhost:7331/socket.io`, matching the default backend dev server
  (`WEEBBREED_BACKEND_PORT=7331`).

### Terminal Monitoring CLI

- The repository ships a Node-based CLI under `@weebbreed/monitoring` that
  consumes the same SSE feed as the browser dashboard. Launch it with
  `pnpm monitor` for a hot-reloading development loop or
  `pnpm --filter @weebbreed/monitoring start -- --url <endpoint>` for a static
  run.
- Keyboard controls mirror the legacy RESIN workflow: `Tab`/arrow keys cycle the
  focus between structures → rooms → zones, `↑/↓` move within the active list,
  `r` triggers a reconnect, and `q`/`Ctrl+C` exits.
- The CLI defaults to `http://localhost:7331/events`; pass `--url` to inspect a
  remote backend. The detail pane surfaces zone environment KPIs, setpoints,
  resource levels, and counts so backend developers can verify payloads without
  the React app.

## Outgoing Events

### `simulationUpdate`

Batched snapshot diff and event bundles. Payload:

```json
{
  "updates": [
    {
      "tick": 123,
      "ts": 1725712345678,
      "durationMs": 8.1,
      "phaseTimings": {
        "applyDevices": { "startedAt": 0, "completedAt": 1.1, "durationMs": 1.1 },
        "deriveEnvironment": { "startedAt": 1.1, "completedAt": 2.6, "durationMs": 1.5 },
        "irrigationAndNutrients": { "startedAt": 2.6, "completedAt": 3.7, "durationMs": 1.1 },
        "updatePlants": { "startedAt": 3.7, "completedAt": 5.0, "durationMs": 1.3 },
        "harvestAndInventory": { "startedAt": 5.0, "completedAt": 6.6, "durationMs": 1.6 },
        "accounting": { "startedAt": 6.6, "completedAt": 7.6, "durationMs": 1.0 },
        "commit": { "startedAt": 7.6, "completedAt": 8.1, "durationMs": 0.5 }
      },
      "events": [
        {
          "type": "plant.stageChanged",
          "tick": 123,
          "ts": 1725712345678,
          "payload": { "plantId": "plant-1", "from": "vegetative", "to": "flowering" }
        }
      ],
      "snapshot": {
        "tick": 123,
        "clock": {
          "tick": 123,
          "isPaused": false,
          "targetTickRate": 1,
          "startedAt": "2025-09-23T08:00:00Z",
          "lastUpdatedAt": "2025-09-23T08:05:00Z"
        },
        "structures": [
          {
            "id": "structure-1",
            "name": "Flagship Campus",
            "status": "active",
            "footprint": { "length": 40, "width": 24, "height": 8, "area": 960, "volume": 7680 },
            "rentPerTick": 540,
            "roomIds": ["room-1"]
          }
        ],
        "rooms": [
          {
            "id": "room-1",
            "name": "Bloom Room A",
            "structureId": "structure-1",
            "structureName": "Flagship Campus",
            "purposeId": "purpose-bloom",
            "purposeKind": "bloom",
            "purposeName": "Bloom Suite",
            "purposeFlags": { "allowsFlowering": true },
            "area": 240,
            "height": 4,
            "volume": 960,
            "cleanliness": 0.92,
            "maintenanceLevel": 0.88,
            "zoneIds": ["zone-1"]
          }
        ],
        "zones": [
          {
            "id": "zone-1",
            "name": "North Bloom",
            "structureId": "structure-1",
            "structureName": "Flagship Campus",
            "roomId": "room-1",
            "roomName": "Bloom Room A",
            "area": 240,
            "ceilingHeight": 4,
            "volume": 960,
            "environment": {
              "temperature": 24.1,
              "relativeHumidity": 0.52,
              "co2": 980,
              "ppfd": 540,
              "vpd": 1.28
            },
            "resources": {
              "waterLiters": 180,
              "nutrientSolutionLiters": 45,
              "nutrientStrength": 1.1,
              "substrateHealth": 0.84,
              "reservoirLevel": 0.66,
              "lastTranspirationLiters": 3.2
            },
            "metrics": {
              "averageTemperature": 23.8,
              "averageHumidity": 0.53,
              "averageCo2": 960,
              "averagePpfd": 530,
              "stressLevel": 0.12,
              "lastUpdatedTick": 123
            },
            "devices": [
              {
                "id": "device-1",
                "blueprintId": "hvac-basic",
                "kind": "hvac",
                "name": "HVAC A1",
                "zoneId": "zone-1",
                "status": "operational",
                "efficiency": 0.95,
                "runtimeHours": 320,
                "maintenance": {
                  "lastServiceTick": 90,
                  "nextDueTick": 210,
                  "condition": 0.92,
                  "runtimeHoursAtLastService": 300,
                  "degradation": 0.08
                },
                "settings": { "targetTemperature": 24 }
              }
            ],
            "plants": [
              {
                "id": "plant-1",
                "strainId": "strain-1",
                "strainName": "Aurora Dream",
                "stage": "flowering",
                "health": 0.93,
                "stress": 0.1,
                "biomassDryGrams": 152.4,
                "yieldDryGrams": 45.2
              }
            ],
            "control": {
              "setpoints": {
                "temperature": 24,
                "humidity": 0.52,
                "co2": 1000,
                "ppfd": 520,
                "vpd": 1.2
              }
            },
            "health": {
              "diseases": 0,
              "pests": 0,
              "pendingTreatments": 0,
              "appliedTreatments": 1,
              "reentryRestrictedUntilTick": 1440,
              "preHarvestRestrictedUntilTick": 1500
            }
          }
        ],
        "personnel": {
          "employees": [
            {
              "id": "emp-1",
              "name": "R. Botanist",
              "role": "grower",
              "salaryPerTick": 120,
              "morale": 0.82,
              "energy": 0.76,
              "maxMinutesPerTick": 300,
              "status": "active",
              "assignedStructureId": "structure-1"
            }
          ],
          "applicants": [
            {
              "id": "app-7",
              "name": "J. Apprentice",
              "desiredRole": "technician",
              "expectedSalary": 80
            }
          ],
          "overallMorale": 0.79
        },
        "finance": {
          "cashOnHand": 125000,
          "reservedCash": 5000,
          "totalRevenue": 182000,
          "totalExpenses": 76000,
          "netIncome": 106000,
          "lastTickRevenue": 2400,
          "lastTickExpenses": 860
        }
      },
      "time": {
        "running": true,
        "paused": false,
        "speed": 1,
        "tick": 123,
        "targetTickRate": 1
      }
    }
  ]
}
```

> **Normalization note:** The `structures[].rentPerTick` value in snapshots is an hourly
> base rent despite the legacy field name. Multiply by `tickLengthMinutes / 60` when
> presenting or applying per-tick rent so UI and automation stay aligned with the
> accounting normalization.

- Batching window defaults to **120 ms** (configurable) or a maximum of five
  ticks before the buffer flushes.
- `snapshot` is generated via `buildSimulationSnapshot` and mirrors the
  `SimulationSnapshot` TypeScript contract (structures, rooms, zones, personnel,
  finance). All nested objects are read-only views over the authoritative state;
  clone before mutating.
- `clock` is the persisted simulation clock (`GameState.clock`). The ISO string
  fields (`startedAt`, `lastUpdatedAt`) represent wall-clock timestamps and are
  stable across save/load.
- `time` mirrors `SimulationFacade.getTimeStatus()` and carries
  `{ running, paused, speed, tick, targetTickRate }`. It is computed when the
  packet is produced and may briefly diverge from the persisted clock while a
  control command is settling (e.g. `running: false`, `paused: false` during a
  scheduler restart). `time.tick` always matches the snapshot tick emitted in
  the same entry.
- The `events` array repeats the domain events emitted during the tick for
  convenience and matches the structure forwarded via `domainEvents`.
- `ts` represents the emission timestamp. If the originating simulation event
  lacks a timestamp the gateway falls back to `Date.now()` when the packet is
  assembled.
- `durationMs` and `phaseTimings` surface tick duration metrics when the loop
  supplies them. Manual `step` calls that short-circuit instrumentation omit
  these fields.

### `sim.tickCompleted`

A raw forwarding of the façade event. Each entry contains:

```json
{
  "tick": 123,
  "ts": 1725712345678,
  "durationMs": 8.1,
  "eventCount": 4,
  "phaseTimings": {
    /* same as above */
  },
  "events": [
    /* domain events for that tick */
  ]
}
```

The gateway always emits this message after the corresponding `simulationUpdate`
flush to keep telemetry ordering deterministic.

### `domainEvents`

Bundled domain-level notifications (plant/device/zone/market/finance/health,
including pests/diseases). Payload:

```json
{
  "events": [
    {
      "type": "plant.stageChanged",
      "tick": 123,
      "ts": 1725712345678,
      "payload": { "plantId": "plant-1", "from": "vegetative", "to": "flowering" }
    },
    {
      "type": "device.degraded",
      "tick": 123,
      "ts": 1725712345685,
      "level": "warning",
      "payload": { "deviceId": "lamp-1", "severity": "warning" }
    }
  ]
}
```

- Default throttling window: **250 ms** with a maximum batch size of 25 events.
- Every individual event is also re-emitted using the event’s `type` as the
  Socket.IO channel for legacy listeners (e.g. `plant.stageChanged`).

## Server-Sent Events (`/events`)

- Default endpoint: `/events` (configurable via `SseGatewayOptions.path`).
- Methods: `GET` for the live stream, `OPTIONS` for CORS preflight. Responses
  include `Access-Control-Allow-Origin: *` and disable proxy buffering.
- Handshake events are identical to the socket gateway (`gateway.protocol`,
  `time.status`, and an initial `simulationUpdate`).
- Keep-alive comments (`: keep-alive`) are emitted every **15 s** by default.
- Each packet from `uiStream$` is forwarded as an SSE event (`event: <channel>`
  - `data: <json>`). Individual domain events keep their original event names.
- Shut down via `SseGateway.close()` to unsubscribe all clients and stop the
  keep-alive timer.

## Incoming Commands

### Common Envelope

Every command payload may include an optional `requestId` string. When present it
is mirrored in the corresponding `*.result` response message and in the
acknowledgement callback. All command responses follow the façade’s
`CommandResult<T>` contract and are echoed back over Socket.IO so UIs without ACK
handlers can still observe outcomes.

Generic response structure:

```json
{
  "requestId": "cmd-1",
  "ok": false,
  "warnings": ["Speed multiplier unchanged."],
  "errors": [
    { "code": "ERR_VALIDATION", "message": "ticks must be greater than zero.", "path": ["ticks"] }
  ]
}
```

### `facade.intent` — Domain Command Envelope

Unified entry point for all simulation-side mutations beyond scheduler control.
Payloads contain the target domain and action name plus an optional payload
object:

```json
{
  "domain": "world",
  "action": "duplicateRoom",
  "payload": { "roomId": "room_8d92e4", "name": "North Bloom Copy" },
  "requestId": "intent-42"
}
```

- `domain` must match one of the façade-registered intent domains. Current
  values: `world`, `devices`, `plants`, `health`, `workforce`, `finance`.
- `action` selects a command within that domain. Actions are validated against
  the domain catalog that `SimulationFacade` builds during startup.
- `payload` is validated with the command’s Zod schema before any engine service
  executes. The socket gateway strips helper metadata, runs the command
  preprocess hook (when present), and responds with the same normalized
  `ERR_VALIDATION` payload the façade would emit. Validation failures do **not**
  invoke command handlers or mutate simulation state. Missing payloads default
  to `{}` when a schema allows it.
- Responses are emitted on `<domain>.intent.result` and include the merged
  `CommandResult` (`{ ok, data?, warnings?, errors? }`). Unknown domains/actions
  yield `ERR_VALIDATION` with the offending field path (`['facade.intent',
'domain']` or `['facade.intent', 'action']`). Internal failures surface as
  `ERR_INTERNAL` while preserving the request id.

#### Supported actions per domain

- **time** — `start`, `pause`, `resume`, `step`, `setSpeed`. Each call mirrors
  the in-process scheduler API and resolves with the updated `TimeStatus`.
- **world** — `getStructureBlueprints`, `getStrainBlueprints`,
  `getDeviceBlueprints`, `rentStructure`, `createRoom`, `updateRoom`,
  `deleteRoom`, `createZone`, `updateZone`, `deleteZone`, `renameStructure`,
  `deleteStructure`, `duplicateStructure`, `duplicateRoom`, `duplicateZone`,
  `resetSession`, `newGame`. Duplication commands accept an optional `name`
  override and return `{ structureId | roomId | zoneId }` for the newly
  created copy.
- **devices** — `installDevice`, `updateDevice`, `moveDevice`, `removeDevice`,
  `toggleDeviceGroup`. The toggle action returns `{ deviceIds: string[] }` with
  every instance that changed status.
  - `installDevice` and `updateDevice` validate settings against the device blueprint contract: only
    numeric control keys (`power`, `ppfd`, `coverageArea`, airflow/cooling controls, hysteresis/pulse
    knobs, humidity/CO₂/temperature setpoints) are accepted. Range fields (`spectralRange`,
    `targetTemperatureRange`, `targetCO2Range`) must be `[min, max]` tuples. Partial patches must supply
    at least one defined value; unknown keys are rejected before a service handler runs.
- **plants** — `addPlanting`, `cullPlanting`, `harvestPlanting`, `harvestPlant`,
  `cullPlant`, `applyIrrigation`, `applyFertilizer`, `togglePlantingPlan`. The
  automation toggle responds with `{ enabled: boolean }` and emits a follow-up
  maintenance task when the state flips. `harvestPlant` returns `{ plantId,
harvestBatchId, weightGrams, quality }` alongside optional warnings, and
  `cullPlant` yields `{ plantId, stage }` with matching warning propagation.
- **health** — `scheduleScouting`, `applyTreatment`, `quarantineZone`.
- **workforce** — `refreshCandidates`, `hire`, `fire`, `setOvertimePolicy`,
  `assignStructure`, `enqueueTask` (payload defaults to `{}` when omitted).
- **finance** — `sellInventory`, `setUtilityPrices`, `setMaintenancePolicy`.
- **config** — `getDifficultyConfig` (payload defaults to `{}`).

##### Blueprint catalog commands

- `getStructureBlueprints` returns the raw `StructureBlueprint[]` catalog
  (geometry, rent, upfront fee). Payload defaults to `{}`.
- `getStrainBlueprints` returns an alphabetised strain catalog with compatibility
  and defaults. Example entry:

```json
{
  "id": "00000000-0000-0000-0000-000000000401",
  "slug": "helios",
  "name": "Helios",
  "lineage": { "parents": [] },
  "genotype": { "sativa": 0.6, "indica": 0.4, "ruderalis": 0 },
  "chemotype": { "thcContent": 0.22, "cbdContent": 0.01 },
  "generalResilience": 0.8,
  "germinationRate": 0.95,
  "compatibility": {
    "methodAffinity": { "85cc0916-0e8a-495e-af8f-50291abe6855": 0.85 },
    "stressTolerance": { "temp_C": 1, "vpd_kPa": 0.15 }
  },
  "defaults": {
    "envBands": { "default": { "temp_C": { "green": [23, 27] } } },
    "phaseDurations": { "vegDays": 21, "flowerDays": 63 },
    "photoperiod": { "vegetationTime": 2419200, "floweringTime": 5443200 },
    "nutrientDemand": { "dailyNutrientDemand": { "flowering": { "nitrogen": 0.07 } } },
    "waterDemand": { "dailyWaterUsagePerSquareMeter": { "flowering": 0.54 } },
    "growthModel": { "maxBiomassDry": 0.18 },
    "yieldModel": { "baseGmPerPlant": 45 }
  },
  "traits": {
    "morphology": { "growthRate": 1, "yieldFactor": 1 },
    "noise": { "enabled": true, "pct": 0.02 }
  },
  "metadata": { "description": "Hybrid strain tuned for balanced growth." },
  "price": { "seedPrice": 1.1, "harvestPricePerGram": 4.4 }
}
```

- `getDeviceBlueprints` returns device catalog entries with compatibility and
  default settings:

```json
{
  "id": "00000000-0000-0000-0000-000000000501",
  "kind": "Lamp",
  "name": "Orion Lamp",
  "quality": 0.95,
  "complexity": 0.5,
  "lifetimeHours": 72000,
  "capexEur": 1350,
  "efficiencyDegeneration": 0.01,
  "compatibility": { "roomPurposes": ["growroom"] },
  "defaults": {
    "settings": { "power": 0.68, "ppfd": 810, "coverageArea": 8 },
    "coverage": { "maxArea_m2": 12 },
    "limits": { "maxPPFD": 1000 }
  },
  "maintenance": { "intervalDays": 90, "costPerService_eur": 80, "hoursPerService": 2 },
  "metadata": { "description": "Balanced flowering lamp" },
  "price": {
    "capitalExpenditure": 1350,
    "baseMaintenanceCostPerTick": 0.0023,
    "costIncreasePer1000Ticks": 0.0005
  }
}
```

Each response is regenerated from the active blueprint repository on demand to
avoid stale caches.

Clients may optimistically update UI state after receiving a successful
`*.intent.result` packet but must still observe follow-up telemetry for the
authoritative snapshot.

### `simulationControl`

Discriminated union on `action`:

| Action        | Payload fields                    | Delegated façade call              |
| ------------- | --------------------------------- | ---------------------------------- |
| `play`        | `gameSpeed?`, `maxTicksPerFrame?` | `start()` (or `resume` if running) |
| `pause`       | –                                 | `pause()`                          |
| `resume`      | –                                 | `resume()`                         |
| `step`        | `ticks?`                          | `step()`                           |
| `fastForward` | `multiplier`                      | `setSpeed()`                       |

Clients emit the raw discriminant payload without an additional `type`
wrapper, e.g. `socket.emit('simulationControl', { action: 'pause' })`. The
gateway performs the discriminant check based on the `action` field alone.

All payloads are validated with Zod before the façade command is executed. If
validation fails the façade is not touched and the client receives an
`ERR_VALIDATION` response immediately.

Successful control commands return the updated `TimeStatus` in
`simulationControl.result.data` (mirroring the `time` block in telemetry) and may
trigger a new `simulationUpdate` batch if a tick is processed as part of the
operation.

### `config.update`

Currently supported targets:
| Type | Payload fields | Behaviour |
| ------------ | --------------------------- | ------------------------------------------------------------------------------------------- |
| `tickLength` | `minutes` (> 0) | Reconfigures the scheduler (restarts if required) and emits a `sim.tickLengthChanged` event. |
| `setpoint` | `zoneId`, `metric`, `value` | Routes a zone setpoint to device settings. Use the `zones[].id` string from telemetry (UUID v4 or legacy slug); see the metric table below. |

Supported setpoint metrics:

| Metric             | Device routing & behaviour                                                                                                                                                                                                                                                                                                        |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `temperature`      | Requires at least one HVAC device in the zone. Clamps inputs to the `[10, 35]` °C band, writes the clamped value to `targetTemperature` on each device, and stores it on the zone control state.                                                                                                                                  |
| `relativeHumidity` | Requires humidifier/dehumidifier coverage (device kinds: `HumidityControlUnit`, `Dehumidifier`). Clamps the value to `[0,1]`, updates `targetHumidity` on each device, clears any active VPD target, and stores the humidity setpoint.                                                                                            |
| `vpd`              | Requires humidity control. Clamps the VPD to the `[0, 2.5]` kPa range, converts it to a humidity target using the zone control reference temperature, applies the derived `targetHumidity` to devices, and stores both humidity and VPD setpoints. The derived humidity is echoed in the command response as `effectiveHumidity`. |
| `co2`              | Requires CO₂ enrichment/scrubber devices. Clamps the value to the `[0, 1800]` ppm range, writes the clamped value to `targetCO2` on devices, and stores the CO₂ setpoint.                                                                                                                                                         |
| `ppfd`             | Requires dimmable lighting. Clamps the value to the `[0, 1500]` µmol·m⁻²·s⁻¹ band, updates each light’s `ppfd` setting, and if the device exposes a finite `power` setting scales it proportionally to the new PPFD (power is forced to zero when the target PPFD is zero).                                                       |

Additional notes:

- `zoneId` must match the zone identifier emitted in snapshots. The gateway trims whitespace and accepts any non-empty string, so UUID v4 identifiers work without prefixes.
- All values must be finite. Clamps trigger warning strings in the
  `config.update.result` payload so the UI can surface them alongside the
  successful response.
- When a zone lacks the required devices the command returns
  `ERR_INVALID_STATE`.
- Successful updates emit an `env.setpointUpdated` domain event containing the
  updated `control` snapshot (including derived humidity when applicable).

Additional configuration mutations can be layered onto the same endpoint in the
future without breaking existing clients.

## Error Handling

- Validation errors (`ERR_VALIDATION`) map 1:1 to the offending field path.
- Internal failures (`ERR_INTERNAL`) surface the error message and the command
  path. The gateway never throws – failures are returned via the Socket.IO ACK
  callback and the mirrored `*.result` event.
- Every error entry carries a `category` field: `'user'` for caller mistakes or
  rejected states, `'internal'` for fatal/back-end issues (`ERR_INTERNAL`,
  `ERR_DATA_RELOAD_PENDING`). Clients can use this to drive UI messaging and
  retry logic.
- The gateway tracks consecutive internal failures per socket. After three
  responses carrying `'internal'` errors it schedules a short disconnect so
  clients back off before retrying.
- Unsupported commands yield `ERR_INVALID_STATE`.

## Batching Guarantees

- Simulation updates are emitted in tick order. No batch spans ticks out of
  order and the gateway never drops ticks – throttling only coalesces them.
- Domain events preserve emission order inside each batch.
- Closing the gateway (`SocketGateway.close()`) flushes pending timers and
  detaches all façade subscriptions.

## Versioning

The protocol version is incremented when payload structures change in a
non-backwards-compatible way. Clients should subscribe to `gateway.protocol` and
fail fast if an unknown version is announced.

## Weedbreed.AI — System Facade (docs/system/facade.md)

Source: [`docs/system/facade.md`](../docs/system/facade.md)

# Weedbreed.AI — System Facade

_A tech‑agnostic, simulation‑first façade that cleanly decouples UI and engine, aligned with the latest DD/TDD (UUID `id`, lineage parents as UUIDs, device purpose binding, phase‑based NPK, currency‑neutral costs, treatments with tick fields, agentic employees, hot‑reload, determinism)._

---

## 1) Purpose & Responsibilities

**Goal.** Provide a **stable, high‑level API** between any client (UI, tests, CLI, worker) and the simulation engine. The façade exposes **intents** and **queries**, never internal object graphs.

**Responsibilities**

- Own the **authoritative state** handle and expose **read‑only snapshots**.
- Accept **commands** (player/AI intents), route to engine services, enforce **invariants**.
- Coordinate the **tick loop** (start/stop/speed/catch‑up) or proxy to an external scheduler.
- Emit **events** with minimal, serializable payloads.
- Handle **persistence** (save/load/export/import) and **hot‑reload** of data.

**Non‑Responsibilities**

- No rendering or UI logic.
- No direct mutation of deep objects by callers (strictly through intents).

---

## 2) Contract & Guarantees

- **Decoupling:** UI never traverses engine internals. All side‑effects go through façade commands.
- **Determinism:** With identical inputs (state, blueprints, tick schedule, seed), results are identical. All RNG uses named streams.
- **Atomicity:** Each tick commits atomically; events correspond to committed state only.
- **Identity:** All references use **`id` (UUID v4)**; no `uuid` field exists.
- **Validation:** Commands and hot‑reloads are validated against the **Data Dictionary** before effect.

---

## 3) Data Surfaces

### 3.1 Read API (snapshots & queries)

- `getState(): Readonly<GameState>` — immutable snapshot, serializable.
- `select(query): Result` — filtered/projection queries (e.g., by `id`, by room purpose, by active tasks, by alarms).
- `subscribe(eventFilter, handler): Unsubscribe` — event stream (see §6).

### 3.2 Write API (intents/commands)

Commands are **idempotent per tick** where reasonably possible and validate against DD constraints. The façade builds domain
registries (`world`, `devices`, `plants`, `health`, `workforce`, `finance`) and exposes them through both the in-process API
(`facade.world.createRoom(payload)`) and the Socket.IO envelope (`facade.intent`). Each registration binds a Zod schema to a
service handler and emits results on `<domain>.intent.result`.

Common categories are below.

---

## 4) Command Surface (categories)

> See [`docs/intents.md`](../intents.md) for the authoritative, per-domain command matrix.

### 4.1 Time & Simulation Control

- `start({ gameSpeed?, maxTicksPerFrame? })`
- `pause()` / `resume()`
- `step(nTicks = 1)` — advance deterministically by n ticks.
- `setSpeed(multiplier: number)`

### 4.2 Session Lifecycle & Blueprints

- `newGame({ difficulty?, seed?, modifiers? })` — bootstraps a fresh state with optional tweaks.
- `resetSession()` — wipes the current run while retaining rented structures for quick restarts.
- `getStructureBlueprints()` / `getStrainBlueprints()` /
  `getDeviceBlueprints()` — read-only catalogs with IDs, names,
  compatibility hints (room purposes or method affinity), default settings, and
  price hints sourced from the active blueprint repository.

### 4.3 World Building (Structures → Rooms → Zones)

- `rentStructure(structureId: UUID)` — validates availability; applies CapEx/Fixed cost rules.
- `renameStructure({ structureId, name })` — trims whitespace, preserves determinism, emits rename events.
- `deleteStructure(structureId)` — enforces empty structure + accounting clean-up.
- `createRoom(structureId, { name, purpose, area, height? })`
- `updateRoom(roomId, patch)` / `deleteRoom(roomId)`
- `duplicateRoom({ roomId, name? })` — clones geometry, zones, and device loadout; returns `{ roomId }` for the copy.
- `createZone(roomId, { name, area, methodId, targetPlantCount? })`
- `updateZone(zoneId, patch)` / `deleteZone(zoneId)`
- `duplicateZone({ zoneId, name? })` — copies cultivation method, automation, and device placement (subject to allowed purposes).
- `duplicateStructure({ structureId, name? })` — creates a structure-level clone including rooms/zones; returns `{ structureId }`.
- `resetSession()` and `newGame()` are also exposed under the world domain; see §4.2 for lifecycle semantics.
- Guards: geometry, purpose bindings, and blueprint availability validated for every mutation.

### 4.4 Devices

- `installDevice(targetId, deviceId, settings?)` — checks **`allowedRoomPurposes`**, clones blueprint defaults,
  clamps coverage/airflow via zone geometry, and emits `device.installed` telemetry with the created instance ID.
- `updateDevice(instanceId, settingsPatch)`
- `moveDevice(instanceId, targetZoneId)` — re‑validate purpose.
- `removeDevice(instanceId)`
- `toggleDeviceGroup({ zoneId, kind, enabled })` — flips operational status in bulk and returns `{ deviceIds }` of affected units.

  Device commands only accept the canonical control keys from the active blueprint catalog. All settings must be finite numbers unless noted:
  - Scalar controls: `power`, `ppfd`, `coverageArea`, `heatFraction`, `airflow`, `coolingCapacity`, `cop`,
    `hysteresisK`, `fullPowerAtDeltaK`, `moistureRemoval`, `hysteresis`, `pulsePpmPerTick`,
    `latentRemovalKgPerTick`, `humidifyRateKgPerTick`, `dehumidifyRateKgPerTick`.
  - Setpoints: `targetTemperature`, `targetHumidity` (0–1), `targetCO2`.
  - Ranges: `spectralRange`, `targetTemperatureRange`, `targetCO2Range` must be two-number tuples `[min, max]`.
  - Patches must define at least one concrete value; undefined entries are ignored, and unknown keys are rejected with validation errors.

### 4.5 Plants & Plantings

- `addPlanting(zoneId, { strainId, count, startTick? })` — enforces cultivation method capacity, strain/method
  compatibility hints, and emits `plant.planted` telemetry including all generated plant IDs.
- `cullPlanting(plantingId, count?)`
- `harvestPlanting(plantingId)` — creates inventory lots, emits events.
- `harvestPlant(plantId)` — removes a single plant, honoring zone safety
  restrictions and returning `{ harvestBatchId, weightGrams, quality }` plus
  optional warnings.
- `cullPlant(plantId)` — discards a plant while respecting re-entry and
  pre-harvest locks, returning `{ plantId, stage }` with warning propagation.
- `applyIrrigation(zoneId, liters)` / `applyFertilizer(zoneId, { N,P,K } in g)` — optional manual overrides.
- `togglePlantingPlan({ zoneId, enabled })` — activates/deactivates automation; returns `{ enabled }` plus a follow-up task event.

### 4.6 Health (Pests/Diseases & Treatments)

- `scheduleScouting(zoneId)` — generates scouting tasks.
- `applyTreatment(zoneId, treatmentOptionId)` — enforces **`reentryIntervalTicks`**, **`preHarvestIntervalTicks`**, cooldowns, and certifications.
- `quarantineZone(zoneId, enabled)` — affects spread graph & safety constraints.

### 4.7 Personnel & Tasks

- See [Job Market Population](./job_market_population.md) for deterministic
  refresh cadence, external provider usage, and fallback rules.

- `refreshCandidates()` — seeded refresh per policy; uses external name provider iff enabled, fallback to local lists.
- `hire(candidateId, role, wage?)` / `fire(employeeId)`
- `setOvertimePolicy({ policy: "payout"|"timeOff", multiplier? })`
- `assignStructure(employeeId, structureId?)`
- `enqueueTask(taskKind, payload)` — manual job board additions.

### 4.8 Finance & Market

- `sellInventory(lotId, quantity_g)` — revenue = `harvestBasePricePerGram × modifiers`.
- `setUtilityPrices({ electricityCostPerKWh, waterCostPerM3, nutrientsCostPerKg })`
- `setMaintenancePolicy(patch)`

**All commands** return `{ ok: boolean, warnings?: string[], errors?: { code: string, message: string, path?: string[], category: 'user' | 'internal' }[] }` and emit events on success.

---

## 5) Error Handling & Validation

- **Schema validation** for every payload (types, ranges).
- **Cross‑ref checks** by UUID `id` (strain/device/method/structure/room/zone).
- **Safety gates**: device placement rules, treatment re‑entry/PHI, quarantine access, task tool requirements.
- **Determinism guard**: disallow commands that would change RNG order within a committed tick; schedule for next tick if needed.

**Standard errors**

- `ERR_NOT_FOUND`, `ERR_FORBIDDEN`, `ERR_CONFLICT`, `ERR_INVALID_STATE`, `ERR_VALIDATION`, `ERR_RATE_LIMIT`, `ERR_DATA_RELOAD_PENDING` (tagged as `internal`), `ERR_INTERNAL`.

---

## 6) Events (taxonomy)

**Simulation**

- `sim.tickCompleted`, `sim.speedChanged`, `sim.paused`, `sim.resumed`, `sim.hotReloaded`, `sim.reloadFailed`.

**World**

- `world.structureRented`, `world.roomCreated`, `world.zoneCreated`, `world.deviceInstalled`, `world.deviceMoved`, `world.deviceRemoved`.

**Plants**

- `plant.stageChanged`, `plant.harvested`, `plant.qualityUpdated`.

**Environment**

- `env.safetyExceeded`, `env.setpointReached`, `env.setpointLost`.

**Health**

- `pest.detected`, `disease.confirmed`, `health.spread`, `treatment.applied`, `treatment.blocked`.

**Tasks & HR**

- `task.created`, `task.claimed`, `task.completed`, `task.failed`, `task.abandoned`.
- `hr.candidatesRefreshed`, `hr.hired`, `hr.fired`, `hr.overtimeAccrued`, `hr.overtimePaid`, `hr.timeOffScheduled`.

**Finance**

- `finance.capex`, `finance.opex`, `finance.saleCompleted`, `finance.tick`.

_All event payloads are minimal, serializable, and reference entities by UUID `id`._

---

## 7) Concurrency Models

- **Same‑thread:** façade calls engine methods directly; use micro‑task queue for event delivery.
- **Worker/Process:** façade marshals commands/events over a message bus. Contract remains identical (opaque transport). Back‑pressure by command queue with ordering guarantees.

---

## 8) Tick Orchestration (conformance to Simulation Deep Dive)

Default phase order per tick:

1. **Device Control** (evaluate setpoints & hysteresis)
2. **Apply Device Deltas** (T/RH/CO₂/PPFD)
3. **Normalize to Ambient** (mixing, airflow)
4. **Irrigation/Nutrients** (NPK g/m²/day → per‑tick, per‑plant)
5. **Plants** (growth, stress, health update)
6. **Health** (detect, progress, spread, treat; enforce re‑entry & PHI)
7. **Tasks & Agents** (generate, claim, execute; overtime policy)
8. **Inventory/Market**
9. **Finance**
10. **Commit & Emit**

Façade controls `start/pause/step/setSpeed` and publishes `sim.tickCompleted` after commit.

---

## 9) Identity & Referencing

- Only **`id` (UUID v4)** is authoritative.
- `name`/`slug` are optional, human‑friendly, never used for joins.
- Strain `lineage.parents` is an array of parent UUIDs; empty/missing ⇒ ur‑plant.

---

## 10) Security & Safety

- **Read isolation:** snapshots are immutable; no shared mutability leaks.
- **Write guards:** commands check purpose binding, quarantines, re‑entry, certifications, inventory locks.
- **Budget fences:** per‑phase time budgets; commands may be deferred to preserve frame budgets.

---

## 11) Testing & Observability

- **Mockable façade**: swap engine with a stub; same contract.
- **Golden tests**: fixed seed + fixed inputs → identical event sequences & snapshots.
- **Metrics**: tick duration, queue depths, task throughput, overtime accrued/paid, environment violations.
- **Tracing**: correlate commands → events → state deltas.

---

## 12) Example API Shape (pseudo‑types)

```ts
// Read
getState(): Readonly<GameState>
select(q: Query): Result
subscribe(filter: EventFilter, handler: (e: Event) => void): Unsubscribe

// Time
start(opts?: { gameSpeed?: number; maxTicksPerFrame?: number }): Ack
pause(): Ack
resume(): Ack
step(nTicks?: number): Ack
setSpeed(multiplier: number): Ack

// Data lifecycle
loadBlueprints(bundleOrPaths: BlueprintInput): ValidationReport
hotReload(bundleOrPaths: BlueprintInput): ValidationReport
newGame(opts: NewGameOptions): Ack
save(): Snapshot
load(snap: Snapshot): Ack

// World
rentStructure(structureId: UUID): Ack
createRoom(structureId: UUID, room: { name: string; purpose: string; area_m2: number; height_m?: number }): Ack
createZone(roomId: UUID, zone: { name: string; area_m2: number; methodId: UUID }): Ack
installDevice(targetId: UUID, deviceId: UUID, settings?: object): Ack

// Plants & health
addPlanting(zoneId: UUID, p: { strainId: UUID; count: number; startTick?: number }): Ack
applyTreatment(zoneId: UUID, optionId: UUID): Ack
quarantineZone(zoneId: UUID, enabled: boolean): Ack

// HR & tasks
refreshCandidates(): Ack
hire(candidateId: UUID, role: string, wage?: number): Ack
setOvertimePolicy(p: { policy: 'payout'|'timeOff'; multiplier?: number }): Ack
enqueueTask(kind: string, payload: object): Ack

// Finance
sellInventory(lotId: UUID, grams: number): Ack
setUtilityPrices(p: { electricityCostPerKWh?: number; waterCostPerM3?: number; nutrientsCostPerKg?: number }): Ack
```

Return type `Ack` = `{ ok: boolean; warnings?: string[]; errors?: string[] }`.  
All `Event` payloads include minimal fields and entity UUIDs.

---

## 13) Anti‑Patterns (explicitly disallowed)

- UI accessing deep state paths and mutating objects directly.
- Commands that leak internal references (must pass UUIDs).
- Blocking the tick loop for long operations (I/O must be async/queued).
- Event payloads containing heavy object graphs; pass UUIDs and query on demand.

---

## 14) Migration & Hot‑Reload Notes

- During hot‑reload, façade queues commands until the new data set is staged and validated, then swaps atomically and emits `sim.hotReloaded`.
- If validation fails, keep last good set; emit `sim.reloadFailed` with diagnostics.

---

## 15) Extensibility

- Additional services (research, contracts, dynamic market, predictive control) plug into the same façade via new intents and events without breaking existing ones.

---

**Summary.** The façade is the system’s "dashboard": it provides stable, intention‑centric controls, upholds invariants, and makes the engine safely composable and testable—no matter which client consumes it.

## Weedbreed.AI — Employee System (docs/system/employees.md)

Source: [`docs/system/employees.md`](../docs/system/employees.md)

# Weedbreed.AI — Employee System

## Overview

Employees are the heart of automation in Weedbreed.AI. They are **autonomous agents** that pick, claim, and complete work based on their **skills**, **role**, and **current state** (energy, morale). Instead of the player micromanaging every step, the simulation **generates tasks** (“Harvest plants in Zone A”, “Repair device in Zone B”), and employees choose the **highest-priority suitable task** to execute. This reduces player burden and naturally scales with company growth.

---

## 1) Candidate Generation & External Name Provider

See [Job Market Population](./job_market_population.md) for the full refresh
pipeline, remote API contract, and configuration knobs. That reference also
covers the startup provisioning service that keeps the offline personnel
directory populated.

To keep the labor market dynamic and credible, the game continuously injects new, unique candidates. Rather than relying only on a fixed local name list, the game **optionally** queries a **seedable external name provider** (e.g., an API that returns first/last names) and falls back to local data if unavailable. An free and open provider is https://randomuser.me/. For detailed information about the API, check the providers documentation.

- **Periodic refresh**
  Once per in-game week (e.g., every **2 016 ticks** with the 5-minute default cadence), refresh the candidate pool.
- **Deterministic, efficient fetch**  
   Use an endpoint that accepts `results` (e.g., 12), `inc=name` (only first/last names), and a deterministic `seed`.
  - **Seed construction**: derive `apiSeed` from the game’s original seed + current in-game week index, e.g.  
     `apiSeed = "{gameSeed}-week-{weekIndex}"`  
     This guarantees **reproducible candidates** for identical runs.
- **Privacy-aware payload**  
   Request **first/last names, age, gender and password only**; no other personal data. The age should range between `[18;65]`. For employee the age should play am altering role for random skill creation.
  A random password will be mapped as "personal" RNG seed. For the ease of use request the password with `password=number,8` as additional parameter from API. The attribute in our Employee-Object is called `personalSeed`, not `password`.
- **Startup provisioning**
  During backend boot the simulation runs `provisionPersonnelDirectory()`.
  Missing `/data/personnel/` files trigger deterministic RandomUser pulls that
  populate gendered first-name lists, the shared last-name list, and
  `randomSeeds.json`. When the files already exist the provisioner exits without
  modifying them.
- **Offline-safe fallback**
  If the external provider is unreachable or disabled, **fallback** to the
  provisioned `/data/personnel/` lists (female first names, male first names,
  last names, traits, and stored seeds) to synthesize names.
- **Resilience & retries**
  The job market service performs up to two attempts per refresh against the remote provider. When the HTTP call fails or is disabled it switches to the local generator, reusing the same deterministic `personalSeed` logic so rerolls remain reproducible.
- **Profile synthesis**
  After names are obtained, the game **generates full candidate profiles**:
  randomized **skills**, **traits**, and a **wage** consistent with the generated
  profile and company difficulty/balancing rules. Offline runs consume the stored
  personal seeds before minting new ones so manual refreshes reproduce the same
  roster when replayed with the same seed.

---

## 2) Work as Discrete Tasks

Work is modeled as **discrete Tasks** rather than continuous processes.

- **Task generation**  
   Each tick, the **task engine** scans the world and generates a list of required tasks.  
   Examples: a broken device creates a `repair_device` task; harvest-ready plants create `harvest_plants`; sanitation needs create `clean_zone`; etc.  
   Base properties (priority, required skill/role, default labor) come from `/data/configs/task_definitions.json`.
- **Duration & scaling**  
   Each task has `durationTicks`. It can **scale** depending on its **cost basis**:
  - `perAction` — fixed duration (e.g., repair a device)
  - `perPlant` — duration × number of plants affected (e.g., harvest)
  - `perSquareMeter` — duration × area (e.g., clean a zone)
- **Progress & completion**  
   When an employee claims a task, their status becomes **Working**. Each tick spent on the task increases `progressTicks` by 1. When `progressTicks >= durationTicks`, the task completes and its **effects** are applied to the game state (device repaired, harvest added to inventory, cleanliness improved, etc.).

---

## 3) Overtime (Energy-Linked)

Overtime is directly tied to **employee energy**.

- **Trigger**
  Employees have **energy** in the range `0..100`. Each tick (≈5 minutes at default cadence) of work consumes energy.
  An employee **always finishes the current task**, even if their energy dips **below 0** during execution. Any negative energy at completion counts as **overtime**.
- **Computation**  
   At task completion, convert the **magnitude of negative energy** into **overtime hours** (ticks). Energy is then clamped/reset according to rest policy.
- **Compensation policy (player-defined)**  
   Company policy `overtimePolicy` determines how overtime is compensated:
  - **`payout`** — pay overtime immediately at **1.5× hourly wage** (or a configurable multiplier). This costs cash now but keeps availability high (after the standard rest).
  - **`timeOff`** — credit overtime hours to the employee’s **`leaveHours`** balance. In their next **OffDuty** period, they take this extra time off. This saves immediate cash but reduces near-term availability.

---

# DD Additions

## Personnel (new or clarified fields)

- `id: string (UUID v4)` — primary key.
- `name: string` — display name (full name).
- `role: string` — e.g., `Gardener`, `Technician`, `IPMSpecialist`.
- `skills: { [skillName: string]: number }` — skill levels `0..n`.
- `traits: string[]` — e.g., `Meticulous`, `Slacker` (modulate utility/learning).
- `hourlyWage: number` — currency-neutral cost per hour.
- `energy: number` — `0..100`.
- `morale: number` — `0..100`.
- `status: "Idle" | "Working" | "Resting" | "OffDuty"`.
- `leaveHours: number` — accrued time-off hours (from overtime when `overtimePolicy = "timeOff"`).
- `certifications?: string[]` — e.g., pesticide handling.
- `assignedStructureId?: string (UUID)` — optional current workplace scope.

## Hiring / Candidate Source

- `hiring.candidateRefreshIntervalTicks: number` — e.g., `2016` at the 5-minute default cadence.
- `hiring.externalNameProvider.enabled: boolean` — on/off.
- `hiring.externalNameProvider.results: number` — e.g., `12`.
- `hiring.externalNameProvider.includeFields: string[]` — e.g., `["name"]`.
- `hiring.externalNameProvider.apiSeedFormat: string` — e.g., `"{gameSeed}-week-{weekIndex}"`.
- `hiring.fallback.useLocalNames: boolean` — default `true`.

## Tasks (augment existing section)

- `task.id: string (UUID v4)`
- `task.kind: string` — task code (must exist in `task_definitions.json`).
- `task.priority: number`
- `task.requiredRole?: string`
- `task.requiredSkills?: { [skillName: string]: number }`
- `task.location: { structureId: string, roomId?: string, zoneId?: string }`
- `task.toolsRequired?: string[]`
- `task.safetyConstraints?: string[]` — e.g., “no entry before `reentryIntervalTicks` expires”.
- `task.costBasis: "perAction" | "perPlant" | "perSquareMeter"`
- `task.quantity?: number` — plants count / area in m² / 1 for perAction.
- `task.durationTicks: number` — computed from template × scaling.
- `task.progressTicks: number` — 0..durationTicks.
- `task.splitable?: boolean` — may be batched across agents.
- `task.blocking?: boolean` — requires exclusive access.
- `task.deadlineTick?: number` — optional.

## Overtime & Policy

- `companyPolicies.overtimePolicy: "payout" | "timeOff"`
- `companyPolicies.overtimeMultiplier: number` — default `1.5`.
- `companyPolicies.maxShiftHours?: number` — optional soft cap before mandatory rest.
- `companyPolicies.restRecoveryPerTick?: number` — energy restored per tick while Resting/OffDuty.

## ADR 0008 — Auto-Provision Personnel Directory from RandomUser (docs/system/adr/0008-randomuser-provisioning.md)

Source: [`docs/system/adr/0008-randomuser-provisioning.md`](../docs/system/adr/0008-randomuser-provisioning.md)

# ADR 0008 — Auto-Provision Personnel Directory from RandomUser

- **Status:** Accepted (2025-09-26)
- **Owner:** Simulation Platform
- **Context:** Personnel directory bootstrapping & offline job market parity

## Context

The job market service already maintains a weekly refresh cadence and falls back
to local name lists when HTTP calls fail. However, freshly-cloned or production
installations often lack the `/data/personnel` directory assets (gendered first
names, last names, stored personal seeds). Without those files, offline
candidate generation degrades to placeholder names and synthetic seeds, which
breaks immersion and makes QA harder.

Operators requested that the backend populate the directory automatically when
it is missing so fully-offline deployments can still ship convincing applicant
rosters. The solution needed to stay deterministic, respect the existing
RandomUser contract, and fail fast when external integrations were intentionally
disabled.

## Decision

- Introduce `provisionPersonnelDirectory()` and invoke it during backend
  startup before the initial game state loads.
- When any of the four required files (`names/firstNamesFemale.json`,
  `names/firstNamesMale.json`, `names/lastNames.json`, `randomSeeds.json`) are
  missing, fetch deterministic RandomUser batches (default: 4×60 profiles) using
  seeds composed from the simulation seed and the batch index.
- Merge fetched entries with any existing data, normalise casing, drop blanks,
  and write sorted JSON files with trailing newlines so repo snapshots remain
  stable.
- Treat provisioning failures as fatal when the directory is incomplete. Missing
  network access, disabled HTTP integrations, or unusable provider payloads
  cause startup to abort with an actionable error so operators can resolve the
  root cause before gameplay begins.
- Leave existing files untouched when the directory is already complete to keep
  release artifacts reproducible and avoid unnecessary churn.

## Consequences

- Fresh deployments automatically populate high-quality name lists and personal
  seeds, ensuring the offline generator mirrors the RandomUser-backed pipeline.
- Provisioning produces deterministic assets tied to the simulation seed, so QA
  can replay a run and inspect the same on-disk names when diagnosing issues.
- Operators can bundle the generated files with release artifacts to avoid
  recurring outbound HTTP calls.
- Startup now depends on RandomUser availability (or pre-provisioned assets).
  Misconfiguration or provider outages will prevent the server from booting
  until the directory is fixed.

## Failure Modes & Mitigations

| Failure                                                               | Impact                                                                               | Mitigation                                                                                           |
| --------------------------------------------------------------------- | ------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------- |
| `WEEBBREED_DISABLE_JOB_MARKET_HTTP=true` or no `fetch` implementation | Provisioner throws and startup aborts.                                               | Ship the personnel directory with the build or enable HTTP for the first boot.                       |
| RandomUser returns malformed payloads (no names)                      | Provisioner throws and startup aborts.                                               | Retry manually later or supply pre-generated files. Logs capture the failing seed and attempt count. |
| Partial network outage during provisioning                            | Provisioner retries (`maxRetries`, default 2) and then aborts.                       | Override batch size/retries or rerun once connectivity is restored.                                  |
| Existing files contain duplicates or blanks                           | Provisioner merges with normalisation and de-duplication, then rewrites clean files. | No action needed; the new pass cleans the data.                                                      |

## Operational Guidance

- Allow outbound HTTPS on the first boot or run provisioning offline beforehand
  and copy the resulting files into `/data/personnel`.
- Monitor startup logs for the `state.personnelProvisioner` component; successful
  runs emit counts of generated male names, female names, last names, and stored
  seeds.
- For deterministic QA repros, note the simulation seed used during
  provisioning—the same seed will recreate identical file contents on another
  machine.

## Alternatives Considered

1. **Manual documentation only.** Rejected because it burdens operators with
   error-prone manual steps and results in inconsistent offline directories.
2. **Bundling static name lists in git.** Deferred to avoid shipping a bloated
   dataset and to preserve localisation flexibility for future markets.
3. **Lazy provisioning inside the job market refresh.** Rejected because the
   server would reach runtime before discovering missing assets, yielding
   confusing mid-simulation failures.

## Rollback Plan

If the automatic provisioning causes unacceptable startup coupling, remove the
`provisionPersonnelDirectory()` call from the backend bootstrap sequence and
restore manual instructions in the ops runbook. Existing generated files can be
left in place; they are regular JSON assets under `/data/personnel`.

## ADR 0005 — Snapshot & Time Status Telemetry Contract (docs/system/adr/0005-snapshot-time-sync.md)

Source: [`docs/system/adr/0005-snapshot-time-sync.md`](../docs/system/adr/0005-snapshot-time-sync.md)

# ADR 0005 — Snapshot & Time Status Telemetry Contract

- **Status:** Accepted (2025-09-24)
- **Owner:** Simulation Platform
- **Context:** Socket/SSE telemetry contract & dashboard integration

## Context

The simulation gateway streams `simulationUpdate` batches to both Socket.IO and
SSE clients. Over time the `SimulationSnapshot` shape evolved to include
additional structures (room purpose metadata, control setpoints, finance and
personnel summaries) and the scheduler began exposing a richer time status with
pause/running semantics for the UI. Documentation and onboarding guides still
reflected the early, zone-only payload without the persisted clock metadata or
`TimeStatus` envelope, leading to client misunderstandings about where to source
pause/resume state and when to expect updates.

## Decision

- Treat `buildSimulationSnapshot` as the authoritative schema provider. The
  emitted payload includes:
  - `clock` with `{ tick, isPaused, targetTickRate, startedAt, lastUpdatedAt }`.
  - Structures, rooms, and zones (including control/resources/health and device
    snapshots).
  - Personnel and finance summaries.
- Every `simulationUpdate` entry carries the scheduler’s `TimeStatus`
  (`{ running, paused, speed, tick, targetTickRate }`) alongside the snapshot.
  This value is sourced from `SimulationFacade.getTimeStatus()` at emission time
  and complements the persisted clock.
- `time.status` remains a handshake event only. Ongoing changes propagate through
  the `time` field on simulation updates and the `CommandResult` envelopes that
  respond to time-control commands.
- Update the protocol guide, AGENTS brief, README, and dashboards to reference
  this contract. Future schema changes must land in the same documents and bump
  the socket protocol version when they break compatibility.

## Consequences

- UI clients have a single, complete contract for both persisted clock data and
  live scheduler state, reducing ad-hoc polling or inference.
- Documentation debt around snapshot payloads is cleared, preventing new
  services from shipping against stale assumptions.
- Introduces a standing requirement to update the protocol guide and ADR when the
  snapshot/time status shapes change.

## References

- `docs/system/socket_protocol.md`
- `AGENTS.md` §4.8
- `src/backend/src/lib/uiSnapshot.ts`
- `src/backend/src/facade/index.ts` (`getTimeStatus`)

## ADR 0012 — Refactoring Governance & Modularisation Thresholds (docs/system/adr/0012-refactoring-governance.md)

Source: [`docs/system/adr/0012-refactoring-governance.md`](../docs/system/adr/0012-refactoring-governance.md)

# ADR 0012 — Refactoring Governance & Modularisation Thresholds

- **Status:** Accepted (2025-09-29)
- **Owner:** Simulation Platform
- **Context:** Multiple core modules (backend world service, shared models, frontend modal host) have exceeded 1,000 lines and now blend unrelated responsibilities. The lack of explicit thresholds let these god modules grow unchecked, making defects harder to isolate, discouraging reuse, and delaying architectural cleanups that would otherwise have been incremental.

## Decision

- Establish quantitative guardrails for module size and responsibility to trigger a refactoring review:
  - Backend/Frontend source files above **600 lines** or containing **three or more distinct responsibilities** (e.g., state orchestration, schema parsing, UI rendering) must be queued for decomposition.
  - Shared utility modules that introduce **runtime-only dependencies** into pure type/contract layers must be split so type definitions remain dependency-light.
- Require feature and platform teams to document approved refactoring plans in `/docs/tasks/*-refactoring-*.md`, capturing problem statement, goals, and sequencing before code changes land.
- Encourage reuse by default: modal, service, or hook implementations that are consumed in **two or more contexts** must be extracted into dedicated modules (e.g., `components/modals/<feature>/` or `engine/world/<domain>/`).
- Embed refactoring checkpoints into quarterly planning: review modules breaching thresholds, prioritise remediation, and update this ADR if thresholds need adjustment.

## Consequences

- Teams have a clear, documented trigger for when to invest in structural cleanups, reducing ambiguity around "too big" modules.
- Documentation of refactorings becomes a prerequisite, improving knowledge transfer and aligning cross-team expectations.
- Component and service reuse increases because extraction is mandated once a second consumer exists, lowering duplication and divergence.
- Planning cadences explicitly account for refactoring debt, making it harder for oversized modules to persist unnoticed.

## References

- `docs/tasks/20250929-refactoring-roadmap.md`
- `src/backend/src/engine/world/worldService.ts`
- `src/backend/src/state/models.ts`
- `src/frontend/src/components/ModalHost.tsx`

## ADR 0011 — Cultivation Setup UI Consolidation (docs/system/adr/0011-cultivation-setup-sharing.md)

Source: [`docs/system/adr/0011-cultivation-setup-sharing.md`](../docs/system/adr/0011-cultivation-setup-sharing.md)

# ADR 0011 — Cultivation Setup UI Consolidation

- **Status:** Accepted (2025-09-29)
- **Owner:** Simulation Platform
- **Context:** The `CreateZoneModal` and `ChangeZoneMethodModal` dialogs both rendered
  cultivation method, container, and substrate selectors alongside capacity checks and
  cost summaries. Each modal carried bespoke state wiring for catalog loading,
  compatibility filtering, container counting, and price math. The duplication caused
  the "Change method" dialog to drift visually from "Add zone" and made catalog or
  capacity tweaks error prone because they required touching two divergent codepaths
  plus separate tests.

## Decision

- Extract a shared `useCultivationSetup` hook that ingests catalog snapshots,
  available area, and initial selections to derive filtered method/container/substrate
  options, container capacity, substrate volume, and cost totals while surfacing a
  normalized state bag for UI rendering.
- Introduce a `CultivationSetupSection` component that receives the hook state and
  renders the normalized selectors, area field (with optional "Max" helper),
  container count input, and cost breakdown. Labels, helper copy, and capacity
  messages remain customizable so host modals can adjust tone without forking the
  layout.
- Update `CreateZoneModal` to render the shared section below the zone-name field and
  delegate catalog/area/capacity logic to the hook, keeping submission validation and
  intent dispatch localized to the modal.
- Update `ChangeZoneMethodModal` to reuse the shared hook/section while preserving its
  current-setup summary, storage handoff confirmation, and warning surfaces. The modal
  now passes zone-specific defaults (existing container count, non-editable area) into
  the shared hook instead of duplicating compatibility rules.
- Refresh React Testing Library suites to cover the shared workflow (capacity clamps,
  storage handoff) through the change-method modal and keep the `ModalHost` create-zone
  regression tests green.

## Consequences

- Cultivation setup UI and logic now live in one place, ensuring both dialogs stay
  visually aligned and reducing the risk of catalog or pricing regressions.
- Future features (e.g., method hints, pricing tweaks) can be implemented once in the
  shared hook/section and immediately benefit both modals.
- The shared hook centralizes catalog status handling, so catalog-loading edge cases
  no longer require redundant defensive code in each modal.

## References

- `src/frontend/src/components/modals/zones/CultivationSetupSection.tsx`
- `src/frontend/src/components/modals/zones/CreateZoneModal.tsx`
- `src/frontend/src/components/modals/zones/ChangeZoneMethodModal.tsx`
- `src/frontend/src/components/modals/__tests__/ChangeZoneMethodModal.test.tsx`
- `docs/ui/ui-components-desciption.md`

## Data and Blueprints [ # Source: docs/backend-overview.md § 3. Blueprints Provided & How to Use Them; docs/system/data-validation.md § Blueprint Data Validation Workflow; docs/DD.md § Conventions (apply to all files) ] (docs/\_final/08-data-and-blueprints.md)

Source: [`docs/_final/08-data-and-blueprints.md`](../docs/_final/08-data-and-blueprints.md)

# Data and Blueprints [ # Source: docs/backend-overview.md § 3. Blueprints Provided & How to Use Them; docs/system/data-validation.md § Blueprint Data Validation Workflow; docs/DD.md § Conventions (apply to all files) ]

- **Blueprint Doctrine.** Blueprints are delivered with the new repo as a validated collection spanning structures, room purposes, cultivation methods, strains, devices, pests, diseases, personnel roles, and price maps; they are immutable templates, never instantiated directly, because runtime systems always materialise instances by copying a blueprint, which enables multiple simultaneous instances—such as many small warehouses, rooms, or zones—from the same template without mutating the source data.【F:docs/backend-overview.md†L40-L52】
- **Schema conventions.** All blueprints follow shared rules: UUID `id` keys, camelCase naming without unit suffixes, SI units for physical quantities, inclusive ranges, and validation that enforces required fields, numeric bounds, and cross-references before runtime use.【F:docs/DD.md†L1-L41】【F:docs/backend-overview.md†L46-L52】【F:docs/backend-overview.md†L123-L139】
- **Validation workflow.** The `pnpm validate:data` command parses each blueprint family, enforces casing-sensitive control setpoints, emits machine- and human-readable reports, and fails CI when errors appear, ensuring data drift is caught before integration.【F:docs/system/data-validation.md†L1-L53】
- **Materialisation pipeline.** Loading blueprints involves validation, copying template values into runtime records, resolving cross-map identifiers (e.g., price tables), and exposing read-only instances to subsystems so deterministic state changes never mutate source JSON.【F:docs/backend-overview.md†L123-L129】

## Devices and Effects [ # Source: docs/system/simulation-engine.md § Environment Model (per Zone; well-mixed, delta-based); docs/DD.md § 2) Devices — `/data/blueprints/devices/*.json`; docs/backend-overview.md § 3.2 Blueprint–to–Subsystem Mapping ] (docs/\_final/06-devices-and-effects.md)

Source: [`docs/_final/06-devices-and-effects.md`](../docs/_final/06-devices-and-effects.md)

# Devices and Effects [ # Source: docs/system/simulation-engine.md § Environment Model (per Zone; well-mixed, delta-based); docs/DD.md § 2) Devices — `/data/blueprints/devices/*.json`; docs/backend-overview.md § 3.2 Blueprint–to–Subsystem Mapping ]

- **Device deltas.** Grow lights contribute heat proportional to power and map photon flux over coverage area to canopy PPFD, HVAC units steer temperature toward setpoints within hysteresis bands, dehumidifiers and humidifiers translate mass flow into relative humidity deltas, and CO₂ injectors push concentration toward targets capped by safety limits.【F:docs/system/simulation-engine.md†L35-L55】
- **Ambient normalisation.** After device and plant deltas, zones apply an exponential pull (`Δ = k_mix * (ambient − current)`) with airflow-dependent gain so ventilation hardware accelerates the return to ambient conditions.【F:docs/system/simulation-engine.md†L57-L59】
- **Blueprint parameters.** Device templates declare kind-specific settings (e.g., power, PPFD, coverage area, cooling capacity, airflow, targetTemperature, latent removal), quality and lifespan metadata, and allowed room purposes, giving the engine enough data to evaluate placement rules and runtime behaviour.【F:docs/DD.md†L203-L331】
- **Subsystem integration.** Lighting, climate/VPD, water/NPK, and energy subsystems derive their per-tick calculations from the declared device settings, enforcing validation such as positive PPFD, airflow bounds, and humidity limits before runtime use.【F:docs/backend-overview.md†L54-L64】

## Open Questions [ # Source: docs/vision_scope.md § 3. Success Criteria; docs/vision_scope.md § 4. Canonical Domain Model; docs/vision_scope.md § 8. Content & Data Strategy; docs/vision_scope.md § 13. Legal & Ethics ] (docs/\_final/11-open-questions.md)

Source: [`docs/_final/11-open-questions.md`](../docs/_final/11-open-questions.md)

# Open Questions [ # Source: docs/vision_scope.md § 3. Success Criteria; docs/vision_scope.md § 4. Canonical Domain Model; docs/vision_scope.md § 8. Content & Data Strategy; docs/vision_scope.md § 13. Legal & Ethics ]

- **First Harvest Time:** First harvest in **< 30 minutes** of play (MVP default setup). _(OPEN: validate)_【F:docs/vision_scope.md†L55-L56】
- **Retention Proxy:** 70% of players reach day 7 of a sandbox save. _(OPEN: measure)_【F:docs/vision_scope.md†L55-L57】
- **Memory Target:** Reference scenario uses < **1.0 GB RAM**. _(OPEN: finalize)_【F:docs/vision_scope.md†L61-L64】
- **Time Scale.** Tick-based with fixed tick duration: **default tick length = 5 in-game minutes**; **12 ticks = 1 in-game hour**, **288 ticks = 1 in-game day**, **7×288 ticks = 1 in-game week**. Ticks are aggregated into day/week summaries; replays/logs reference tick IDs. _(OPEN: standard wall-clock tick duration, e.g., 1 min)_【F:docs/vision_scope.md†L95-L96】
- **v1 Scope (Targets):** \~8–12 strains, \~10–15 devices, 2–3 cultivation methods, basic pests/diseases, treatments. _(OPEN: finalize list)_【F:docs/vision_scope.md†L214-L218】
- **Open-Source Strategy:** License model (e.g., AGPL/Polyform?); contributions via PR policy, CLA. _(OPEN: decide)_【F:docs/vision_scope.md†L254-L257】

## Assumptions and Constraints [ # Source: docs/vision_scope.md § 3. Success Criteria; docs/vision_scope.md § 12. Non-Functional Requirements (NFR); docs/vision_scope.md § 15. Risks & Assumptions; docs/vision_scope.md § 16. Binding Rules & Technical Guardrails (Coding‑Ready) ] (docs/\_final/10-assumptions-constraints.md)

Source: [`docs/_final/10-assumptions-constraints.md`](../docs/_final/10-assumptions-constraints.md)

# Assumptions and Constraints [ # Source: docs/vision_scope.md § 3. Success Criteria; docs/vision_scope.md § 12. Non-Functional Requirements (NFR); docs/vision_scope.md § 15. Risks & Assumptions; docs/vision_scope.md § 16. Binding Rules & Technical Guardrails (Coding‑Ready) ]

- **Performance envelope.** The reference scenario must sustain at least one tick per second at 1× speed with a per-tick CPU budget under 50 ms, aligning balancing and benchmark work around that baseline.【F:docs/vision_scope.md†L61-L77】
- **Deterministic numerics.** All randomness flows through seeded generators, SI units underpin every quantity, persistence uses JSON numbers with up to six decimal places, and audit comparisons apply tight relative and absolute tolerances, constraining both engine and content design.【F:docs/vision_scope.md†L305-L315】
- **Validation and safety.** Safe defaults on parameter errors, strict schema validation at load, and prohibition of `Math.random` in the core guard against drift and ensure deterministic recovery.【F:docs/vision_scope.md†L245-L249】【F:docs/vision_scope.md†L311-L315】
- **Community expectations.** The roadmap assumes modding demand, deterministic replays as a core value proposition, and broad acceptance of SI units, guiding documentation and tooling priorities.【F:docs/vision_scope.md†L293-L296】
- **Localization and privacy.** Out-of-the-box support targets German and English with SI units and configurable formatting, while saves remain local and avoid personal data, bounding compliance scope.【F:docs/vision_scope.md†L247-L250】

## Core Principles [ # Source: docs/vision_scope.md § 1. Vision; docs/system/simulation_philosophy.md § 1. Time & Simulation Loop: Stability and Fairness; docs/system/simulation_philosophy.md § 2. Environmental Model: Emergent Complexity from Simple Rules; docs/backend-overview.md § 3. Blueprints Provided & How to Use Them ] (docs/\_final/02-core-principles.md)

Source: [`docs/_final/02-core-principles.md`](../docs/_final/02-core-principles.md)

# Core Principles [ # Source: docs/vision_scope.md § 1. Vision; docs/system/simulation_philosophy.md § 1. Time & Simulation Loop: Stability and Fairness; docs/system/simulation_philosophy.md § 2. Environmental Model: Emergent Complexity from Simple Rules; docs/backend-overview.md § 3. Blueprints Provided & How to Use Them ]

- **Determinism first.** The simulation favours reproducibility over spectacle: every run uses seeded randomness, a fixed one-hour tick, and catch-up rules that prioritise fairness and responsiveness over raw step throughput.【F:docs/vision_scope.md†L13-L17】【F:docs/system/simulation_philosophy.md†L5-L8】
- **Emergent systems over monoliths.** Environment control is modelled as composable deltas (each device or plant contributes its own change), enabling extensibility and transparent root-cause analysis for players and developers alike.【F:docs/system/simulation_philosophy.md†L10-L12】
- **Stress → health → growth clarity.** Cultivation gameplay hinges on the player managing stressors so that health multiplies potential growth, making the optimisation loop explicit instead of opaque.【F:docs/system/simulation_philosophy.md†L14-L21】
- **Managerial control surface.** Autonomous employees claim tasks via utility scores so players focus on strategic decisions rather than micromanagement, aligning with the project’s indirect-control philosophy.【F:docs/system/simulation_philosophy.md†L23-L26】
- **Economic pressure with rewards.** Per-tick costs maintain constant tension while non-linear pricing amplifies high-quality harvests, rewarding mastery without relaxing deterministic accounting.【F:docs/system/simulation_philosophy.md†L27-L31】
- **Blueprint Doctrine.** Blueprints are delivered with the new repo as a validated set covering structures, room purposes, cultivation methods, strains, devices, pests, diseases, personnel roles, and price maps; they are immutable templates and are never instantiated directly, because runtime instances are created by copying a blueprint before the engine consumes them, which enables many simultaneous instances from a single template such as multiple small warehouses, rooms, or zones.【F:docs/backend-overview.md†L40-L52】

## Domain Model [ # Source: docs/vision_scope.md § 4. Canonical Domain Model; docs/DD.md § 1) Strains — `/data/blueprints/strains/*.json`; docs/DD.md § 2) Devices — `/data/blueprints/devices/*.json`; docs/DD.md § 3) Cultivation Methods — `/data/blueprints/cultivationMethods/*.json` ] (docs/\_final/03-domain-model.md)

Source: [`docs/_final/03-domain-model.md`](../docs/_final/03-domain-model.md)

# Domain Model [ # Source: docs/vision_scope.md § 4. Canonical Domain Model; docs/DD.md § 1) Strains — `/data/blueprints/strains/*.json`; docs/DD.md § 2) Devices — `/data/blueprints/devices/*.json`; docs/DD.md § 3) Cultivation Methods — `/data/blueprints/cultivationMethods/*.json` ]

- **Spatial hierarchy.** Structures contain rooms that contain zones; zones host plantings and the devices that condition their microclimate, mirroring the gameplay drill-down from buildings to individual plants.【F:docs/vision_scope.md†L84-L89】
- **Lifecycle coverage.** Plant entities progress from seed through vegetative and flowering stages into harvest and post-harvest handling, while devices degrade over time, requiring maintenance and replacement decisions.【F:docs/vision_scope.md†L90-L94】
- **Tick scale.** The simulation advances in fixed one-hour ticks (24 ticks per in-game day, 7×24 per week), anchoring telemetry aggregation, audits, and replays to tick identifiers.【F:docs/vision_scope.md†L95-L99】
- **Blueprint-backed entities.** Strains define genetics, environmental preferences, nutrient and water demand, phenology, resilience, and lineage; cultivation methods govern area per plant, spacing, labour intensity, and compatible traits; devices declare type-specific settings such as power, PPFD, airflow, temperature targets, and dehumidification rates.【F:docs/DD.md†L12-L115】【F:docs/DD.md†L203-L255】【F:docs/DD.md†L259-L331】

## Title & Scope [ # Source: docs/vision_scope.md § 1. Vision; docs/backend-overview.md § 1. Purpose & Non-Goals ] (docs/\_final/01-title-scope.md)

Source: [`docs/_final/01-title-scope.md`](../docs/_final/01-title-scope.md)

# Title & Scope [ # Source: docs/vision_scope.md § 1. Vision; docs/backend-overview.md § 1. Purpose & Non-Goals ]

- **Weedbreed.AI** is positioned as a modular, deterministic cultivation simulation that spans structures, climate control, and plant lifecycles while remaining open and extensible through data-driven content contributions.【F:docs/vision_scope.md†L5-L17】
- The simulation core’s mandate is to deliver reproducible cultivation and economy modelling with structured telemetry and validated intent handling, keeping internal coupling hidden from clients.【F:docs/backend-overview.md†L3-L11】
- Experience pillars emphasise planning and optimisation of climate and lighting, risk management around pests and devices, and an economy loop that balances OpEx/CapEx, cash flow, and quality-driven pricing.【F:docs/vision_scope.md†L25-L29】
- Anti-scope guardrails exclude political or regulatory modelling, shooter-style mechanics, and lab-grade growth modelling so the project can favour plausible, playable systems over exhaustive realism.【F:docs/vision_scope.md†L19-L23】

## Provenance Index [ # Source: docs/vision_scope.md § 1. Vision; docs/backend-overview.md § 3. Blueprints Provided & How to Use Them; docs/system/simulation-engine.md § Timebase & Core Loop (fixed-step, scheduler-agnostic); docs/_extraction/formulas.md § Extracted Formulas; docs/system/socket_protocol.md § UI Stream (`uiStream$`); docs/ui-building_guide.md § Guiding Principles; docs/system/data-validation.md § Blueprint Data Validation Workflow; docs/DD.md § Conventions (apply to all files); docs/system/simulation_philosophy.md § 1. Time & Simulation Loop: Stability and Fairness ] (docs/\_final/12-provenance-index.md)

Source: [`docs/_final/12-provenance-index.md`](../docs/_final/12-provenance-index.md)

# Provenance Index [ # Source: docs/vision_scope.md § 1. Vision; docs/backend-overview.md § 3. Blueprints Provided & How to Use Them; docs/system/simulation-engine.md § Timebase & Core Loop (fixed-step, scheduler-agnostic); docs/_extraction/formulas.md § Extracted Formulas; docs/system/socket_protocol.md § UI Stream (`uiStream$`); docs/ui-building_guide.md § Guiding Principles; docs/system/data-validation.md § Blueprint Data Validation Workflow; docs/DD.md § Conventions (apply to all files); docs/system/simulation_philosophy.md § 1. Time & Simulation Loop: Stability and Fairness ]

| Final Section              | Primary Sources                                                                                                                                                                                                                                                   |
| -------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 01-title-scope             | `docs/vision_scope.md § 1. Vision`, `docs/backend-overview.md § 1. Purpose & Non-Goals`【F:docs/vision_scope.md†L5-L29】【F:docs/backend-overview.md†L3-L11】                                                                                                     |
| 02-core-principles         | `docs/vision_scope.md § 1. Vision`, `docs/system/simulation_philosophy.md §§ 1–5`, `docs/backend-overview.md § 3.1 Operating Principles`【F:docs/vision_scope.md†L13-L17】【F:docs/system/simulation_philosophy.md†L5-L31】【F:docs/backend-overview.md†L40-L52】 |
| 03-domain-model            | `docs/vision_scope.md § 4. Canonical Domain Model`, `docs/DD.md §§ 1–3`【F:docs/vision_scope.md†L84-L99】【F:docs/DD.md†L12-L331】                                                                                                                                |
| 04-simulation-lifecycle    | `docs/system/simulation-engine.md §§ Timebase & Core Loop, Environment Model, Plant Growth, Health, Tasks, Economics`【F:docs/system/simulation-engine.md†L12-L190】                                                                                              |
| 05-math-formulas-overview  | `docs/_extraction/formulas.md § Extracted Formulas`【F:docs/\_extraction/formulas.md†L3-L440】                                                                                                                                                                    |
| 06-devices-and-effects     | `docs/system/simulation-engine.md § Environment Model`, `docs/DD.md § 2) Devices`, `docs/backend-overview.md § 3.2 Blueprint–to–Subsystem Mapping`【F:docs/system/simulation-engine.md†L35-L59】【F:docs/DD.md†L203-L331】【F:docs/backend-overview.md†L54-L64】  |
| 07-economy-and-costs       | `docs/vision_scope.md §§ 6–6a`, `docs/system/simulation-engine.md § Economics`, `docs/system/simulation_philosophy.md § 5`【F:docs/vision_scope.md†L112-L195】【F:docs/system/simulation-engine.md†L173-L190】【F:docs/system/simulation_philosophy.md†L27-L31】  |
| 08-data-and-blueprints     | `docs/backend-overview.md § 3`, `docs/system/data-validation.md`, `docs/DD.md § Conventions`【F:docs/backend-overview.md†L40-L139】【F:docs/system/data-validation.md†L1-L53】【F:docs/DD.md†L1-L41】                                                             |
| 09-telemetry-and-ui-views  | `docs/system/socket_protocol.md §§ UI Stream, Connection & Handshake`, `docs/ui-building_guide.md §§ Guiding Principles, Layout & Navigation, Dashboard & Global Chrome`【F:docs/system/socket_protocol.md†L3-L145】【F:docs/ui-building_guide.md†L1-L127】       |
| 10-assumptions-constraints | `docs/vision_scope.md §§ 3, 12, 15, 16`【F:docs/vision_scope.md†L61-L315】                                                                                                                                                                                        |
| 11-open-questions          | `docs/vision_scope.md §§ 3, 4, 8, 13`【F:docs/vision_scope.md†L55-L257】                                                                                                                                                                                          |

## Math Formulas Overview [ # Source: docs/_extraction/formulas.md § Extracted Formulas ] (docs/\_final/05-math-formulas-overview.md)

Source: [`docs/_final/05-math-formulas-overview.md`](../docs/_final/05-math-formulas-overview.md)

# Math Formulas Overview [ # Source: docs/_extraction/formulas.md § Extracted Formulas ]

## Breeding

- `T_gen = veg + flower + tail + post`【F:docs/\_extraction/formulas.md†L3-L12】
- `veg   = avg(vegetationDays[A], vegetationDays[B])`【F:docs/\_extraction/formulas.md†L14-L23】
- `flower= avg(floweringDays[A],  floweringDays[B])`【F:docs/\_extraction/formulas.md†L25-L34】
- `tail  = max(0, seedMaturationDays - (flower - pollinationDayInFlower))`【F:docs/\_extraction/formulas.md†L36-L45】
- `post  = postProcessingDays`【F:docs/\_extraction/formulas.md†L47-L56】
- `effectiveDays ≈ ceil(T_gen / parallelBatches)`【F:docs/\_extraction/formulas.md†L58-L67】
- `±noise × base`【F:docs/\_extraction/formulas.md†L113-L122】

## Terpenes

- `w_t = mg_g_t / total_mg_g`【F:docs/\_extraction/formulas.md†L69-L78】
- `axis = Σ (share_terpene × weight_terpene→axis) → clamp \[0..1]`【F:docs/\_extraction/formulas.md†L80-L89】

## Genetics & Resilience

- `sum ≤ 1`【F:docs/\_extraction/formulas.md†L91-L100】
- `1.0 = neutral`【F:docs/\_extraction/formulas.md†L102-L111】

## Capacity

- `Max plant count = floor(zoneArea / areaPerPlant)`【F:docs/\_extraction/formulas.md†L123-L133】

## Time Scaling

- `tickLengthMinutes / 60`【F:docs/\_extraction/formulas.md†L135-L144】
- `tickHours = tickLengthMinutes / 60`【F:docs/\_extraction/formulas.md†L366-L375】

## Tasks & Workforce

- `progressTicks >= durationTicks`【F:docs/\_extraction/formulas.md†L146-L155】
- `U = w1*priority + w2*skillMatch + w3*roleAffinity + w4*urgency`【F:docs/\_extraction/formulas.md†L421-L430】
- `w5*distance - w6*fatigue + w7*morale + w8*toolAvailability ± traitMods`【F:docs/\_extraction/formulas.md†L432-L440】

## Economics

- `revenue = harvestBasePricePerGram × modifiers`【F:docs/\_extraction/formulas.md†L157-L166】
- `device.power_kW × tickHours × electricityCostPerKWh`【F:docs/\_extraction/formulas.md†L355-L364】

## Scheduler & Seeding

- `Math.floor(tick / 2016)`【F:docs/\_extraction/formulas.md†L168-L177】
- `apiSeed = override ?? "<gameSeed>-<weekIndex>"`【F:docs/\_extraction/formulas.md†L179-L188】
- `accumulatedMs += now - lastNow`【F:docs/\_extraction/formulas.md†L212-L221】
- `accumulatedMs ≥ tickIntervalMs / gameSpeed`【F:docs/\_extraction/formulas.md†L223-L232】
- `accumulatedMs -= tickIntervalMs / gameSpeed`【F:docs/\_extraction/formulas.md†L234-L243】

## Probability

- `P(other) = pDiverse`【F:docs/\_extraction/formulas.md†L190-L199】
- `P(male) = P(female) = (1 - pDiverse) / 2`【F:docs/\_extraction/formulas.md†L201-L210】

## Environment & Humidity

- `ΔRH = (mass_kg ÷ (volume_m3 × SATURATION_VAPOR_DENSITY_KG_PER_M3)) × efficiency × powerMod`【F:docs/\_extraction/formulas.md†L245-L254】
- `Δ = k_mix * (ambient − current)`【F:docs/\_extraction/formulas.md†L256-L265】
- `Tₜ = Tₐ + (T₀ − Tₐ) · exp(−k · Δt)`【F:docs/\_extraction/formulas.md†L377-L386】

## Nutrition & Growth

- `req_phase = curve[phase]`【F:docs/\_extraction/formulas.md†L267-L276】
- `req_tick_plant = req_phase * (zoneArea / plantCount) * (tickHours / 24)`【F:docs/\_extraction/formulas.md†L278-L287】
- `stress_raw = Σ w_D * penalty_D`【F:docs/\_extraction/formulas.md†L289-L298】
- `stress = clamp01(stress_raw * (1 − generalResilience))`【F:docs/\_extraction/formulas.md†L300-L309】
- `stress > θ_stress`【F:docs/\_extraction/formulas.md†L311-L320】
- `health -= α * stress`【F:docs/\_extraction/formulas.md†L322-L331】
- `health += β_recovery`【F:docs/\_extraction/formulas.md†L333-L342】
- `actualGrowth = potentialGrowth * health * (1 − γ * stress)`【F:docs/\_extraction/formulas.md†L344-L353】

## Temperature & Transpiration

- `g_c = g₀ · clamp(LAI / 3, 0.3, 2)`【F:docs/\_extraction/formulas.md†L388-L397】
- `E = g_c · VPD · f_stomatal`【F:docs/\_extraction/formulas.md†L400-L408】
- `litres = E · area · Δt · 3600 · 0.018`【F:docs/\_extraction/formulas.md†L410-L419】

## Economy and Costs [ # Source: docs/vision_scope.md § 6. Progression & Economy; docs/vision_scope.md § 6a. Quality Grades & Price Functions; docs/system/simulation-engine.md § Economics (currency-neutral); docs/system/simulation_philosophy.md § 5. Economic Model: Constant Pressure and Rewarding Mastery ] (docs/\_final/07-economy-and-costs.md)

Source: [`docs/_final/07-economy-and-costs.md`](../docs/_final/07-economy-and-costs.md)

# Economy and Costs [ # Source: docs/vision_scope.md § 6. Progression & Economy; docs/vision_scope.md § 6a. Quality Grades & Price Functions; docs/system/simulation-engine.md § Economics (currency-neutral); docs/system/simulation_philosophy.md § 5. Economic Model: Constant Pressure and Rewarding Mastery ]

- **Dual loops.** Expansion decisions manage CapEx—renting structures, purchasing or replacing devices, unlocking cultivation methods—while daily operations juggle OpEx via climate control, irrigation, pest mitigation, staffing, and consumables.【F:docs/vision_scope.md†L112-L123】
- **Cost mechanics.** Maintenance costs rise with device wear, energy spend is derived from power draw per tick hour, water and nutrient purchases follow per-m²/day demand curves, rent multiplies hourly base rates by tick length, and labour costs respect overtime policies, ensuring all recurring charges scale with the current tick duration.【F:docs/system/simulation-engine.md†L173-L190】
- **Quality-driven revenue.** Harvest sales multiply base price by quality modifiers, with the quality model rewarding high health and low stress while a non-linear price function amplifies above-baseline quality and penalises poor output.【F:docs/vision_scope.md†L129-L195】
- **Design intent.** Persistent per-tick expenses maintain financial pressure so passive play is unviable, whereas mastering the systems to raise quality yields outsized rewards, reinforcing the tycoon-style tension.【F:docs/system/simulation_philosophy.md†L27-L31】

## ﻿# All JSON configurations file, currently available in `/data` (docs/addendum/all-json.md)

Source: [`docs/addendum/all-json.md`](../docs/addendum/all-json.md)

﻿# All JSON configurations file, currently available in `/data`

_Important rule for the consistency_ if in other documents attributes are listed but not in this document, the other document is right and attributes and data has to be added to the following files!
These files are crucial! The blueprinted Objects will be rehidrated from these configuration files, so there is no need, for hardcoded representation!

## /data/blueprints/cultivationMethods/basic_soil_pot.json

```json
{
  "id": "85cc0916-0e8a-495e-af8f-50291abe6855",
  "kind": "CultivationMethod",
  "name": "Basic Soil Pot",
  "laborIntensity": 0.1,
  "laborProfile": {
    "hoursPerPlantPerWeek": 0.35
  },
  "areaPerPlant": 0.5,
  "minimumSpacing": 0.5,
  "maxCycles": 1,
  "compatibleSubstrateTypes": ["soil", "coco"],
  "compatibleContainerTypes": ["pot"],
  "strainTraitCompatibility": {},
  "envBias": {},
  "capacityHints": {
    "plantsPer_m2": 4,
    "canopyHeight_m": 1.2
  },
  "idealConditions": {
    "idealTemperature": [20, 28],
    "idealHumidity": [0.5, 0.7]
  },
  "meta": {
    "description": "Simple cultivation method: one plant per pot in soil. Low setup cost, minimal labor, universally compatible.",
    "advantages": ["Very low initial cost", "Compatible with most strains", "Easy to manage"],
    "disadvantages": ["Moderate space usage", "Lower productivity than advanced methods"]
  }
}
```

## /data/blueprints/cultivationMethods/scrog.json

```json
{
  "id": "41229377-ef2d-4723-931f-72eea87d7a62",
  "kind": "CultivationMethod",
  "name": "Screen of Green",
  "laborIntensity": 0.7,
  "laborProfile": {
    "hoursPerPlantPerWeek": 1.2
  },
  "areaPerPlant": 1.0,
  "minimumSpacing": 0.8,
  "maxCycles": 4,
  "compatibleSubstrateTypes": ["soil", "coco"],
  "compatibleContainerTypes": ["pot"],
  "strainTraitCompatibility": {
    "preferred": {
      "genotype.sativa": {
        "min": 0.5
      }
    },
    "conflicting": {
      "genotype.indica": {
        "min": 0.7
      }
    }
  },
  "envBias": {
    "temp_C": 0.5,
    "co2_ppm": 50
  },
  "capacityHints": {
    "plantsPer_m2": 2,
    "canopyHeight_m": 0.8
  },
  "idealConditions": {
    "idealTemperature": [21, 27],
    "idealHumidity": [0.55, 0.7]
  },
  "meta": {
    "description": "Screen of Green (SCROG) is a low-density cultivation method that uses a screen to train plants to grow horizontally, creating a flat, even canopy. It maximizes light exposure for a smaller number of larger plants.",
    "advantages": [
      "Maximizes yield per plant",
      "Excellent light distribution",
      "Good for limited height spaces"
    ],
    "disadvantages": [
      "Longer vegetative phase required",
      "High training effort (pruning, tucking)",
      "Less suitable for very fast-cycling grows"
    ]
  }
}
```

## /data/blueprints/cultivationMethods/sog.json

```json
{
  "id": "659ba4d7-a5fc-482e-98d4-b614341883ac",
  "kind": "CultivationMethod",
  "name": "Sea of Green",
  "laborIntensity": 0.4,
  "laborProfile": {
    "hoursPerPlantPerWeek": 0.65
  },
  "areaPerPlant": 0.25,
  "minimumSpacing": 0.25,
  "maxCycles": 2,
  "compatibleSubstrateTypes": ["soil", "coco"],
  "compatibleContainerTypes": ["pot"],
  "strainTraitCompatibility": {
    "preferred": {
      "genotype.indica": {
        "min": 0.5
      },
      "photoperiod.vegetationTime": {
        "max": 1814400
      }
    },
    "conflicting": {
      "genotype.sativa": {
        "min": 0.5
      },
      "photoperiod.vegetationTime": {
        "min": 2419200
      }
    }
  },
  "envBias": {
    "vpd_kPa": 0.1,
    "rh_frac": -0.05
  },
  "capacityHints": {
    "plantsPer_m2": 18,
    "canopyHeight_m": 0.6
  },
  "idealConditions": {
    "idealTemperature": [22, 28],
    "idealHumidity": [0.5, 0.65]
  },
  "meta": {
    "description": "Sea of Green (SOG) is a high-density cultivation method where many small plants are grown close together to quickly fill a canopy. It emphasizes short vegetative phases and rapid cycling, ideal for fast-flowering indica-dominant strains.",
    "advantages": ["Shorter grow cycles", "Efficient use of space", "Lower training effort"],
    "disadvantages": [
      "More plants to manage",
      "Legal limitations in plant count (IRL)",
      "Not suitable for large or tall plants"
    ]
  }
}
```

## /data/prices/cultivationMethodPrices.json

```json
{
  "version": "2024-09-01",
  "cultivationMethodPrices": {
    "85cc0916-0e8a-495e-af8f-50291abe6855": {
      "setupCost": 2
    },
    "41229377-ef2d-4723-931f-72eea87d7a62": {
      "setupCost": 15
    },
    "659ba4d7-a5fc-482e-98d4-b614341883ac": {
      "setupCost": 10
    }
  }
}
```

## /data/prices/consumablePrices.json

```json
{
  "version": "2024-09-01",
  "substrates": {
    "soil-single-cycle": {
      "costPerLiter": 0.025
    },
    "soil-multi-cycle": {
      "costPerLiter": 0.035
    },
    "coco-coir": {
      "costPerLiter": 0.55
    }
  },
  "containers": {
    "pot-10l": {
      "costPerUnit": 1.5
    },
    "pot-11l": {
      "costPerUnit": 2
    },
    "pot-25l": {
      "costPerUnit": 4
    }
  }
}
```

## /data/blueprints/substrates/soil_single_cycle.json

```json
{
  "id": "04c8b1a5-09cc-4d86-8dc6-9007a64de6f2",
  "slug": "soil-single-cycle",
  "kind": "Substrate",
  "name": "Single-Cycle Soil Mix",
  "type": "soil",
  "maxCycles": 1,
  "meta": {
    "description": "Pre-charged soil mix formulated for one-and-done harvests; ideal when designers prefer a fresh medium each run.",
    "advantages": [
      "Arrives with a balanced nutrient charge",
      "High buffering capacity smooths pH swings",
      "Familiar handling for soil-focused operators"
    ],
    "disadvantages": [
      "Needs full replacement after a single cycle",
      "Spent media can harbor pests if disposal is delayed"
    ]
  }
}
```

## /data/blueprints/substrates/soil_multi_cycle.json

```json
{
  "id": "ebdb6d5e-fb3d-4db2-90a4-8e6c5be137f4",
  "slug": "soil-multi-cycle",
  "kind": "Substrate",
  "name": "Multi-Cycle Soil Mix",
  "type": "soil",
  "maxCycles": 2,
  "meta": {
    "description": "Reconditionable soil blend that survives two full runs with proper amendment and sterilization between crops.",
    "advantages": [
      "Supports two reuse cycles with consistent structure",
      "Balanced water retention keeps irrigation predictable",
      "Cation exchange capacity stabilizes nutrient delivery"
    ],
    "disadvantages": [
      "Needs re-amendment between harvests",
      "Heavier medium increases handling effort"
    ]
  }
}
```

## /data/blueprints/substrates/coco_coir.json

```json
{
  "id": "285041f1-9586-4b43-b55c-0cb76f343037",
  "slug": "coco-coir",
  "kind": "Substrate",
  "name": "Coco Coir",
  "type": "coco",
  "maxCycles": 4,
  "meta": {
    "description": "Buffered coco coir blend optimized for drain-to-waste or recirculating fertigation systems with multiple reuse cycles.",
    "advantages": [
      "Excellent aeration drives rapid root development",
      "Handles high-frequency fertigation without compaction",
      "Reusable across four cycles with proper flushing"
    ],
    "disadvantages": [
      "Demands precise nutrient and EC management",
      "Dries quickly without automated irrigation"
    ]
  }
}
```

## /data/blueprints/containers/pot_10l.json

```json
{
  "id": "0c48f3e3-2c19-4be4-86ea-4de97f5aa51e",
  "slug": "pot-10l",
  "kind": "Container",
  "name": "10 L Pot",
  "type": "pot",
  "volumeInLiters": 10,
  "footprintArea": 0.25,
  "reusableCycles": 3,
  "packingDensity": 0.9,
  "meta": {
    "description": "Compact 10 L pot tuned for short-cycle soil or coco runs where designers want dense spacing without root binding surprises.",
    "advantages": [
      "Small footprint keeps canopy layouts tight",
      "Lightweight shell is easy to reposition",
      "Medium warms quickly under indoor lighting"
    ],
    "disadvantages": [
      "Limited root volume for extended vegetative phases",
      "Requires tighter irrigation cadence to avoid drybacks"
    ]
  }
}
```

## /data/blueprints/containers/pot_11l.json

```json
{
  "id": "d9267b6f-41f3-4e91-95b8-5bd7be381d3f",
  "slug": "pot-11l",
  "kind": "Container",
  "name": "11 L Pot",
  "type": "pot",
  "volumeInLiters": 11,
  "footprintArea": 0.2,
  "reusableCycles": 6,
  "packingDensity": 0.95,
  "meta": {
    "description": "Balanced 11 L container sized for standard indoor runs; pairs with ebb-and-flow trays or benches without sacrificing root stability.",
    "advantages": [
      "Supports moderate root mass for full-cycle plants",
      "Fits common flood tables and rolling benches",
      "Durable enough for multiple sanitization cycles"
    ],
    "disadvantages": [
      "Heavier to maneuver when saturated",
      "Still undersized for very long veg or mother plants"
    ]
  }
}
```

## /data/blueprints/containers/pot_25l.json

```json
{
  "id": "9fb62d74-df4e-4e74-a0fb-77fa1f21d3ef",
  "slug": "pot-25l",
  "kind": "Container",
  "name": "25 L Pot",
  "type": "pot",
  "volumeInLiters": 25,
  "footprintArea": 0.3,
  "reusableCycles": 6,
  "packingDensity": 0.9,
  "meta": {
    "description": "Large 25 L pot for flagship plants or extended veg; gives roots the headroom needed for heavy-feeding cultivars.",
    "advantages": [
      "High volume supports vigorous, tall plants",
      "Moisture buffer stretches irrigation intervals",
      "Wide base resists tipping in high-canopy rooms"
    ],
    "disadvantages": [
      "Consumes more floor area per plant",
      "Longer dry-down can slow reset between cycles"
    ]
  }
}
```

## /data/blueprints/devices/climate_unit_01.json

```json
{
  "id": "7d3d3f1a-8c6f-4e9c-926d-5a2a4a3b6f1b",
  "kind": "ClimateUnit",
  "name": "CoolAir Split 3000",
  "quality": 0.9,
  "complexity": 0.4,
  "lifespan": 126144000,
  "roomPurposes": ["growroom"],
  "settings": {
    "power": 1.2,
    "coolingCapacity": 1.6,
    "airflow": 350,
    "targetTemperature": 24,
    "targetTemperatureRange": [18, 30],
    "cop": 3.2,
    "hysteresisK": 0.8,
    "fullPowerAtDeltaK": 2
  },
  "meta": {
    "description": "High-performance climate control unit for clean indoor cultivation rooms; targeted cooling with moderate energy usage and solid airflow.",
    "advantages": [
      "Effective cooling for medium-sized rooms",
      "Reliable airflow distribution",
      "Energy-efficient at moderate loads"
    ],
    "disadvantages": [
      "Higher maintenance costs over time",
      "Limited precision for multi-zone systems"
    ],
    "notes": "Recommended for vegetative and early flowering stages in temperate climates."
  }
}
```

## /data/blueprints/devices/co2injector-01.json

```json
{
  "id": "c701efa6-1e90-4f28-8934-ea9c584596e4",
  "kind": "CO2Injector",
  "name": "CO2 Pulse",
  "quality": 0.85,
  "complexity": 0.15,
  "lifespan": 31536000,
  "roomPurposes": ["growroom"],
  "settings": {
    "power": 0.05,
    "targetCO2": 1100,
    "targetCO2Range": [400, 1500],
    "hysteresis": 60,
    "pulsePpmPerTick": 150
  },
  "meta": {
    "description": "Automated CO2 injector for controlled enrichment.",
    "advantages": ["Precise dosing", "Energy efficient"],
    "disadvantages": ["Requires CO2 supply", "Overuse can harm plants"]
  }
}
```

## /data/blueprints/devices/dehumidifier-01.json

```json
{
  "id": "7a639d3d-4750-440a-a200-f90d11dc3c62",
  "kind": "Dehumidifier",
  "name": "DryBox 200",
  "quality": 0.8,
  "complexity": 0.25,
  "lifespan": 94608000,
  "roomPurposes": ["growroom"],
  "settings": {
    "latentRemovalKgPerTick": 0.05,
    "power": 0.3
  },
  "meta": {
    "description": "Compact unit for reducing ambient humidity.",
    "advantages": ["Efficient moisture removal", "Low energy consumption"],
    "disadvantages": ["Limited capacity for large rooms", "Generates heat"]
  }
}
```

## /data/blueprints/devices/exhaust_fan_01.json

```json
{
  "id": "f5d5c5a0-1b2c-4d3e-8f9a-0b1c2d3e4f5a",
  "kind": "Ventilation",
  "name": "Exhaust Fan 4-inch",
  "quality": 0.7,
  "complexity": 0.1,
  "lifespan": 63072000,
  "roomPurposes": ["growroom"],
  "settings": {
    "power": 0.05,
    "airflow": 170
  },
  "meta": {
    "description": "A simple and affordable exhaust fan with an airflow of 170 m³/h, perfect for small tents and grow areas. Effectively removes heat, humidity, and stale air by exchanging it with the ambient environment.",
    "advantages": [
      "Low cost",
      "Low power consumption",
      "Effective for small-scale climate control"
    ],
    "disadvantages": [
      "Not as effective as an AC unit for large heat loads",
      "Relies on ambient temperature for cooling"
    ],
    "notes": "Essential for any small grow setup to prevent heat and humidity buildup without the cost of a full climate unit."
  }
}
```

## /data/blueprints/devices/humidity_control_unit_01.json

```json
{
  "id": "3d762260-88a5-4104-b03c-9860bbac34b6",
  "kind": "HumidityControlUnit",
  "name": "Humidity Control Unit L1",
  "quality": 0.8,
  "complexity": 0.3,
  "lifespan": 31536000,
  "roomPurposes": ["growroom"],
  "settings": {
    "power": 0.35,
    "humidifyRateKgPerTick": 0.1,
    "dehumidifyRateKgPerTick": 0.1,
    "targetHumidity": 0.6,
    "hysteresis": 0.05
  },
  "meta": {
    "description": "A standard unit to control humidity.",
    "advantages": ["Handles both humidification and dehumidification", "Simple to operate"],
    "disadvantages": ["Limited capacity for large rooms", "Requires regular maintenance"]
  }
}
```

## /data/blueprints/devices/veg_light_01.json

```json
{
  "id": "3b5f6ad7-672e-47cd-9a24-f0cc45c4101e",
  "kind": "Lamp",
  "name": "LED VegLight 600",
  "quality": 0.95,
  "complexity": 0.2,
  "lifespan": 189216000,
  "roomPurposes": ["growroom"],
  "settings": {
    "power": 0.6,
    "ppfd": 800,
    "coverageArea": 1.2,
    "spectralRange": [400, 700],
    "heatFraction": 0.3
  },
  "meta": {
    "description": "Full-spectrum LED grow light optimized for the vegetative phase of cannabis plants. Balanced light distribution with low heat generation.",
    "advantages": ["High energy efficiency", "Low heat output", "Ideal for early growth stages"],
    "disadvantages": ["Limited effectiveness for flowering", "Higher upfront cost compared to HPS"],
    "notes": "Best used in enclosed environments with adequate canopy management."
  }
}
```

## /data/blueprints/diseases/anthracnose.json

```json
{
  "id": "83c4447f-8439-44cb-84ab-bbed8725e190",
  "kind": "Disease",
  "name": "Anthracnose",
  "pathogenType": "fungus",
  "targets": ["leaves", "stems"],
  "environmentalRisk": {
    "idealHumidityRange": [0.6, 0.9],
    "temperatureRange": [18, 28],
    "leafWetnessRequired": true
  },
  "transmission": ["splashingWater", "tools"],
  "contagious": true,
  "model": {
    "dailyInfectionIncrement": 0.05,
    "infectionThreshold": 0.25,
    "degenerationRate": 0.025,
    "recoveryRate": 0.015,
    "regenerationRate": 0.012,
    "fatalityThreshold": 0.93
  },
  "detection": {
    "symptoms": ["Dark, sunken lesions on leaves and stems", "Possible spore rings"]
  },
  "treatments": {
    "cultural": ["Avoid overhead irrigation", "Disinfect tools"],
    "mechanical": ["Remove infected shoots"]
  }
}
```

## /data/blueprints/diseases/bacterial_leaf_spot.json

```json
{
  "id": "c1823c46-47df-4106-a039-88e60a6aa5ed",
  "kind": "Disease",
  "name": "Bacterial Leaf Spot",
  "pathogenType": "bacteria",
  "targets": ["leaves"],
  "environmentalRisk": {
    "idealHumidityRange": [0.6, 0.95],
    "temperatureRange": [18, 28],
    "leafWetnessRequired": true
  },
  "transmission": ["splashingWater", "tools", "workers"],
  "contagious": true,
  "model": {
    "dailyInfectionIncrement": 0.06,
    "infectionThreshold": 0.22,
    "degenerationRate": 0.03,
    "recoveryRate": 0.014,
    "regenerationRate": 0.01,
    "fatalityThreshold": 0.9
  },
  "detection": {
    "symptoms": [
      "Water-soaked, later brown spots with yellow halo",
      "Oily sheen, marginal necrosis"
    ]
  },
  "treatments": {
    "cultural": ["Keep foliage dry", "Disinfect tools"],
    "mechanical": ["Remove heavily infected leaves"]
  }
}
```

## /data/blueprints/diseases/bacterial_wilt.json

```json
{
  "id": "01b6d921-88d8-42f0-8009-7111eff56e70",
  "kind": "Disease",
  "name": "Bacterial Wilt (Erwinia-like)",
  "pathogenType": "bacteria",
  "targets": ["stems", "vascular"],
  "environmentalRisk": {
    "idealHumidityRange": [0.5, 0.9],
    "temperatureRange": [20, 30],
    "woundEntryRisk": 0.8
  },
  "transmission": ["tools", "substrate", "splashingWater"],
  "contagious": true,
  "model": {
    "dailyInfectionIncrement": 0.07,
    "infectionThreshold": 0.2,
    "degenerationRate": 0.045,
    "recoveryRate": 0.01,
    "regenerationRate": 0.008,
    "fatalityThreshold": 0.96
  },
  "detection": {
    "symptoms": ["Sudden wilting despite sufficient soil moisture", "Darkened vascular tissue"]
  },
  "treatments": {
    "cultural": ["Avoid wounding", "Increase hygiene", "Maintain low rH"],
    "mechanical": ["Remove heavily infected plants"]
  }
}
```

## /data/blueprints/diseases/botrytis_gray_mold.json

```json
{
  "id": "eaca3c76-875c-4ebe-9ea5-c91dc9651f73",
  "kind": "Disease",
  "name": "Botrytis (Gray Mold / Bud Rot)",
  "pathogenType": "fungus",
  "targets": ["buds", "flowers", "leaves"],
  "environmentalRisk": {
    "idealHumidityRange": [0.6, 0.9],
    "temperatureRange": [15, 22],
    "leafWetnessRequired": true,
    "lowAirflowRisk": 0.8,
    "denseCanopyRisk": 0.85
  },
  "transmission": ["airborneSpores", "wounds"],
  "contagious": true,
  "model": {
    "dailyInfectionIncrement": 0.08,
    "infectionThreshold": 0.15,
    "degenerationRate": 0.05,
    "recoveryRate": 0.01,
    "regenerationRate": 0.008,
    "fatalityThreshold": 0.9
  },
  "yieldImpact": {
    "budLossFractionPerDay": 0.05
  },
  "detection": {
    "symptoms": ["Brown-gray, mushy spots inside buds", "Cottony mold growth with musty smell"]
  },
  "treatments": {
    "cultural": ["Maintain rH < 0.55 in late flowering", "Increase air circulation"],
    "mechanical": ["Remove affected buds"]
  }
}
```

## /data/blueprints/diseases/downy_mildew.json

```json
{
  "id": "645b6253-4692-4396-ab6a-f3b02c9783bf",
  "kind": "Disease",
  "name": "Downy Mildew",
  "pathogenType": "fungus",
  "targets": ["leaves"],
  "environmentalRisk": {
    "idealHumidityRange": [0.7, 0.95],
    "temperatureRange": [15, 24],
    "leafWetnessRequired": true,
    "lowAirflowRisk": 0.7
  },
  "transmission": ["airborneSpores", "splashingWater"],
  "contagious": true,
  "model": {
    "dailyInfectionIncrement": 0.055,
    "infectionThreshold": 0.2,
    "degenerationRate": 0.022,
    "recoveryRate": 0.012,
    "regenerationRate": 0.01,
    "fatalityThreshold": 0.92
  },
  "detection": {
    "symptoms": ["Yellowish angular leaf spots", "Gray-white fungal growth on leaf undersides"]
  },
  "treatments": {
    "cultural": ["Avoid night condensation", "Irrigate during day"],
    "mechanical": ["Remove infected leaves"]
  }
}
```

## /data/blueprints/diseases/hop_latent_viroid.json

```json
{
  "id": "259acd2f-d4af-49dd-8f0e-450c3045aea1",
  "kind": "Disease",
  "name": "Hop Latent Viroid (HpLVd)",
  "pathogenType": "viroid",
  "targets": ["systemic"],
  "environmentalRisk": {
    "temperatureRange": [18, 28]
  },
  "transmission": ["clones", "sap", "tools"],
  "contagious": true,
  "model": {
    "dailyInfectionIncrement": 0.03,
    "infectionThreshold": 0.15,
    "degenerationRate": 0.03,
    "recoveryRate": 0.002,
    "regenerationRate": 0.002,
    "fatalityThreshold": 0.85
  },
  "detection": {
    "symptoms": [
      "General growth suppression ('dudding')",
      "Small, deformed leaves; reduced resin production"
    ]
  },
  "treatments": {
    "cultural": ["Use tested clones only", "Strict tool hygiene"],
    "mechanical": ["Screen and remove infected mother plants"]
  }
}
```

## /data/blueprints/diseases/mosaic_virus.json

```json
{
  "id": "da9b207b-3aeb-4784-875e-bbee1e27ced9",
  "kind": "Disease",
  "name": "Mosaic Virus (TMV/CMV-like)",
  "pathogenType": "virus",
  "targets": ["leaves", "systemic"],
  "environmentalRisk": {
    "temperatureRange": [18, 28]
  },
  "transmission": ["sap", "tools", "pests"],
  "contagious": true,
  "model": {
    "dailyInfectionIncrement": 0.04,
    "infectionThreshold": 0.18,
    "degenerationRate": 0.028,
    "recoveryRate": 0.003,
    "regenerationRate": 0.003,
    "fatalityThreshold": 0.9
  },
  "detection": {
    "symptoms": [
      "Mottled light and dark green leaf patterns (mosaic)",
      "Leaf deformation, stunted growth"
    ]
  },
  "treatments": {
    "cultural": ["Use pathogen-free plant material", "Disinfect tools"],
    "mechanical": ["Remove infected plants"]
  }
}
```

## /data/blueprints/diseases/powdery_mildew.json

```json
{
  "id": "818bc83c-0a18-47c5-b861-c378181b0812",
  "kind": "Disease",
  "name": "Powdery Mildew",
  "pathogenType": "fungus",
  "targets": ["leaves", "stems"],
  "environmentalRisk": {
    "idealHumidityRange": [0.5, 0.7],
    "temperatureRange": [20, 28],
    "leafWetnessRequired": false,
    "lowAirflowRisk": 0.8,
    "overcrowdingRisk": 0.7
  },
  "transmission": ["airborneSpores", "tools", "workers"],
  "contagious": true,
  "model": {
    "dailyInfectionIncrement": 0.06,
    "infectionThreshold": 0.18,
    "degenerationRate": 0.018,
    "recoveryRate": 0.017,
    "regenerationRate": 0.012,
    "fatalityThreshold": 0.9
  },
  "detection": {
    "symptoms": ["White, powdery coating on leaf surfaces", "Yellowish spots leading to necrosis"],
    "scoutingHints": [
      "Inspect leaf surfaces in dense canopies",
      "Check during humidity fluctuations"
    ]
  },
  "treatments": {
    "cultural": ["Increase air circulation", "Prune dense leaves", "Avoid humidity spikes"],
    "biological": ["Bacillus subtilis", "Low-dose sulfur sprays"],
    "mechanical": ["Remove heavily infected leaves"]
  }
}
```

## /data/blueprints/diseases/root_rot.json

```json
{
  "id": "55741064-9052-407f-8fbe-9eb3690ff851",
  "kind": "Disease",
  "name": "Root Rot (Pythium/Fusarium/Rhizoctonia)",
  "pathogenType": "fungus-complex",
  "targets": ["roots", "crown"],
  "environmentalRisk": {
    "idealHumidityRange": [0.4, 0.7],
    "temperatureRange": [18, 26],
    "substrateWaterloggingRisk": 0.9,
    "poorDrainageRisk": 0.85
  },
  "transmission": ["contaminatedWater", "substrate", "tools"],
  "contagious": true,
  "model": {
    "dailyInfectionIncrement": 0.07,
    "infectionThreshold": 0.22,
    "degenerationRate": 0.04,
    "recoveryRate": 0.012,
    "regenerationRate": 0.009,
    "fatalityThreshold": 0.98
  },
  "detection": {
    "symptoms": ["Plants wilting despite wet soil", "Brown, slimy roots with foul smell"]
  },
  "treatments": {
    "cultural": ["Avoid overwatering", "Improve drainage", "Extend irrigation intervals"],
    "biological": ["Trichoderma spp."],
    "mechanical": ["Remove heavily affected plants"]
  }
}
```

## /data/blueprints/personnel/roles/Gardener.json

```json
{
  "id": "Gardener",
  "name": "Gardener",
  "salary": {
    "basePerTick": 24,
    "skillFactor": { "base": 0.85, "perPoint": 0.04, "min": 0.85, "max": 1.45 },
    "randomRange": { "min": 0.9, "max": 1.1 },
    "skillWeights": { "primary": 1.2, "secondary": 0.6, "tertiary": 0.35 }
  },
  "maxMinutesPerTick": 90,
  "roleWeight": 0.35,
  "skillProfile": {
    "primary": {
      "skill": "Gardening",
      "startingLevel": 4,
      "roll": { "min": 3, "max": 5 }
    },
    "secondary": {
      "skill": "Cleanliness",
      "startingLevel": 2,
      "roll": { "min": 1, "max": 4 }
    },
    "tertiary": {
      "chance": 0.25,
      "roll": { "min": 1, "max": 3 },
      "candidates": [
        { "skill": "Logistics", "startingLevel": 1 },
        { "skill": "Administration", "startingLevel": 1 },
        { "skill": "Maintenance", "startingLevel": 1 }
      ]
    }
  }
}
```

## /data/blueprints/personnel/roles/Janitor.json

```json
{
  "id": "Janitor",
  "name": "Janitor",
  "salary": {
    "basePerTick": 18,
    "skillFactor": { "base": 0.85, "perPoint": 0.04, "min": 0.85, "max": 1.45 },
    "randomRange": { "min": 0.88, "max": 1.08 },
    "skillWeights": { "primary": 1.1, "secondary": 0.55, "tertiary": 0.3 }
  },
  "maxMinutesPerTick": 75,
  "preferredShiftId": "shift.night",
  "roleWeight": 0.15,
  "skillProfile": {
    "primary": {
      "skill": "Cleanliness",
      "startingLevel": 4,
      "roll": { "min": 3, "max": 5 }
    },
    "secondary": {
      "skill": "Logistics",
      "startingLevel": 1,
      "roll": { "min": 0, "max": 3 }
    },
    "tertiary": {
      "chance": 0.3,
      "roll": { "min": 1, "max": 3 },
      "candidates": [
        { "skill": "Administration", "startingLevel": 1 },
        { "skill": "Gardening", "startingLevel": 1 },
        { "skill": "Maintenance", "startingLevel": 1 }
      ]
    }
  }
}
```

## /data/blueprints/personnel/roles/Manager.json

```json
{
  "id": "Manager",
  "name": "Manager",
  "salary": {
    "basePerTick": 35,
    "skillFactor": { "base": 0.85, "perPoint": 0.04, "min": 0.85, "max": 1.5 },
    "randomRange": { "min": 0.95, "max": 1.18 },
    "skillWeights": { "primary": 1.3, "secondary": 0.7, "tertiary": 0.45 }
  },
  "maxMinutesPerTick": 60,
  "preferredShiftId": "shift.day",
  "roleWeight": 0.12,
  "skillProfile": {
    "primary": {
      "skill": "Administration",
      "startingLevel": 4,
      "roll": { "min": 3, "max": 5 }
    },
    "secondary": {
      "skill": "Logistics",
      "startingLevel": 2,
      "roll": { "min": 1, "max": 4 }
    },
    "tertiary": {
      "chance": 0.4,
      "roll": { "min": 1, "max": 3 },
      "candidates": [{ "skill": "Cleanliness", "startingLevel": 2, "weight": 2 }]
    }
  }
}
```

## /data/blueprints/personnel/roles/Operator.json

```json
{
  "id": "Operator",
  "name": "Operator",
  "salary": {
    "basePerTick": 22,
    "skillFactor": { "base": 0.85, "perPoint": 0.04, "min": 0.85, "max": 1.45 },
    "randomRange": { "min": 0.9, "max": 1.1 },
    "skillWeights": { "primary": 1.15, "secondary": 0.6, "tertiary": 0.35 }
  },
  "maxMinutesPerTick": 90,
  "preferredShiftId": "shift.day",
  "roleWeight": 0.18,
  "skillProfile": {
    "primary": {
      "skill": "Logistics",
      "startingLevel": 3,
      "roll": { "min": 2, "max": 4 }
    },
    "secondary": {
      "skill": "Administration",
      "startingLevel": 2,
      "roll": { "min": 1, "max": 4 }
    },
    "tertiary": {
      "chance": 0.25,
      "roll": { "min": 1, "max": 3 },
      "candidates": [
        { "skill": "Cleanliness", "startingLevel": 1 },
        { "skill": "Gardening", "startingLevel": 1 },
        { "skill": "Maintenance", "startingLevel": 1 }
      ]
    }
  }
}
```

## /data/blueprints/personnel/roles/Technician.json

```json
{
  "id": "Technician",
  "name": "Technician",
  "salary": {
    "basePerTick": 28,
    "skillFactor": { "base": 0.85, "perPoint": 0.04, "min": 0.85, "max": 1.45 },
    "randomRange": { "min": 0.9, "max": 1.12 },
    "skillWeights": { "primary": 1.25, "secondary": 0.65, "tertiary": 0.4 }
  },
  "maxMinutesPerTick": 120,
  "roleWeight": 0.2,
  "skillProfile": {
    "primary": {
      "skill": "Maintenance",
      "startingLevel": 4,
      "roll": { "min": 3, "max": 5 }
    },
    "secondary": {
      "skill": "Logistics",
      "startingLevel": 2,
      "roll": { "min": 1, "max": 4 }
    },
    "tertiary": {
      "chance": 0.25,
      "roll": { "min": 1, "max": 3 },
      "candidates": [
        { "skill": "Gardening", "startingLevel": 1 },
        { "skill": "Administration", "startingLevel": 1 },
        { "skill": "Cleanliness", "startingLevel": 1 }
      ]
    }
  }
}
```

## /data/blueprints/personnel/skills/Administration.json

```json
{
  "id": "Administration",
  "name": "Administration",
  "description": "Planning, reporting, compliance oversight, and documentation workflows.",
  "tags": ["management", "compliance"]
}
```

## /data/blueprints/personnel/skills/Cleanliness.json

```json
{
  "id": "Cleanliness",
  "name": "Cleanliness",
  "description": "Sanitation, hygiene, and compliance routines across rooms and devices.",
  "tags": ["quality", "safety"]
}
```

## /data/blueprints/personnel/skills/Gardening.json

```json
{
  "id": "Gardening",
  "name": "Gardening",
  "description": "Plant care, canopy management, pruning, and phenology adjustments.",
  "tags": ["cultivation"]
}
```

## /data/blueprints/personnel/skills/Logistics.json

```json
{
  "id": "Logistics",
  "name": "Logistics",
  "description": "Inventory stewardship, material handling, and production scheduling.",
  "tags": ["operations"]
}
```

## /data/blueprints/personnel/skills/Maintenance.json

```json
{
  "id": "Maintenance",
  "name": "Maintenance",
  "description": "Device diagnostics, preventive maintenance, and facility upkeep routines.",
  "tags": ["operations", "technical"]
}
```

## /data/blueprints/pests/aphids.json

```json
{
  "id": "90fd2899-4563-468d-9e32-500a75ce9275",
  "kind": "Pest",
  "name": "Aphids",
  "category": "sap-sucking",
  "targets": ["leaves", "stems"],
  "environmentalRisk": {
    "temperatureRange": [18, 28],
    "humidityRange": [0.4, 0.8]
  },
  "populationDynamics": {
    "dailyReproductionRate": 0.32,
    "dailyMortalityRate": 0.06,
    "carryingCapacity": 1.2
  },
  "damageModel": {
    "photosynthesisReductionPerDay": 0.15,
    "rootUptakeReductionPerDay": 0.0,
    "budLossFractionPerDay": 0.0,
    "diseaseVectorRisk": 0.5,
    "honeydew": true
  },
  "detection": {
    "symptoms": [
      "Clusters on shoot tips and undersides",
      "Sticky honeydew leading to sooty mold",
      "Leaf curling"
    ],
    "monitoring": ["Yellow sticky cards", "Visual scouting on new growth"]
  },
  "controlOptions": {
    "biological": ["Lady beetles (Coccinellidae)", "Aphidius parasitoids"],
    "cultural": ["Remove infested shoots", "Avoid over-fertilizing with N"],
    "mechanical": ["Water jet dislodging", "Pruning"],
    "chemical": ["Soaps and oils", "Azadirachtin (where compliant)"]
  }
}
```

## /data/blueprints/pests/broad_mites.json

```json
{
  "id": "2c574211-0e96-44f1-82ee-327056ac5fcb",
  "kind": "Pest",
  "name": "Broad Mites / Russet Mites",
  "category": "sap-sucking",
  "targets": ["meristems", "flowers", "leaves"],
  "environmentalRisk": {
    "temperatureRange": [20, 28],
    "humidityRange": [0.4, 0.8]
  },
  "populationDynamics": {
    "dailyReproductionRate": 0.33,
    "dailyMortalityRate": 0.07,
    "carryingCapacity": 1.0
  },
  "damageModel": {
    "photosynthesisReductionPerDay": 0.2,
    "rootUptakeReductionPerDay": 0.0,
    "budLossFractionPerDay": 0.0,
    "diseaseVectorRisk": 0.2,
    "honeydew": false
  },
  "detection": {
    "symptoms": [
      "Twisted, hardened new growth",
      "Bronzed, rough leaf surfaces",
      "Flower deformities"
    ],
    "monitoring": ["High-magnification scope (≥60x) on meristems", "Sentinel plants in hotspots"]
  },
  "controlOptions": {
    "biological": ["Predatory mites (Amblyseius swirskii, A. andersoni)"],
    "cultural": ["Quarantine and destroy heavily infested stock", "Strict sanitation"],
    "mechanical": ["Remove infested tips"],
    "chemical": ["Targeted miticides where compliant; rotate modes"]
  }
}
```

## /data/blueprints/pests/caterpillars.json

```json
{
  "id": "2335b750-3c2a-4540-a44c-3d510036bafd",
  "kind": "Pest",
  "name": "Caterpillars",
  "category": "chewing",
  "targets": ["leaves", "buds"],
  "environmentalRisk": {
    "temperatureRange": [18, 30],
    "humidityRange": [0.4, 0.8]
  },
  "populationDynamics": {
    "dailyReproductionRate": 0.2,
    "dailyMortalityRate": 0.1,
    "carryingCapacity": 0.8
  },
  "damageModel": {
    "photosynthesisReductionPerDay": 0.18,
    "rootUptakeReductionPerDay": 0.0,
    "budLossFractionPerDay": 0.05,
    "diseaseVectorRisk": 0.3,
    "honeydew": false
  },
  "detection": {
    "symptoms": [
      "Chewed leaves and frass (droppings)",
      "Holes and tunnels in buds",
      "Secondary bud rot (Botrytis)"
    ],
    "monitoring": ["Blacklight scouting outdoors", "Pheromone traps where available"]
  },
  "controlOptions": {
    "biological": ["Bacillus thuringiensis kurstaki (Btk)", "Trichogramma wasps"],
    "cultural": ["Remove plant debris", "Timing: treat early instars"],
    "mechanical": ["Hand-pick, inspect buds"],
    "chemical": ["Selective stomach poisons (where allowed)"]
  }
}
```

## /data/blueprints/pests/fungus_gnats.json

```json
{
  "id": "33fc7bb4-9ca1-42e8-8d70-8267f8b6abe3",
  "kind": "Pest",
  "name": "Fungus Gnats",
  "category": "soil-dwelling",
  "targets": ["roots", "substrate"],
  "environmentalRisk": {
    "temperatureRange": [18, 26],
    "humidityRange": [0.5, 0.9],
    "overwateringRisk": 0.9
  },
  "populationDynamics": {
    "dailyReproductionRate": 0.27,
    "dailyMortalityRate": 0.08,
    "carryingCapacity": 1.0
  },
  "damageModel": {
    "photosynthesisReductionPerDay": 0.05,
    "rootUptakeReductionPerDay": 0.15,
    "budLossFractionPerDay": 0.0,
    "diseaseVectorRisk": 0.5,
    "honeydew": false
  },
  "detection": {
    "symptoms": [
      "Adults on soil surface and near pots",
      "Larvae feed on roots causing stunting",
      "Algae growth on wet media"
    ],
    "monitoring": ["Yellow sticky cards at substrate level", "Potato slice test for larvae"]
  },
  "controlOptions": {
    "biological": ["Steinernema feltiae (nematodes)", "Bacillus thuringiensis israelensis (Bti)"],
    "cultural": ["Dry-down cycles", "Improve drainage", "Avoid algae"],
    "mechanical": ["Top-dress with sand/perlite layer"],
    "chemical": ["H2O2 drenches (careful), compliant larvicides where allowed"]
  }
}
```

## /data/blueprints/pests/root_aphids.json

```json
{
  "id": "1946a4a4-e2c7-494b-8777-7beffafcffba",
  "kind": "Pest",
  "name": "Root Aphids",
  "category": "sap-sucking",
  "targets": ["roots"],
  "environmentalRisk": {
    "temperatureRange": [18, 26],
    "humidityRange": [0.5, 0.9],
    "overfertilizationRisk": 0.5
  },
  "populationDynamics": {
    "dailyReproductionRate": 0.3,
    "dailyMortalityRate": 0.06,
    "carryingCapacity": 1.0
  },
  "damageModel": {
    "photosynthesisReductionPerDay": 0.08,
    "rootUptakeReductionPerDay": 0.25,
    "budLossFractionPerDay": 0.0,
    "diseaseVectorRisk": 0.4,
    "honeydew": false
  },
  "detection": {
    "symptoms": [
      "Stunted plants resembling nutrient deficiency",
      "White waxy residue on roots",
      "Poor response to fertilization"
    ],
    "monitoring": ["Root inspections during repotting", "Yellow sticky cards at substrate level"]
  },
  "controlOptions": {
    "biological": ["Beneficial nematodes (Steinernema/ Heterorhabditis)"],
    "cultural": ["Avoid overwatering and excess N", "Sterilize media/tools"],
    "mechanical": ["Discard heavily infested media"],
    "chemical": ["Drenches permitted by regulation (jurisdiction-dependent)"]
  }
}
```

## /data/blueprints/pests/spider_mites.json

```json
{
  "id": "7a887ad2-34ed-4284-9c86-b573aadffdb9",
  "kind": "Pest",
  "name": "Spider Mites",
  "category": "sap-sucking",
  "targets": ["leaves", "stems"],
  "environmentalRisk": {
    "temperatureRange": [24, 32],
    "humidityRange": [0.3, 0.6],
    "lowAirflowRisk": 0.6,
    "dustyCanopyRisk": 0.5
  },
  "populationDynamics": {
    "dailyReproductionRate": 0.35,
    "dailyMortalityRate": 0.05,
    "carryingCapacity": 1.0
  },
  "damageModel": {
    "photosynthesisReductionPerDay": 0.18,
    "rootUptakeReductionPerDay": 0.0,
    "budLossFractionPerDay": 0.0,
    "diseaseVectorRisk": 0.2,
    "honeydew": false
  },
  "detection": {
    "symptoms": [
      "Fine yellow stippling on upper leaf surfaces",
      "Webbing under leaves at high density",
      "Leaves bronzing and drying out"
    ],
    "monitoring": ["Use hand lens (≥40x) under leaves", "Sticky traps for presence trends"]
  },
  "controlOptions": {
    "biological": ["Predatory mites (Phytoseiulus persimilis, Amblyseius californicus)"],
    "cultural": ["Increase humidity short-term", "Improve airflow", "Quarantine new plants"],
    "mechanical": ["Rinse undersides, remove heavily infested leaves"],
    "chemical": ["Horticultural oils", "Soaps (rotate actives to avoid resistance)"]
  }
}
```

## /data/blueprints/pests/thrips.json

```json
{
  "id": "4bb767d7-403e-49c9-aa10-b957dfc0e881",
  "kind": "Pest",
  "name": "Thrips",
  "category": "sap-sucking",
  "targets": ["leaves", "flowers"],
  "environmentalRisk": {
    "temperatureRange": [20, 30],
    "humidityRange": [0.3, 0.7]
  },
  "populationDynamics": {
    "dailyReproductionRate": 0.3,
    "dailyMortalityRate": 0.06,
    "carryingCapacity": 1.0
  },
  "damageModel": {
    "photosynthesisReductionPerDay": 0.12,
    "rootUptakeReductionPerDay": 0.0,
    "budLossFractionPerDay": 0.0,
    "diseaseVectorRisk": 0.6,
    "honeydew": false
  },
  "detection": {
    "symptoms": [
      "Silvery streaks and speckling on leaves",
      "Black fecal spots",
      "Distorted new growth"
    ],
    "monitoring": ["Blue sticky cards near canopy", "Tap test over white paper"]
  },
  "controlOptions": {
    "biological": ["Orius spp.", "Amblyseius cucumeris"],
    "cultural": ["Remove weeds/volunteers", "Screen intakes"],
    "mechanical": ["Sticky cards mass-trapping"],
    "chemical": ["Spinosad where allowed", "Soaps and oils (rotate)"]
  }
}
```

## /data/blueprints/pests/whiteflies.json

```json
{
  "id": "ac38b09c-d963-4dd4-b105-54c8f4ba30b6",
  "kind": "Pest",
  "name": "Whiteflies",
  "category": "sap-sucking",
  "targets": ["leaves"],
  "environmentalRisk": {
    "temperatureRange": [22, 30],
    "humidityRange": [0.4, 0.8]
  },
  "populationDynamics": {
    "dailyReproductionRate": 0.28,
    "dailyMortalityRate": 0.06,
    "carryingCapacity": 1.0
  },
  "damageModel": {
    "photosynthesisReductionPerDay": 0.1,
    "rootUptakeReductionPerDay": 0.0,
    "budLossFractionPerDay": 0.0,
    "diseaseVectorRisk": 0.4,
    "honeydew": true
  },
  "detection": {
    "symptoms": [
      "Adults fly up when disturbed",
      "Sticky honeydew, sooty mold",
      "Leaf yellowing and drop"
    ],
    "monitoring": ["Yellow sticky cards just above canopy", "Check leaf undersides for nymphs"]
  },
  "controlOptions": {
    "biological": ["Encarsia formosa", "Eretmocerus spp."],
    "cultural": ["Sanitation, remove lower leaves", "Screen air intakes"],
    "mechanical": ["Vacuum adults routinely"],
    "chemical": ["Soaps/oils (rotate modes)"]
  }
}
```

## /data/blueprints/roomPurposes/breakroom.json

```json
{
  "id": "5ab7d9ac-f14a-45d9-b5f9-908182ca4a02",
  "kind": "breakroom",
  "name": "Break Room",
  "description": "A space for employees to rest and recover energy.",
  "flags": {
    "supportsRest": true,
    "staffOnly": true
  },
  "economy": {
    "areaCost": 280,
    "baseRentPerTick": 1.5
  }
}
```

## /data/blueprints/roomPurposes/growroom.json

```json
{
  "id": "2630459c-fc40-4e91-a69f-b47665b5a917",
  "kind": "growroom",
  "name": "Grow Room",
  "description": "A room designed for cultivating plants under controlled conditions.",
  "flags": {
    "supportsCultivation": true,
    "requiresControlledEnvironment": true
  },
  "economy": {
    "areaCost": 950,
    "baseRentPerTick": 4.8
  }
}
```

## /data/blueprints/roomPurposes/lab.json

```json
{
  "id": "05566944-af3c-40f5-9d22-2cbe701457c7",
  "kind": "lab",
  "name": "Laboratory",
  "description": "A facility for research and breeding new plant strains.",
  "flags": {
    "supportsResearch": true,
    "requiresSterileAccess": true
  },
  "economy": {
    "areaCost": 1200,
    "baseRentPerTick": 5.5
  }
}
```

## /data/blueprints/roomPurposes/salesroom.json

```json
{
  "id": "828aa416-37be-4176-bfa6-9ce847e9dfd5",
  "kind": "salesroom",
  "name": "Sales Room",
  "description": "A commercial space for selling harvested products.",
  "flags": {
    "customerFacing": true,
    "requiresPointOfSale": true
  },
  "economy": {
    "areaCost": 600,
    "baseRentPerTick": 3.2
  }
}
```

## /data/blueprints/strains/ak-47.json

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "slug": "ak47",
  "name": "AK-47",
  "lineage": {
    "parents": []
  },
  "genotype": {
    "sativa": 0.65,
    "indica": 0.35,
    "ruderalis": 0.0
  },
  "generalResilience": 0.7,
  "germinationRate": 0.95,
  "chemotype": {
    "thcContent": 0.2,
    "cbdContent": 0.01
  },
  "morphology": {
    "growthRate": 1.0,
    "yieldFactor": 1.0,
    "leafAreaIndex": 3.2
  },
  "growthModel": {
    "maxBiomassDry": 0.18,
    "baseLightUseEfficiency": 0.0009,
    "maintenanceFracPerDay": 0.01,
    "dryMatterFraction": {
      "vegetation": 0.25,
      "flowering": 0.2
    },
    "harvestIndex": {
      "targetFlowering": 0.7
    },
    "phaseCapMultiplier": {
      "vegetation": 0.5,
      "flowering": 1.0
    },
    "temperature": {
      "Q10": 2.0,
      "T_ref_C": 25
    }
  },
  "noise": {
    "enabled": true,
    "pct": 0.02
  },
  "environmentalPreferences": {
    "lightSpectrum": {
      "vegetation": [400, 700],
      "flowering": [300, 650]
    },
    "lightIntensity": {
      "vegetation": [400, 600],
      "flowering": [600, 1000]
    },
    "lightCycle": {
      "vegetation": [18, 6],
      "flowering": [12, 12]
    },
    "idealTemperature": {
      "vegetation": [20, 28],
      "flowering": [22, 30]
    },
    "idealHumidity": {
      "vegetation": [0.6, 0.7],
      "flowering": [0.5, 0.6]
    },
    "phRange": [5.8, 6.2]
  },
  "nutrientDemand": {
    "dailyNutrientDemand": {
      "seedling": {
        "nitrogen": 0.03,
        "phosphorus": 0.02,
        "potassium": 0.03
      },
      "vegetation": {
        "nitrogen": 0.12,
        "phosphorus": 0.06,
        "potassium": 0.1
      },
      "flowering": {
        "nitrogen": 0.07,
        "phosphorus": 0.14,
        "potassium": 0.16
      }
    },
    "npkTolerance": 0.15,
    "npkStressIncrement": 0.04
  },
  "waterDemand": {
    "dailyWaterUsagePerSquareMeter": {
      "seedling": 0.15,
      "vegetation": 0.36,
      "flowering": 0.54
    },
    "minimumFractionRequired": 0.15
  },
  "diseaseResistance": {
    "dailyInfectionIncrement": 0.03,
    "infectionThreshold": 0.4,
    "recoveryRate": 0.01,
    "degenerationRate": 0.01,
    "regenerationRate": 0.005,
    "fatalityThreshold": 0.95
  },
  "photoperiod": {
    "vegetationTime": 2419200,
    "floweringTime": 5443200,
    "transitionTrigger": 43200
  },
  "stageChangeThresholds": {
    "vegetative": {
      "minLightHours": 300,
      "maxStressForStageChange": 0.3
    },
    "flowering": {
      "minLightHours": 600,
      "maxStressForStageChange": 0.2
    }
  },
  "harvestWindow": [5184000, 6480000],
  "harvestProperties": {
    "ripeningTime": 172800,
    "maxStorageTime": 432000,
    "qualityDecayRate": 5.555555555555556e-6
  },
  "meta": {
    "description": "AK-47 is a classic hybrid cannabis strain known for its high THC levels and fast flowering. It combines strong sativa effects with compact indica growth.",
    "advantages": ["High THC potential", "Reliable yields", "Adaptable to indoor systems"],
    "disadvantages": [
      "Humidity-sensitive during flowering",
      "Not ideal for low-light environments"
    ],
    "notes": "Popular choice for both commercial grows and personal use due to its balance."
  }
}
```

## /data/blueprints/strains/northern-lights.json

```json
{
  "id": "3f0f15f4-1b75-4196-b3f3-5f6b6b7cf7a7",
  "slug": "northern_lights",
  "name": "Northern Lights",
  "photoperiodic": true,
  "vegDays": 28,
  "flowerDays": 50,
  "autoFlowerDays": null,
  "light": {
    "ppfdOpt_umol_m2s": 650,
    "ppfdMax_umol_m2s": 1000,
    "dliHalfSat_mol_m2d": 18,
    "dliMax_mol_m2d": 38
  },
  "coeffs": {
    "budGrowthBase_g_per_day": 1.4,
    "tempOptC": 25,
    "tempWidthC": 5.5,
    "co2HalfSat_ppm": 800
  },
  "lineage": {
    "parents": []
  },
  "genotype": {
    "sativa": 0.65,
    "indica": 0.35,
    "ruderalis": 0.0
  },
  "generalResilience": 0.7,
  "germinationRate": 0.98,
  "chemotype": {
    "thcContent": 0.2,
    "cbdContent": 0.01
  },
  "morphology": {
    "growthRate": 1.0,
    "yieldFactor": 1.0,
    "leafAreaIndex": 3.2
  },
  "growthModel": {
    "maxBiomassDry": 0.18,
    "baseLightUseEfficiency": 0.0009,
    "maintenanceFracPerDay": 0.01,
    "dryMatterFraction": {
      "vegetation": 0.25,
      "flowering": 0.2
    },
    "harvestIndex": {
      "targetFlowering": 0.7
    },
    "phaseCapMultiplier": {
      "vegetation": 0.5,
      "flowering": 1.0
    },
    "temperature": {
      "Q10": 2.0,
      "T_ref_C": 25
    }
  },
  "noise": {
    "enabled": true,
    "pct": 0.02
  },
  "environmentalPreferences": {
    "lightSpectrum": {
      "vegetation": [400, 700],
      "flowering": [300, 650]
    },
    "lightIntensity": {
      "vegetation": [400, 600],
      "flowering": [600, 1000]
    },
    "lightCycle": {
      "vegetation": [18, 6],
      "flowering": [12, 12]
    },
    "idealTemperature": {
      "vegetation": [20, 28],
      "flowering": [22, 30]
    },
    "idealHumidity": {
      "vegetation": [0.6, 0.7],
      "flowering": [0.5, 0.6]
    },
    "phRange": [5.8, 6.2]
  },
  "nutrientDemand": {
    "dailyNutrientDemand": {
      "seedling": {
        "nitrogen": 0.03,
        "phosphorus": 0.02,
        "potassium": 0.03
      },
      "vegetation": {
        "nitrogen": 0.12,
        "phosphorus": 0.06,
        "potassium": 0.1
      },
      "flowering": {
        "nitrogen": 0.07,
        "phosphorus": 0.14,
        "potassium": 0.16
      }
    },
    "npkTolerance": 0.15,
    "npkStressIncrement": 0.04
  },
  "waterDemand": {
    "dailyWaterUsagePerSquareMeter": {
      "seedling": 0.15,
      "vegetation": 0.36,
      "flowering": 0.54
    },
    "minimumFractionRequired": 0.15
  },
  "diseaseResistance": {
    "dailyInfectionIncrement": 0.03,
    "infectionThreshold": 0.4,
    "recoveryRate": 0.01,
    "degenerationRate": 0.01,
    "regenerationRate": 0.005,
    "fatalityThreshold": 0.95
  },
  "photoperiod": {
    "vegetationTime": 2419200,
    "floweringTime": 4320000,
    "transitionTrigger": 43200
  },
  "stageChangeThresholds": {
    "vegetative": {
      "minLightHours": 300,
      "maxStressForStageChange": 0.3
    },
    "flowering": {
      "minLightHours": 600,
      "maxStressForStageChange": 0.2
    }
  },
  "harvestWindow": [4147200, 5184000],
  "harvestProperties": {
    "ripeningTime": 172800,
    "maxStorageTime": 432000,
    "qualityDecayRate": 5.555555555555556e-6
  },
  "meta": {
    "description": "Northern Lights is a legendary indica strain prized for its resilience and fast flowering time.",
    "advantages": ["Compact growth", "Resistant to stress", "Classic indica effects"],
    "disadvantages": ["Moderate yields", "Prefers stable climates"],
    "notes": "Often used as a baseline in breeding projects."
  }
}
```

## /data/blueprints/strains/skunk-1.json

```json
{
  "id": "5a6e9e57-0b3a-4f9f-8f19-12f3f8ec3a0e",
  "slug": "skunk_1",
  "name": "Skunk #1",
  "photoperiodic": true,
  "vegDays": 30,
  "flowerDays": 55,
  "autoFlowerDays": null,
  "light": {
    "ppfdOpt_umol_m2s": 700,
    "ppfdMax_umol_m2s": 1100,
    "dliHalfSat_mol_m2d": 21,
    "dliMax_mol_m2d": 41
  },
  "coeffs": {
    "budGrowthBase_g_per_day": 1.7,
    "tempOptC": 26,
    "tempWidthC": 6,
    "co2HalfSat_ppm": 900
  },
  "lineage": {
    "parents": []
  },
  "genotype": {
    "sativa": 0.65,
    "indica": 0.35,
    "ruderalis": 0.0
  },
  "generalResilience": 0.7,
  "germinationRate": 0.96,
  "chemotype": {
    "thcContent": 0.2,
    "cbdContent": 0.01
  },
  "morphology": {
    "growthRate": 1.0,
    "yieldFactor": 1.0,
    "leafAreaIndex": 3.2
  },
  "growthModel": {
    "maxBiomassDry": 0.18,
    "baseLightUseEfficiency": 0.0009,
    "maintenanceFracPerDay": 0.01,
    "dryMatterFraction": {
      "vegetation": 0.25,
      "flowering": 0.2
    },
    "harvestIndex": {
      "targetFlowering": 0.7
    },
    "phaseCapMultiplier": {
      "vegetation": 0.5,
      "flowering": 1.0
    },
    "temperature": {
      "Q10": 2.0,
      "T_ref_C": 25
    }
  },
  "noise": {
    "enabled": true,
    "pct": 0.02
  },
  "environmentalPreferences": {
    "lightSpectrum": {
      "vegetation": [400, 700],
      "flowering": [300, 650]
    },
    "lightIntensity": {
      "vegetation": [400, 600],
      "flowering": [600, 1000]
    },
    "lightCycle": {
      "vegetation": [18, 6],
      "flowering": [12, 12]
    },
    "idealTemperature": {
      "vegetation": [20, 28],
      "flowering": [22, 30]
    },
    "idealHumidity": {
      "vegetation": [0.6, 0.7],
      "flowering": [0.5, 0.6]
    },
    "phRange": [5.8, 6.2]
  },
  "nutrientDemand": {
    "dailyNutrientDemand": {
      "seedling": {
        "nitrogen": 0.03,
        "phosphorus": 0.02,
        "potassium": 0.03
      },
      "vegetation": {
        "nitrogen": 0.12,
        "phosphorus": 0.06,
        "potassium": 0.1
      },
      "flowering": {
        "nitrogen": 0.07,
        "phosphorus": 0.14,
        "potassium": 0.16
      }
    },
    "npkTolerance": 0.15,
    "npkStressIncrement": 0.04
  },
  "waterDemand": {
    "dailyWaterUsagePerSquareMeter": {
      "seedling": 0.15,
      "vegetation": 0.36,
      "flowering": 0.54
    },
    "minimumFractionRequired": 0.15
  },
  "diseaseResistance": {
    "dailyInfectionIncrement": 0.03,
    "infectionThreshold": 0.4,
    "recoveryRate": 0.01,
    "degenerationRate": 0.01,
    "regenerationRate": 0.005,
    "fatalityThreshold": 0.95
  },
  "photoperiod": {
    "vegetationTime": 2592000,
    "floweringTime": 4752000,
    "transitionTrigger": 43200
  },
  "stageChangeThresholds": {
    "vegetative": {
      "minLightHours": 300,
      "maxStressForStageChange": 0.3
    },
    "flowering": {
      "minLightHours": 600,
      "maxStressForStageChange": 0.2
    }
  },
  "harvestWindow": [4752000, 5616000],
  "harvestProperties": {
    "ripeningTime": 172800,
    "maxStorageTime": 432000,
    "qualityDecayRate": 5.555555555555556e-6
  },
  "meta": {
    "description": "Skunk #1 set the standard for modern hybrids with its skunky aroma and balanced growth.",
    "advantages": ["Stable genetics", "Fast flowering", "Classic flavor"],
    "disadvantages": ["Strong odor", "Can stretch in veg"],
    "notes": "Widely used as a benchmark strain since the 1970s."
  }
}
```

## /data/blueprints/strains/sour-diesel.json

```json
{
  "id": "8b9a0b6c-2d6c-4f58-9c37-7a6c9d4aa5c2",
  "slug": "sour_diesel",
  "name": "Sour Diesel",
  "photoperiodic": true,
  "vegDays": 36,
  "flowerDays": 70,
  "autoFlowerDays": null,
  "light": {
    "ppfdOpt_umol_m2s": 850,
    "ppfdMax_umol_m2s": 1250,
    "dliHalfSat_mol_m2d": 27,
    "dliMax_mol_m2d": 48
  },
  "coeffs": {
    "budGrowthBase_g_per_day": 1.9,
    "tempOptC": 26.5,
    "tempWidthC": 6.5,
    "co2HalfSat_ppm": 950
  },
  "lineage": {
    "parents": []
  },
  "genotype": {
    "sativa": 0.65,
    "indica": 0.35,
    "ruderalis": 0.0
  },
  "generalResilience": 0.7,
  "germinationRate": 0.92,
  "chemotype": {
    "thcContent": 0.2,
    "cbdContent": 0.01
  },
  "morphology": {
    "growthRate": 1.0,
    "yieldFactor": 1.0,
    "leafAreaIndex": 3.2
  },
  "growthModel": {
    "maxBiomassDry": 0.18,
    "baseLightUseEfficiency": 0.0009,
    "maintenanceFracPerDay": 0.01,
    "dryMatterFraction": {
      "vegetation": 0.25,
      "flowering": 0.2
    },
    "harvestIndex": {
      "targetFlowering": 0.7
    },
    "phaseCapMultiplier": {
      "vegetation": 0.5,
      "flowering": 1.0
    },
    "temperature": {
      "Q10": 2.0,
      "T_ref_C": 25
    }
  },
  "noise": {
    "enabled": true,
    "pct": 0.02
  },
  "environmentalPreferences": {
    "lightSpectrum": {
      "vegetation": [400, 700],
      "flowering": [300, 650]
    },
    "lightIntensity": {
      "vegetation": [400, 600],
      "flowering": [600, 1000]
    },
    "lightCycle": {
      "vegetation": [18, 6],
      "flowering": [12, 12]
    },
    "idealTemperature": {
      "vegetation": [20, 28],
      "flowering": [22, 30]
    },
    "idealHumidity": {
      "vegetation": [0.6, 0.7],
      "flowering": [0.5, 0.6]
    },
    "phRange": [5.8, 6.2]
  },
  "nutrientDemand": {
    "dailyNutrientDemand": {
      "seedling": {
        "nitrogen": 0.03,
        "phosphorus": 0.02,
        "potassium": 0.03
      },
      "vegetation": {
        "nitrogen": 0.12,
        "phosphorus": 0.06,
        "potassium": 0.1
      },
      "flowering": {
        "nitrogen": 0.07,
        "phosphorus": 0.14,
        "potassium": 0.16
      }
    },
    "npkTolerance": 0.15,
    "npkStressIncrement": 0.04
  },
  "waterDemand": {
    "dailyWaterUsagePerSquareMeter": {
      "seedling": 0.15,
      "vegetation": 0.36,
      "flowering": 0.54
    },
    "minimumFractionRequired": 0.15
  },
  "diseaseResistance": {
    "dailyInfectionIncrement": 0.03,
    "infectionThreshold": 0.4,
    "recoveryRate": 0.01,
    "degenerationRate": 0.01,
    "regenerationRate": 0.005,
    "fatalityThreshold": 0.95
  },
  "photoperiod": {
    "vegetationTime": 3110400,
    "floweringTime": 6048000,
    "transitionTrigger": 43200
  },
  "stageChangeThresholds": {
    "vegetative": {
      "minLightHours": 300,
      "maxStressForStageChange": 0.3
    },
    "flowering": {
      "minLightHours": 600,
      "maxStressForStageChange": 0.2
    }
  },
  "harvestWindow": [5616000, 6912000],
  "harvestProperties": {
    "ripeningTime": 172800,
    "maxStorageTime": 432000,
    "qualityDecayRate": 5.555555555555556e-6
  },
  "meta": {
    "description": "Sour Diesel delivers pungent aromas and energizing effects, popular among sativa enthusiasts.",
    "advantages": ["High vigor", "Strong aroma", "Excellent for daytime use"],
    "disadvantages": ["Long flowering period", "Requires ample light"],
    "notes": "Originates from the U.S. East Coast underground scene."
  }
}
```

## /data/blueprints/strains/white-widow.json

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440001",
  "slug": "white_widow",
  "name": "White Widow",
  "lineage": {
    "parents": []
  },
  "genotype": {
    "sativa": 0.5,
    "indica": 0.5,
    "ruderalis": 0.0
  },
  "generalResilience": 0.75,
  "germinationRate": 0.97,
  "chemotype": {
    "thcContent": 0.18,
    "cbdContent": 0.02
  },
  "morphology": {
    "growthRate": 0.95,
    "yieldFactor": 1.1,
    "leafAreaIndex": 3.0
  },
  "growthModel": {
    "maxBiomassDry": 0.18,
    "baseLightUseEfficiency": 0.0009,
    "maintenanceFracPerDay": 0.01,
    "dryMatterFraction": {
      "vegetation": 0.25,
      "flowering": 0.2
    },
    "harvestIndex": {
      "targetFlowering": 0.7
    },
    "phaseCapMultiplier": {
      "vegetation": 0.5,
      "flowering": 1.0
    },
    "temperature": {
      "Q10": 2.0,
      "T_ref_C": 25
    }
  },
  "noise": {
    "enabled": true,
    "pct": 0.02
  },
  "environmentalPreferences": {
    "lightSpectrum": {
      "vegetation": [400, 700],
      "flowering": [300, 650]
    },
    "lightIntensity": {
      "vegetation": [350, 550],
      "flowering": [550, 950]
    },
    "lightCycle": {
      "vegetation": [18, 6],
      "flowering": [12, 12]
    },
    "idealTemperature": {
      "vegetation": [21, 27],
      "flowering": [20, 26]
    },
    "idealHumidity": {
      "vegetation": [0.55, 0.65],
      "flowering": [0.45, 0.55]
    },
    "phRange": [5.8, 6.2]
  },
  "nutrientDemand": {
    "dailyNutrientDemand": {
      "seedling": {
        "nitrogen": 0.03,
        "phosphorus": 0.02,
        "potassium": 0.03
      },
      "vegetation": {
        "nitrogen": 0.11,
        "phosphorus": 0.07,
        "potassium": 0.11
      },
      "flowering": {
        "nitrogen": 0.06,
        "phosphorus": 0.15,
        "potassium": 0.15
      }
    },
    "npkTolerance": 0.2,
    "npkStressIncrement": 0.035
  },
  "waterDemand": {
    "dailyWaterUsagePerSquareMeter": {
      "seedling": 0.14,
      "vegetation": 0.34,
      "flowering": 0.51
    },
    "minimumFractionRequired": 0.15
  },
  "diseaseResistance": {
    "dailyInfectionIncrement": 0.025,
    "infectionThreshold": 0.45,
    "recoveryRate": 0.012,
    "degenerationRate": 0.01,
    "regenerationRate": 0.006,
    "fatalityThreshold": 0.95
  },
  "photoperiod": {
    "vegetationTime": 2419200,
    "floweringTime": 5184000,
    "transitionTrigger": 43200
  },
  "stageChangeThresholds": {
    "vegetative": {
      "minLightHours": 320,
      "maxStressForStageChange": 0.35
    },
    "flowering": {
      "minLightHours": 620,
      "maxStressForStageChange": 0.25
    }
  },
  "harvestWindow": [5011200, 6048000],
  "harvestProperties": {
    "ripeningTime": 172800,
    "maxStorageTime": 432000,
    "qualityDecayRate": 5.555555555555556e-6
  },
  "meta": {
    "description": "White Widow is a balanced hybrid strain, a cross between a Brazilian sativa landrace and a resin-heavy South Indian indica. It is known for its resin production and relatively easy growth.",
    "advantages": ["High resin production", "Balanced effects", "Good for beginners"],
    "disadvantages": ["Can be sensitive to nutrients", "Prefers stable temperatures"],
    "notes": "A classic Dutch coffee-shop strain that remains popular worldwide."
  }
}
```

## /data/blueprints/structures/medium_warehouse.json

```json
{
  "id": "59ec5597-42f5-4e52-acb9-cb65d68fd72d",
  "name": "Medium Warehouse",
  "footprint": {
    "length_m": 40,
    "width_m": 60,
    "height_m": 3
  },
  "rentalCostPerSqmPerMonth": 10,
  "upfrontFee": 1500
}
```

## /data/blueprints/structures/shed.json

```json
{
  "id": "d96dd659-4678-4d5d-a97c-a590ab52c2f2",
  "name": "Shed",
  "footprint": {
    "length_m": 6,
    "width_m": 5,
    "height_m": 3
  },
  "rentalCostPerSqmPerMonth": 1,
  "upfrontFee": 50
}
```

## /data/blueprints/structures/small_warehouse.json

```json
{
  "id": "43ee4095-627d-4a0c-860b-b10affbcf603",
  "name": "Small Warehouse",
  "footprint": {
    "length_m": 20,
    "width_m": 20,
    "height_m": 3
  },
  "rentalCostPerSqmPerMonth": 10,
  "upfrontFee": 500
}
```

## configs/difficulty.json

```json
{
  "easy": {
    "name": "Easy",
    "description": "A relaxed experience with more resilient plants, reliable equipment, and favorable economic conditions.",
    "modifiers": {
      "plantStress": {
        "optimalRangeMultiplier": 1.2,
        "stressAccumulationMultiplier": 0.8
      },
      "deviceFailure": {
        "mtbfMultiplier": 1.5
      },
      "economics": {
        "initialCapital": 2000000,
        "itemPriceMultiplier": 0.9,
        "harvestPriceMultiplier": 1.1,
        "rentPerSqmStructurePerTick": 0.1,
        "rentPerSqmRoomPerTick": 0.2
      }
    }
  },
  "normal": {
    "name": "Normal",
    "description": "A balanced simulation reflecting standard conditions.",
    "modifiers": {
      "plantStress": {
        "optimalRangeMultiplier": 1.0,
        "stressAccumulationMultiplier": 1.0
      },
      "deviceFailure": {
        "mtbfMultiplier": 1.0
      },
      "economics": {
        "initialCapital": 1500000,
        "itemPriceMultiplier": 1.0,
        "harvestPriceMultiplier": 1.0,
        "rentPerSqmStructurePerTick": 0.15,
        "rentPerSqmRoomPerTick": 0.3
      }
    }
  },
  "hard": {
    "name": "Hard",
    "description": "A challenging simulation with sensitive plants, less reliable equipment, and tighter economic constraints.",
    "modifiers": {
      "plantStress": {
        "optimalRangeMultiplier": 0.8,
        "stressAccumulationMultiplier": 1.2
      },
      "deviceFailure": {
        "mtbfMultiplier": 0.75
      },
      "economics": {
        "initialCapital": 1000000,
        "itemPriceMultiplier": 1.1,
        "harvestPriceMultiplier": 0.9,
        "rentPerSqmStructurePerTick": 0.2,
        "rentPerSqmRoomPerTick": 0.4
      }
    }
  }
}
```

## configs/disease_balancing.json

```json
{
  "kind": "DiseaseBalancing",
  "version": "1.0.0",
  "notes": "Phase- and environment-level multipliers for disease progression and recovery; values are normalized (0..1) or unitless multipliers.",
  "global": {
    "baseDailyInfectionMultiplier": 1.0,
    "baseRecoveryMultiplier": 1.0,
    "maxConcurrentDiseases": 2,
    "symptomDelayDays": {
      "min": 1,
      "max": 5
    },
    "eventWeights": {
      "emitOnThresholdCross": 1.0,
      "emitOnFatality": 1.0
    }
  },
  "phaseMultipliers": {
    "seedling": {
      "infection": 1.2,
      "degeneration": 1.1,
      "recovery": 0.85
    },
    "vegetation": {
      "infection": 1.0,
      "degeneration": 1.0,
      "recovery": 1.0
    },
    "earlyFlower": {
      "infection": 1.1,
      "degeneration": 1.2,
      "recovery": 0.95
    },
    "lateFlower": {
      "infection": 1.3,
      "degeneration": 1.4,
      "recovery": 0.8
    },
    "ripening": {
      "infection": 1.1,
      "degeneration": 1.5,
      "recovery": 0.75
    }
  },
  "environmentModifiers": {
    "relativeHumidity": {
      "sensitivity": 1.0,
      "optimalRange": [0.5, 0.65],
      "aboveOptimalInfectionMultPer+0.05": 1.1,
      "belowOptimalInfectionMultPer-0.05": 1.05
    },
    "temperature": {
      "sensitivity": 0.8,
      "optimalRange": [22, 26],
      "distanceToOptimalMultPer+2C": 1.05
    },
    "leafWetness": {
      "sensitivity": 1.2,
      "wetnessBonusInfectionMultiplier": 1.25
    },
    "airflow": {
      "lowAirflowRiskMultiplier": 1.15,
      "goodAirflowRecoveryMultiplier": 1.1
    }
  },
  "strainResistanceWeights": {
    "generalResilienceWeight": 0.7,
    "specificResistanceWeight": 0.3
  },
  "treatmentEfficacy": {
    "cultural": {
      "infectionMultiplier": 0.9,
      "degenerationMultiplier": 0.95,
      "recoveryMultiplier": 1.05
    },
    "biological": {
      "infectionMultiplier": 0.85,
      "degenerationMultiplier": 0.9,
      "recoveryMultiplier": 1.1
    },
    "mechanical": {
      "infectionMultiplier": 0.8,
      "degenerationMultiplier": 0.85,
      "recoveryMultiplier": 1.05
    },
    "chemical": {
      "infectionMultiplier": 0.7,
      "degenerationMultiplier": 0.8,
      "recoveryMultiplier": 1.15
    }
  },
  "caps": {
    "minDailyDegeneration": 0.0,
    "maxDailyDegeneration": 0.2,
    "minDailyRecovery": 0.0,
    "maxDailyRecovery": 0.2
  },
  "integrationHints": {
    "applyOrder": [
      "phaseMultipliers",
      "environmentModifiers",
      "strainResistanceWeights",
      "treatmentEfficacy",
      "caps"
    ],
    "mapToDiseaseModel": {
      "dailyInfectionIncrement": "× global.baseDailyInfectionMultiplier × phaseMultipliers.*.infection × environmentModifiers.* × (1 - resistance)",
      "degenerationRate": "× phaseMultipliers.*.degeneration × treatmentEfficacy.*.degenerationMultiplier → clamp caps",
      "recoveryRate": "× phaseMultipliers.*.recovery × treatmentEfficacy.*.recoveryMultiplier → clamp caps"
    }
  }
}
```

## configs/pest_balancing.json

```json
{
  "kind": "PestBalancing",
  "version": "1.0.0",
  "notes": "Population growth, damage and control multipliers for pests; normalized values and unitless multipliers.",
  "global": {
    "baseDailyReproductionMultiplier": 1.0,
    "baseDailyMortalityMultiplier": 1.0,
    "baseDamageMultiplier": 1.0,
    "maxConcurrentPests": 3,
    "economicThresholds": {
      "photosynthesisReductionAlert": 0.08,
      "rootUptakeReductionAlert": 0.12,
      "budLossAlert": 0.02
    },
    "eventWeights": {
      "emitOnOutbreak": 1.0,
      "emitOnControlSuccess": 1.0
    }
  },
  "phaseMultipliers": {
    "seedling": {
      "reproduction": 1.1,
      "damage": 1.15,
      "mortality": 0.95
    },
    "vegetation": {
      "reproduction": 1.0,
      "damage": 1.0,
      "mortality": 1.0
    },
    "earlyFlower": {
      "reproduction": 1.05,
      "damage": 1.15,
      "mortality": 0.95
    },
    "lateFlower": {
      "reproduction": 1.1,
      "damage": 1.3,
      "mortality": 0.9
    },
    "ripening": {
      "reproduction": 0.95,
      "damage": 1.4,
      "mortality": 0.95
    }
  },
  "environmentModifiers": {
    "relativeHumidity": {
      "hotDryBoostForMitesAtRH<0.45": 1.2,
      "wetMediaBoostForGnatsAtRH>0.70": 1.25
    },
    "temperature": {
      "warmBoostForMitesAtT>26": 1.15,
      "coolSlowdownForWhitefliesAtT<20": 0.85
    },
    "substrate": {
      "overwateringBoost": 1.3,
      "goodDrainageMortalityBoost": 1.1
    },
    "airflow": {
      "lowAirflowReproductionBoost": 1.1
    }
  },
  "naturalEnemies": {
    "backgroundPredationPerDay": 0.03,
    "enhancedPredationWithBiocontrol": 0.12
  },
  "controlEfficacy": {
    "biological": {
      "reproductionMultiplier": 0.8,
      "mortalityMultiplier": 1.2,
      "damageMultiplier": 0.9
    },
    "cultural": {
      "reproductionMultiplier": 0.9,
      "mortalityMultiplier": 1.05,
      "damageMultiplier": 0.95
    },
    "mechanical": {
      "reproductionMultiplier": 0.85,
      "mortalityMultiplier": 1.1,
      "damageMultiplier": 0.9
    },
    "chemical": {
      "reproductionMultiplier": 0.7,
      "mortalityMultiplier": 1.3,
      "damageMultiplier": 0.8
    }
  },
  "diseaseInteraction": {
    "vectorRiskToInfectionMultiplier": 1.15,
    "honeydewToMoldRiskMultiplier": 1.2
  },
  "caps": {
    "minDailyReproduction": 0.0,
    "maxDailyReproduction": 0.6,
    "minDailyMortality": 0.0,
    "maxDailyMortality": 0.6,
    "minDailyDamage": 0.0,
    "maxDailyDamage": 0.4
  },
  "integrationHints": {
    "applyOrder": [
      "phaseMultipliers",
      "environmentModifiers",
      "naturalEnemies",
      "controlEfficacy",
      "caps"
    ],
    "mapToPestModel": {
      "populationGrowth": "populationDynamics.dailyReproductionRate × global.baseDailyReproductionMultiplier × phaseMultipliers.*.reproduction × envMods → − mortality",
      "mortality": "populationDynamics.dailyMortalityRate × global.baseDailyMortalityMultiplier × phaseMultipliers.*.mortality × (1 + naturalEnemies.backgroundPredationPerDay)",
      "damage": "damageModel.* × global.baseDamageMultiplier × phaseMultipliers.*.damage × controlEfficacy.*.damageMultiplier → clamp caps"
    }
  }
}
```

## configs/task_definitions.json

```json
{
  "repair_device": {
    "costModel": { "basis": "perAction", "laborMinutes": 90 },
    "priority": 100,
    "requiredRole": "Technician",
    "requiredSkill": "Maintenance",
    "minSkillLevel": 2,
    "description": "Repair {deviceName} in {zoneName}"
  },
  "maintain_device": {
    "costModel": { "basis": "perAction", "laborMinutes": 30 },
    "priority": 30,
    "requiredRole": "Technician",
    "requiredSkill": "Maintenance",
    "minSkillLevel": 4,
    "description": "Maintain {deviceName} in {zoneName}"
  },
  "harvest_plants": {
    "costModel": { "basis": "perPlant", "laborMinutes": 5 },
    "priority": 90,
    "requiredRole": "Gardener",
    "requiredSkill": "Gardening",
    "minSkillLevel": 0,
    "description": "Harvest {plantCount} plants in {zoneName}"
  },
  "refill_supplies_water": {
    "costModel": { "basis": "perAction", "laborMinutes": 15 },
    "priority": 80,
    "requiredRole": "Gardener",
    "requiredSkill": "Gardening",
    "minSkillLevel": 0,
    "description": "Refill water in {zoneName}"
  },
  "refill_supplies_nutrients": {
    "costModel": { "basis": "perAction", "laborMinutes": 15 },
    "priority": 80,
    "requiredRole": "Gardener",
    "requiredSkill": "Gardening",
    "minSkillLevel": 0,
    "description": "Refill nutrients in {zoneName}"
  },
  "clean_zone": {
    "costModel": { "basis": "perSquareMeter", "laborMinutes": 1 },
    "priority": 60,
    "requiredRole": "Janitor",
    "requiredSkill": "Cleanliness",
    "minSkillLevel": 0,
    "description": "Clean {zoneName} ({area}m²)"
  },
  "overhaul_zone_substrate": {
    "costModel": { "basis": "perSquareMeter", "laborMinutes": 5 },
    "priority": 70,
    "requiredRole": "Janitor",
    "requiredSkill": "Cleanliness",
    "minSkillLevel": 2,
    "description": "Overhaul substrate in {zoneName} ({area}m²)"
  },
  "reset_light_cycle": {
    "costModel": { "basis": "perAction", "laborMinutes": 5 },
    "priority": 50,
    "requiredRole": "Gardener",
    "requiredSkill": "Gardening",
    "minSkillLevel": 0,
    "description": "Reset light cycle in {zoneName}"
  },
  "execute_planting_plan": {
    "costModel": { "basis": "perPlant", "laborMinutes": 2 },
    "priority": 40,
    "requiredRole": "Gardener",
    "requiredSkill": "Gardening",
    "minSkillLevel": 0,
    "description": "Plant {plantCount} seedlings in {zoneName}"
  },
  "adjust_light_cycle": {
    "costModel": { "basis": "perAction", "laborMinutes": 5 },
    "priority": 80,
    "requiredRole": "Gardener",
    "requiredSkill": "Gardening",
    "minSkillLevel": 3,
    "description": "Adjust light cycle in {zoneName} for flowering"
  },
  "apply_treatment": {
    "costModel": { "basis": "perPlant", "laborMinutes": 4 },
    "priority": 90,
    "requiredRole": "Gardener",
    "requiredSkill": "Gardening",
    "minSkillLevel": 2,
    "description": "Apply {treatmentName} to affected plants in {zoneName}"
  }
}
```

## configs/treatment_options.json

```json
{
  "kind": "TreatmentOptions",
  "version": "1.1.0",
  "notes": "Unified treatment catalogue for diseases and pests. All efficacy values are multipliers applied on top of blueprint/balancing values. Values <1 reduce infection/reproduction/damage; values >1 increase recovery/mortality. Costs: materialsCost uses a costBasis to scale to the actual application size.",
  "global": {
    "stackingRules": {
      "maxConcurrentTreatmentsPerZone": 3,
      "mechanicalAlwaysStacks": true,
      "chemicalAndBiologicalCantShareSameMoAWithin7Days": true,
      "cooldownDaysDefault": 3
    },
    "sideEffects": {
      "phytotoxicityRiskKeys": ["oilOnBloom", "uvcOnTenderLeaves"],
      "beneficialsHarmRiskKeys": ["broadSpectrumInsecticide", "sulfurHighDose"]
    },
    "costModel": {
      "costBasis": {
        "perZone": "materialsCost applies once per application for the entire zone (scaleFactor=1).",
        "perPlant": "materialsCost is multiplied by the number of plants in the treated zone.",
        "perSquareMeter": "materialsCost is multiplied by the zone area in square meters."
      },
      "totalCostFormula": "totalCost = (materialsCost × scaleFactor) + laborMinutes×wageRate + optionalEnergy + optionalEquipment"
    }
  },
  "options": [
    {
      "id": "defbc266-d4a8-4d1d-bb90-c603ea4574d6",
      "name": "Increase Airflow",
      "category": "cultural",
      "targets": ["disease", "pest"],
      "applicability": ["seedling", "vegetation", "earlyFlower", "lateFlower", "ripening"],
      "efficacy": {
        "disease": {
          "infectionMultiplier": 0.92,
          "degenerationMultiplier": 0.95,
          "recoveryMultiplier": 1.05
        },
        "pest": {
          "reproductionMultiplier": 0.92,
          "damageMultiplier": 0.95,
          "mortalityMultiplier": 1.05
        }
      },
      "costs": {
        "laborMinutes": 45,
        "materialsCost": 0.0
      },
      "cooldownDays": 0,
      "notes": "Pruning lower leaves, repositioning fans, cleaning filters.",
      "costBasis": "perZone"
    },
    {
      "id": "97187f66-817f-4e8a-b0cb-db237b663743",
      "name": "Dehumidify Night Cycle",
      "category": "cultural",
      "targets": ["disease"],
      "applicability": ["earlyFlower", "lateFlower", "ripening"],
      "efficacy": {
        "disease": {
          "infectionMultiplier": 0.85,
          "degenerationMultiplier": 0.9,
          "recoveryMultiplier": 1.1
        }
      },
      "costs": {
        "laborMinutes": 10,
        "energyPerHourKWh": 1.2,
        "materialsCost": 2.0
      },
      "cooldownDays": 0,
      "notes": "Adjust setpoints to prevent condensation; pairs well with defoliation.",
      "costBasis": "perZone"
    },
    {
      "id": "0828046f-3986-456b-9abe-3f35f5a1f9c4",
      "name": "Dry-Down Irrigation Cycle",
      "category": "cultural",
      "targets": ["pest", "disease"],
      "applicability": ["seedling", "vegetation", "earlyFlower"],
      "efficacy": {
        "pest": {
          "reproductionMultiplier": 0.85,
          "mortalityMultiplier": 1.1,
          "damageMultiplier": 0.95
        },
        "disease": {
          "infectionMultiplier": 0.9,
          "recoveryMultiplier": 1.05
        }
      },
      "costs": {
        "laborMinutes": 15,
        "materialsCost": 0.0
      },
      "cooldownDays": 2,
      "notes": "Especially effective against fungus gnats and root pathogens.",
      "costBasis": "perZone"
    },
    {
      "id": "fa328792-9539-4254-bd5d-cbe8233b6289",
      "name": "Predatory Mites (Phytoseiulus/Amblyseius)",
      "category": "biological",
      "targets": ["pest"],
      "applicability": ["vegetation", "earlyFlower", "lateFlower"],
      "efficacy": {
        "pest": {
          "reproductionMultiplier": 0.75,
          "mortalityMultiplier": 1.25,
          "damageMultiplier": 0.9
        }
      },
      "costs": {
        "laborMinutes": 20,
        "materialsCost": 35.0
      },
      "cooldownDays": 7,
      "risks": {
        "beneficialsHarm": false
      },
      "notes": "Best for spider/broad mites; maintain moderate RH.",
      "costBasis": "perPlant"
    },
    {
      "id": "a0e34f90-c9de-4a95-a88d-9a1a615dd747",
      "name": "Bacillus subtilis (foliar)",
      "category": "biological",
      "targets": ["disease"],
      "applicability": ["vegetation", "earlyFlower"],
      "efficacy": {
        "disease": {
          "infectionMultiplier": 0.8,
          "degenerationMultiplier": 0.9,
          "recoveryMultiplier": 1.1
        }
      },
      "costs": {
        "laborMinutes": 30,
        "materialsCost": 18.0
      },
      "cooldownDays": 7,
      "notes": "Preventive + early curative against powdery mildew.",
      "costBasis": "perSquareMeter"
    },
    {
      "id": "80edee83-4577-4063-877c-68f8d6ab35bc",
      "name": "Trichoderma (root drench)",
      "category": "biological",
      "targets": ["disease", "pest"],
      "applicability": ["seedling", "vegetation", "earlyFlower"],
      "efficacy": {
        "disease": {
          "infectionMultiplier": 0.82,
          "degenerationMultiplier": 0.9,
          "recoveryMultiplier": 1.08
        },
        "pest": {
          "reproductionMultiplier": 0.9,
          "mortalityMultiplier": 1.05
        }
      },
      "costs": {
        "laborMinutes": 20,
        "materialsCost": 22.0
      },
      "cooldownDays": 10,
      "notes": "Suppresses root pathogens; slight benefit vs root aphids.",
      "costBasis": "perSquareMeter"
    },
    {
      "id": "26eba5ec-66e0-41e9-98b5-cce64ebbc079",
      "name": "Bti (Bacillus thuringiensis israelensis)",
      "category": "biological",
      "targets": ["pest"],
      "applicability": ["seedling", "vegetation", "earlyFlower"],
      "efficacy": {
        "pest": {
          "reproductionMultiplier": 0.7,
          "mortalityMultiplier": 1.35,
          "damageMultiplier": 0.85
        }
      },
      "costs": {
        "laborMinutes": 20,
        "materialsCost": 15.0
      },
      "cooldownDays": 7,
      "notes": "Highly effective on fungus gnat larvae; drench media.",
      "costBasis": "perSquareMeter"
    },
    {
      "id": "8241536e-1b0e-4f7b-8857-63bca0179c3e",
      "name": "Remove Infected Tissue",
      "category": "mechanical",
      "targets": ["disease"],
      "applicability": ["vegetation", "earlyFlower", "lateFlower"],
      "efficacy": {
        "disease": {
          "infectionMultiplier": 0.85,
          "degenerationMultiplier": 0.8,
          "recoveryMultiplier": 1.05
        }
      },
      "costs": {
        "laborMinutes": 25,
        "materialsCost": 1.5
      },
      "cooldownDays": 0,
      "notes": "Bag and discard; disinfect tools between cuts.",
      "costBasis": "perZone"
    },
    {
      "id": "40d709c5-5cc6-4bbf-92d0-7e172057170c",
      "name": "Sticky Cards (yellow/blue)",
      "category": "mechanical",
      "targets": ["pest"],
      "applicability": ["seedling", "vegetation", "earlyFlower", "lateFlower", "ripening"],
      "efficacy": {
        "pest": {
          "reproductionMultiplier": 0.95,
          "mortalityMultiplier": 1.08,
          "damageMultiplier": 0.97
        }
      },
      "costs": {
        "laborMinutes": 10,
        "materialsCost": 8.0
      },
      "cooldownDays": 0,
      "notes": "Monitoring plus partial mass trapping of flying adults.",
      "costBasis": "perZone"
    },
    {
      "id": "327a4266-caba-4129-8538-0f7f2c12fbd0",
      "name": "Rinse/Jet Wash",
      "category": "mechanical",
      "targets": ["pest"],
      "applicability": ["vegetation"],
      "efficacy": {
        "pest": {
          "reproductionMultiplier": 0.85,
          "mortalityMultiplier": 1.1,
          "damageMultiplier": 0.9
        }
      },
      "costs": {
        "laborMinutes": 30,
        "materialsCost": 0.5
      },
      "cooldownDays": 3,
      "notes": "Effective on aphids/mites early; avoid oversaturation of media.",
      "costBasis": "perZone"
    },
    {
      "id": "91d9ee39-32e5-4d83-9702-1365d171a5ea",
      "name": "Horticultural Oil (foliar)",
      "category": "chemical",
      "targets": ["pest", "disease"],
      "applicability": ["vegetation", "earlyFlower"],
      "efficacy": {
        "pest": {
          "reproductionMultiplier": 0.7,
          "mortalityMultiplier": 1.3,
          "damageMultiplier": 0.85
        },
        "disease": {
          "infectionMultiplier": 0.85,
          "degenerationMultiplier": 0.9
        }
      },
      "costs": {
        "laborMinutes": 35,
        "materialsCost": 12.0
      },
      "cooldownDays": 7,
      "risks": {
        "phytotoxicity": "medium",
        "notes": "Avoid on open flowers; can harm beneficials."
      },
      "costBasis": "perSquareMeter"
    },
    {
      "id": "ba30fafa-3751-4c56-9315-c289c8780dd0",
      "name": "Potassium Bicarbonate (foliar)",
      "category": "chemical",
      "targets": ["disease"],
      "applicability": ["vegetation", "earlyFlower"],
      "efficacy": {
        "disease": {
          "infectionMultiplier": 0.75,
          "degenerationMultiplier": 0.85,
          "recoveryMultiplier": 1.1
        }
      },
      "costs": {
        "laborMinutes": 25,
        "materialsCost": 6.0
      },
      "cooldownDays": 5,
      "notes": "Good knockdown for powdery mildew; pH shock on leaf surface.",
      "costBasis": "perSquareMeter"
    },
    {
      "id": "131fe37b-967b-4ff3-a9fd-d15cab018dc0",
      "name": "Sulfur (vapor/low-dose spray)",
      "category": "chemical",
      "targets": ["disease", "pest"],
      "applicability": ["vegetation"],
      "efficacy": {
        "disease": {
          "infectionMultiplier": 0.7,
          "degenerationMultiplier": 0.85
        },
        "pest": {
          "reproductionMultiplier": 0.9,
          "mortalityMultiplier": 1.08
        }
      },
      "costs": {
        "laborMinutes": 30,
        "materialsCost": 10.0
      },
      "cooldownDays": 10,
      "risks": {
        "phytotoxicity": "medium",
        "beneficialsHarm": "medium"
      },
      "notes": "Do not combine with oils within 10–14 days.",
      "costBasis": "perSquareMeter"
    },
    {
      "id": "b5792994-eb74-4d89-8c50-246308b138a2",
      "name": "Spinosad (where permitted)",
      "category": "chemical",
      "targets": ["pest"],
      "applicability": ["vegetation", "earlyFlower"],
      "efficacy": {
        "pest": {
          "reproductionMultiplier": 0.6,
          "mortalityMultiplier": 1.4,
          "damageMultiplier": 0.8
        }
      },
      "costs": {
        "laborMinutes": 25,
        "materialsCost": 18.0
      },
      "cooldownDays": 10,
      "risks": {
        "beneficialsHarm": "high"
      },
      "notes": "Rotate modes of action to prevent resistance.",
      "costBasis": "perSquareMeter"
    },
    {
      "id": "dfac9a95-ea56-4606-9417-e5e1382892ed",
      "name": "Btk (Bacillus thuringiensis kurstaki)",
      "category": "chemical",
      "targets": ["pest"],
      "applicability": ["vegetation", "earlyFlower", "lateFlower"],
      "efficacy": {
        "pest": {
          "reproductionMultiplier": 0.7,
          "mortalityMultiplier": 1.35,
          "damageMultiplier": 0.85
        }
      },
      "costs": {
        "laborMinutes": 20,
        "materialsCost": 14.0
      },
      "cooldownDays": 7,
      "notes": "Selective for caterpillars; minimal impact on beneficials.",
      "costBasis": "perSquareMeter"
    },
    {
      "id": "5dc92d86-7f0f-4e7f-8577-69b50f71ee78",
      "name": "UV-C Pass (controlled exposure)",
      "category": "physical",
      "targets": ["disease", "pest"],
      "applicability": ["vegetation"],
      "efficacy": {
        "disease": {
          "infectionMultiplier": 0.85,
          "degenerationMultiplier": 0.92
        },
        "pest": {
          "reproductionMultiplier": 0.9,
          "mortalityMultiplier": 1.05
        }
      },
      "costs": {
        "laborMinutes": 20,
        "equipmentRentalEUR": 25.0,
        "materialsCost": 0.0
      },
      "cooldownDays": 14,
      "risks": {
        "phytotoxicity": "high"
      },
      "notes": "Short exposure; high risk for tender tissue. Safety protocols required.",
      "costBasis": "perZone"
    }
  ]
}
```

## personnel/names/firstNamesFemale.json

```json
[
  "Aaliyah",
  "Abigail",
  "Aisha",
  "Alexandra",
  "Alice",
  "Alicia",
  "Amelia",
  "Ana",
  "Andrea",
  "Anna",
  "Aria",
  "Ashley",
  "Astrid",
  "Ava",
  "Beatrice",
  "Camila",
  "Carmen",
  "Chloe",
  "Clara",
  "Elena",
  "Elizabeth",
  "Ella",
  "Emily",
  "Emma",
  "Eva",
  "Evelyn",
  "Fatima",
  "Fiona",
  "Gabriela",
  "Grace",
  "Guadalupe",
  "Hailey",
  "Hana",
  "Hannah",
  "Harper",
  "Helena",
  "Ida",
  "Imani",
  "Ingrid",
  "Irina",
  "Isabella",
  "Isabelle",
  "Isla",
  "Jasmine",
  "Jessica",
  "Julia",
  "Katarina",
  "Kate",
  "Kristina",
  "Laura",
  "Lea",
  "Lila",
  "Lily",
  "Linda",
  "Lotte",
  "Luna",
  "Madison",
  "Maja",
  "Maria",
  "Mariam",
  "Marta",
  "Mary",
  "Mei",
  "Mia",
  "Mila",
  "Natalia",
  "Nora",
  "Olivia",
  "Penelope",
  "Priya",
  "Rosa",
  "Rose",
  "Sakura",
  "Samantha",
  "Sandra",
  "Sara",
  "Sasha",
  "Sofia",
  "Sofie",
  "Sonya",
  "Sophia",
  "Sophie",
  "Stella",
  "Tatiana",
  "Tatyana",
  "Valentina",
  "Valeria",
  "Vera",
  "Victoria",
  "Yara",
  "Ying",
  "Yua",
  "Zoe",
  "Zofia"
]
```

## personnel/names/firstNamesMale.json

```json
[
  "Aaron",
  "Adam",
  "Aditya",
  "Ahmed",
  "Alex",
  "Alexander",
  "Ali",
  "Andrei",
  "Anthony",
  "Anton",
  "Arthur",
  "Atsuki",
  "Benjamin",
  "Carlos",
  "Chen",
  "Cho",
  "Christian",
  "Christopher",
  "Daniel",
  "David",
  "Dmitry",
  "Elijah",
  "Enrique",
  "Eric",
  "Ethan",
  "Felix",
  "Finn",
  "Francisco",
  "Gabriel",
  "George",
  "Gustav",
  "Han",
  "Hassan",
  "Heinrich",
  "Henry",
  "Hiroki",
  "Hiroshi",
  "Hugo",
  "Ibrahim",
  "Igor",
  "Illya",
  "Ivan",
  "Jack",
  "Jacob",
  "Jakub",
  "James",
  "Javier",
  "Jayden",
  "Ji-hoon",
  "Jin",
  "Joao",
  "John",
  "Jose",
  "Joseph",
  "Joshua",
  "Juan",
  "Julian",
  "Jung",
  "Kai",
  "Kaito",
  "Katsumi",
  "Kenji",
  "Khaled",
  "Kim",
  "Klaus",
  "Leon",
  "Li",
  "Liam",
  "Logan",
  "Louis",
  "Lucas",
  "Ludwig",
  "Luka",
  "Luke",
  "Manuel",
  "Marco",
  "Mario",
  "Mark",
  "Martin",
  "Mateo",
  "Matthew",
  "Michael",
  "Miguel",
  "Min-jun",
  "Mohammed",
  "Muhammad",
  "Naoki",
  "Nathan",
  "Nikolai",
  "Nikola",
  "Noah",
  "Omar",
  "Oscar",
  "Owen",
  "Pablo",
  "Park",
  "Patrick",
  "Paul",
  "Peter",
  "Rahul",
  "Raj",
  "Riku",
  "Robert",
  "Rodrigo",
  "Rohan",
  "Ronan",
  "Ruben",
  "Ryan",
  "Samuel",
  "Santiago",
  "Sebastian",
  "Sergei",
  "Shinji",
  "Stefan",
  "Sven",
  "Takashi",
  "Taro",
  "Tatsuo",
  "Thomas",
  "Tom",
  "Tomoya",
  "Victor",
  "Viktor",
  "Vincent",
  "Vladimir",
  "Wei",
  "William",
  "Xin",
  "Yadav",
  "Yamada",
  "Yan",
  "Yuki",
  "Yuri",
  "Yusuf"
]
```

## personnel/names/lastNames.json

```json
[
  "Abbas",
  "Abbott",
  "Abe",
  "Abebe",
  "Abramson",
  "Ackerman",
  "Adams",
  "Adler",
  "Agarwal",
  "Aguilar",
  "Ahmed",
  "Aitken",
  "Akhtar",
  "Al-Farsi",
  "Al-Ghassani",
  "Al-Hamad",
  "Al-Jamil",
  "Al-Rashid",
  "Al-Saeed",
  "Ali",
  "Allen",
  "Almeida",
  "Alonso",
  "Alvarez",
  "Anand",
  "Andersen",
  "Anderson",
  "Andersson",
  "Ando",
  "Andrews",
  "Antonelli",
  "Antonopoulos",
  "Aoki",
  "Araya",
  "Araújo",
  "Arnold",
  "Aronsson",
  "Arora",
  "Ashton",
  "Auer",
  "Baba",
  "Bach",
  "Bae",
  "Baek",
  "Bailey",
  "Baker",
  "Bakker",
  "Balakrishnan",
  "Banerjee",
  "Bang",
  "Baranov",
  "Barbieri",
  "Barnes",
  "Barros",
  "Bauer",
  "Becker",
  "Bell",
  "Ben-David",
  "Bennett",
  "Berendsen",
  "Berg",
  "Berger",
  "Bergman",
  "Bernard",
  "Bernstein",
  "Bhatt",
  "Bianchi",
  "Bibi",
  "Bjork",
  "Black",
  "Blanc",
  "Blanco",
  "Blau",
  "Blom",
  "Böhm",
  "Bondarenko",
  "Bos",
  "Botha",
  "Boucher",
  "Boyko",
  "Braun",
  "Bravo",
  "Breuer",
  "Brooks",
  "Brown",
  "Browne",
  "Brun",
  "Bruno",
  "Bryant",
  "Burke",
  "Burns",
  "Bustos",
  "Byrne",
  "Campbell",
  "Campos",
  "Cardoso",
  "Carlson",
  "Carlsson",
  "Carr",
  "Carroll",
  "Carter",
  "Carvalho",
  "Castillo",
  "Castro",
  "Chae",
  "Chakrabarti",
  "Chan",
  "Chandran",
  "Chang",
  "Chapman",
  "Chaudhari",
  "Chavez",
  "Chen",
  "Cheng",
  "Cheung",
  "Cho",
  "Choi",
  "Chopra",
  "Chow",
  "Christensen",
  "Christiansen",
  "Chu",
  "Chung",
  "Ciobanu",
  "Clark",
  "Clarke",
  "Cohen",
  "Cole",
  "Coleman",
  "Collins",
  "Conti",
  "Cook",
  "Cooper",
  "Correa",
  "Costa",
  "Cox",
  "Craig",
  "Crawford",
  "Cruz",
  "Cullen",
  "Cunningham",
  "Da Silva",
  "Dahl",
  "Dalton",
  "Dam",
  "Das",
  "Dasgupta",
  "Davies",
  "Davis",
  "De Boer",
  "De Haan",
  "De Jong",
  "De Lange",
  "De Luca",
  "De Vries",
  "Deng",
  "Desai",
  "Deshpande",
  "Devi",
  "Dias",
  "Diaz",
  "Dijkstra",
  "Dimitrov",
  "Dixon",
  "Djordjevic",
  "Do",
  "Dominguez",
  "Doshi",
  "Doyle",
  "Dubois",
  "Dunn",
  "Dutta",
  "Edwards",
  "Egorov",
  "Ek",
  "Eliassen",
  "Endo",
  "Eriksson",
  "Espinoza",
  "Estevez",
  "Evans",
  "Fabre",
  "Falk",
  "Fan",
  "Farah",
  "Farrell",
  "Faulkner",
  "Fedorov",
  "Feng",
  "Ferguson",
  "Fernandes",
  "Fernandez",
  "Ferreira",
  "Fiedler",
  "Fischer",
  "Fisher",
  "Fitzgerald",
  "Fleming",
  "Fletcher",
  "Flores",
  "Flynn",
  "Fodor",
  "Foley",
  "Fonseca",
  "Fontaine",
  "Ford",
  "Forster",
  "Foster",
  "Fournier",
  "Fox",
  "Frank",
  "Franke",
  "Fraser",
  "Freeman",
  "Friedman",
  "Friesen",
  "Fu",
  "Fujii",
  "Fujimoto",
  "Fujita",
  "Fukuda",
  "Fung",
  "Gallagher",
  "Gallo",
  "Gao",
  "Garcia",
  "Garg",
  "Gauthier",
  "Geisler",
  "Gentile",
  "Georgiev",
  "Gerber",
  "Ghosh",
  "Gibson",
  "Gillespie",
  "Gimenez",
  "Giri",
  "Gomes",
  "Gomez",
  "Gonçalves",
  "Gonzalez",
  "Goodman",
  "Gorbachev",
  "Gordon",
  "Goto",
  "Gould",
  "Goyal",
  "Graf",
  "Graham",
  "Grant",
  "Gray",
  "Green",
  "Greene",
  "Greer",
  "Griffin",
  "Griffiths",
  "Gruber",
  "Gu",
  "Guan",
  "Guerrero",
  "Guo",
  "Gupta",
  "Gutierrez",
  "Ha",
  "Haas",
  "Hahn",
  "Hall",
  "Hamalainen",
  "Hamid",
  "Hamilton",
  "Han",
  "Hansen",
  "Hansson",
  "Hara",
  "Harb",
  "Harris",
  "Harrison",
  "Hart",
  "Hartmann",
  "Hasan",
  "Hasegawa",
  "Hashimoto",
  "Hassan",
  "Hayashi",
  "Hayes",
  "He",
  "Heikkila",
  "Heinonen",
  "Henderson",
  "Hendriks",
  "Henry",
  "Hernandez",
  "Herrmann",
  "Hertz",
  "Hess",
  "Hill",
  "Hirano",
  "Ho",
  "Hoffman",
  "Hoffmann",
  "Hofmann",
  "Holland",
  "Holm",
  "Holmgren",
  "Hong",
  "Horvath",
  "Hosseini",
  "Howard",
  "Howell",
  "Hsu",
  "Hu",
  "Huang",
  "Huber",
  "Hughes",
  "Huh",
  "Hunt",
  "Hunter",
  "Husain",
  "Hussain",
  "Hwang",
  "Ibrahim",
  "Ichikawa",
  "Iglesias",
  "Iida",
  "Ikeda",
  "Im",
  "Inoue",
  "Ishida",
  "Ishii",
  "Ishikawa",
  "Ito",
  "Ivanov",
  "Ivanova",
  "Iversen",
  "Jackson",
  "Jacobs",
  "Jacobsen",
  "Jaeger",
  "Jain",
  "Jakobsson",
  "Jansen",
  "Janssen",
  "Janssens",
  "Jarvinen",
  "Jensen",
  "Jeong",
  "Jimenez",
  "Jin",
  "Jo",
  "Johansen"
]
```

## personnel/randomSeeds.json

```json
[
  "wb-seed-0001",
  "wb-seed-0002",
  "wb-seed-0003",
  "wb-seed-0004",
  "wb-seed-0005",
  "wb-seed-0006",
  "wb-seed-0007",
  "wb-seed-0008",
  "wb-seed-0009",
  "wb-seed-0010",
  "wb-seed-0011",
  "wb-seed-0012",
  "wb-seed-0013",
  "wb-seed-0014",
  "wb-seed-0015",
  "wb-seed-0016",
  "wb-seed-0017",
  "wb-seed-0018",
  "wb-seed-0019",
  "wb-seed-0020",
  "wb-seed-0021",
  "wb-seed-0022",
  "wb-seed-0023",
  "wb-seed-0024",
  "wb-seed-0025",
  "wb-seed-0026",
  "wb-seed-0027",
  "wb-seed-0028",
  "wb-seed-0029",
  "wb-seed-0030",
  "wb-seed-0031",
  "wb-seed-0032",
  "wb-seed-0033",
  "wb-seed-0034",
  "wb-seed-0035",
  "wb-seed-0036",
  "wb-seed-0037",
  "wb-seed-0038",
  "wb-seed-0039",
  "wb-seed-0040",
  "wb-seed-0041",
  "wb-seed-0042",
  "wb-seed-0043",
  "wb-seed-0044",
  "wb-seed-0045",
  "wb-seed-0046",
  "wb-seed-0047",
  "wb-seed-0048",
  "wb-seed-0049",
  "wb-seed-0050",
  "wb-seed-0051",
  "wb-seed-0052",
  "wb-seed-0053",
  "wb-seed-0054",
  "wb-seed-0055",
  "wb-seed-0056",
  "wb-seed-0057",
  "wb-seed-0058",
  "wb-seed-0059",
  "wb-seed-0060",
  "wb-seed-0061",
  "wb-seed-0062",
  "wb-seed-0063",
  "wb-seed-0064",
  "wb-seed-0065",
  "wb-seed-0066",
  "wb-seed-0067",
  "wb-seed-0068",
  "wb-seed-0069",
  "wb-seed-0070",
  "wb-seed-0071",
  "wb-seed-0072",
  "wb-seed-0073",
  "wb-seed-0074",
  "wb-seed-0075",
  "wb-seed-0076",
  "wb-seed-0077",
  "wb-seed-0078",
  "wb-seed-0079",
  "wb-seed-0080",
  "wb-seed-0081",
  "wb-seed-0082",
  "wb-seed-0083",
  "wb-seed-0084",
  "wb-seed-0085",
  "wb-seed-0086",
  "wb-seed-0087",
  "wb-seed-0088",
  "wb-seed-0089",
  "wb-seed-0090",
  "wb-seed-0091",
  "wb-seed-0092",
  "wb-seed-0093",
  "wb-seed-0094",
  "wb-seed-0095",
  "wb-seed-0096",
  "wb-seed-0097",
  "wb-seed-0098",
  "wb-seed-0099",
  "wb-seed-0100",
  "wb-seed-0101",
  "wb-seed-0102",
  "wb-seed-0103",
  "wb-seed-0104",
  "wb-seed-0105",
  "wb-seed-0106",
  "wb-seed-0107",
  "wb-seed-0108",
  "wb-seed-0109",
  "wb-seed-0110",
  "wb-seed-0111",
  "wb-seed-0112",
  "wb-seed-0113",
  "wb-seed-0114",
  "wb-seed-0115",
  "wb-seed-0116",
  "wb-seed-0117",
  "wb-seed-0118",
  "wb-seed-0119",
  "wb-seed-0120",
  "wb-seed-0121",
  "wb-seed-0122",
  "wb-seed-0123",
  "wb-seed-0124",
  "wb-seed-0125",
  "wb-seed-0126",
  "wb-seed-0127",
  "wb-seed-0128",
  "wb-seed-0129",
  "wb-seed-0130",
  "wb-seed-0131",
  "wb-seed-0132",
  "wb-seed-0133",
  "wb-seed-0134",
  "wb-seed-0135",
  "wb-seed-0136",
  "wb-seed-0137",
  "wb-seed-0138",
  "wb-seed-0139",
  "wb-seed-0140",
  "wb-seed-0141",
  "wb-seed-0142",
  "wb-seed-0143",
  "wb-seed-0144",
  "wb-seed-0145",
  "wb-seed-0146",
  "wb-seed-0147",
  "wb-seed-0148",
  "wb-seed-0149",
  "wb-seed-0150",
  "wb-seed-0151",
  "wb-seed-0152",
  "wb-seed-0153",
  "wb-seed-0154",
  "wb-seed-0155",
  "wb-seed-0156",
  "wb-seed-0157",
  "wb-seed-0158",
  "wb-seed-0159",
  "wb-seed-0160",
  "wb-seed-0161",
  "wb-seed-0162",
  "wb-seed-0163",
  "wb-seed-0164",
  "wb-seed-0165",
  "wb-seed-0166",
  "wb-seed-0167",
  "wb-seed-0168",
  "wb-seed-0169",
  "wb-seed-0170",
  "wb-seed-0171",
  "wb-seed-0172",
  "wb-seed-0173",
  "wb-seed-0174",
  "wb-seed-0175",
  "wb-seed-0176",
  "wb-seed-0177",
  "wb-seed-0178",
  "wb-seed-0179",
  "wb-seed-0180",
  "wb-seed-0181",
  "wb-seed-0182",
  "wb-seed-0183",
  "wb-seed-0184",
  "wb-seed-0185",
  "wb-seed-0186",
  "wb-seed-0187",
  "wb-seed-0188",
  "wb-seed-0189",
  "wb-seed-0190",
  "wb-seed-0191",
  "wb-seed-0192",
  "wb-seed-0193",
  "wb-seed-0194",
  "wb-seed-0195",
  "wb-seed-0196",
  "wb-seed-0197",
  "wb-seed-0198",
  "wb-seed-0199",
  "wb-seed-0200"
]
```

## personnel/traits.json

```json
[
  {
    "id": "trait_green_thumb",
    "name": "Green Thumb",
    "description": "Naturally gifted with plants, providing a slight bonus to all gardening tasks.",
    "type": "positive"
  },
  {
    "id": "trait_night_owl",
    "name": "Night Owl",
    "description": "More energetic and efficient during night shifts.",
    "type": "positive"
  },
  {
    "id": "trait_quick_learner",
    "name": "Quick Learner",
    "description": "Gains skill experience from working and training 15% faster.",
    "type": "positive"
  },
  {
    "id": "trait_optimist",
    "name": "Optimist",
    "description": "Slightly raises the morale of all other employees in the same structure.",
    "type": "positive"
  },
  {
    "id": "trait_gearhead",
    "name": "Gearhead",
    "description": "Has a knack for mechanics, causing devices they maintain to degrade slower.",
    "type": "positive"
  },
  {
    "id": "trait_frugal",
    "name": "Frugal",
    "description": "Accepts a slightly lower salary than their skills would normally demand.",
    "type": "positive"
  },
  {
    "id": "trait_meticulous",
    "name": "Meticulous",
    "description": "Excels at keeping things clean, reducing the chance of random pest or disease outbreaks.",
    "type": "positive"
  },
  {
    "id": "trait_clumsy",
    "name": "Clumsy",
    "description": "Slightly increases the chance of minor errors during maintenance tasks.",
    "type": "negative"
  },
  {
    "id": "trait_slacker",
    "name": "Slacker",
    "description": "Works 10% slower and loses energy more quickly.",
    "type": "negative"
  },
  {
    "id": "trait_pessimist",
    "name": "Pessimist",
    "description": "Slightly lowers the morale of all other employees in the same structure.",
    "type": "negative"
  },
  {
    "id": "trait_forgetful",
    "name": "Forgetful",
    "description": "Takes longer to complete complex tasks and is less efficient at planning.",
    "type": "negative"
  },
  {
    "id": "trait_demanding",
    "name": "Demanding",
    "description": "Expects a higher salary than their skills would normally demand.",
    "type": "negative"
  },
  {
    "id": "trait_slow_learner",
    "name": "Slow Learner",
    "description": "Gains skill experience from working and training 15% slower.",
    "type": "negative"
  }
]
```

## prices/devicePrices.json

```json
{
  "devicePrices": {
    "7d3d3f1a-8c6f-4e9c-926d-5a2a4a3b6f1b": {
      "capitalExpenditure": 1200,
      "baseMaintenanceCostPerTick": 0.004,
      "costIncreasePer1000Ticks": 0.001
    },
    "3b5f6ad7-672e-47cd-9a24-f0cc45c4101e": {
      "capitalExpenditure": 600,
      "baseMaintenanceCostPerTick": 0.002,
      "costIncreasePer1000Ticks": 0.0008
    },
    "3d762260-88a5-4104-b03c-9860bbac34b6": {
      "capitalExpenditure": 250,
      "baseMaintenanceCostPerTick": 0.002,
      "costIncreasePer1000Ticks": 0.1
    },
    "7a639d3d-4750-440a-a200-f90d11dc3c62": {
      "capitalExpenditure": 350,
      "baseMaintenanceCostPerTick": 0.0015,
      "costIncreasePer1000Ticks": 0.0006
    },
    "c701efa6-1e90-4f28-8934-ea9c584596e4": {
      "capitalExpenditure": 220,
      "baseMaintenanceCostPerTick": 0.0008,
      "costIncreasePer1000Ticks": 0.0004
    },
    "f5d5c5a0-1b2c-4d3e-8f9a-0b1c2d3e4f5a": {
      "capitalExpenditure": 75,
      "baseMaintenanceCostPerTick": 0.0005,
      "costIncreasePer1000Ticks": 0.0002
    }
  }
}
```

## prices/strainPrices.json

```json
{
  "strainPrices": {
    "550e8400-e29b-41d4-a716-446655440000": {
      "seedPrice": 0.5,
      "harvestPricePerGram": 4.2
    },
    "550e8400-e29b-41d4-a716-446655440001": {
      "seedPrice": 0.6,
      "harvestPricePerGram": 4.0
    },
    "3f0f15f4-1b75-4196-b3f3-5f6b6b7cf7a7": {
      "seedPrice": 0.7,
      "harvestPricePerGram": 4.5
    },
    "5a6e9e57-0b3a-4f9f-8f19-12f3f8ec3a0e": {
      "seedPrice": 0.55,
      "harvestPricePerGram": 4.3
    },
    "8b9a0b6c-2d6c-4f58-9c37-7a6c9d4aa5c2": {
      "seedPrice": 0.8,
      "harvestPricePerGram": 5.0
    }
  }
}
```

## prices/utilityPrices.json

```json
{
  "pricePerKwh": 0.15,
  "pricePerLiterWater": 0.02,
  "pricePerGramNutrients": 0.1
}
```

## Terpene & Effects — High‑Level Concepts for Strain Blueprints (Augmented) (docs/addendum/ideas/terpenes.md)

Source: [`docs/addendum/ideas/terpenes.md`](../docs/addendum/ideas/terpenes.md)

# Terpene & Effects — High‑Level Concepts for Strain Blueprints (Augmented)

> Goal: A consistent, extensible concept to represent **terpenes**, **effect axes** (e.g., calming/energizing), **positive/negative effects**, and **aroma notes** in strain blueprints — implementation‑agnostic. This augmented edition adds **English effect lists** (positive/negative + experience descriptors) and an **English canon of cannabis‑relevant terpenes** (with common synonyms).

---

## 0) Guardrails

- **Scales & Units**
  - Cannabinoids as fractions \[0..1].
  - Terpenes in **mg/g** (total + components). Alternate sources (%/ppm) are conceptually normalized to mg/g.
  - Effect axes and effect tags normalized to \[0..1]; include **confidence** \[0..1].

- **Canonization**: Fixed **canon keys** for terpenes, aromas, and effects. Synonyms are mapped into the canon (concept; no hardcoded list required by the engine).
- **Provenance/Audit**: Every derived number keeps **source**, **timestamp**, and a **normalization tag** (concept string).

---

## 1) Target Schema (Concept)

**Blueprint Concepts**

- `chemistry.cannabinoids`: THC/CBD/… as fractions (mean, optional quantiles).
- `chemistry.terpenes`: `total_mg_g` + `components[terpeneKey].mg_g`.
- `sensory.aromaNotes`: weighted notes (`note`, `weight`).
- `effects.axes`: axes like `energizing`, `calming`, `focus`, `euphoria`, `sedation` → each with `value` + `confidence`.
- `effects.positives` / `effects.negatives`: weighted effect keys (e.g., `relaxed`, `happy` … / `dryMouth`, `anxious` …).
- `provenance`: sources, normalization tag.

**Requirement:** Schema is **additively** extensible (new terpenes/effects via canon updates).

---

## 2) Normalization (Concept)

**Input → Internal Scales**

- Cannabinoids: percent → fraction \[0..1].
- Terpenes: %, ppm → mg/g.
- Effects/Tags: unify heterogeneous rating scales (votes/stars → \[0..1]).

```pseudocode
FOR each strainInput:
  cannabinoids := normalizeCannabinoids(strainInput.cannabinoids)
  terpeneComponents := convertTerpenesToMgPerG(strainInput.terpenes) // canonized keys
  total_mg_g := sum(terpeneComponents)
  aromaNotes := mapAromaSynonyms(strainInput.aromaTags)
  posEffects := mapEffectSynonyms(strainInput.positiveTags)
  negEffects := mapEffectSynonyms(strainInput.negativeTags)
  confidence := computeConfidence(sourceQuality, dataCompleteness)
```

---

## 3) Axis Derivation from Terpene Profile (Heuristic, Concept)

- **Input:** terpene shares `w_t = mg_g_t / total_mg_g`.
- **Matrix (concept):** For each terpene, weights to axes (e.g., limonene → energizing↑, euphoria↑; myrcene → calming↑, sedation↑).
- **Computation:** axis = Σ (share_terpene × weight_terpene→axis) → clamp \[0..1]; optional gamma/rescaling.
- **Confidence:** increases with `total_mg_g` and source quality.

```pseudocode
weights := normalize(terpeneComponents)
axes := { energizing:0, calming:0, focus:0, euphoria:0, sedation:0 }
FOR each terpene t IN weights:
  FOR each axis a:
    axes[a] += weights[t] * MATRIX[t][a]
axes := clamp01(applyGamma(axes, gamma≈0.9))
confidence_axes := f(total_mg_g, sourceQuality)
```

---

## 4) Deriving Positive/Negative Effects (Concept)

- If direct crowd/lab/clinical tags exist → map to canon keys, scale to \[0..1].
- If missing → seed from axis values (and THC level) with documented heuristics; later override with real data.

```pseudocode
if hasDirectEffectData:
  positives := scaleToUnitInterval(mapToCanonKeys(input.positives))
  negatives := scaleToUnitInterval(mapToCanonKeys(input.negatives))
else:
  positives := derivePositivesFromAxes(axes, thc)
  negatives := deriveNegativesFromAxes(axes, thc)
```

---

## 5) ETL Pipeline (Concept)

```pseudocode
PIPELINE ingestStrains(source):
  FOR each raw in source:
    data := extract(raw)
    data := canonizeSynonyms(data)
    data := normalizeScales(data) // mg/g, [0..1]
    axes, axesConfidence := deriveAxesFromTerpenes(data.terpenes)
    pos, neg := mergeDirectAndDerivedEffects(data.effects, axes, data.cannabinoids)
    blueprint := assembleBlueprint(data, axes, pos, neg, provenanceTag)
    validate(blueprint)
writeToRepository(blueprint)
AFTER all: exportAsBundleZip()
```

---

# Appendices (New)

## A) **Effect Vocabulary — English (Canon Keys)**

### A.1 Positive effects (list)

- relaxed
- happy
- euphoric
- uplifted
- creative
- focused
- talkative
- giggly
- sociable
- calm
- energized
- motivated
- mindful
- tingly
- bodyLightness
- appetiteIncrease
- aroused
- painRelief (tag; see medical)
- stressRelief (tag; see medical)

> _Note:_ Some "positive" keys (e.g., painRelief, stressRelief) straddle wellness/medical semantics; keep them as tags if you separate recreational vs. medical schemas.

### A.2 Negative effects (list)

- dryMouth
- dryEyes
- anxious
- paranoia
- dizziness
- headache
- fatigue
- couchLock
- overfocused (tunnelVision)
- increasedHeartRate
- memoryLapse (shortTerm)
- coordinationImpairment

### A.3 Experience descriptors ("Wirkung") — English list

Use these as high‑level **experience labels** (non‑medical, UI‑friendly):

- clearHeaded
- cerebral
- uplifting
- energizing
- invigorating
- mellow
- calming
- soothing
- grounding
- dreamy
- stoney
- sedating
- balanced
- social
- creativeFlow
- focusedFlow
- introspective
- bodyEuphoric
- mindEuphoric
- daytimeFriendly
- nighttimeFriendly

> _Usage:_ These descriptors can be derived from axes or curated per cultivar; expose them as a simple list for UI chips and shop filters.

---

## B) **Cannabis‑Relevant Terpene Canon — English**

> Canon keys (lowerCamelCase). Include common synonyms for ingestion/ETL.

- **myrcene** (β‑myrcene)
- **limonene** (d‑limonene)
- **betaCaryophyllene** (β‑caryophyllene, BCP)
- **alphaPinene** (α‑pinene)
- **betaPinene** (β‑pinene)
- **linalool**
- **terpinolene**
- **humulene** (α‑humulene; caryophyllene oxide ≠ humulene → list separately if measured)
- **ocimene** (α‑ocimene, β‑ocimene, allo‑ocimene)
- **bisabolol** (α‑bisabolol, levomenol)
- **nerolidol** (trans‑/cis‑nerolidol)
- **eucalyptol** (1,8‑cineole)
- **geraniol**
- **valencene**
- **borneol**
- **camphene**
- **terpineol** (α‑terpineol; include β/γ variants if available)
- **fenchol**
- **sabinene**
- **delta3Carene** (Δ³‑carene)
- **phellandrene** (α‑/β‑phellandrene)
- **pulegone** (typically trace)
- **guaiol**
- **cedrene** (α‑/β‑cedrene)
- **camphor**
- **isopulegol**
- **phytol** (terpenoid alcohol; often from chlorophyll degradation)
- **paraCymene** (p‑cymene)
- **thymol** (phenolic monoterpenoid)
- **carvacrol** (phenolic monoterpenoid)
- **menthol** (rare in cannabis chemovars; include if measured)
- **hexahydrofarnesylAcetone** (terpenoid‑like; optional extended canon)

**Notes**

- Keep the **primary canon** compact for gameplay and analytics. Track **synonyms** and **isomers** in a mapping table used by the importer.
- If labs report only "top‑3" terpenes, allow partial vectors; compute `total_mg_g` from known components and mark confidence accordingly.

---

## C) JSON Blueprint Stubs (Effects & Terpenes)

```jsonc
{
  "chemistry": {
    "terpenes": {
      "total_mg_g": 6.2,
      "components": {
        "myrcene": 2.4,
        "limonene": 0.9,
        "betaCaryophyllene": 0.8,
        "alphaPinene": 0.5,
        "linalool": 0.3,
      },
    },
  },
  "effects": {
    "axes": {
      "energizing": { "value": 0.62, "confidence": 0.7 },
      "calming": { "value": 0.38, "confidence": 0.7 },
      "focus": { "value": 0.55, "confidence": 0.6 },
      "euphoria": { "value": 0.68, "confidence": 0.7 },
      "sedation": { "value": 0.32, "confidence": 0.6 },
    },
    "positives": {
      "uplifted": 0.7,
      "happy": 0.65,
      "creative": 0.6,
      "relaxed": 0.45,
      "focused": 0.55,
    },
    "negatives": {
      "dryMouth": 0.5,
      "dryEyes": 0.35,
      "anxious": 0.2,
    },
    "descriptors": ["cerebral", "daytimeFriendly", "creativeFlow", "balanced"],
  },
}
```

---

## D) Validation & Canon Checks (Zod Sketch)

```ts
const TerpeneKey = z.enum([
  'myrcene',
  'limonene',
  'betaCaryophyllene',
  'alphaPinene',
  'betaPinene',
  'linalool',
  'terpinolene',
  'humulene',
  'ocimene',
  'bisabolol',
  'nerolidol',
  'eucalyptol',
  'geraniol',
  'valencene',
  'borneol',
  'camphene',
  'terpineol',
  'fenchol',
  'sabinene',
  'delta3Carene',
  'phellandrene',
  'pulegone',
  'guaiol',
  'cedrene',
  'camphor',
  'isopulegol',
  'phytol',
  'paraCymene',
  'thymol',
  'carvacrol',
  'menthol',
]);

const PositiveEffect = z.enum([
  'relaxed',
  'happy',
  'euphoric',
  'uplifted',
  'creative',
  'focused',
  'talkative',
  'giggly',
  'sociable',
  'calm',
  'energized',
  'motivated',
  'mindful',
  'tingly',
  'bodyLightness',
  'appetiteIncrease',
  'aroused',
  'painRelief',
  'stressRelief',
]);

const NegativeEffect = z.enum([
  'dryMouth',
  'dryEyes',
  'anxious',
  'paranoia',
  'dizziness',
  'headache',
  'fatigue',
  'couchLock',
  'overfocused',
  'increasedHeartRate',
  'memoryLapse',
  'coordinationImpairment',
]);

const Descriptor = z.enum([
  'clearHeaded',
  'cerebral',
  'uplifting',
  'energizing',
  'invigorating',
  'mellow',
  'calming',
  'soothing',
  'grounding',
  'dreamy',
  'stoney',
  'sedating',
  'balanced',
  'social',
  'creativeFlow',
  'focusedFlow',
  'introspective',
  'bodyEuphoric',
  'mindEuphoric',
  'daytimeFriendly',
  'nighttimeFriendly',
]);
```

---

## E) UI/Gameplay Hooks (Quick Notes)

- **Radar** for axes, **bar** for top terpenes (mg/g), **chips** for descriptors and effects.
- **Filters**: descriptors, top terpenes, axes thresholds.
- **Economy tie‑in**: market segments consume by descriptor bundles (e.g., Calm‑Sleep vs. Party‑Uplift).

---

**Normalization Tags (example):** `terpene-mg-g.v1; axes-matrix.v2025-09; effects-canon.v2025-09`

## KIEF DSL — High‑Level Integration (Monorepo, `data/kief`, Pseudocode‑Only) (docs/addendum/ideas/kief_dsl.md)

Source: [`docs/addendum/ideas/kief_dsl.md`](../docs/addendum/ideas/kief_dsl.md)

# KIEF DSL — High‑Level Integration (Monorepo, `data/kief`, Pseudocode‑Only)

> **Goal:** High‑level integration framework for **KIEF** (file extension **`.kief`**) in your PNPM monorepo. Backend source code lives under **`/src/backend/src`**. **Rule files live under `/**data/kief/**`**. No legacy extensions.
> Treat all state code in this document as pseudocode!

---

## 1) Core Idea

- **Engine** (TS) computes physics/biology and owns state (under `src/backend/src/engine`).
- **KIEF** expresses **policies/automation** as if‑then rules per **scope** (`company|structure|room|zone|plant|device`).
- Pipeline: **`.kief`** → **Parser** → **IR (JSON‑like)** → **Compiler** → **RuleRuntime** → hooks into **tick loop** & **event bus**.

---

## 2) Monorepo Folder Structure (Proposal)

```
/                        # Repo root (pnpm workspace root)
  package.json           # root scripts (rules:*)
  pnpm-workspace.yaml
  /data
    /kief                # 🔹 Rule packages (authoring layer)
      core.kief
      devices.kief
      economy.kief
  /src
    /backend
      /src               # 🔹 Backend code
        /engine          # Sim core (physics/bio)
        /rulekit         # KIEF stack (Parser/IR/Compiler/Runtime)
          /dsl           # grammar.kief-spec.md, parser.pseudo, units.pseudo
          /ir            # schema.pseudo, types.pseudo
          /compiler      # binder.pseudo, expr-compiler.pseudo, effect-ops.pseudo
          /runtime       # runtime.pseudo, scheduler.pseudo, metrics.pseudo
```

---

## 3) KIEF File (Author View)

```kief
rule "Plant VPD raises stress":
  scope: plant
  trigger: onTick(every=1)
  when: self.env.vpdEffective > self.targets.vpd + 0.2 kPa
  then:
    inc self.stress.vpd by clamp((self.env.vpdEffective - self.targets.vpd) * self.sensitivity.vpd, 0, 3.0)
    cap self.stress.vpd between [0, 100]
```

**Language Building Blocks (Short):**

- **Trigger:** `onTick(every=N[, offset=M]) | onEvent("Name") | onThreshold(path, above|below, value[, hysteresis=Δ]) | onChange(path)`
- **Condition:** Boolean expr over `self.*`, `parent.*`, aggregations via `children.*` (`sum/avg/min/max/quantile`)
- **Effects:** `set | inc | dec | cap | emit | schedule | transition` (write access **only to `self.*`**)
- **Units:** Literals like `1.5 kPa`, `1600 ppm`, `120 EUR` → normalized internally

---

## 4) Parser → IR (Pseudocode)

```pseudo
function parseKief(text):
  tokens = lex(text)
  ast = parseRules(tokens)
  ir = []
  for node in ast.rules:
    irRule = {
      id: slug(node.title),
      scope: node.scope,
      trigger: normalizeTrigger(node.trigger),
      where: compileExpr(node.where?),
      when: compileExpr(node.when?),
      then: compileEffects(node.effects)
    }
    validateUnits(irRule)      # kPa/ppm/EUR → SI
    assertWriteScope(irRule)   # only self.* is writable
    ir.push(irRule)
  return { rules: ir }
```

**IR Sketch (JSON‑like):**

```json
{
  "rules": [
    {
      "id": "plant_vpd_raises_stress",
      "scope": "plant",
      "trigger": { "type": "onTick", "every": 1, "offset": 0 },
      "where": null,
      "when": {
        "op": ">",
        "lhs": "self.env.vpdEffective",
        "rhs": { "op": "+", "lhs": "self.targets.vpd", "rhs": { "value": 0.2, "unit": "kPa" } }
      },
      "then": [
        {
          "op": "inc",
          "path": "self.stress.vpd",
          "expr": {
            "fn": "clamp",
            "args": [
              {
                "op": "*",
                "lhs": { "op": "-", "lhs": "self.env.vpdEffective", "rhs": "self.targets.vpd" },
                "rhs": { "path": "self.sensitivity.vpd" }
              },
              0,
              3
            ]
          }
        },
        { "op": "cap", "path": "self.stress.vpd", "lo": 0, "hi": 100 }
      ]
    }
  ]
}
```

---

## 5) Compiler (IR → Closures)

```pseudo
function compile(ir):
  compiled = []
  for r in ir.rules:
    whenFn = makeBoolExprFn(r.when)            # (ctx) → bool
    effectFns = r.then.map(makeEffectFn)       # (ctx) → void
    compiled.push({ id:r.id, scope:r.scope, trigger:r.trigger,
                    whereFn: makeBoolExprFn(r.where?), whenFn, effectFns })
  return compiled
```

**Adapter (Decoupling from the Data Model):**

```pseudo
interface EntityAdapter { get(path); set(path,val); inc(path,delta); }
interface Accessors {
  resolve(scope,id): EntityAdapter
  parentOf(scope,id): EntityAdapter | null
  childrenOf(scope,id, childScope): Iterable<EntityAdapter>
}
```

---

## 6) Runtime & Hooks

```pseudo
class RuleRuntime {
  loadFromText(kiefText): ruleset = compile(parseKief(kiefText))
  bindAccessors(acc)
  setRng(rng)

  onTick(t):
    for scope in order(company→…→device):
      for entity in world.byScope(scope):
        for rule in ruleset where rule.scope==scope:
          if matchTrigger(rule.trigger,t) and rule.whereFn(entity) and rule.whenFn(entity):
            applyEffects(rule.effectFns, entity)  # atomic per rule

  onEvent(evt,t):
    for rule in ruleset matching evt:
      if rule.whereFn(evt.scopeEntity) and rule.whenFn(evt.scopeEntity):
        applyEffects(rule.effectFns, evt.scopeEntity)
}
```

**Determinism & Safety:** stable ordering `(scope, priority=0, ruleId)`, atomic rule transactions, write access strictly `self.*`, hysteresis/edges (`onThreshold(..., hysteresis=Δ)`).

---

## 7) Engine Integration (Main Loop, Backend under `src/backend/src`)

```pseudo
// composition root (src/backend/src/index.ts)
const runtime = new RuleRuntime()
runtime.bindAccessors(makeAccessors(world))
runtime.setRng(seedRng(SEED))

// Load KIEF rules from /data/kief
for file in readDir('/data/kief/*.kief'):
  runtime.loadFromText(read(file))

// Event bridge
engine.on('event', (evt) => runtime.onEvent(evt, engine.tick))

// Tick loop
while engine.running:
  runtime.onTick(engine.tick)   # 1) apply policies
  engine.step(engine.tick)      # 2) compute physics/biology
  telemetry.push(runtime.metrics())
```

---

## 8) Root Scripts (PNPM, Repo Root)

```json
{
  "scripts": {
    "rules:compile": "kief compile \"data/kief/**/*.kief\"",
    "rules:lint": "kief lint \"data/kief/**/*.kief\"",
    "rules:test": "vitest -c src/backend/rulekit.vitest.config.ts"
  }
}
```

> If you don’t have a CLI yet: implement `validate`/`compile` as Node scripts in the backend for now and invoke them via root scripts.

---

## 9) Telemetry & Tests

- **Per‑tick metrics:** `rulesEvaluated`, `rulesFired`, `effectsApplied`, `avgEvalMicros`.
- **Golden tests:** Mini world → tick sequence → expected state diffs (JSON).
- **Property checks:** Caps take effect, hysteresis doesn’t flip‑flop, determinism (seed).

---

## 10) Authoring Guardrails

- Always end continuous quantities with **`cap …`**.
- Units in literals are mandatory; parser normalizes internally.
- Use hysteresis for `onThreshold`/actuators to prevent pumping.
- Stable `id` (kebab‑case) for diffs & telemetry.

---

## 11) Starter Packages (`/data/kief`)

- `core.kief`: Plant‑VPD stress, CO₂ safety clamp, night‑cycle light cap
- `devices.kief`: Dehumidifier control p95(leaf‑VPD), device replacement trigger
- `economy.kief`: Monthly OPEX alert, budget guard

## 12) Integration Plan

1. **Rulekit scaffolding**
   - Create `src/backend/src/rulekit` with `dsl/`, `ir/`, `compiler/`, and `runtime/` subfolders plus barrel exports.
   - Add placeholder TypeScript modules that mirror the pseudocode filenames and expose typed interfaces.
   - Wire path aliases (if needed) so backend code can import the rulekit without relative path noise.

2. **Lexer & parser foundation**
   - Implement a deterministic lexer that recognizes rule headers, scopes, triggers, expressions, effect verbs, and unit-bearing literals.
   - Encode the grammar from `dsl/grammar.kief-spec.md` as parser combinators or a hand-written recursive-descent parser with clear AST types.
   - Include unit tests that cover happy paths, malformed rules, and unit literal handling (kPa, ppm, EUR, etc.).

3. **IR schema & validation**
   - Translate the AST nodes into the IR shape described in section 4 with strong TypeScript types.
   - Implement validators for scope, trigger configuration, writable paths (`self.*`), and unit normalization.
   - Persist schema docs in `dsl/` and export JSON Schema artifacts for future tooling.

4. **Expression compiler**
   - Build expression evaluators for boolean and numeric expressions with support for math functions (`clamp`, aggregates).
   - Guarantee deterministic evaluation order and side-effect free execution.
   - Cover edge cases (division by zero, undefined paths) with defensive checks and targeted tests.

5. **Effect operator implementation**
   - Implement effect handlers (`set`, `inc`, `dec`, `cap`, `emit`, `schedule`, `transition`) that act on an `EntityAdapter` instance.
   - Ensure atomic application per rule by batching reads and writes before committing.
   - Add runtime safeguards against scope violations or non-finite values.

6. **Runtime scheduler & trigger engine**
   - Implement tick-based evaluation ordering (company → … → device) with stable rule sorting.
   - Support `onTick`, `onEvent`, `onThreshold`, and `onChange` triggers with hysteresis tracking.
   - Emit per-tick metrics (`rulesEvaluated`, `rulesFired`, etc.) for telemetry consumers.

7. **Engine accessors & integration hooks**
   - Expose adapters that bridge simulation entities (company/structure/room/zone/plant/device) to the runtime’s `EntityAdapter` interface.
   - Bind the rule runtime in the backend composition root, share the seeded RNG, and register event listeners.
   - Insert `runtime.onTick` before `engine.step` within the tick loop, respecting existing phase ordering.

8. **Rule loading pipeline**
   - Implement a loader that reads `data/kief/**/*.kief`, parses, compiles, and caches rulesets on startup.
   - Provide hot-reload hooks (dev mode) that rebuild the runtime when files change.
   - Surface parse/compile diagnostics with file, line, and column context.

9. **Tooling & scripts**
   - Add root `rules:compile`, `rules:lint`, and `rules:test` scripts invoking backend entry points.
   - Produce CLI output suitable for CI (non-zero exit codes on failure, structured logs where feasible).
   - Document the commands in `README.md` or a dedicated authoring guide.

10. **Authoring starter packages**
    - Populate `data/kief/core.kief`, `devices.kief`, and `economy.kief` with the sample rules described in section 11.
    - Validate that rules compile and bind against fixture simulation data.
    - Provide comments or separate docs outlining expected data paths for authors.

11. **Testing & QA suite**
    - Create golden master tests that run mini-world simulations and assert expected state deltas.
    - Add property-based or fuzz tests for hysteresis stability and determinism under repeated runs.
    - Integrate rule metrics assertions into existing integration tests.

12. **Telemetry & observability**
    - Publish runtime metrics alongside existing telemetry streams (`simulationUpdate`, logs).
    - Ensure rule fire events or diagnostics can be inspected via the event bus without bloating payloads.
    - Add documentation for interpreting metrics and troubleshooting rule behaviour.

## Room Purpose Registry (docs/addendum/ideas/room-purpose-registry.md)

Source: [`docs/addendum/ideas/room-purpose-registry.md`](../docs/addendum/ideas/room-purpose-registry.md)

# Room Purpose Registry

## Overview

Room purposes are content blueprints that describe how a room is used (e.g. grow room, break room).
The shared engine module exposes repository-backed helpers that operate on the data loaded by the
backend `BlueprintRepository`. Blueprints are validated with Zod during repository initialisation, so
the runtime helpers only need a source that implements `listRoomPurposes()` (the repository does).

## API

The helpers live at `src/backend/src/engine/roomPurposes/index.ts` and export repository-oriented utilities:

- `listRoomPurposes(source)` — Returns all known room purposes from a repository-like source.
- `getRoomPurpose(source, value, { by })` — Retrieves a purpose by id (default), name, or slug
  (`kind`); lookups are case-insensitive and return `undefined` when no match is found.
- `requireRoomPurpose(source, value, { by })` — Same as `getRoomPurpose` but throws when the lookup
  fails.
- `resolveRoomPurposeId(source, name)` — Convenience helper that resolves an id from a room purpose
  name (throws when unknown).
- `getRoomPurposeByKind(source, kind)` / `requireRoomPurposeByKind(source, kind)` — Convenience
  wrappers around slug lookups.

Example:

```ts
import { BlueprintRepository } from './data/index.js';
import { resolveRoomPurposeId } from './engine/roomPurposes/index.js';

const repository = await BlueprintRepository.loadFrom('/absolute/path/to/data');
const growRoomId = resolveRoomPurposeId(repository, 'Grow Room');
```

## Schema

Each blueprint is validated against the following Zod schema:

```json
{
  "type": "object",
  "required": ["id", "kind", "name"],
  "properties": {
    "id": { "type": "string", "format": "uuid" },
    "kind": {
      "type": "string",
      "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$",
      "description": "Lowercase slug that uniquely identifies the purpose"
    },
    "name": { "type": "string", "minLength": 1 },
    "description": { "type": "string" },
    "flags": { "type": "object", "additionalProperties": { "type": "boolean" } },
    "economy": {
      "type": "object",
      "properties": {
        "areaCost": { "type": "number", "minimum": 0 },
        "baseRentPerTick": {
          "type": "number",
          "minimum": 0,
          "description": "Hourly rent baseline; multiply by tick length in hours for per-tick cost"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": true
}
```

Additional fields are allowed to accommodate future gameplay metadata. The lowercase `kind` slug and
UUID `id` ensure interoperability with other blueprint loaders while giving designers a human-readable
identifier that can be referenced from JSON (e.g. `allowedRoomPurposes`).

## Weed Breed — Breeding Module (TS + Pseudocode) (docs/addendum/ideas/breeding_module.md)

Source: [`docs/addendum/ideas/breeding_module.md`](../docs/addendum/ideas/breeding_module.md)

# Weed Breed — Breeding Module (TS + Pseudocode)

> Consolidated spec & ready‑to‑use TypeScript for a deterministic breeding pipeline (A × B → C), plus UI pseudocode (React/Vite). Matches our schemas (strain JSON), naming rules (camelCase, SI), and the Node/TS toolchain.

---

## 0) Goals

- Deterministic, seed‑driven **breeding core** (F1 / F2+ / BX / IBL) that mixes parent traits into child strain blueprints.
- **Time model** that maps real breeding steps to in‑game calendar days (with overlap and parallelization).
- **UI flow** (Breeding Lab) to pick parents, plan a program, spawn populations, and select top genotypes.

---

## 1) Real → Game Mapping (Time)

**Realistic ranges**: A×B to a stable C line often takes **1.5–3 years**. A fast limited run (F2/F3) \~**8–12 months**.

**Game model per generation** (A×B → seed batch):

```
T_gen = veg + flower + tail + post
veg   = avg(vegetationDays[A], vegetationDays[B])
flower= avg(floweringDays[A],  floweringDays[B])
tail  = max(0, seedMaturationDays - (flower - pollinationDayInFlower))
post  = postProcessingDays
```

Defaults: `pollinationDayInFlower = 14`, `seedMaturationDays = 28`, `postProcessingDays = 21` (days).

Parallelization reduces **calendar time** after the first generation: `effectiveDays ≈ ceil(T_gen / parallelBatches)`.

---

## 2) Strain Fields used (subset)

We rely on keys already present/accepted by our `strain.json` shape:

- `id`, `name`, `lineage.parents[]`
- `genotype.{sativa,indica,ruderalis}`
- `chemotype.{thcContent,cbdContent}`
- `morphology.{growthRate,yieldFactor,leafAreaIndex}`
- `environmentalPreferences.{ lightSpectrum, lightIntensity, lightCycle, idealTemperature, idealHumidity, phRange }`
- `dailyNutrientDemand.{vegetation,flowering}` (NPK per phase)
- `dailyWaterUsagePerSquareMeter.{vegetation,flowering}`
- `generalResilience`, `npkTolerance`, `npkStressIncrement`
- `dailyInfectionIncrement`, `infectionThreshold`, `recoveryRate`, `regenerationRate`, `degenerationRate`, `fatalityThreshold`
- `vegetationDays`, `floweringDays`, `transitionTriggerHours`

> All numeric values in SI, camelCase identifiers, no unit suffixes.

---

## 3) Breeding Core (TypeScript)

> Drop this into **`packages/backend/src/breeding/breedingEngine.ts`** (or similar). No external deps.

```ts
// packages/backend/src/breeding/breedingEngine.ts
// Deterministic breeding core for Weed Breed.
// Exports: crossF1, segregateF2, backcross, stabilizeIBL, generatePopulation, selectTop, scoreStrain

import { randomUUID } from 'node:crypto';

/** Deterministic RNG seeded by (seedString, streamId). */
export function createRng(seedString = 'WB-SEED', streamId = 'breeding') {
  let h = 1779033703 ^ seedString.length;
  for (let i = 0; i < seedString.length; i++) {
    h = Math.imul(h ^ seedString.charCodeAt(i), 3432918353);
    h = (h << 13) | (h >>> 19);
  }
  for (let i = 0; i < streamId.length; i++) {
    h = Math.imul(h ^ streamId.charCodeAt(i), 461845907);
    h = (h << 13) | (h >>> 19);
  }
  return function rnd() {
    h = Math.imul(h ^ (h >>> 16), 2246822507);
    h = Math.imul(h ^ (h >>> 13), 3266489909);
    const t = (h ^= h >>> 16) >>> 0;
    return (t & 0x7fffffff) / 0x80000000; // [0,1)
  };
}

/** Standard normal via Box–Muller */
function normal01(rnd: () => number) {
  let u = 0,
    v = 0;
  while (u === 0) u = rnd();
  while (v === 0) v = rnd();
  return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2 * Math.PI * v);
}

const clamp01 = (x: number) => Math.max(0, Math.min(1, x));
const lerp = (a: number, b: number, t: number) => a + (b - a) * t;

function mixScalar(
  a: number,
  b: number,
  { t, sigma, rnd }: { t: number; sigma: number; rnd: () => number },
) {
  const base = lerp(a, b, t);
  return base + sigma * normal01(rnd);
}

function mixRange(
  rA: [number, number],
  rB: [number, number],
  opts: { t: number; sigma: number; rnd: () => number },
): [number, number] {
  const lo = Math.min(mixScalar(rA[0], rB[0], opts), mixScalar(rA[1], rB[1], opts));
  const hi = Math.max(mixScalar(rA[1], rB[1], opts), mixScalar(rA[0], rB[0], opts));
  return [lo, hi];
}

function mixPhasedObject(
  oA: any,
  oB: any,
  keys: string[],
  opts: { t: number; sigma: number; rnd: () => number },
) {
  const out: any = {};
  for (const k of keys) {
    out[k] = {};
    const phases = new Set([...Object.keys(oA?.[k] ?? {}), ...Object.keys(oB?.[k] ?? {})]);
    for (const p of phases) {
      const a = oA?.[k]?.[p];
      const b = oB?.[k]?.[p];
      if (typeof a === 'number' && typeof b === 'number') {
        out[k][p] = mixScalar(a, b, opts);
      } else if (a && b && typeof a === 'object' && typeof b === 'object') {
        out[k][p] = {};
        const nutrients = new Set([...Object.keys(a), ...Object.keys(b)]);
        for (const n of nutrients) {
          const an = a[n] ?? b[n] ?? 0;
          const bn = b[n] ?? a[n] ?? 0;
          out[k][p][n] = mixScalar(an, bn, opts);
        }
      }
    }
  }
  return out;
}

function normalizeGenotype(g: { sativa?: number; indica?: number; ruderalis?: number }) {
  const s = (g.sativa ?? 0) + (g.indica ?? 0) + (g.ruderalis ?? 0);
  if (s <= 0) return { sativa: 0.33, indica: 0.33, ruderalis: 0.34 };
  return {
    sativa: clamp01((g.sativa ?? 0) / s),
    indica: clamp01((g.indica ?? 0) / s),
    ruderalis: clamp01((g.ruderalis ?? 0) / s),
  };
}

function applyHeterosis(child: any, factor = { yieldFactor: 1.06, growthRate: 1.03 }) {
  if (child.morphology?.yieldFactor != null) child.morphology.yieldFactor *= factor.yieldFactor;
  if (child.morphology?.growthRate != null) child.morphology.growthRate *= factor.growthRate;
}

export type BreedingMode = 'F1' | 'F2' | 'BX' | 'IBL';

export interface MinimalStrain {
  id: string;
  name: string;
  genotype?: { sativa?: number; indica?: number; ruderalis?: number };
  chemotype?: { thcContent?: number; cbdContent?: number };
  morphology?: { growthRate?: number; yieldFactor?: number; leafAreaIndex?: number };
  environmentalPreferences?: any;
  dailyNutrientDemand?: any;
  dailyWaterUsagePerSquareMeter?: any;
  generalResilience?: number;
  npkTolerance?: number;
  npkStressIncrement?: number;
  dailyInfectionIncrement?: number;
  infectionThreshold?: number;
  recoveryRate?: number;
  degenerationRate?: number;
  regenerationRate?: number;
  fatalityThreshold?: number;
  vegetationDays?: number;
  floweringDays?: number;
  transitionTriggerHours?: number;
}

function makeChild(
  parentA: MinimalStrain,
  parentB: MinimalStrain,
  {
    seed = 'WB-SEED',
    mode = 'F1' as BreedingMode,
    bxParent = 'A' as 'A' | 'B',
    mutationSigma = 0.01,
  } = {},
) {
  const rnd = createRng(seed, `breed-${mode}`);
  const t = mode === 'F1' ? 0.5 : mode === 'BX' ? (bxParent === 'A' ? 0.75 : 0.25) : 0.5;
  const sigma =
    mode === 'F1'
      ? 0.02
      : mode === 'F2'
        ? 0.06
        : mode === 'BX'
          ? 0.03
          : mode === 'IBL'
            ? 0.015
            : 0.03;
  const mix = (a: number, b: number) => mixScalar(a, b, { t, sigma, rnd });

  const geno = normalizeGenotype({
    sativa: mix(parentA.genotype?.sativa ?? 0.33, parentB.genotype?.sativa ?? 0.33),
    indica: mix(parentA.genotype?.indica ?? 0.33, parentB.genotype?.indica ?? 0.33),
    ruderalis: mix(parentA.genotype?.ruderalis ?? 0.34, parentB.genotype?.ruderalis ?? 0.34),
  });

  const thc = clamp01(
    mix(parentA.chemotype?.thcContent ?? 0.15, parentB.chemotype?.thcContent ?? 0.15),
  );
  const cbd = clamp01(
    mix(parentA.chemotype?.cbdContent ?? 0.01, parentB.chemotype?.cbdContent ?? 0.01),
  );

  const growthRate = clamp01(
    mix(parentA.morphology?.growthRate ?? 0.5, parentB.morphology?.growthRate ?? 0.5),
  );
  const yieldFactor = Math.max(
    0,
    mix(parentA.morphology?.yieldFactor ?? 1.0, parentB.morphology?.yieldFactor ?? 1.0),
  );
  const leafAreaIndex = Math.max(
    0,
    mix(parentA.morphology?.leafAreaIndex ?? 2.0, parentB.morphology?.leafAreaIndex ?? 2.0),
  );

  const child: any = {
    id: randomUUID(),
    name: `${parentA.name ?? 'A'} × ${parentB.name ?? 'B'} ${mode}`,
    lineage: { parents: [parentA.id, parentB.id] },
    genotype: geno,
    chemotype: { thcContent: thc, cbdContent: cbd },
    morphology: { growthRate, yieldFactor, leafAreaIndex },
    environmentalPreferences: {
      lightSpectrum: {
        vegetation: mixRange(
          (parentA.environmentalPreferences?.lightSpectrum?.vegetation as [number, number]) ?? [
            400, 700,
          ],
          (parentB.environmentalPreferences?.lightSpectrum?.vegetation as [number, number]) ?? [
            400, 700,
          ],
          { t, sigma, rnd },
        ),
        flowering: mixRange(
          (parentA.environmentalPreferences?.lightSpectrum?.flowering as [number, number]) ?? [
            350, 660,
          ],
          (parentB.environmentalPreferences?.lightSpectrum?.flowering as [number, number]) ?? [
            350, 660,
          ],
          { t, sigma, rnd },
        ),
      },
      lightIntensity: {
        vegetation: mixRange(
          (parentA.environmentalPreferences?.lightIntensity?.vegetation as [number, number]) ?? [
            400, 600,
          ],
          (parentB.environmentalPreferences?.lightIntensity?.vegetation as [number, number]) ?? [
            400, 600,
          ],
          { t, sigma, rnd },
        ),
        flowering: mixRange(
          (parentA.environmentalPreferences?.lightIntensity?.flowering as [number, number]) ?? [
            600, 1000,
          ],
          (parentB.environmentalPreferences?.lightIntensity?.flowering as [number, number]) ?? [
            600, 1000,
          ],
          { t, sigma, rnd },
        ),
      },
      lightCycle: {
        vegetation: [
          Math.round(
            mix(
              parentA.environmentalPreferences?.lightCycle?.vegetation?.[0] ?? 18,
              parentB.environmentalPreferences?.lightCycle?.vegetation?.[0] ?? 18,
            ),
          ),
          Math.round(
            mix(
              parentA.environmentalPreferences?.lightCycle?.vegetation?.[1] ?? 6,
              parentB.environmentalPreferences?.lightCycle?.vegetation?.[1] ?? 6,
            ),
          ),
        ],
        flowering: [12, 12],
      },
      idealTemperature: {
        vegetation: mixRange(
          (parentA.environmentalPreferences?.idealTemperature?.vegetation as [number, number]) ?? [
            20, 28,
          ],
          (parentB.environmentalPreferences?.idealTemperature?.vegetation as [number, number]) ?? [
            20, 28,
          ],
          { t, sigma, rnd },
        ),
        flowering: mixRange(
          (parentA.environmentalPreferences?.idealTemperature?.flowering as [number, number]) ?? [
            22, 30,
          ],
          (parentB.environmentalPreferences?.idealTemperature?.flowering as [number, number]) ?? [
            22, 30,
          ],
          { t, sigma, rnd },
        ),
      },
      idealHumidity: {
        vegetation: mixRange(
          (parentA.environmentalPreferences?.idealHumidity?.vegetation as [number, number]) ?? [
            0.6, 0.7,
          ],
          (parentB.environmentalPreferences?.idealHumidity?.vegetation as [number, number]) ?? [
            0.6, 0.7,
          ],
          { t, sigma, rnd },
        ),
        flowering: mixRange(
          (parentA.environmentalPreferences?.idealHumidity?.flowering as [number, number]) ?? [
            0.5, 0.6,
          ],
          (parentB.environmentalPreferences?.idealHumidity?.flowering as [number, number]) ?? [
            0.5, 0.6,
          ],
          { t, sigma, rnd },
        ),
      },
      phRange: mixRange(
        (parentA.environmentalPreferences?.phRange as [number, number]) ?? [5.8, 6.2],
        (parentB.environmentalPreferences?.phRange as [number, number]) ?? [5.8, 6.2],
        { t, sigma, rnd },
      ),
    },
    ...mixPhasedObject(
      {
        dailyNutrientDemand: parentA.dailyNutrientDemand,
        dailyWaterUsagePerSquareMeter: parentA.dailyWaterUsagePerSquareMeter,
      },
      {
        dailyNutrientDemand: parentB.dailyNutrientDemand,
        dailyWaterUsagePerSquareMeter: parentB.dailyWaterUsagePerSquareMeter,
      },
      ['dailyNutrientDemand', 'dailyWaterUsagePerSquareMeter'],
      { t, sigma, rnd },
    ),
    generalResilience: clamp01(
      mix(parentA.generalResilience ?? 0.5, parentB.generalResilience ?? 0.5),
    ),
    npkTolerance: Math.max(0, mix(parentA.npkTolerance ?? 0.05, parentB.npkTolerance ?? 0.05)),
    npkStressIncrement: Math.max(
      0,
      mix(parentA.npkStressIncrement ?? 0.01, parentB.npkStressIncrement ?? 0.01),
    ),
    dailyInfectionIncrement: Math.max(
      0,
      mix(parentA.dailyInfectionIncrement ?? 0.002, parentB.dailyInfectionIncrement ?? 0.002),
    ),
    infectionThreshold: clamp01(
      mix(parentA.infectionThreshold ?? 0.2, parentB.infectionThreshold ?? 0.2),
    ),
    recoveryRate: Math.max(0, mix(parentA.recoveryRate ?? 0.04, parentB.recoveryRate ?? 0.04)),
    degenerationRate: Math.max(
      0,
      mix(parentA.degenerationRate ?? 0.03, parentB.degenerationRate ?? 0.03),
    ),
    regenerationRate: Math.max(
      0,
      mix(parentA.regenerationRate ?? 0.03, parentB.regenerationRate ?? 0.03),
    ),
    fatalityThreshold: clamp01(
      mix(parentA.fatalityThreshold ?? 0.95, parentB.fatalityThreshold ?? 0.95),
    ),
    vegetationDays: Math.max(
      7,
      Math.round(mix(parentA.vegetationDays ?? 21, parentB.vegetationDays ?? 21)),
    ),
    floweringDays: Math.max(
      42,
      Math.round(mix(parentA.floweringDays ?? 60, parentB.floweringDays ?? 60)),
    ),
    transitionTriggerHours: Math.round(
      mix(parentA.transitionTriggerHours ?? 13, parentB.transitionTriggerHours ?? 13),
    ),
  };

  if (mode === 'F1') applyHeterosis(child);

  // light global mutation
  child.morphology.growthRate = clamp01(child.morphology.growthRate + 0.01 * normal01(rnd));
  child.chemotype.thcContent = clamp01(child.chemotype.thcContent + 0.01 * normal01(rnd));
  child.chemotype.cbdContent = clamp01(child.chemotype.cbdContent + 0.01 * normal01(rnd));

  return child;
}

export function crossF1(a: MinimalStrain, b: MinimalStrain, opts: any = {}) {
  return makeChild(a, b, { ...opts, mode: 'F1' });
}
export function segregateF2(a: MinimalStrain, b: MinimalStrain, opts: any = {}) {
  return makeChild(a, b, { ...opts, mode: 'F2' });
}
export function backcross(
  a: MinimalStrain,
  b: MinimalStrain,
  { recurrent = 'A', ...opts }: any = {},
) {
  return makeChild(a, b, { ...opts, mode: 'BX', bxParent: recurrent === 'A' ? 'A' : 'B' });
}
export function stabilizeIBL(p: MinimalStrain, opts: any = {}) {
  return makeChild(p, p, { ...opts, mode: 'IBL' });
}

export function generatePopulation(
  a: MinimalStrain,
  b: MinimalStrain,
  { count = 24, mode = 'F1', seed = 'WB-SEED' } = {},
) {
  const kids: any[] = [];
  for (let i = 0; i < count; i++) kids.push(makeChild(a, b, { seed: `${seed}-i${i}`, mode }));
  return kids;
}

export function scoreStrain(
  strain: MinimalStrain,
  weights = { yield: 0.5, thc: 0.3, resilience: 0.2 },
) {
  const cycleDays = (strain.vegetationDays ?? 21) + (strain.floweringDays ?? 60);
  const cyclePenalty = Math.max(0, (cycleDays - 84) / 84);
  const score =
    (strain.morphology?.yieldFactor ?? 1) * weights.yield +
    (strain.chemotype?.thcContent ?? 0.15) * weights.thc +
    (strain.generalResilience ?? 0.5) * weights.resilience -
    cyclePenalty * 0.2;
  return score;
}

export function selectTop(pop: MinimalStrain[], k = 3, weights?: any) {
  return [...pop]
    .map((s) => ({ s, score: scoreStrain(s as any, weights) }))
    .sort((a, b) => b.score - a.score)
    .slice(0, k)
    .map((e) => e.s);
}
```

---

## 4) Time Model (TypeScript)

> Drop this into **`packages/backend/src/breeding/timeModel.ts`**.

```ts
// packages/backend/src/breeding/timeModel.ts
// Time estimation for breeding generations with overlap & parallelization.

export interface MinimalStrain {
  id: string;
  name: string;
  vegetationDays?: number;
  floweringDays?: number;
}

export interface BreedingTimingSettings {
  pollinationDayInFlower: number;
  seedMaturationDays: number;
  postProcessingDays: number;
}

export const defaultBreedingTimings: BreedingTimingSettings = {
  pollinationDayInFlower: 14,
  seedMaturationDays: 28,
  postProcessingDays: 21,
};

export interface GenerationBreakdown {
  vegetationDays: number;
  floweringDays: number;
  overlapCompensationDays: number;
  postProcessingDays: number;
  totalDays: number;
}

function avg(a?: number, b?: number, fallback = 21) {
  const va = typeof a === 'number' ? a : fallback;
  const vb = typeof b === 'number' ? b : fallback;
  return (va + vb) / 2;
}

export function generationDurationDays(
  parentA: MinimalStrain,
  parentB: MinimalStrain,
  settings: BreedingTimingSettings = defaultBreedingTimings,
): GenerationBreakdown {
  const vegetationDays = Math.max(
    7,
    Math.round(avg(parentA.vegetationDays, parentB.vegetationDays, 21)),
  );
  const floweringDays = Math.max(
    42,
    Math.round(avg(parentA.floweringDays, parentB.floweringDays, 60)),
  );

  const afterPollination = Math.max(0, floweringDays - settings.pollinationDayInFlower);
  const missingForSeeds = Math.max(0, settings.seedMaturationDays - afterPollination);
  const overlapCompensationDays = Math.round(missingForSeeds);

  const totalDays =
    vegetationDays + floweringDays + overlapCompensationDays + settings.postProcessingDays;
  return {
    vegetationDays,
    floweringDays,
    overlapCompensationDays,
    postProcessingDays: settings.postProcessingDays,
    totalDays,
  };
}

export type ProgramStep = 'F1' | 'F2' | 'F3' | 'F4' | 'F5' | 'BX1' | 'BX2' | 'IBL';

export function estimateProjectTimelineDays(
  parents: { A: MinimalStrain; B: MinimalStrain },
  steps: ProgramStep[] = ['F1', 'F2', 'F3', 'F4', 'F5'],
  settings: BreedingTimingSettings = defaultBreedingTimings,
  parallelBatches = 1,
): { perGeneration: GenerationBreakdown[]; calendarDays: number } {
  const perGeneration: GenerationBreakdown[] = [];
  let calendarDays = 0;
  const base = generationDurationDays(parents.A, parents.B, settings);

  steps.forEach((_, index) => {
    perGeneration.push(base);
    if (index === 0) calendarDays += base.totalDays;
    else calendarDays += Math.ceil(base.totalDays / Math.max(1, parallelBatches));
  });

  return { perGeneration, calendarDays };
}

export function examplePrograms(
  parents: { A: MinimalStrain; B: MinimalStrain },
  settings: BreedingTimingSettings = defaultBreedingTimings,
) {
  const classic = estimateProjectTimelineDays(parents, ['F1', 'F2', 'F3', 'F4', 'F5'], settings, 1);
  const backcross = estimateProjectTimelineDays(
    parents,
    ['F1', 'BX1', 'BX2', 'F2', 'F3'],
    settings,
    2,
  );
  return { classic, backcross };
}
```

---

## 5) UI (React/Vite) — Pseudocode

> Frontend lives in `apps/frontend`. Keep it simple; use hooks and a store (zustand or context) to keep selected parents & program.

**State Model (sketch)**

```ts
// apps/frontend/src/features/breeding/state.ts
export type ProgramStep = 'F1' | 'F2' | 'F3' | 'F4' | 'F5' | 'BX1' | 'BX2' | 'IBL';
export interface BreedingState {
  parentAId?: string;
  parentBId?: string;
  steps: ProgramStep[];
  seed: string; // deterministic seed
  populationSize: number; // per generation
  parallelBatches: number;
}
```

**Page Layout**

```tsx
// apps/frontend/src/features/breeding/BreedingLabPage.tsx
// Pseudocode – wire to real components/APIs later
import { useState } from 'react';
import { generationDurationDays, estimateProjectTimelineDays } from '@backend/breeding/timeModel';
import { generatePopulation, selectTop } from '@backend/breeding/breedingEngine';

export default function BreedingLabPage() {
  const [parentA, setParentA] = useState<any>();
  const [parentB, setParentB] = useState<any>();
  const [steps, setSteps] = useState(['F1', 'F2', 'F3', 'F4', 'F5'] as const);
  const [seed, setSeed] = useState('WB-SEED');
  const [populationSize, setPopulationSize] = useState(24);
  const [parallelBatches, setParallelBatches] = useState(1);

  const canSim = !!parentA && !!parentB;
  const breakdown = canSim ? generationDurationDays(parentA, parentB) : undefined;
  const timeline = canSim
    ? estimateProjectTimelineDays(
        { A: parentA, B: parentB },
        steps as any,
        undefined,
        parallelBatches,
      )
    : undefined;

  function handleSimulate() {
    if (!canSim) return;
    const pop = generatePopulation(parentA, parentB, { count: populationSize, mode: 'F1', seed });
    const top = selectTop(pop, 3);
    // show in table/modal; allow user to pin as new parents for next step
  }

  return (
    <div className="grid gap-4">
      {/* Parent pickers */}
      {/* Program planner (steps) */}
      {/* Seed, populationSize, parallelBatches inputs */}
      {/* Breakdown cards for veg/flower/tail/post */}
      {/* Timeline summary (calendar days) */}
      <button onClick={handleSimulate} disabled={!canSim}>
        Simulate F1 Population
      </button>
    </div>
  );
}
```

**Components (sketch)**

- `ParentPicker`: list/search strain blueprints → sets `parentA|B` (by id or full object).
- `ProgramPlanner`: editable chips for steps (`F1`, `F2`, `BX1`, …) with presets.
- `TimelineCard`: renders numbers from `generationDurationDays` and `estimateProjectTimelineDays`.
- `PopulationTable`: shows generated children (id, key traits, score); actions: **Promote as Parent**, **Save as Blueprint**.

**Saving a blueprint**

- Backend route `POST /api/breeding/blueprints` to persist a generated child JSON (validates against strain schema; auto‑adds `lineage.parents`).

---

## 6) CLI Demo (optional)

Add a minimal script to run from backend:

```ts
// packages/backend/scripts/breedTimeDemo.ts
import { examplePrograms } from '../src/breeding/timeModel';

const A = { id: 'A', name: 'Parent A', vegetationDays: 21, floweringDays: 60 };
const B = { id: 'B', name: 'Parent B', vegetationDays: 24, floweringDays: 58 };

const out = examplePrograms({ A, B });
console.log(JSON.stringify(out, null, 2));
```

**package.json** (backend)

```json
{
  "scripts": {
    "breed:time": "tsx packages/backend/scripts/breedTimeDemo.ts"
  }
}
```

---

## 7) Balancing Knobs

- **Heterosis** multipliers (affect `yieldFactor`, `growthRate`).
- **σ per mode**: F1 (low), F2 (high), BX (mid), IBL (very low).
- **Mutation sigma**: rare small global shake.
- **Score weights** in `scoreStrain` for your meta (yield vs THC vs resilience vs cycle length penalty).
- **Parallelization** vs cost: larger labs shorten calendar time but burn cash.

---

## 8) Integration Tips

- Keep RNG streams **per run**: `createRng(seed, 'breed-F1')`, `'breed-F2'`, …
- Use schema validation (Zod) on save; never rename JSON keys.
- Store all times as **days**; UI may format into months/weeks.
- Deterministic tests: fix `seed`, assert distribution ranges and ordering by `scoreStrain`.

---

**Done.** This file gives you drop‑in TS modules, UI scaffolding, and a CLI demo hook. Adjust weights/sigmas to hit your desired gameplay curve.

## UI Screenshot Insights (docs/ui/ui-screenshot-insights.md)

Source: [`docs/ui/ui-screenshot-insights.md`](../docs/ui/ui-screenshot-insights.md)

# UI Screenshot Insights

## Overview of the Frontend Idea

The screenshots convey a dashboard-style application that guides the player from high-level operations down to per-plant decisions through a clear Structure → Room → Zone drill-down, as illustrated in the structure and room overview captures ([Structure overview](./screenshots/03-structure-overview.png), [Room overview](./screenshots/10-room-overview-%28growroom%29.png)). Global navigation relies on cards and inline actions to jump between these hierarchy levels while providing immediate CRUD affordances for each tier.【F:docs/ui/ui-components-desciption.md†L483-L525】【F:docs/ui/ui_interactions_spec.md†L27-L37】 Zone views then compose telemetry, device management, and plant operations into a single control surface, matching the micro-loop described in the interaction spec and shown in the zone detail screens ([Zone detail – collapsed](./screenshots/11-zone-detailview-%28setup-closed%29.png), [Zone detail – expanded](./screenshots/12-zone-detailview-%28setup-opened%29.png), [Zone detail – batch mode](./screenshots/13-zone-detailview-%28mass-selection-activated%29.png)).【F:docs/ui/ui-components-desciption.md†L407-L533】【F:docs/ui/ui_interactions_spec.md†L40-L54】

## Game Lifecycle Surfaces

The welcome screen foregrounds the StartScreen component with quick entry points for New, Quick, and Import game flows, reflecting the lifecycle actions in the façade contract and captured in the welcome hero ([Welcome screen](./screenshots/01-welcome-screen.png)).【F:docs/ui/ui-components-desciption.md†L393-L399】【F:docs/ui/ui_interactions_spec.md†L13-L23】 Selecting “New Game” opens a dedicated modal that captures company metadata and a deterministic seed using shared modal and form primitives, reinforcing that modal workflows pause gameplay until the façade acknowledges the command, as seen in the new game form ([New game modal](./screenshots/02-modal-new_game.png)).【F:docs/ui/ui-components-desciption.md†L347-L353】【F:docs/ui/ui-components-desciption.md†L123-L178】

## Strategic Management Views

The structure overview leans on DashboardView cards with inline rename/duplicate buttons, enabling fast adjustments while encouraging the user to descend into specific rooms or zones without leaving the main context, which is showcased in the management dashboard capture ([Structure overview cards](./screenshots/03-structure-overview.png)).【F:docs/ui/ui-components-desciption.md†L483-L487】【F:docs/ui/ui-components-desciption.md†L95-L165】 Structure and room detail views then reuse ZoneCard summaries so that geometry, duplication, and deletion actions stay one click away, aligning with the macro infrastructure flows for renting, cloning, or removing spaces, as highlighted in the deep-dive shots ([Structure detail view](./screenshots/09-structure-detailview.png), [Room overview](./screenshots/10-room-overview-%28growroom%29.png)).【F:docs/ui/ui-components-desciption.md†L513-L525】【F:docs/ui/ui_interactions_spec.md†L27-L36】

## Operations, Personnel, and Finance Loops

Within a zone, the screenshots highlight the layered EnvironmentPanel (collapsed vs. expanded), device lists, and the ZonePlantPanel’s batch-selection mode. This trio encapsulates monitoring, setpoint control, and multi-plant actions that the cultivation loop depends on, as evidenced in the zone detail captures ([Zone detail – collapsed](./screenshots/11-zone-detailview-%28setup-closed%29.png), [Zone detail – expanded](./screenshots/12-zone-detailview-%28setup-opened%29.png), [Zone detail – batch mode](./screenshots/13-zone-detailview-%28mass-selection-activated%29.png)).【F:docs/ui/ui-components-desciption.md†L407-L462】【F:docs/ui/ui_interactions_spec.md†L40-L54】 Complementary strategic views such as PersonnelView and FinanceView expose their respective loops via tabbed candidate/staff management and collapsible revenue/expense reports, mirroring the hiring and finance stories from the spec and illustrated by their overview shots ([Personnel – job market](./screenshots/04-personell-overview-%28job-market%29.png), [Personnel – employees](./screenshots/05-personell-overview-%28my-employees%29.png), [Finance – cards collapsed](./screenshots/06-finances-overview-%28cards_closed%29.png), [Finance – cards expanded](./screenshots/07-finances-overview-%28cards_opened%29.png)).【F:docs/ui/ui-components-desciption.md†L490-L509】【F:docs/ui/ui_interactions_spec.md†L58-L73】

## Interaction & Visual Patterns

Every modal in the screenshots—including the game menu and hiring/new game flows—reuses the shared Modal shell, Form inputs, and Primary buttons, underscoring a consistent command pattern for façade intents and visible across multiple modal captures ([Game menu modal](./screenshots/08-model-game_menu.png), [New game modal](./screenshots/02-modal-new_game.png)).【F:docs/ui/ui-components-desciption.md†L123-L178】【F:docs/ui/ui-components-desciption.md†L323-L337】 The dark Tailwind-based design system (stone background, lime accents) gives all cards and panels a cohesive appearance, reinforcing that gameplay relies on high-contrast status colors for quick scanning, a theme evident in the dashboard imagery ([Structure overview cards](./screenshots/03-structure-overview.png), [Zone detail – expanded](./screenshots/12-zone-detailview-%28setup-opened%29.png)).【F:docs/ui/ui-components-desciption.md†L551-L574】 Together, these patterns show that the UI concept emphasizes deterministic flows, reusable components, and a layered information hierarchy that mirrors the simulation architecture.

## Weedbreed.AI — Frontend Implementation Spec (docs/ui/ui-implementation-spec.md)

Source: [`docs/ui/ui-implementation-spec.md`](../docs/ui/ui-implementation-spec.md)

# Weedbreed.AI — Frontend Implementation Spec

_Purpose: A precise, file‑agnostic specification for a coding AI to implement the UI. UI holds **no business logic**; it renders read‑only **snapshots** and sends **facade commands**. All entity references use `id` (UUID v4). Currency handling is neutral. Device placement must respect `allowedRoomPurposes`. Treatment modals must respect `reentryIntervalTicks` / `preHarvestIntervalTicks` policies. CSS snippets below justify UX decisions._

---

## 1) Overall Architecture & Layout

The frontend is a single‑page application with a persistent header, breadcrumb navigation, and a dynamic content area.

**Main regions**

- **Dashboard**: persistent header showing key game stats and global controls.
- **Navigation Bar**: breadcrumb bar below the dashboard, reflecting the current hierarchy (e.g., _Structures > Warehouse 1 > Grow Room A_).
- **Content Area (Main View)**: renders interactive views based on selected entity.

_Implementation status:_ `src/frontend/src/App.tsx` now implements this shell using `DashboardHeader`, `TimeDisplay`, and the `Navigation` component. The sidebar consumes the navigation slice (Structure/Room/Zone), while the header wires up the simulation controls via `useGameStore` and embeds an event ticker from `selectRecentEvents`.

**Modal focus handling**

- When a modal is open, the simulation content behind it is visually de‑emphasized using a blur.
- Apply `.content-area.blurred` to the scrollable content root while any modal is active.

```css
.content-area.blurred {
  filter: blur(3px);
  pointer-events: none; /* prevents accidental interactions behind modal */
}
```

---

## 2) Core Components (Behavior & Layout)

### 2.1 Dashboard (primary info & controls)

**Layout**: horizontal flex container split into two groups: `dashboard-metrics` (left) and `dashboard-controls` (right).

```css
.dashboard {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
}
.dashboard-metrics,
.dashboard-controls {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}
```

**Functions (left → right)**

- **Capital**: displays current capital (formatted as currency by the UI layer; currency‑neutral value).
- **Cumulative Yield**: total harvested product in grams.
- **Planned plant capacity**: sum of `zones[].plantingPlan.count` for enabled plans; hide when the aggregate is zero to avoid UI clutter during early runs.
- **Time Display**:
  - **In‑game date/time** (e.g., `Y1, D30, 14:00`).
  - **Tick progress ring**: an SVG circle animating to the next tick (hour). Animate stroke via `stroke-dashoffset`.

```css
.tick-ring circle.progress {
  transition: stroke-dashoffset 0.3s linear;
}
```

- **Simulation Controls**:
  - **Play/Pause** toggle (icons: `play_circle` / `pause_circle`).
  - **Game speed controls** (`.game-speed-controls`): buttons for `0.5x`, `1x`, `10x`, `25x`, `50x`, `100x`, and `250x`. The active one has `.active` and primary background color.

```css
.game-speed-controls .btn {
  padding: 0.4rem 0.6rem;
  border-radius: 0.5rem;
}
.game-speed-controls .btn.active {
  background: var(--color-primary);
  color: #fff;
}
```

- **View Switchers**:
  - **Finances** (icon: `monitoring`) → switches main view to financial overview.
  - **Personnel** (icon: `groups`) → switches main view to personnel management.

- **Notifications** (icon: `notifications`) → opens a popover with alerts. A red badge (`.notifications-badge`) shows the count of unread alerts.
- **Game Menu** (icon: `settings`) → flyout with **Save**, **Load**, **Export**, **Reset**.

### 2.2 Navigation Bar (breadcrumbs)

**Layout**: simple horizontal bar with text and icons.

**Functions**

- **Back arrow** (`←`): visible once the user navigates below the top structures list; clicking steps one level up (e.g., Zone → Room).
- **Breadcrumbs**: path like `Structures / Warehouse 1 / Grow Room A`. Each segment is clickable to jump directly to that level.

```css
.breadcrumbs {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.breadcrumbs a {
  color: var(--color-link);
  text-decoration: none;
}
.breadcrumbs .sep {
  opacity: 0.6;
}
```

---

## 3) Hierarchical Views (Structure → Room → Zone)

Users navigate through containers forming the core gameplay loop.

### 3.1 Structures View

**Layout**: responsive grid of cards.

```css
.card-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 1rem;
}
.card {
  background: var(--surface-color);
  border-radius: var(--radius-lg);
  padding: 1rem;
}
```

**Functions**

- **Structure Card**: represents a rented building; shows **name**, **floor area**, **room count**, and a **plant summary**. Clicking navigates to its detail view.
- **+ Rent Structure** button: opens the **rent** modal.

### 3.2 Structure Detail View

**Layout**: header with details/actions plus a `.card-container` for the rooms in the structure.

**Header**

- **Title & actions** with icon buttons:
  - **Rename** (`edit`) → opens **rename** modal.
  - **Delete** (`delete`) → opens **delete** confirmation modal.

**Room Cards**

- Each card shows **name**, **area**, **purpose**, and a **plant summary**. Clicking navigates to the room detail view.
- **Actions (top‑right icons)**
  - **Rename** (`edit`) → transforms the card title into an inline input for immediate rename (no modal).
  - **Duplicate** (`content_copy`) → duplicates room with zones/devices if sufficient structure space exists; disabled if space is insufficient. Plants, PlantingPlan and Water or Nutrients are not to be duplicated. Devices are duplicatable, and the user will be cashed for the duplicated devices. a hover over the icon shows info about the "copy"-costs.
  - **Delete** (`delete`) → opens delete modal for that room.

### 3.3 Room Detail View

**Layout**: header + `.card-container` for zones.

**Special case**: if room `purpose` is `lab`, render a **Breeding Station** component instead of the zones list.

**Functions**

- **Header**: shows room name and a `.purpose-badge`. Actions identical to structure header (rename, delete).
- **Zone Cards**
  - Click → navigates to zone detail view.
  - Actions: inline **rename**, **duplicate** (`content_copy`), **delete** (`delete`).

### 3.4 Zone Detail View

**Layout**: two‑column grid; single column below 900px.

```css
.zone-detail-view {
  display: grid;
  grid-template-columns: 1.2fr 1fr; /* left status, right lists */
  gap: 1rem;
}
@media (max-width: 900px) {
  .zone-detail-view {
    grid-template-columns: 1fr;
  }
}
```

**Header functions**

- **Zone navigation** arrows (`arrow_back_ios`, `arrow_forward_ios`) to jump between sibling zones in the same room.

**Left column — Zone Info Panel**

- **Supplies Card**: shows water and nutrient stocks. **+ Water** and **+ Nutrients** buttons open the **addSupply** modal.
- **Lighting Card**: shows light cycle and current lighting (PPFD, DLI). Coverage is color‑coded:
  - `.lighting-ok` (green) for sufficient coverage
  - `.lighting-insufficient` (yellow) for insufficient coverage

  _Data contract_: read `snapshot.zones[].lighting`. The backend now derives `coverageRatio` by summing the coverage area of operational lighting devices (scaled by device efficiency) and exposes any `averagePpfd`/`dli` readings if available.

```css
.lighting-ok {
  color: #18a957;
}
.lighting-insufficient {
  color: #d8a400;
}
```

- **Environment Card**: shows temperature, humidity, CO₂, etc.; values are highlighted when outside recommended ranges.

**Right column — Lists & Actions**

**Plantings List**

- Collapsible list of planting groups.
- **Info icon** (`info`) next to strain name shows a tooltip with ideal growth conditions.
- **Harvesting**:
  - **Single plant**: if a group is expanded, each harvestable plant shows a scissor icon (`content_cut`) to harvest that single plant.
  - **Harvest All**: if at least one plant is harvest‑ready, show a prominent `.btn-harvest-all` button to harvest all ready plants in the zone.

- **Delete**: trash icon (`delete`) on the group deletes all plants in that group; trash on a plant deletes only that plant.

**Planting Plan**

- Configure an **auto‑replant** plan for the zone.
- UI shows planned **strain** and **quantity**; a `.toggle-switch` enables/disables automatic replanting. Buttons with `edit` and `delete` icons allow editing/removing the plan. If no plan exists, show a **+ Create Plan** button.
- Consume `snapshot.zones[].plantingPlan` when present; hide the summary UI when the field is missing or `null`.

**Devices List**

- Devices collapsed by **type**; each group is collapsible.
- **Status indicator** `.device-status-indicator` uses color to reflect group state:
  - `status-on` (green): all on
  - `status-off` (gray): all off
  - `status-mixed` (yellow): mixed
  - `status-broken` (red): all broken

```css
.device-status-indicator {
  width: 0.6rem;
  height: 0.6rem;
  border-radius: 50%;
}
.device-status-indicator.status-on {
  background: #19b56b;
}
.device-status-indicator.status-off {
  background: #8b8f97;
}
.device-status-indicator.status-mixed {
  background: #d8a400;
}
.device-status-indicator.status-broken {
  background: #d64545;
}
```

- Clicking the indicator toggles **all devices in the group** on/off.
- **Tuning** (`tune`) for climate/CO₂ devices opens **editDevice** modal for setpoints (temperature, humidity, etc.).
- Setpoint modals send `config.update` commands with the zone's `id`
  (UUID v4) as `zoneId`, `metric` (`temperature`, `relativeHumidity`,
  `vpd`, `co2`, `ppfd`), and surface backend warnings (e.g., clamp
  notifications). Inputs must stay within the enforced ranges —
  Temperature `[10, 35]` °C, Relative Humidity `[0, 1]`, VPD `[0, 2.5]` kPa,
  CO₂ `[0, 1800]` ppm, PPFD `[0, 1500]` µmol·m⁻²·s⁻¹ — and the UI should
  reflect any clamp messages returned in
  `config.update.result`. The UI should also react to the
  `env.setpointUpdated` event to keep forms in sync when other clients adjust
  targets. Backend validation now trims and honours these identifiers, so the
  UI should pass the telemetry `id` without rewriting it.
- **Edit Light Cycle** (`schedule`) available for lights; opens **editLightCycle** modal to change on/off cycle for the entire zone.

---

## 4) Modal System

Modals are used for actions requiring user input.

**Pause behavior**

- The modal controller stores whether the simulation was running _before_ opening a modal (e.g., `wasRunningBeforeModal`).
- On open: pause the simulation explicitly.
- On close: restore the prior running state; resume if it was previously running.
- `useAppStore.openModal` applies this policy automatically: descriptors pause the sim unless `autoPause: false`, and the store
  replays a `resume` control command when closing if the sim was running beforehand.

**Close behavior**

- A modal consists of an overlay and content. The **overlay does not close on click**. Closing occurs **only** via explicit buttons inside the modal (e.g., _Cancel_, _Save_, _Create_). This enforces deliberate user decisions.

**Visual design**

- Overlay: semi‑transparent black to dim the background.
- Content: dark surface color and a border to stand out from the overlay.

```css
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.75);
  display: grid;
  place-items: center;
}
.modal-content {
  background: var(--surface-color);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: var(--radius-xl);
  padding: 1rem 1.25rem;
  max-width: 720px;
  width: min(720px, 92vw);
}
```

---

## 5) Implemented User Interactions (Command Mapping)

**Game lifecycle**

- Start New: `newGame({ name, seed? })`
- Load/Import: `load(snapshot)` / `importState(json)`
- Save/Export: `save()` / `exportState()`
- Reset: new run after confirmation

**Infrastructure**

- Rent Structure: `rentStructure(structureId)`
- Create Room: `createRoom(structureId, { name, purpose, area_m2, height_m? })`
- Create Zone: `createZone(roomId, { name, area_m2, methodId })`
- Duplicate Room/Zone: dedicated intents that replicate geometry/config and purchase devices if space permits
- Rename/Delete: generic update/delete intents

**Cultivation (Zone)**

- Install Device: `installDevice(targetId, deviceId, settings?)` (placement validated)
- Add Supply: `applyIrrigation(zoneId, liters)` / fertilizer `{ N,P,K }`
- Plant Strain: `addPlanting(zoneId, { strainId, count })`
- Harvest: `harvestPlanting(plantingId)` / harvest all ready plants in the zone
- Planting Plan: create/edit/delete plan; toggle Auto‑Replant
- Edit Device Setpoints: `updateDevice(instanceId, patch)`
- Edit Light Cycle: zone‑level intent

**Personnel**

- Refresh Candidates: `refreshCandidates()` (seeded; offline fallback)
- Hire/Fire: `hire(candidateId, role, wage?)` / `fire(employeeId)`
- Set Overtime Policy: `setOvertimePolicy({ policy, multiplier? })`

**Finance**

- Sell Inventory: `sellInventory(lotId, grams)`

---

## 6) Icons (Material Symbols Outlined)

| Icon                | Usage                                                   |
| ------------------- | ------------------------------------------------------- |
| `play_circle`       | Start simulation                                        |
| `pause_circle`      | Pause simulation                                        |
| `monitoring`        | Switch to financial view                                |
| `groups`            | Switch to personnel view                                |
| `notifications`     | Open notifications                                      |
| `settings`          | Open game menu (Save/Load/Export/Reset)                 |
| `edit`              | Rename structures/rooms/zones; edit planting plan       |
| `delete`            | Delete structures/rooms/zones/devices/individual plants |
| `delete_sweep`      | Delete an entire planting group                         |
| `content_copy`      | Duplicate rooms or zones                                |
| `info`              | Show strain info tooltip                                |
| `content_cut`       | Harvest a single plant                                  |
| `tune`              | Adjust settings for a device group (opens modal)        |
| `schedule`          | Edit light cycle for a zone (opens modal)               |
| `arrow_back_ios`    | Navigate to previous zone                               |
| `arrow_forward_ios` | Navigate to next zone                                   |
| `person_remove`     | Fire an employee                                        |

---

## 7) Accessibility & Responsiveness

- **Keyboard nav**: all actionable elements focusable; modals trap focus and restore on close.
- **ARIA**: role="dialog" for modals; descriptive labels for icons.
- **Contrast**: adhere to WCAG AA at minimum; avoid information conveyed by color alone (pair icons/labels).
- **Responsive**: grids collapse to single column below 900px; controls wrap gracefully.

---

## 8) Non‑Goals / Anti‑Patterns

- No business logic in the UI (pricing, growth, environment deltas computed by engine only).
- No direct state mutation; all changes are through facade commands.
- No non‑UUID keys for cross‑references.
- No overlay click‑to‑close for modals (explicit decisions only).

---

_This spec is aligned with the System Facade, Data Dictionary, and Simulation Deep Dive. It is intentionally file‑agnostic; replace concrete filenames with equivalent roles in your chosen framework._

## Weedbreed.AI — UI Interaction Spec (docs/ui/ui_interactions_spec.md)

Source: [`docs/ui/ui_interactions_spec.md`](../docs/ui/ui_interactions_spec.md)

# Weedbreed.AI — UI Interaction Spec

_A comprehensive, façade‑aligned description of user interactions, views, modals, and components. Tech‑agnostic by contract; React names below are **illustrative** only. All mutations go through the **System Facade**; all references use **`id` (UUID v4)**; economics are **currency‑neutral**; data and policies follow the **DD/TDD**._

---

## 1) Overview of Implemented User Interactions

The interface is hierarchical and supports a strategic (macro) and operational (micro) loop. The UI renders **read‑only snapshots** and issues **facade commands**; it contains **no game logic**.

### A. Game Lifecycle & Setup

- **Start a Game**  
   From _StartScreen_, users can:
  - **New Game**: provide company name and optional seed → `facade.newGame({ name, seed? })`.
  - **Load Game**: select a prior snapshot → `facade.load(snapshot)`.
  - **Import Game**: load from a JSON snapshot → `facade.importState(json)`.
- **Saving/Loading**  
   At any time via global menu:
  - **Save** → `facade.save()` (named entry in client storage) and optional `facade.exportState()` for a portable JSON.
  - **Load/Delete Slot** → `facade.load(snapshot)` / remove stored entry (client concern).
- **Reset**  
   Clear current run and stored entries; upon confirmation start fresh via `newGame`.

### B. Infrastructure Management (Macro Loop)

- **Rent Structures**
  From _Structures_ view: `facade.world.rentStructure({ structureId })`; façade validates availability and applies fixed costs.
- **Drill‑Down Navigation**  
   Structure → Rooms → Zones; breadcrumb navigation updates selected `{ structureId, roomId, zoneId }`.
- **Create & Manage Rooms/Zones**
  - Room: `facade.world.createRoom({ structureId, room: { name, purpose, area, height? } })` (purpose validated).
  - Zone: `facade.world.createZone({ roomId, zone: { name, area, methodId, targetPlantCount? } })`.
  - Rename/Delete via modals → `facade.world.renameStructure({ structureId, name })`, `facade.world.updateRoom({ roomId, patch })`, `facade.world.deleteZone({ zoneId })`, etc.
- **Duplicate Structure/Room/Zone**
  Quick actions call `facade.world.duplicateStructure({ structureId, name? })`, `facade.world.duplicateRoom({ roomId, name? })`, or `facade.world.duplicateZone({ zoneId, name? })`. Geometry, cultivation methods, automation plans, and eligible devices are cloned; pricing honours the existing CapEx rules and only installs blueprinted devices that pass `allowedRoomPurposes`.

### C. Cultivation & Zone Management (Micro Loop)

- **Equip Zones**
  In _ZoneDetail_ users install devices and buy supplies:
  - Devices → `facade.devices.installDevice({ targetId, deviceId, settings })` (placement checks against `allowedRoomPurposes`).
    - Supplies → `facade.plants.applyIrrigation({ zoneId, liters })` / fertilizer by grams `{ N,P,K }` via `facade.plants.applyFertilizer({ zoneId, nutrients })` (optional manual overrides in addition to automation).
  - **Sufficiency Preview** shows estimated PPFD/DLI or climate coverage from device specs (`ppf_umol_s`, `coverage_m2`, airflow) vs. strain `ppfdTarget` and zone area.
- **Planting**  
   Select strain and quantity → `facade.plants.addPlanting({ zoneId, strainId, count })`. UI warns if exceeding capacity from cultivation method (`areaPerPlant`) or if method/strain hints conflict (qualitative `environmentalPreferences`).
- **Environment Control**
  Batch‑edit device groups: e.g., toggle HVAC banks via `facade.devices.toggleDeviceGroup({ zoneId, kind, enabled })`, adjust settings with `facade.devices.updateDevice({ instanceId, settings })`, or change lighting cycle for the zone. Commands route through façade intents so automation remains deterministic.
- **Monitoring**  
   Real‑time panels show `temperature_C`, `humidity` (0–1), `co2_ppm`, PPFD/DLI, water/nutrient stocks, and active safety constraints (e.g., `reentryIntervalTicks`).
- **Harvesting**  
   Harvest per planting or _Harvest All_ in a zone → `facade.plants.harvestPlanting({ plantingId })` (creates inventory lots; revenue occurs on sale events).
- **Automation**
  _Planting Plan_: define default `strainId` and `count`; the Auto‑Replant toggle maps to `facade.plants.togglePlantingPlan({ zoneId, enabled })`. After harvest/cleaning the engine enqueues tasks automatically when enabled and emits maintenance events.

### D. Personnel Management

- **Hiring**  
   In _Job Market_: review candidates; hire into a structure → `facade.workforce.hire({ candidateId, role, wage? })`. Candidate refresh uses a seeded provider with offline fallback (per DD/TDD).
- **Managing Staff**  
   _Your Staff_ lists employees; assign role/structure → `facade.workforce.assignStructure({ employeeId, structureId })`; fire via `facade.workforce.fire({ employeeId })`.
- **Salary Negotiation**  
   Alerts surface raise requests; modal offers accept/decline/bonus. Accepted raises patch wage; decline risks morale drop (engine computes effects).
- **Policy Setting**  
   Company‑wide overtime policy → `facade.workforce.setOvertimePolicy({ policy: 'payout'|'timeOff', multiplier? })`.

### E. Financial & Strategic Overview

- **Dashboard**  
   At‑a‑glance KPIs (Capital, Cumulative Yield, Date/Time), sim controls (play/pause/speed), and alerts. Clicking an alert deep‑links to the relevant view (structure/room/zone/personnel).
- **Finances View**  
   Detailed breakdown of revenue/expenses (CapEx/OpEx, utilities, labor, maintenance) from façade reports (`finance.tick`).
- **Alerts System**  
   Notifications for low supplies, harvest‑ready, device failures, raise requests, PHI/re‑entry gates. Payloads contain **UUIDs**; UI resolves names from the snapshot.

---

## 2) Technical UI Component Breakdown (illustrative)

> Names are examples for teams using React. The architecture is façade‑first and remains valid with any UI stack.

### A. Core Application Structure

- **App (root)**  
   Initializes bridge hooks (snapshot/events/commands), view manager, and modals; composes main screens (Dashboard + MainView).
- **hooks/bridge**  
   Single contact point with the **System Facade** (subscribe to snapshots & events; expose stable command callbacks).
- **hooks/useViewManager**  
   Navigation state machine managing `{ currentView, selectedStructureId?, selectedRoomId?, selectedZoneId? }` with `goTo`, `back`, `home`.
- **hooks/useModals**  
   Central modal controller; manages `visibleModal` and `formState`. Optionally **pauses** sim on open and **resumes** on close.

### B. Primary Views

- **StartScreen**  
   New/Load/Import flows.
- **MainView**  
   Router‑like composition that decides which primary content to show based on navigation state.
- **FinancesView**  
   Financial reports (CapEx/OpEx, utilities, labor, maintenance, revenue) with summaries and trends.
- **PersonnelView**  
   Two tabs: _Your Staff_ (management) and _Job Market_ (candidates & hiring).

### C. Hierarchical Detail Components

- **Structures**  
   Top‑level list of rented structures (cards with KPIs).
- **StructureDetail**  
   Rooms list + actions (create/rename/delete/duplicate).
- **RoomDetail**  
   Zones list; special rendering if `purpose != 'growroom'` (e.g., Lab/BreedingStation).
- **ZoneDetail**  
   Deep control surface: devices, plantings, plan, environment, and safety state.

### D. UI Chrome & Navigation

- **Dashboard**  
   Persistent header: KPIs, sim controls, quick nav (Finances/Personnel), alerts & game lifecycle (save/load/reset/export/import).
- **Breadcrumbs**  
   Hierarchical trail (e.g., _Structures / Warehouse A / Grow Room 1_); clicking updates selected entity IDs.

### E. Modals (managed by the modal controller)

-**Creation**

- **RentModal** → `facade.world.rentStructure({ structureId })`.
- **AddRoomModal** → `facade.world.createRoom({ structureId, room: { name, purpose, area, height? } })`.
- **AddZoneModal** → `facade.world.createZone({ roomId, zone: { name, area, methodId, targetPlantCount? } })`.
- **InstallDeviceModal** → `facade.devices.installDevice({ targetId, deviceId, settings })` (enforces `allowedRoomPurposes`).
- **AddSupplyModal** → `facade.plants.applyIrrigation({ zoneId, liters })` / `facade.plants.applyFertilizer({ zoneId, nutrients })`.
- **PlantZoneModal** → `facade.plants.addPlanting({ zoneId, strainId, count })` with capacity and method affinity hints sourced from the cultivation method blueprint.【F:src/frontend/src/components/modals/ModalHost.tsx†L104-L323】
- **BreedStrainModal** → select two parent strains by **UUID `id`** to create a new strain (lineage stores parent UUIDs; empty parents ⇒ ur‑plant).

**Management & Editing**

- **RenameModal** → `facade.world.renameStructure({ structureId, name })` or equivalent room/zone updates.
- **DeleteModal** → generic delete (contextual warnings, e.g., severance on firing employees).
- **UpdateDeviceModal** → batch adjust device settings via `facade.devices.updateDevice({ instanceId, settings })`.
- **MoveDeviceModal** → relocate an instance with `facade.devices.moveDevice({ instanceId, targetZoneId })` while the façade validates placement rules.
- **Device removal confirmation** → reuse `ConfirmDeletionModal` to emit `facade.devices.removeDevice({ instanceId })`.
- **EditLightCycleModal** → zone light hours; UI does not compute growth—engine does.
- **PlantingPlanModal** → define automation plan (strain/quantity, **Auto‑Replant** toggle) with `facade.plants.togglePlantingPlan({ zoneId, enabled })`.

**HR**

- **HireEmployeeModal** → `facade.workforce.hire({ candidateId, role, wage? })` and assign structure.
- **NegotiateSalaryModal** → respond to raise alert (accept/decline/bonus) and patch wage.

**Game Lifecycle**

- **NewGameModal** → `newGame` with name/seed.
- **SaveGameModal** → `save`.
- **LoadGameModal** → list/load/delete saved snapshots.
- **ResetModal** → confirm full reset.

### F. Reusable & Specialized Components

- **Card**  
   Generic container for structure/room/zone/employee summaries.
- **BreedingStation**  
   Specialized panel in Lab views listing custom strains (lineage shown via parent UUID resolution to names).
- **ZoneInfoPanel**  
   Zone KPIs: environment (T/RH/CO₂), PPFD/DLI, supplies, safety (PHI/re‑entry timers).
- **ZoneDeviceList**  
   Devices by type; install/remove/update; placement validated by `allowedRoomPurposes`.
- **ZonePlantingList**  
   Plantings with per‑planting harvest; access to PlantStrain modal.
- **ZonePlantingPlan**  
   Automation plan management (auto‑replant pipeline).

---

## 3) Identity, Validation & Safety (UI Contract)

- **Identity**: All cross‑refs are **UUID `id`**; UI may display `name`/`slug` only.
- **Validation**: Errors/warnings come from the Facade; UI displays them verbatim (no client‑side fixes).
- **Safety**: The Facade enforces: device purpose binding, quarantine and **reentryIntervalTicks**/**preHarvestIntervalTicks**, certifications for treatments, inventory locks, and geometry constraints.

---

## 4) Performance & UX Notes

- **Selectors & memoization** for derived views and KPIs.
- **Virtualization** for large lists (structures, zones, employees, tasks).
- **Optimistic UI** is avoided; the UI waits for façade ACK or events before reflecting changes (deterministic ordering).
- **Modals** may pause the sim; resuming is explicit on close.

---

## 5) Anti‑Patterns (explicitly disallowed)

- Computing prices, growth, stress, or environment deltas in the UI.
- Using non‑UUID keys to correlate entities.
- Mutating deep state directly; all changes go through façade commands.
- Emitting or depending on heavy object graphs in events; use UUIDs and snapshot lookups.

---

_This spec aligns with the System Facade and Simulation Deep Dive. It can be used as a checklist for UI implementation and QA._

## Weedbreed.AI — UI Architecture (docs/ui/ui_archictecture.md)

Source: [`docs/ui/ui_archictecture.md`](../docs/ui/ui_archictecture.md)

# Weedbreed.AI — UI Architecture

_A tech‑agnostic overview of the UI and its architecture, aligned with the System Facade, Data Dictionary (DD), and Technical Design Document (TDD). The UI is intentionally logic‑free: it renders **snapshots** and turns user gestures into **facade commands**. All entity references use `id` (UUID v4)._

---

## 1) Core Philosophy — “Dumb” UI, Smart Engine

**Separation of concerns.** The UI contains **no game logic**. It:

- renders a **read‑only snapshot** of the authoritative state; and
- converts user intent into **facade commands** (see System Facade).

**Wrong (tight coupling):** a button computes harvest revenue in the UI.

**Right (loose coupling):** a button calls `facade.harvestPlanting(plantingId)` (or another intent). The engine computes results and emits events.

**Single bridge.** All interactions go through the **System Facade**. The UI never mutates deep objects directly and never dereferences beyond documented read models.

---

## 2) Unidirectional Dataflow (Render → Act → Apply → Notify → Re‑render)

1. **Render (read)**  
   The UI receives a **read‑only Snapshot** of the Game State. Components render from snapshot fields (e.g., `snapshot.company.capital`).
2. **User Action (intent)**  
   A user presses “Add Room”, “Install Device”, “Hire”, etc.
3. **Command (through the Facade)**  
   Event handlers call a **facade intent**, e.g.:
   - `facade.world.createRoom({ structureId, room: { name, purpose, area, height? } })`
   - `facade.devices.installDevice({ targetId: targetZoneId, deviceId, settings })`
   - `facade.plants.addPlanting({ zoneId, strainId, count })`
   - `facade.health.applyTreatment({ zoneId, optionId })`
     All parameters use **UUID `id`** for cross‑refs. The UI does not compute business rules.
4. **Logic (engine)**  
   The Facade validates, routes, and the engine applies rules: geometry checks, `allowedRoomPurposes`, treatment **reentryIntervalTicks**/PHI, costs, task generation, etc.
5. **State Update (commit)**  
   The engine commits a new authoritative state. A **fresh snapshot** is produced.
6. **Notification (events)**  
   The Facade emits batched events (`sim.tickCompleted`, `world.zoneCreated`, `task.created`, `plant.harvested`, …) that reference entity UUIDs only.
7. **Re‑render (subscribe)**  
   The UI’s subscription receives the new snapshot and re‑renders affected components.

This cycle enforces **one‑way dataflow**, making behavior predictable and debuggable.

---

## 3) Technical Building Blocks (UI layer)

> The names below are illustrative. Any framework can be used; a React mapping is provided where helpful.

### 3.1 Bridge Hook (UI ↔ Facade)

**Purpose.** The single gateway for the UI to:

- subscribe to **snapshots** and **events**; and
- expose stable **command callbacks**.

**Behavior.** On mount it subscribes to Facade events (`sim.ready`, `sim.tickCompleted`, `sim.paused`, `sim.hotReloaded`). On event, it swaps in the latest **Snapshot**. It memoizes command functions (e.g., `createRoom`, `installDevice`, `addPlanting`) so children don’t re‑render unnecessarily.

### 3.2 Application Orchestrator

**Purpose.** Root composition that wires providers and high‑level views.  
**Behavior.**

- Requests the initial snapshot (or waits for `sim.ready`).
- Provides **navigation state**, **modal state**, and **theme** to the tree.
- Passes **snapshot** + **command callbacks** down as props/context.

### 3.3 Navigation Manager

**Purpose.** Centralized routing between top‑level views and selected entities.  
**State.** `{ currentView, selectedStructureId?, selectedRoomId?, selectedZoneId? }`.  
**API.** `goTo(view, params)`, `selectEntity({ structureId?, roomId?, zoneId? })`, `back()`, `home()`.

### 3.4 Modal Manager (Input Workflows)

**Purpose.** Unified control of dialogs/wizards (rent structure, add room/zone, install device, hire, treatments).
**Behavior.** Maintains `{ visibleModal, formState }`. When opening a modal, it **may pause** the sim for clarity; on close, it optionally **resumes** if it was running.
**Implementation.** `ModalHost` subscribes to the modal slice, renders typed modal bodies (e.g., hire/fire personnel) and drives the pause/resume handshake via the game store.

### 3.5 Views vs. Components

- **Views**: page‑scale screens (e.g., `FinancesView`, `PersonnelView`, `ZoneDetail`, `StructuresOverview`), composed of many components, consume snapshots & callbacks.
- **Components**: reusable building blocks (e.g., cards, tables, charts, `SkillBar`, `DeviceList`, `TreatmentPlanner`).

### 3.6 Styling & Theming

- **Design tokens** (CSS variables): colors, spacing, typography under `:root` for quick theme changes.
- **Naming**: BEM‑like or utility‑first—consistent, collision‑free, accessible.
- **Accessibility**: color contrast, keyboard nav, ARIA roles for all interactive elements.

---

## 4) Read Models & Identity in the UI

- The UI reads only what it needs: **derived/projection selectors** (e.g., list of zones with current PPFD/CO₂, active tasks per structure, cost summaries).
- All entity references are **`id` (UUID v4)**. The UI may display `name`/`slug`, but never uses them for joins.
- **Lineage** is displayed by resolving `strain.lineage.parents[]` (UUIDs) to names through snapshot lookups.

---

## 5) Command Usage Patterns (UI)

**World building**

- Add room → `facade.world.createRoom({ structureId, room: { name, purpose, area, height? } })`
- Add zone → `facade.world.createZone({ roomId, zone: { name, area, methodId, targetPlantCount? } })`
- Install device → `facade.devices.installDevice({ targetId, deviceId, settings })` (Facade rejects if `allowedRoomPurposes` violate.)
- Duplicate → `facade.world.duplicateRoom({ roomId, name? })`, `facade.world.duplicateZone({ zoneId, name? })`, or `facade.world.duplicateStructure({ structureId, name? })`

**Cultivation**

- Start planting → `facade.plants.addPlanting({ zoneId, strainId, count })`
- Harvest → `facade.plants.harvestPlanting({ plantingId })`
- Apply treatment → `facade.health.applyTreatment({ zoneId, optionId })` (Enforces **reentryIntervalTicks**/PHI.)
- Toggle planting plan → `facade.plants.togglePlantingPlan({ zoneId, enabled })`

**Personnel & tasks**

- Refresh candidates → `facade.workforce.refreshCandidates()` (seeded, with offline fallback)
- Hire/fire → `facade.workforce.hire({ candidateId, role, wage? })` / `facade.workforce.fire({ employeeId })`
- Overtime policy → `facade.workforce.setOvertimePolicy({ policy, multiplier? })`

**Finance**

- Sell lots → `facade.finance.sellInventory({ lotId, grams })`
- Adjust utilities → `facade.finance.setUtilityPrices({ electricityCostPerKWh?, waterCostPerM3?, nutrientsCostPerKg? })`
- Maintenance policy → `facade.finance.setMaintenancePolicy({ strategy?, multiplier? })`

All commands return `{ ok, warnings?, errors? }`; UI displays inline validation/notifications.

---

## 6) Event Consumption

UI subscribes to Facade events and reacts via toasts, banners, and local updates:

- **Simulation**: `sim.tickCompleted`, `sim.paused/resumed`, `sim.hotReloaded/reloadFailed`.
- **World**: `world.structureRented`, `world.roomCreated`, `world.zoneCreated`, `world.deviceInstalled`.
- **Plants/Health**: `plant.stageChanged`, `plant.harvested`, `pest.detected`, `treatment.applied`.
- **HR/Tasks**: `task.created/claimed/completed`, `hr.hired/fired`, `hr.overtimeAccrued`.
- **Finance**: `finance.capex/opex`, `finance.saleCompleted`.

Event payloads contain minimal fields + UUIDs; the UI **looks up details** in the snapshot.

---

## 7) Performance & Robustness

- **Memoized selectors** for derived views (e.g., KPIs).
- **Virtualized lists** for large entity sets (zones, tasks, employees).
- **Incremental re‑render**: keep command callbacks stable; slice snapshots by interest (e.g., per view) to limit diff surface.
- **Error surfaces**: show validation errors from Facade; never try to "fix" state client‑side.

---

## 8) Anti‑Patterns (explicitly disallowed)

- Computing business logic in the UI (e.g., pricing, growth, environment deltas).
- Writing to deep state objects directly (must go through the Facade).
- Using non‑UUID keys to correlate entities.
- Emitting large object graphs in events; always fetch via snapshot.

---

## 9) Optional React Mapping (for teams using React)

- **Bridge Hook** ≈ `useGameState()` that returns `{ snapshot, events, actions }` (memoized `useCallback`s wrapping Facade commands).
- **App Orchestrator** ≈ `App` component wiring providers (theme, router, modals) and placing Views.
- **Navigation** ≈ `useViewManager()` for `{ currentView, selected*Id }`.
- **Modals** ≈ `useModals()` with pause/resume behavior when opening/closing.
- **Styling** ≈ `index.css` with tokens under `:root`; BEM or utility classes.

_This mapping is optional; the architectural rules remain the same regardless of framework._

## Component Documentation (docs/ui/ui-components-desciption.md)

Source: [`docs/ui/ui-components-desciption.md`](../docs/ui/ui-components-desciption.md)

# Component Documentation

This document provides a detailed overview of every React component in the Weedbreed.AI frontend application. The components are organized by their directory structure, with explanations of their purpose, props, and key functionalities.

## Screenshot Reference Map

The following mapping links each UX screenshot in `/docs/ui/screenshots` to the components and interactions described below. Use it as a quick index when reviewing the visual design alongside the technical breakdown.

| Screenshot                                                                                                                                                                                                                                                                   | View context                                                             | Primary components                                                                                                                                                                                                                                                              | Interaction focus                                                                                                                                  |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- |
| `01-welcome-screen.png`                                                                                                                                                                                                                                                      | Initial landing screen that introduces the simulation and entry actions. | `StartScreen` provides the New/Quick/Import game CTAs rendered while `App.tsx` is in the `startScreen` state.【F:docs/ui/ui-components-desciption.md†L393-L399】                                                                                                                | Launch points for `newGame`, `load`, and `import` flows outlined in the interaction spec.【F:docs/ui/ui_interactions_spec.md†L13-L23】             |
| `02-modal-new_game.png`                                                                                                                                                                                                                                                      | New game setup modal collecting company metadata and deterministic seed. | `NewGameModal` wrapped by the generic `Modal` shell with `FormInput`/`PrimaryButton` controls.【F:docs/ui/ui-components-desciption.md†L347-L353】【F:docs/ui/ui-components-desciption.md†L123-L140】【F:docs/ui/ui-components-desciption.md†L167-L178】                         | Confirms the start-of-run workflow before handing control to `facade.newGame` per the lifecycle spec.【F:docs/ui/ui_interactions_spec.md†L13-L23】 |
| `03-structure-overview.png`                                                                                                                                                                                                                                                  | Portfolio overview of rented structures presented as cards.              | `DashboardView` composes structure cards with inline rename/duplicate affordances via `InlineEdit` and `ActionIcons`.【F:docs/ui/ui-components-desciption.md†L483-L487】【F:docs/ui/ui-components-desciption.md†L95-L105】【F:docs/ui/ui-components-desciption.md†L150-L165】   | Supports structure rental/duplication and drill-down navigation from the macro loop.【F:docs/ui/ui_interactions_spec.md†L27-L37】                  |
| `04-personell-overview-(job-market).png`                                                                                                                                                                                                                                     | Personnel screen focused on external candidates.                         | `PersonnelView` in the “Job Market” tab lists `CandidateCard`s with hire actions surfaced through modal flows.【F:docs/ui/ui-components-desciption.md†L504-L509】【F:docs/ui/ui-components-desciption.md†L333-L337】                                                            | Hiring and candidate refresh intents driven by the workforce interaction flow.【F:docs/ui/ui_interactions_spec.md†L58-L61】                        |
| `05-personell-overview-(my-employees).png`                                                                                                                                                                                                                                   | Personnel screen showing the internal staff roster.                      | `PersonnelView` “Your Staff” tab renders `EmployeeCard`s with fire/assignment controls tied to the store actions.【F:docs/ui/ui-components-desciption.md†L504-L509】                                                                                                            | Manages firing and reassignment interactions described for workforce management.【F:docs/ui/ui_interactions_spec.md†L60-L65】                      |
| `06-finances-overview-(cards_closed).png`                                                                                                                                                                                                                                    | Finance dashboard with collapsed revenue/expense summaries.              | `FinanceView` stacks KPI `StatCard`s above collapsible categories controlled by chevron toggles.【F:docs/ui/ui-components-desciption.md†L490-L500】【F:docs/ui/ui-components-desciption.md†L182-L193】                                                                          | Gives at-a-glance access to CapEx/OpEx metrics from the finance overview loop.【F:docs/ui/ui_interactions_spec.md†L69-L73】                        |
| `07-finances-overview-(cards_opened).png`                                                                                                                                                                                                                                    | Finance dashboard with expanded detail panels.                           | `FinanceView` shows the same sections after expansion, revealing the detailed breakdowns under each card.【F:docs/ui/ui-components-desciption.md†L490-L500】                                                                                                                    | Highlights the deeper inspection step of the financial reporting flow.【F:docs/ui/ui_interactions_spec.md†L69-L73】                                |
| `08-model-game_menu.png`                                                                                                                                                                                                                                                     | Game-level menu summoned from the dashboard header.                      | `GameMenuModal` surfaced from the header cog presents save/load/export/reset options within the shared modal chassis.【F:docs/ui/ui-components-desciption.md†L323-L329】【F:docs/ui/ui-components-desciption.md†L167-L178】                                                     | Access point for global save/load/reset actions described in the lifecycle spec.【F:docs/ui/ui_interactions_spec.md†L18-L23】                      |
| `09-structure-detailview.png`                                                                                                                                                                                                                                                | Detail page for a single structure with nested rooms/zones.              | `StructureDetailView` lists rooms leveraging `ZoneCard` summaries and inline rename/duplicate actions.【F:docs/ui/ui-components-desciption.md†L521-L525】【F:docs/ui/ui-components-desciption.md†L413-L420】                                                                    | Enables room-level CRUD/duplicate paths as part of infrastructure management.【F:docs/ui/ui_interactions_spec.md†L27-L36】                         |
| `10-room-overview-(growroom).png`                                                                                                                                                                                                                                            | Room detail focusing on the grid of grow zones.                          |
| `RoomView` surfaces icon-only duplicate/delete affordances wired to the zone modals and adds cultivation method/substrate metadata alongside climate KPIs.【F:src/frontend/src/views/RoomView.tsx†L12-L121】【F:src/frontend/src/views/**tests**/RoomView.test.tsx†L46-L68】 |
| Supports zone creation/duplication flows from the macro management loop.【F:docs/ui/ui_interactions_spec.md†L31-L36】                                                                                                                                                        |
| `11-zone-detailview-(setup-closed).png`                                                                                                                                                                                                                                      | Zone management view with the environment panel collapsed.               | `ZoneDetailView` layout plus the collapsed state of `EnvironmentPanel` summarizing KPIs alongside device/plant panels.【F:docs/ui/ui-components-desciption.md†L529-L533】【F:docs/ui/ui-components-desciption.md†L407-L417】【F:docs/ui/ui-components-desciption.md†L421-L429】 | Anchors monitoring of climate KPIs and device status per the cultivation micro loop.【F:docs/ui/ui_interactions_spec.md†L40-L50】                  |
| `12-zone-detailview-(setup-opened).png`                                                                                                                                                                                                                                      | Zone management view with environment controls expanded.                 | Expanded `EnvironmentPanel` exposes sliders/toggles while `ZoneDeviceList` remains adjacent for equipment actions.【F:docs/ui/ui-components-desciption.md†L412-L415】【F:docs/ui/ui-components-desciption.md†L421-L429】                                                        | Demonstrates runtime setpoint adjustments and device management described for zone control.【F:docs/ui/ui_interactions_spec.md†L40-L48】           |
| `13-zone-detailview-(mass-selection-activated).png`                                                                                                                                                                                                                          | Zone plant grid in batch-selection mode.                                 | `ZonePlantPanel` selection workflow with `BatchActionBar` for multi-plant harvest/trash/treat operations.【F:docs/ui/ui-components-desciption.md†L451-L462】                                                                                                                    | Executes batch cultivation actions and automation toggles outlined in the zone interaction spec.【F:docs/ui/ui_interactions_spec.md†L45-L54】      |

---

## Simulation Facade Intent Coverage

The backend façade groups all write operations behind intent domains (`time`, `world`, `devices`, `plants`, `health`, `workforce`, `finance`) plus configuration helpers such as zone setpoints.【F:src/backend/src/facade/index.ts†L1134-L1385】【F:src/backend/src/facade/index.ts†L856-L901】 The tables below list which UI elements currently dispatch those intents and highlight the commands that have not been wired up yet.

### Time & Loop Control

- `time.start`, `time.pause`, `time.step`, `time.setSpeed`: dispatched through the dashboard control bar (`DashboardControls`) which wires Play/Pause/Step/Fast Forward buttons in `App.tsx` to `useGameStore.issueControlCommand`, ultimately emitting `simulationControl` commands handled by the façade’s time registry.【F:src/backend/src/facade/index.ts†L1134-L1165】【F:src/frontend/src/App.tsx†L208-L217】【F:src/frontend/src/App.tsx†L526-L548】【F:src/frontend/src/store/gameStore.ts†L148-L163】
- `time.setTickLength`: triggered when the tick-length slider changes; `useGameStore.requestTickLength` forwards the update via the socket to `SimulationFacade.setTickLength`, which rebuilds the scheduler with the new interval.【F:src/backend/src/facade/index.ts†L856-L899】【F:src/frontend/src/App.tsx†L535-L545】【F:src/frontend/src/store/gameStore.ts†L157-L163】
- `time.resume`: emitted automatically when modal flows request a resume (e.g., after closing auto-paused dialogs) via the same control channel; there is no dedicated UI button, but the façade command exists for completeness.【F:src/backend/src/facade/index.ts†L1134-L1146】

### Environment Configuration

- `config.setSetpoint` (`SimulationFacade.setZoneSetpoint`): the zone detail view exposes temperature, humidity, CO₂, PPFD, and VPD sliders. Interactions call `useZoneStore.sendSetpoint`, which routes to the façade and emits `env.setpointUpdated` events for the UI timeline.【F:src/backend/src/facade/index.ts†L904-L1068】【F:src/frontend/src/views/ZoneDetail.tsx†L321-L370】【F:src/frontend/src/store/zoneStore.ts†L240-L247】

### World Domain (Structures, Rooms, Zones)

- Active flows: rent/create/duplicate/delete/rename actions (`world.rentStructure`, `world.createRoom`, `world.createZone`, `world.duplicateStructure`, `world.duplicateRoom`, `world.duplicateZone`, `world.renameStructure`, `world.updateRoom`, `world.updateZone`, `world.deleteStructure`, `world.deleteRoom`, `world.deleteZone`) are surfaced through `ModalHost` dialogs. Each modal now invokes the matching `useZoneStore` intent helper which emits the façade command so the backend processes geometry, costing, and duplication rules deterministically, and the regression suite drives these flows through `ModalHost.test.tsx` to assert both the dispatched intent and modal teardown.【F:src/backend/src/facade/index.ts†L1168-L1233】【F:src/frontend/src/components/ModalHost.tsx†L157-L318】【F:src/frontend/src/store/zoneStore.ts†L240-L338】【F:src/frontend/src/components/ModalHost.test.tsx†L80-L262】 The Zone view header also surfaces cultivation method, container, and substrate labels alongside a “Change method” CTA that opens the dedicated modal; the dialog filters compatible methods, pulls matching container/substrate catalogs, clamps container counts to the zone capacity, recomputes substrate volume and cost estimates, runs the temporary storage handoff stub, and dispatches `bridge.world.updateZone` with the consumable payload. RTL coverage exercises the filtering, clamping, and dispatched intent.【F:src/frontend/src/views/ZoneView.tsx†L332-L370】【F:src/frontend/src/components/modals/ModalHost.tsx†L365-L544】【F:src/frontend/src/components/modals/**tests**/ChangeZoneMethodModal.test.tsx†L128-L210】【F:src/frontend/src/facade/systemFacade.ts†L440-L456】

- `CreateRoomModal`, `CreateZoneModal`, `RentStructureModal`, and `DuplicateStructureModal` dispatch `useZoneStore.createRoom`, `useZoneStore.createZone`, `useZoneStore.rentStructure`, and `useZoneStore.duplicateStructure` respectively, wiring the previously inert forms to façade intents.【F:src/frontend/src/views/world/modals/CreateRoomModal.tsx†L9-L114】【F:src/frontend/src/views/world/modals/CreateZoneModal.tsx†L9-L132】【F:src/frontend/src/views/world/modals/RentStructureModal.tsx†L1-L71】【F:src/frontend/src/views/world/modals/DuplicateStructureModal.tsx†L1-L108】

### Device Domain

- Active flow: the “Device automation” panel toggles device groups via `devices.toggleDeviceGroup`, using the zone store dispatcher that sends façade intents for each switch interaction.【F:src/backend/src/facade/index.ts†L1236-L1266】【F:src/frontend/src/views/ZoneDetail.tsx†L964-L1014】【F:src/frontend/src/store/zoneStore.ts†L385-L393】
- New UI: the “Device inventory” panel now surfaces install/update/move/remove lifecycle commands. The Install/Update/Move actions open dedicated modals that collect blueprint IDs, JSON settings patches, or destination zones before dispatching `devices.installDevice`, `devices.updateDevice`, and `devices.moveDevice`. Remove uses the shared confirmation modal to emit `devices.removeDevice`. All flows reuse `ModalHost` wiring and new zone-store helpers so façade intents fire deterministically from a single place.【F:src/frontend/src/views/ZoneDetail.tsx†L1019-L1086】【F:src/frontend/src/components/ModalHost.tsx†L1-L260】【F:src/frontend/src/store/zoneStore.ts†L385-L456】【F:src/backend/src/facade/index.ts†L1236-L1266】

### Plant Domain

- Active flows: irrigation, fertilizer dosing, harvest (single and batch), and planting-plan toggles map to `plants.applyIrrigation`, `plants.applyFertilizer`, `plants.harvestPlanting`, and `plants.togglePlantingPlan`, all triggered from the zone detail actions drawer.【F:src/backend/src/facade/index.ts†L1269-L1304】【F:src/frontend/src/views/ZoneDetail.tsx†L321-L352】【F:src/frontend/src/store/zoneStore.ts†L356-L419】
- Not yet wired: `plants.addPlanting` and `plants.cullPlanting` have façade handlers but are not surfaced in the UI yet.【F:src/backend/src/facade/index.ts†L1269-L1304】【F:src/frontend/src/store/zoneStore.ts†L356-L419】

### Health Domain

- The façade exposes scouting, treatment, and quarantine commands, but no current component or store dispatches `domain: 'health'` intents, so these flows remain backend-only placeholders.【F:src/backend/src/facade/index.ts†L1307-L1325】【F:src/frontend/src/store/zoneStore.ts†L240-L420】

### Workforce Domain

- Active flows: hire/fire/refresh candidate operations map to `workforce.hire`, `workforce.fire`, and `workforce.refreshCandidates`. The personnel store sends these intents, and the personnel view exposes the corresponding UI (Hire/Fire modals and refresh button).【F:src/backend/src/facade/index.ts†L1327-L1365】【F:src/frontend/src/store/personnelStore.ts†L40-L90】【F:src/frontend/src/views/PersonnelView.tsx†L123-L304】【F:src/frontend/src/components/ModalHost.tsx†L120-L156】
- Not yet wired: overtime policy, structure assignment, and task queueing (`workforce.setOvertimePolicy`, `workforce.assignStructure`, `workforce.enqueueTask`) have façade hooks but no front-end dispatchers yet.【F:src/backend/src/facade/index.ts†L1327-L1365】【F:src/frontend/src/store/personnelStore.ts†L40-L97】

### Finance Domain

- The façade supports selling inventory and adjusting utility or maintenance pricing, but the finance view is read-only today—no store issues `domain: 'finance'` intents, so these commands remain unused by the UI.【F:src/backend/src/facade/index.ts†L1367-L1385】【F:src/frontend/src/views/FinancesView.tsx†L1-L186】【F:src/frontend/src/store/zoneStore.ts†L240-L420】

---

## 1. Top-Level Components

### `src/App.tsx`

- **Purpose:** The main entry point and root component of the application. It acts as the central state manager and orchestrator for the entire UI.
- **Detailed Functionality:**
  - **Game State Machine:** Manages the overall application flow through the `gameState` state (`'loading'`, `'startScreen'`, `'playing'`, `'error'`). It begins by fetching all necessary blueprint data (showing a loading screen), then transitions to the `StartScreen`. Once the user initiates a game, it moves to the `'playing'` state, rendering the main simulation interface.
  - **Central State Hub:** `App.tsx` is the single source of truth for the application's dynamic data. It holds the `gameData` object (the entire simulation state), the `selection` object (which dictates what the user is currently viewing), and the `modal` state (which controls pop-up dialogs).
  - **Action Dispatcher:** All user actions that modify the game state are handled by `handle...` functions within this component (e.g., `handleCreateRoom`, `handleHireEmployee`). These functions receive events from child components, compute the new state immutably (by creating deep copies and modifying them), and then update the `gameData` using `setGameData`. This ensures a predictable, top-down data flow.
  - **Modal Orchestration:** A central `modalContent` function acts as a router or switch. It reads the `modal.type` from the state and renders the corresponding modal component (e.g., `NewGameModal`, `AddRoomModal`), passing in all the necessary props and callbacks. This keeps all modal-related logic centralized and prevents individual components from needing to manage their own visibility.
- **Props:** None.
- **Icons Used:** None directly.
- **Dependencies:** `ToastProvider`, `DashboardHeader`, `Sidebar`, `MainContent`, `EventLog`, `Modal`, `StartScreen`, and all modal components.
- **Usage Context:** Rendered once by `index.tsx` to mount the entire application to the DOM. It wraps the core application logic in a `ToastProvider` for global notifications.

---

## 2. Common Components (`src/components/common/`)

These are generic, reusable components used throughout the application.

### `ActionIcons.tsx`

- **Purpose:** A small component that groups common action icons (Duplicate, Delete) together for consistent placement and styling.
- **Props:**
  | Prop | Type | Required | Description |
  |---|---|---|---|
  | `onDuplicate` | `(event: React.MouseEvent) => void` | Yes | Callback function for the duplicate button click. |
  | `onDelete` | `(event: React.MouseEvent) => void` | Yes | Callback function for the delete button click. |
  | `className` | `string` | No | Optional classes for custom styling. |
- **Icons Used:** `DuplicateIcon`, `DeleteIcon`.
- **Dependencies:** `DuplicateIcon`, `DeleteIcon`.
- **Usage Context:** Used in detail views (`StructureDetailView`, `RoomDetailView`, `ZoneDetailView`) and cards (`ZoneCard`) to provide consistent action buttons.

### `Breadcrumbs.tsx`

- **Purpose:** Displays the current navigation path (e.g., Structures > Warehouse 1 > Room A) and allows users to navigate back to parent levels.
- **Functionality:** The component dynamically generates a series of buttons from the `path` prop. Clicking any part of the path calls the `onNavigate` function with the appropriate parameters to update the global `selection` state, causing the `MainContent` to render the corresponding view.
- **Props:**
  | Prop | Type | Required | Description |
  |---|---|---|---|
  | `path` | `BreadcrumbItem[]` | Yes | An array of objects representing the navigation hierarchy. |
  | `onNavigate` | `(...) => void` | Yes | Callback function to handle navigation when a breadcrumb link is clicked. |
- **Icons Used:** `ChevronRightIcon`.
- **Dependencies:** `ChevronRightIcon`.
- **Usage Context:** Used in `MainContent.tsx` to show the user's current location within the game's structural hierarchy.

### `Buttons.tsx`

- **Purpose:** Provides standardized, pre-styled button components to ensure UI consistency.
- **Components:**
  - `PrimaryButton`: A lime-green button for primary, positive actions (e.g., "Create", "Submit", "Confirm"). Includes a disabled state.
  - `DangerButton`: A red button for destructive actions (e.g., "Delete", "Fire").
- **Props:** Standard HTML button attributes.
- **Icons Used:** None.
- **Dependencies:** None.
- **Usage Context:** Used in forms and modals across the application.

### `Form.tsx`

- **Purpose:** Provides standardized, pre-styled form elements to ensure a consistent look and feel for all user input fields.
- **Components:**
  - `FormInput`: A labeled text, number, or password input field.
  - `FormSelect`: A labeled dropdown/select field.
  - `FormCheckbox`: A labeled checkbox.
- **Props:** Standard HTML input/select attributes, plus a `label` prop.
- **Icons Used:** None.
- **Dependencies:** None.
- **Usage Context:** Used extensively in all modals that require user input.

### `Icons.tsx`

- **Purpose:** A central repository for all Google Material Icons used in the app, wrapped as React components. This ensures consistency, simplifies usage, and allows for easy swapping of icons in the future.
- **Props:** Some icons accept an optional `className` for custom styling (e.g., changing size or color).
- **Icons Used:** This is the definition file; it does not use other icons.
- **Dependencies:** None.
- **Usage Context:** Icons are imported from this file and used in virtually every other component.

### `InlineEdit.tsx`

- **Purpose:** A component that displays text, but transforms into an input field when clicked, allowing for in-place editing.
- **Functionality:**
  - It starts as a simple `<span>`. On click, it switches its state to `isEditing` and renders an `<input>` field, automatically focusing it.
  - When the user presses "Enter" or the input field loses focus (onBlur), the `onSave` callback is triggered with the new value.
  - If the user presses "Escape", the edit is cancelled, and the value reverts to the original.
- **Props:**
  | Prop | Type | Required | Description |
  |---|---|---|---|
  | `value` | `string` | Yes | The initial text value to display and edit. |
  | `onSave` | `(newValue: string) => void` | Yes | Callback function triggered when editing is complete. |
  | `className` | `string` | No | Optional classes to style the text/input. |
- **Icons Used:** None.
- **Dependencies:** None.
- **Usage Context:** Used for renaming structures, rooms, and zones in their respective detail views without needing a separate modal.

### `Modal.tsx`

- **Purpose:** A generic modal component that provides a styled container, a title bar with a close button, and a content area. It handles the outer shell and overlay, while the specific content is passed in as children.
- **Props:**
  | Prop | Type | Required | Description |
  |---|---|---|---|
  | `title` | `string` | Yes | The title displayed in the modal's header. |
  | `children` | `React.ReactNode` | Yes | The content to be rendered inside the modal. |
  | `onClose` | `() => void` | Yes | Callback function for the close button. |
- **Icons Used:** `XIcon`.
- **Dependencies:** `XIcon`.
- **Usage Context:** The main `App.tsx` component uses this to wrap the content of whatever modal is currently active.

### `StatCard.tsx`

- **Purpose:** A small, reusable card for displaying a key statistic with an icon, title, value, and unit.
- **Props:**
  | Prop | Type | Required | Description |
  |---|---|---|---|
  | `icon` | `React.ReactNode` | Yes | The icon to display. |
  | `title` | `string` | Yes | The label for the statistic. |
  | `value` | `string` | Yes | The value of the statistic. |
  | `unit` | `string` | No | The unit for the value (e.g., "€", "m²"). |
  | `color` | `string` | Yes | The Tailwind color class for the icon (e.g., 'green', 'cyan'). |
- **Icons Used:** Receives an icon via props; does not use any specific icons itself.
- **Dependencies:** None.
- **Usage Context:** Used in the `DashboardHeader` and `FinanceView` to display key performance indicators.

### `Toast.tsx`

- **Purpose:** Provides the visual components for the notification system.
- **Functionality:** The `ToastContainer` positions itself in the top-right corner of the screen and renders a list of active `Toast` components from the `ToastContext`. Each `Toast` has an entry animation controlled by Tailwind classes and can be dismissed manually or, for non-error types, automatically after a timeout.
- **Components:**
  - `Toast`: A single toast notification with an icon, message, and close button, styled by its type (success, error, etc.).
  - `ToastContainer`: A container that positions and renders all active toasts on the screen.
- **Props (`Toast`):**
  | Prop | Type | Required | Description |
  |---|---|---|---|
  | `message` | `string` | Yes | The notification message. |
  | `type` | `'success' \| 'error' \| ...` | Yes | The type of toast, which determines its style. |
  | `onClose` | `() => void` | Yes | Callback to close the toast. |
- **Icons Used:**
  - `XIcon`
  - `CheckIcon`
  - Direct Material Icons: `error`, `warning`, `info`.
- **Dependencies:** `useToast` (context hook), `XIcon`, `CheckIcon`.
- **Usage Context:** `ToastContainer` is rendered once in `App.tsx`. Toasts are added via the `useToast` hook from anywhere in the app.

---

## 3. Layout Components (`src/components/layout/`)

These components define the main structure and layout of the application interface.

### `DashboardHeader.tsx`

- **Purpose:** The main header bar at the top of the application. It contains game controls (play/pause, speed), primary navigation links (Structures, Personnel, Finance), key global stats, and a button to open the game menu.
- **Functionality:** The play/pause and speed controls directly manipulate the game loop state in `App.tsx`. The navigation buttons call `onNavigate` to change the `selection` state, which updates the `MainContent` view. The stats are passed in and displayed in `StatCard` components.
- **Props:** A large number of props for stats, game state, and event handlers.
- **Icons Used:**
  - `ClockIcon`
  - `DollarIcon`
  - `PauseIcon`
  - `PlayIcon`
  - `HomeIcon`
  - `BadgeIcon`
  - `CogIcon`
  - Direct Material Icons: `paid`.
- **Dependencies:** `StatCard`, various `Icon` components.
- **Usage Context:** Rendered in `App.tsx` as the persistent header for the 'playing' state.

### `EventLog.tsx`

- **Purpose:** The footer component that displays a log of recent in-game events, color-coded by type (info, success, warning, danger).
- **Props:**
  | Prop | Type | Required | Description |
  |---|---|---|---|
  | `events` | `EventLogItem[]` | Yes | An array of event objects to display. |
- **Icons Used:** None.
- **Dependencies:** None.
- **Usage Context:** Rendered in `App.tsx` as the persistent footer for the 'playing' state.

### `MainContent.tsx`

- **Purpose:** Acts as a content router for the main area of the UI. It determines which view to display based on the global `selection` state and renders the appropriate `Breadcrumbs`.
- **Functionality:** It inspects the `selection` object (`view`, `structureId`, `roomId`, `zoneId`). Based on these values, it conditionally renders the correct detailed view (e.g., `DashboardView` if no IDs are selected, `ZoneDetailView` if a `zoneId` is present). It passes all necessary data and callbacks down to the currently active view. This component is the critical link between the navigation state (`selection`) and the actual content presented to the user.
- **Props:** A large number of props for game state, selection state, and event handlers to pass down to the active view.
- **Icons Used:** None directly.
- **Dependencies:** `Breadcrumbs`, all `View` components.
- **Usage Context:** Rendered in `App.tsx` to control the central panel of the UI.

### `Sidebar.tsx`

- **Purpose:** The left-hand sidebar that displays the rooms and zones of the currently selected structure, allowing for hierarchical navigation.
- **Functionality:** Its content is conditional. If no structure is selected in the global state (`selection.structureId` is null), it displays a prompt. If a structure is selected, it maps over that structure's rooms and zones to create a nested list of navigation links. Clicking on any of these links triggers the `onNavigate` callback, which updates the global `selection` state in `App.tsx`. This, in turn, causes the `MainContent` to show the corresponding detail view.
- **Props:**
  | Prop | Type | Required | Description |
  |---|---|---|---|
  | `structures` | `Structure[]` | Yes | The list of all structures in the game. |
  | `selection` | `Selection` | Yes | The current UI selection state. |
  | `onNavigate` | `(...) => void` | Yes | Callback for navigation clicks. |
  | `onOpenModal` | `(...) => void` | Yes | Callback to open modals (e.g., "Add Room"). |
- **Icons Used:** `ChevronDownIcon`, `PlusIcon`.
- **Dependencies:** `ChevronDownIcon`, `PlusIcon`.
- **Usage Context:** Rendered in `App.tsx` as the persistent sidebar for the 'playing' state.

---

## 4. Modal Components (`src/components/modals/`)

These components define the content for various modals used for user input and information display.

### `PlantZoneModal` (`ModalHost`)

- **Purpose:** Gathers strain and count for a zone planting, loads the strain catalog via the facade, and surfaces cultivation-method capacity and affinity hints before dispatching `plants.addPlanting`.
- **State:** Manages async catalog loading, selection state, capacity feedback, and warning surfaces from the command response.
- **Usage Context:** Triggered from the zone detail "Plant zone" CTA; modal pausing handled by `ModalHost` ensures safe execution.【F:src/frontend/src/views/ZoneView.tsx†L380-L398】【F:src/frontend/src/components/modals/ModalHost.tsx†L104-L323】【F:src/frontend/src/components/modals/**tests**/PlantAndDeviceModals.test.tsx†L64-L103】

### `InstallDeviceModal` (`ModalHost`)

- **Purpose:** Presents the device catalog with coverage/compatibility hints, allows JSON overrides for settings, and submits `devices.installDevice` while relaying facade warnings back to the user.
- **State:** Tracks catalog loading, editable JSON text, parse errors, and facade warnings so the modal only closes on clean installs.
- **Usage Context:** Invoked from the zone detail "Install device" CTA; complements device list empty states and hooks into the shared modal pause/resume workflow.【F:src/frontend/src/views/ZoneView.tsx†L286-L305】【F:src/frontend/src/components/modals/ModalHost.tsx†L325-L470】【F:src/frontend/src/components/modals/**tests**/PlantAndDeviceModals.test.tsx†L104-L149】

### `CreateRoomModal.tsx`

- **Purpose:** Collects a room name, purpose, footprint area, and height before dispatching `world.createRoom`. Geometry limits are enforced in the UI and the sanitized payload is sent via `useZoneStore.createRoom` on submit.【F:src/frontend/src/views/world/modals/CreateRoomModal.tsx†L9-L114】【F:src/frontend/src/components/ModalHost.tsx†L175-L197】
- **Props:** `structure`, `existingRooms`, `onSubmit`, `onCancel`, `title?`, `description?`.
- **Usage Context:** Shown when the user adds a room from structure-level actions; the modal pauses the sim (via `ModalHost`) and resumes after the command is dispatched. Regression coverage exercises the default confirm path via `ModalHost.test.tsx` to ensure the zone store receives the create-room intent and the dialog closes.【F:src/frontend/src/components/ModalHost.test.tsx†L103-L142】

### `CreateZoneModal.tsx`

- **Purpose:** Allocates footprint within a room, captures the zone name, and relays the `world.createZone` intent with the shared cultivation setup selection (method, container, substrate, costs). The dialog renders the reusable `CultivationSetupSection` below the name input so the Add/Change flows stay visually aligned.【F:src/frontend/src/components/modals/zones/CreateZoneModal.tsx†L1-L159】【F:src/frontend/src/components/modals/zones/CultivationSetupSection.tsx†L180-L430】
- **Props:** `bridge`, `closeModal`, `context?` (expects `roomId`). Catalog data, area clamps, and container counts are managed through the shared hook instead of bespoke local state.【F:src/frontend/src/components/modals/zones/CreateZoneModal.tsx†L1-L159】
- **Notable Controls:**
  - The area input sits beside a secondary **Max** button that snaps the value to the available room area (with a 0.1 m² floor) and immediately recomputes container capacity via `useCultivationSetup`.
  - Container counts are parsed through helpers inside the hook that reject `NaN`, clamp to `[min, max]`, and repopulate from existing selections when possible, preventing stale overfill states.
- **Usage Context:** Launched from room-level actions when expanding a grow area. The ModalHost regression suite still covers both the default submission path and the Max-area workflow to prove the recalculated container counts are sent with the intent payload.【F:src/frontend/src/components/modals/ModalHost.test.tsx†L288-L363】

### `CultivationSetupSection.tsx`

- **Purpose:** Houses the shared method/container/substrate selectors, area controls, container capacity logic, and cost breakdown used by both the Create Zone and Change Method dialogs. The companion `useCultivationSetup` hook centralises catalog readiness checks, compatibility filtering, capacity calculation, and consumable price totals.【F:src/frontend/src/components/modals/zones/CultivationSetupSection.tsx†L1-L430】
- **Props:** Accepts a `setup` state bag from the hook, flags for area editability, optional helper copy, capacity message overrides, and label overrides so hosting modals can tailor copy without reimplementing layout.【F:src/frontend/src/components/modals/zones/CultivationSetupSection.tsx†L180-L430】
- **Usage Context:** Embedded by `CreateZoneModal` and `ChangeZoneMethodModal` to ensure both dialogs render identical controls, catalog loading states, and cost summaries while only leaving modal-specific chrome (zone name, current setup, warnings) in the hosts.【F:src/frontend/src/components/modals/zones/CreateZoneModal.tsx†L95-L139】【F:src/frontend/src/components/modals/zones/ChangeZoneMethodModal.tsx†L120-L208】

### `RentStructureModal.tsx`

- **Purpose:** Confirms structure rental and provides a summary of footprint, rooms/zones, and rent per tick before emitting `world.rentStructure` through `useZoneStore`.
- **Props:** `structure`, `rooms?`, `zones?`, `onConfirm`, `onCancel`, `title?`, `description?`.
- **Usage Context:** Triggered from structure catalog cards; the confirm button sends the rent intent and closes the modal once acknowledged. Automated coverage in `ModalHost.test.tsx` clicks the confirm action to assert the rent intent and modal teardown paths.【F:src/frontend/src/views/world/modals/RentStructureModal.tsx†L1-L71】【F:src/frontend/src/components/ModalHost.tsx†L223-L246】【F:src/frontend/src/components/ModalHost.test.tsx†L186-L218】

### `DuplicateStructureModal.tsx`

- **Purpose:** Allows renaming and reviewing totals (rooms, zones, area, device count) before cloning a structure via `world.duplicateStructure`.
- **Props:** `structure`, `rooms`, `zones`, `onConfirm`, `onCancel`, `title?`, `description?`.
- **Usage Context:** Available from structure actions; after submission the façade handles geometry/cost validation while the UI awaits confirmation. The ModalHost regression suite submits the dialog with its default copy name to prove the duplicate-structure intent is dispatched and the modal closes.【F:src/frontend/src/views/world/modals/DuplicateStructureModal.tsx†L1-L108】【F:src/frontend/src/components/ModalHost.tsx†L247-L270】【F:src/frontend/src/components/ModalHost.test.tsx†L220-L262】

### `DuplicateRoomModal.tsx`

- **Purpose:** Mirrors an existing room, summarising footprint consumption, zones, devices, and estimated CapEx before issuing `world.duplicateRoom`.
- **Props:** `room`, `structure`, `zones`, `availableArea`, `deviceCount`, `estimatedDeviceCapex?`, `onConfirm`, `onCancel`, `title?`, `description?`.
- **Usage Context:** Appears from room action menus; the confirm action triggers the façade intent through `useZoneStore.duplicateRoom` and closes the dialog.【F:src/frontend/src/views/world/modals/DuplicateRoomModal.tsx†L1-L112】【F:src/frontend/src/components/ModalHost.tsx†L205-L221】

### `DuplicateZoneModal` (`ModalHost`)

- **Purpose:** Clones a zone and optionally overrides the display name before dispatching `world.duplicateZone` via the bridge.
- **Usage Context:** Triggered from the room view duplicate icon; ModalHost pauses the simulation, forwards the intent, and tests assert both the payload and modal teardown.【F:src/frontend/src/components/modals/ModalHost.tsx†L1635-L1686】【F:src/frontend/src/components/modals/ModalHost.test.tsx†L381-L407】

### `DeleteZoneModal` (`ModalHost`)

- **Purpose:** Requests confirmation before dispatching `world.deleteZone`, including an exact-name guard to prevent accidental removal.
- **Usage Context:** Invoked from the room view delete icon; ModalHost handles the pause/resume cycle and tests cover the confirm path and modal teardown.【F:src/frontend/src/components/modals/ModalHost.tsx†L1688-L1727】【F:src/frontend/src/components/modals/ModalHost.test.tsx†L409-L434】

### `GameMenuModal.tsx`

- **Purpose:** Displays a list of game-level actions like Save, Load, and Reset. (Currently placeholder functionality).
- **Props:** None.
- **Icons Used:** None.
- **Dependencies:** None.
- **Usage Context:** Displayed when the user clicks the settings (cog) icon in the `DashboardHeader`.

### `HireEmployeeModal.tsx`

- **Purpose:** A form for hiring a candidate and assigning them to a structure via a dropdown menu.
- **Props:** `onSubmit`, `candidate`, `structures`, `onClose`.
- **Icons Used:** None.
- **Dependencies:** `FormSelect`, `PrimaryButton`.
- **Usage Context:** Displayed when the user clicks "Hire" on a `CandidateCard` in the `PersonnelView`.

### `InfoModal.tsx`

- **Purpose:** Displays detailed information about a specific pest or disease, sourced from its blueprint file. It shows symptoms and categorized control options to help the player make informed decisions.
- **Props:** `blueprint`.
- **Icons Used:** None.
- **Dependencies:** None.
- **Usage Context:** Displayed when a user clicks on a pest or disease icon on a `Plant` card.

### `NewGameModal.tsx`

- **Purpose:** A form that appears when starting a new game, allowing the player to set their company name, CEO name, and a deterministic game seed.
- **Props:** `onSubmit`, `onClose`.
- **Icons Used:** None.
- **Dependencies:** `FormInput`, `PrimaryButton`.
- **Usage Context:** Displayed when the "New Game" button is clicked on the `StartScreen`.

### `PlantDetailModal.tsx`

- **Purpose:** Displays detailed stats for a single plant (health, progress, status) and provides actions to harvest or trash it. The harvest button is disabled if the plant is not yet harvestable.
- **Props:** `plant`, `onHarvest`, `onTrash`.
- **Icons Used:** `CutIcon`, `TrashIcon`.
- **Dependencies:** `CutIcon`, `TrashIcon`.
- **Usage Context:** Displayed when a user clicks on a plant card in the `ZonePlantPanel` (when not in selection mode).

### Device removal confirmation

- **Purpose:** Device removal reuses `ConfirmDeletionModal`, injecting device-specific copy before emitting `devices.removeDevice` so the facade handles bookkeeping.【F:src/frontend/src/components/modals/ModalHost.tsx†L1356-L1371】
- **Usage Context:** Available from the “Remove” button in the device inventory panel; once confirmed the zone snapshot updates after the façade acknowledges the command.【F:src/frontend/src/components/modals/ModalHost.tsx†L1356-L1371】

### `RentStructureModal.tsx`

- **Purpose:** A form for renting a new structure (e.g., warehouse). The dropdown of available structures disables options the player cannot afford.
- **Props:** `onSubmit`, `availableStructures`, `balance`, `onClose`.
- **Icons Used:** None.
- **Dependencies:** `FormInput`, `FormSelect`, `PrimaryButton`.
- **Usage Context:** Displayed when the "Rent New Structure" button is clicked on the `DashboardView`.

---

## 5. Screen Components (`src/components/screens/`)

These components represent full-screen states of the application, like the initial start screen.

### `StartScreen.tsx`

- **Purpose:** The initial screen the user sees after the app loads. It provides the main entry points into the game: "New Game", "Quick Start", and "Import Game".
- **Props:** `onNewGame`, `onQuickStart`, `onImportGame`.
- **Icons Used:** `AddCircleOutlineIcon`, `ForwardIcon`, `UploadIcon`.
- **Dependencies:** `AddCircleOutlineIcon`, `ForwardIcon`, `UploadIcon`.
- **Usage Context:** Rendered by `App.tsx` when the `gameState` is 'startScreen'.

---

## 6. Simulation Components (`src/components/simulation/`)

These are complex components directly related to displaying and interacting with the core simulation elements.

### `EnvironmentPanel.tsx`

- **Purpose:** A detailed panel for viewing and adjusting the environmental controls of a zone. It has two states to balance information density with control availability.
- **Detailed Functionality:**
  - **Collapsed State:** By default, the panel is collapsed and acts as a high-level KPI summary. It displays the most critical environmental metrics (Temperature, Humidity, VPD, CO₂, PPFD, and Light Cycle) with color-coded status indicators (e.g., green for optimal, yellow for warning) for a quick at-a-glance assessment of the zone's health. Clicking anywhere on this summary bar expands the panel.
  - **Expanded State:** When expanded, the panel reveals a detailed control interface.
    - **Range Inputs:** Users can adjust `Temperature`, `Relative Humidity`, `VPD`, `CO₂`, and `PPFD` using interactive range sliders. Slider values mirror the current setpoints and update as `env.setpointUpdated` events arrive from the simulation facade so remote changes remain in sync.
    - **Setpoint Ranges:** Slider bounds align with the backend clamps: Temperature `[10, 35]` °C, Relative Humidity `[0, 1]`, VPD `[0, 2.5]` kPa, CO₂ `[0, 1800]` ppm, and PPFD `[0, 1500]` µmol·m⁻²·s⁻¹. Attempts outside those corridors show the returned warnings inline.
    - **Lighting Controls:** A dedicated section allows toggling the entire light system on/off (`PowerIcon`). Turning the lights off sends a PPFD target of zero while preserving the previous non-zero target for a quick restore. The panel reads the current light cycle from telemetry for context.
    - **Device Dependency:** Controls are automatically disabled (grayed out) if the required device (e.g., an HVAC unit for temperature control) is not installed in the zone, providing clear feedback to the user about equipment limitations. This is a key feature that connects the simulation's inventory (`zone.devices`) directly to the UI's capabilities.
    - **Warnings:** Facade warnings (for example, clamp notifications) are surfaced inline beneath the controls so operators can react immediately when a target is adjusted beyond safe bounds.
    - **Additional KPIs:** Displays secondary metrics like Vapor Pressure Deficit (VPD) that are derived from the primary environmental values.
- **Props:** `zone`, `setpoints`, `bridge`.
- **Icons Used:**
  - `ThermometerIcon`
  - `DropletIcon`
  - `SunIcon`
  - `WindIcon`
  - `PowerIcon`
  - `LightCycleIcon`
  - `NightlightIcon`
  - `WbSunnyIcon`
  - `ChevronRightIcon`
  - `ChevronDownIcon`
  - Direct Material Icons: `science`.
- **Dependencies:** Various `Icon` components.
- **Usage Context:** A key part of the `ZoneDetailView`.

### `ZoneCard.tsx`

- **Purpose:** A compact card representing a single zone. Used in list views to provide a summary and quick access to details or actions.
- **Functionality:** Displays the zone's name, strain, phase, and a progress bar for plant growth. The main body is clickable to navigate to the `ZoneDetailView`. It also includes `ActionIcons` for quick duplication or deletion.
- **Props:** `zone`, `onClick`, `onOpenModal`.
- **Icons Used:** Relies on `ActionIcons` for its icons.
- **Dependencies:** `ActionIcons`.
- **Usage Context:** Used in `RoomDetailView` and `StructureDetailView` to list zones.

### `ZoneDeviceList.tsx`

- **Purpose:** Displays a list of all devices installed in a specific zone, grouped by type, and surfaces lifecycle actions.
- **Functionality:** It aggregates devices by name (e.g., "Sunstream Pro LED x3") for a clean display. From here operators can launch the install, update, move, and removal modals described above via the inline action buttons rendered by `ZoneDetailView`’s device inventory panel.【F:src/frontend/src/views/ZoneDetail.tsx†L1019-L1086】
- **Props:** `devices`, `onOpenModal`, `zoneId`.
- **Icons Used:** `DeleteIcon`.
- **Dependencies:** `DeleteIcon`.
- **Usage Context:** A key part of the `ZoneDetailView`.

### `ZonePlantPanel.tsx`

- **Purpose:** A large, interactive panel that displays all the plants in a zone as a grid. It has two primary interaction modes to handle both individual and batch operations efficiently.
- **Detailed Functionality:**
  - **Normal Mode (Default):**
    - **Inspection:** Hovering over a plant card shows a tooltip with its basic stats. Clicking the card opens the detailed `PlantDetailModal` for a full overview and specific actions.
    - **Direct Actions:** Clicking on a status icon on the plant card triggers a direct action, bypassing the detail modal. Clicking a pest or disease icon opens the `InfoModal` with blueprint data. Clicking the harvest icon immediately harvests the plant. This provides a fast workflow for common tasks.
  - **Selection Mode:**
    - **Activation:** The user clicks the "Select Plants" button to enter this mode. The button then changes to "Cancel Selection".
    - **Interaction:** In this mode, clicking a plant toggles its selection state, indicated by a visual highlight (a green border and overlay).
    - **Batch Actions:** A `BatchActionBar` appears at the top, showing the number of selected plants. This bar has buttons for "Harvest", "Trash", and "Treat". Clicking one of these buttons applies the action to _all_ selected plants, sends the batch action to the `App` component's state handler, and then automatically exits selection mode. This is designed for efficient management of large numbers of plants.
- **Props:** `zone`, `onOpenModal`, `onBatchAction`, `onPlantAction`.
- **Icons Used:**
  - `ChevronDownIcon`
  - `ChevronRightIcon`
  - `BugIcon`
  - `SickIcon`
  - `HealingIcon`
  - `CheckIcon`
  - `CutIcon`
  - Direct Material Icons: `grass`.
- **Dependencies:** `FormSelect`, various `Icon` components.
- **Usage Context:** A key part of the `ZoneDetailView`.

---

## 7. View Components (`src/components/views/`)

These components represent the main content for each primary section of the application.

### `DashboardView.tsx`

- **Purpose:** The main dashboard screen, showing an overview of all player-owned structures as a series of cards.
- **Props:** `structures`, `onNavigate`, `onOpenModal`, `onRename`.
- **Icons Used:** `StoreIcon`.
- **Dependencies:** `InlineEdit`, `StoreIcon`.
- **Usage Context:** The default view when the game starts.

### `FinanceView.tsx`

- **Purpose:** Displays a detailed financial overview.
- **Functionality:** Features several `StatCard` components for high-level numbers. The main content consists of collapsible cards for Revenue, OpEx, and CapEx. The user can select a time range (1D, 1W, 1M, 1Y) which dynamically recalculates and displays the financial data for that period.
- **Props:** `gameData`.
- **Icons Used:**
  - `DollarIcon`
  - `ChevronDownIcon`
  - `ChevronRightIcon`
  - Direct Material Icons: `trending_up`, `receipt_long`, `account_balance`.
- **Dependencies:** `StatCard`, various `Icon` components.
- **Usage Context:** Shown when the user navigates to the "Finance" section.

### `PersonnelView.tsx`

- **Purpose:** The personnel management screen.
- **Functionality:** Uses a tabbed interface to switch between the "Job Market" (a grid of `CandidateCard`s for hiring) and "Your Staff" (a grid of `EmployeeCard`s for managing current staff). Provides buttons to refresh candidates and fire employees.
- **Props:** `gameData`, `onOpenModal`, `onRefreshCandidates`, `onFireEmployee`.
- **Icons Used:** `DeleteIcon`.
- **Dependencies:** `DeleteIcon`.
- **Usage Context:** Shown when the user navigates to the "Personnel" section.

### `RoomView.tsx`

- **Purpose:** Displays the details of a single room, rendering each zone as a climate and cultivation summary card.
- **Functionality:** Zone cards highlight temperature/humidity, cultivation method and substrate names, plant counts, and surface icon-only duplicate/delete controls that open the respective modals while the primary CTA drills into the zone view.【F:src/frontend/src/views/RoomView.tsx†L12-L139】【F:src/frontend/src/views/**tests**/RoomView.test.tsx†L46-L68】
- **Data Sources:** Reads the live simulation snapshot and blueprint catalogs from `useSimulationStore`, using `useNavigationStore` for the current room selection.【F:src/frontend/src/views/RoomView.tsx†L12-L47】
- **Usage Context:** Shown when a user navigates to a specific room from the dashboard or structure view.【F:src/frontend/src/views/RoomView.tsx†L48-L121】

### `StructureDetailView.tsx`

- **Purpose:** Provides a detailed overview of a single structure, listing all of its rooms. For grow rooms, it also shows a nested list of `ZoneCard`s.
- **Props:** `structure`, `onNavigate`, `onOpenModal`, `onRename`.
- **Icons Used:** `GroupIcon`. Relies on `ZoneCard` and `ActionIcons` for other icons.
- **Dependencies:** `InlineEdit`, `ZoneCard`, `ActionIcons`, `GroupIcon`.
- **Usage Context:** Shown when a user selects a structure from the main dashboard.

### `ZoneDetailView.tsx`

- **Purpose:** The most detailed view in the simulation. It composes the `EnvironmentPanel`, `ZonePlantPanel`, and `ZoneDeviceList` to provide a complete interface for managing a single grow zone.
- **Props:** `zone`, `onControlsChange`, `onOpenModal`, `onRename`, `onBatchAction`, `onPlantAction`.
- **Icons Used:** Relies on its child components (`ActionIcons`, `EnvironmentPanel`, `ZonePlantPanel`, `ZoneDeviceList`) for all icons.
- **Dependencies:** `InlineEdit`, `ActionIcons`, `EnvironmentPanel`, `ZonePlantPanel`, `ZoneDeviceList`.
- **Usage Context:** Shown when a user navigates to a specific zone.
- **Device lifecycle controls:** The device inventory panel now features an “Install device” CTA plus inline buttons for adjusting settings, relocating hardware to another zone, or removing a unit. Each action opens a modal (`InstallDeviceModal`, `UpdateDeviceModal`, `MoveDeviceModal`, or the shared confirmation dialog) and delegates to the new zone-store helpers so façade intents fire in order.【F:src/frontend/src/views/ZoneDetail.tsx†L1019-L1086】【F:src/frontend/src/components/ModalHost.tsx†L1-L260】【F:src/frontend/src/store/zoneStore.ts†L385-L456】
- **Cultivation method management:** The zone header highlights `zone.cultivationMethodName` plus container/substrate names and offers a “Change method” button that opens the dedicated modal. The dialog now filters compatible methods, constrains the container/substrate lists to the selected method, clamps the container count to the zone’s capacity while recomputing substrate volume and cost estimates, confirms the storage handoff via the stub handler, and dispatches `world.updateZone` through the frontend bridge with the consumable payload.【F:src/frontend/src/views/ZoneView.tsx†L332-L370】【F:src/frontend/src/components/modals/ModalHost.tsx†L365-L544】【F:src/frontend/src/components/modals/**tests**/ChangeZoneMethodModal.test.tsx†L128-L210】【F:src/frontend/src/facade/systemFacade.ts†L440-L456】

---

## 8. Contexts (`src/contexts/`)

### `ToastContext.tsx`

- **Purpose:** Provides a global state management solution for toast notifications using React Context, decoupling the notification-triggering logic from the presentation component.
- **Components:**
  - `ToastProvider`: The provider component that should wrap the entire application to make the toast context available.
- **Hooks:**
  - `useToast`: A custom hook that allows any component to access the `addToast` function. Calling `addToast("Message", "success")` will automatically add a new toast to the state, which is then rendered by the `ToastContainer`. This follows the producer/consumer pattern, where many components can produce toasts, but only one component is responsible for consuming and displaying them.
- **Icons Used:** None.
- **Usage Context:** `ToastProvider` is wrapped around `AppContent` in `App.tsx`. The `useToast` hook is used in `App.tsx` and other components to show feedback to the user.

---

## Styling and Design System

This section outlines the visual design principles, color palette, and common styling patterns used throughout the Weedbreed.AI application.

### Core Philosophy: Tailwind CSS Utility-First

The application is styled exclusively with **Tailwind CSS**. There is no separate CSS file for component-specific styles (with one minor exception for the scrollbar). This utility-first approach ensures consistency, reduces CSS bloat, and makes styling rapid and maintainable. All styling is co-located with the component markup.

### Color Palette (Dark Theme)

The UI uses a consistent dark theme based on the Tailwind `stone` color family, with `lime` as the primary accent color for interactive elements.

- **Background:** `bg-stone-900`
- **Text (Primary):** `text-stone-200` / `text-stone-100`
- **Text (Secondary/Muted):** `text-stone-400` / `text-stone-500`
- **Panels & Cards:** `bg-stone-800/30` (a semi-transparent dark gray for a layered effect)
- **Borders & Dividers:** `border-stone-700`
- **Primary Accent (Buttons, Highlights):** `bg-lime-600`, `text-lime-400`
- **Status Colors:**
  - **Success/Optimal:** `text-green-400`, `bg-green-600`
  - **Warning/Attention:** `text-yellow-400`, `bg-yellow-500`
  - **Danger/Error:** `text-red-400`, `bg-red-600`
  - **Informational:** `text-blue-400`, `text-cyan-400`

### Typography

- **Font Family:** The entire application uses the **Inter** font, loaded via Google Fonts in `index.html`.
- **Headings:** Headings are styled using Tailwind's font-size and font-weight utilities (e.g., `text-3xl font-bold`) on `<p>` or `<div>` tags, rather than relying on default `<h1>`, `<h2>` styles. This ensures visual consistency is controlled by the utility classes.

### Common UI Pattern Snippets

Here are examples of the Tailwind classes used for common, repeated UI elements:

**1. Standard Card/Panel:**
Most content containers share this base style.

```html
<div class="bg-stone-800/30 rounded-lg p-6">
  <!-- Card content -->
</div>
```

**2. Primary Button:**
Used for the main positive action in a form or modal.

```html
<button
  class="w-full bg-lime-600 hover:bg-lime-700 text-white font-semibold py-2 px-4 rounded-md transition-colors disabled:bg-stone-600 disabled:cursor-not-allowed"
>
  Action
</button>
```

**3. Form Input:**
A standard input field with consistent styling.

```html
<div>
  <label class="block text-sm font-medium text-stone-300 mb-1">Label</label>
  <input
    class="w-full bg-stone-900 border border-stone-700 rounded-md px-3 py-2 text-stone-100 focus:ring-2 focus:ring-lime-500 focus:border-lime-500 outline-none"
  />
</div>
```

**4. Modal Structure:**
The base classes for the modal overlay and container.

```html
<div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-stone-800 border border-stone-700 rounded-lg shadow-xl w-full max-w-md m-4">
    <header class="flex items-center justify-between p-4 border-b border-stone-700">
      <!-- Header content -->
    </header>
    <div class="p-6">
      <!-- Modal content -->
    </div>
  </div>
</div>
```

### Custom CSS: Scrollbar

The only piece of custom CSS in the entire application is for styling the browser scrollbar to match the dark theme. This is defined in a `<style>` block in `index.html`.

```css
/* Custom scrollbar for a better dark-mode aesthetic */
::-webkit-scrollbar {
  width: 8px;
}
::-webkit-scrollbar-track {
  background: #1c1917; /* stone-900 */
}
::-webkit-scrollbar-thumb {
  background: #57534e; /* stone-600 */
  border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
  background: #78716c; /* stone-500 */
}
```

---

## Fehlende Schlüsselinformationen für einen UI-Neubau

Die vorliegende Komponentendokumentation beschreibt die _Struktur_ und _Verantwortlichkeit_ der UI-Elemente, lässt jedoch kritische Informationen für eine technische Neuimplementierung aus.

- **Domain- & Datenmodelle fehlen:** Die Beschreibungen verweisen auf Objekte wie `gameData`, `selection`, `Structure`, `Zone` oder `EventLogItem`, ohne deren Felder oder Typen zu definieren. Damit ist unklar, welche Datenstrukturen ein neues Frontend erwarten oder erzeugen muss.

- **State-Management & Backend-Anbindung unklar:** Es wird nur erwähnt, dass `App.tsx` den kompletten Zustand verwaltet, doch Angaben zu einem globalen Store (z. B. Zustand/Zustandshooks), zu Socket.IO-Subscriptions oder zu API-Aufrufen fehlen. Ohne diese Informationen lässt sich die Datenversorgung des UI nicht rekonstruieren.

- **Interaktionskontrakte nicht spezifiziert:** Viele Props wie `onUpdate`, `onBatchAction`, `onPlantAction` oder `onNavigate` werden genannt, aber weder ihre erwarteten Parameter noch die resultierenden Seiteneffekte werden definiert. Für eine Neuimplementierung ist daher unklar, welche Payloads Aktionen verarbeiten sollen.

- **Fehlende UI-/Design-Details:** Zwar wird von „standardisierten“ Buttons, Formularen oder Karten gesprochen, konkrete Stilvorgaben (Tailwind-Klassen, Farb-/Spacing-Tokens, Breakpoints) oder Layout-Spezifikationen fehlen jedoch komplett. Somit lassen sich Look & Feel oder Responsiveness nicht reproduzieren.

- **Zustands- und Fehlerszenarien offen:** Das Dokument beschreibt Idealabläufe (z. B. zwei Zustände des `EnvironmentPanel` oder den Auswahlmodus im `ZonePlantPanel`), liefert aber keine Hinweise auf Edge Cases wie Validierungsfehler, leere Listen, Netzwerkprobleme oder konkurrierende Updates.

### Empfohlene Ergänzungen

- Typdefinitionen bzw. Links zu Schema-/Blueprint-Dokumenten für alle erwähnten Datenobjekte.
- Beschreibung des globalen Datenflusses (Socket-Events, REST-Endpunkte, Zustand-Store, Event-Handler-Signaturen).
- Design-Spezifikation mit Tailwind-Tokens, Komponenten-Layouts, Responsive-Verhalten und Accessibility-Anforderungen.
- Ablauf- oder Sequenzdiagramme für wichtige Interaktionen (z. B. wie `onUpdate` aus `EnvironmentPanel` in die Simulation greift).
- Fehler-, Lade- und Edge-Case-Szenarien einschließlich erwarteter Nutzerführung und Fallbacks.

## Documentation Outline (docs/\_inventory/outline.md)

Source: [`docs/_inventory/outline.md`](../docs/_inventory/outline.md)

# Documentation Outline

- docs/CHANGELOG.md
  - # Documentation Changelog
    - ## [Unreleased]
      - ### Added
      - ### Changed

- docs/DD.md
  - # Weedbreed.AI — Data Dictionary (DD)
    - ## Conventions (apply to all files)
    - ## 1) Strains — `/data/blueprints/strains/*.json`
      - ### Purpose
      - ### Schema (fields & meaning)
      - ### Example (minimal)
    - ## 2) Devices — `/data/blueprints/devices/*.json`
      - ### Purpose
      - ### Schema
      - ### Example (Grow light)
    - ## 3) Cultivation Methods — `/data/blueprints/cultivationMethods/*.json`
      - ### Purpose
      - ### Schema
    - ## 4) Diseases — `/data/blueprints/diseases/*.json`
      - ### Purpose
      - ### Schema
    - ## 5) Pests — `/data/blueprints/pests/*.json`
      - ### Purpose
      - ### Schema
    - ## 6) Treatment Options — `/data/configs/treatment_options.json`
      - ### Purpose
      - ### Schema
    - ## 7) Prices — `/data/prices/*.json`
    - ## 8) Task Definitions — `/data/configs/task_definitions.json`
    - ## 9) Structures — `/data/blueprints/structures/*.json`
    - ## 10) Personnel Pools — `/data/personnel`

- docs/TDD.md
  - # Weedbreed.AI — Technical Design Document (TDD)
    - ## 0) Goals & Principles
    - ## 1) Authoritative State & Public API
    - ## 2) Simulation Loop (fixed-step)
    - ## 3) Environment & Device Models
    - ## 4) Plants & Growth
    - ## 5) Health System (Pests & Diseases)
    - ## 6) Personnel as Agents
      - ### Personnel & Labor Market
      - ### Task Engine (augment)
      - ### Agentic Employees (augment)
      - ### Overtime Mechanics
      - ### Data & Validation Hooks (augment)
    - ## 7) Economy & Inventory
    - ## 8) Device Placement Rules
    - ## 9) Data Loading, Validation, & Hot Reload
    - ## 10) Identifier Policy (final)
    - ## 11) Events & Telemetry (examples)
    - ## 12) Determinism, Performance, Testing
    - ## 13) Security & Safety
    - ## 14) Extensibility & Roadmap
    - ## 15) Example Public API (shape-only, stack-neutral)

- docs/addendum/all-json.md
  - ## /data/blueprints/cultivationMethods/basic_soil_pot.json
  - ## /data/blueprints/cultivationMethods/scrog.json
  - ## /data/blueprints/cultivationMethods/sog.json
  - ## /data/blueprints/devices/climate_unit_01.json
  - ## /data/blueprints/devices/co2injector-01.json
  - ## /data/blueprints/devices/dehumidifier-01.json
  - ## /data/blueprints/devices/exhaust_fan_01.json
  - ## /data/blueprints/devices/humidity_control_unit_01.json
  - ## /data/blueprints/devices/veg_light_01.json
  - ## /data/blueprints/diseases/anthracnose.json
  - ## /data/blueprints/diseases/bacterial_leaf_spot.json
  - ## /data/blueprints/diseases/bacterial_wilt.json
  - ## /data/blueprints/diseases/botrytis_gray_mold.json
  - ## /data/blueprints/diseases/downy_mildew.json
  - ## /data/blueprints/diseases/hop_latent_viroid.json
  - ## /data/blueprints/diseases/mosaic_virus.json
  - ## /data/blueprints/diseases/powdery_mildew.json
  - ## /data/blueprints/diseases/root_rot.json
  - ## /data/blueprints/personnel/roles/Gardener.json
  - ## /data/blueprints/personnel/roles/Janitor.json
  - ## /data/blueprints/personnel/roles/Manager.json
  - ## /data/blueprints/personnel/roles/Operator.json
  - ## /data/blueprints/personnel/roles/Technician.json
  - ## /data/blueprints/personnel/skills/Administration.json
  - ## /data/blueprints/personnel/skills/Cleanliness.json
  - ## /data/blueprints/personnel/skills/Gardening.json
  - ## /data/blueprints/personnel/skills/Logistics.json
  - ## /data/blueprints/personnel/skills/Maintenance.json
  - ## /data/blueprints/pests/aphids.json
  - ## /data/blueprints/pests/broad_mites.json
  - ## /data/blueprints/pests/caterpillars.json
  - ## /data/blueprints/pests/fungus_gnats.json
  - ## /data/blueprints/pests/root_aphids.json
  - ## /data/blueprints/pests/spider_mites.json
  - ## /data/blueprints/pests/thrips.json
  - ## /data/blueprints/pests/whiteflies.json
  - ## /data/blueprints/roomPurposes/breakroom.json
  - ## /data/blueprints/roomPurposes/growroom.json
  - ## /data/blueprints/roomPurposes/lab.json
  - ## /data/blueprints/roomPurposes/salesroom.json
  - ## /data/blueprints/strains/ak-47.json
  - ## /data/blueprints/strains/northern-lights.json
  - ## /data/blueprints/strains/skunk-1.json
  - ## /data/blueprints/strains/sour-diesel.json
  - ## /data/blueprints/strains/white-widow.json
  - ## /data/blueprints/structures/medium_warehouse.json
  - ## /data/blueprints/structures/shed.json
  - ## /data/blueprints/structures/small_warehouse.json
  - ## configs/difficulty.json
  - ## configs/disease_balancing.json
  - ## configs/pest_balancing.json
  - ## configs/task_definitions.json
  - ## configs/treatment_options.json
  - ## personnel/names/firstNamesFemale.json
  - ## personnel/names/firstNamesMale.json
  - ## personnel/names/lastNames.json
  - ## personnel/randomSeeds.json
  - ## personnel/traits.json
  - ## prices/devicePrices.json
  - ## prices/strainPrices.json
  - ## prices/utilityPrices.json

- docs/addendum/ideas/breeding_module.md
  - # Weed Breed — Breeding Module (TS + Pseudocode)
    - ## 0) Goals
    - ## 1) Real → Game Mapping (Time)
    - ## 2) Strain Fields used (subset)
    - ## 3) Breeding Core (TypeScript)
    - ## 4) Time Model (TypeScript)
    - ## 5) UI (React/Vite) — Pseudocode
    - ## 6) CLI Demo (optional)
    - ## 7) Balancing Knobs
    - ## 8) Integration Tips

- docs/addendum/ideas/kief_dsl.md
  - # KIEF DSL — High‑Level Integration (Monorepo, `data/kief`, Pseudocode‑Only)
    - ## 1) Core Idea
    - ## 2) Monorepo Folder Structure (Proposal)
    - ## 3) KIEF File (Author View)
    - ## 4) Parser → IR (Pseudocode)
    - ## 5) Compiler (IR → Closures)
    - ## 6) Runtime & Hooks
    - ## 7) Engine Integration (Main Loop, Backend under `src/backend/src`)
    - ## 8) Root Scripts (PNPM, Repo Root)
    - ## 9) Telemetry & Tests
    - ## 10) Authoring Guardrails
    - ## 11) Starter Packages (`/data/kief`)
    - ## 12) Integration Plan

- docs/addendum/ideas/room-purpose-registry.md
  - # Room Purpose Registry
    - ## Overview
    - ## API
    - ## Schema

- docs/addendum/ideas/terpenes.md
  - # Terpene & Effects — High‑Level Concepts for Strain Blueprints (Augmented)
    - ## 0) Guardrails
    - ## 1) Target Schema (Concept)
    - ## 2) Normalization (Concept)
    - ## 3) Axis Derivation from Terpene Profile (Heuristic, Concept)
    - ## 4) Deriving Positive/Negative Effects (Concept)
    - ## 5) ETL Pipeline (Concept)
  - # Appendices (New)
    - ## A) **Effect Vocabulary — English (Canon Keys)**
      - ### A.1 Positive effects (list)
      - ### A.2 Negative effects (list)
      - ### A.3 Experience descriptors ("Wirkung") — English list
    - ## B) **Cannabis‑Relevant Terpene Canon — English**
    - ## C) JSON Blueprint Stubs (Effects & Terpenes)
    - ## D) Validation & Canon Checks (Zod Sketch)
    - ## E) UI/Gameplay Hooks (Quick Notes)

- docs/addendum/migrations/2025-01-22-typescript-toolchain.md
  - # Migration — Backend TypeScript Toolchain
    - ## Summary
    - ## Required actions for feature branches
    - ## Notes

- docs/backend-overview.md
  - # Backend Overview
    - ## 1. Purpose & Non-Goals
    - ## 2. Architecture Overview
    - ## 3. Blueprints Provided & How to Use Them
      - ### 3.1 Operating Principles
      - ### 3.2 Blueprint–to–Subsystem Mapping
    - ## 4. Blueprint Inventory
      - ### 4.1 Structures & Room Purposes
      - ### 4.2 Cultivation Methods
      - ### 4.3 Strain Blueprints
      - ### 4.4 Device Blueprints
      - ### 4.5 Pest & Disease Blueprints
      - ### 4.6 Personnel Roles & Skills
      - ### 4.7 Price & Cost Blueprints
    - ## 5. Materialization & Runtime State
    - ## 6. Identifier Strategy
    - ## 7. Quality Gates & Validation

- docs/constants/balance.md
  - # Game Balance Constants
    - ## Human Resources & Employee Morale
    - ## Skills & Experience
    - ## Plant Growth & Health
    - ## General Time

- docs/constants/environment.md
  - # Environmental Simulation Constants
    - ## Zone Sufficiency & Climate Control
    - ## Ambient (External) Environment Conditions
    - ## Normalization & Physics Factors
    - ## Device & Plant Effect Factors
    - ## Durability & Disease

- docs/releases/2025-02-si-blueprint-migration.md
  - # Blueprint Unit Migration (SI Base Units)
    - ## Summary
    - ## Renamed Fields & Unit Changes
    - ## Authoring Guidance
    - ## Runtime Implications
    - ## Migration Checklist

- docs/system/adr/0001-typescript-toolchain.md
  - # ADR 0001 — Backend TypeScript Toolchain Stabilization
    - ## Context
    - ## Decision
    - ## Consequences
    - ## Alternatives Considered
    - ## Rollback Plan

- docs/system/adr/0002-frontend-realtime-stack.md
  - # ADR 0002 — Frontend Real-Time Dashboard Stack
    - ## Context
    - ## Decision
    - ## Consequences
    - ## Alternatives Considered
    - ## Rollback Plan

- docs/system/adr/0003-facade-messaging-overhaul.md
  - # ADR 0003 — Facade Messaging Overhaul
    - ## Context
    - ## Decision
    - ## Consequences
    - ## Alternatives Considered
    - ## Rollback Plan

- docs/system/adr/0004-zone-setpoint-routing.md
  - # ADR 0004 — Zone Setpoint Routing
    - ## Context
    - ## Decision
    - ## Consequences
    - ## Alternatives Considered
    - ## Rollback Plan

- docs/system/adr/0005-snapshot-time-sync.md
  - # ADR 0005 — Snapshot & Time Status Telemetry Contract
    - ## Context
    - ## Decision
    - ## Consequences
    - ## References

- docs/system/adr/0006-socket-transport-parity.md
  - # ADR 0006 — Socket Transport Version Parity
    - ## Context
    - ## Decision
    - ## Consequences
    - ## Alternatives Considered
    - ## Rollback Plan

- docs/system/adr/0007-physio-module-relocation.md
  - # ADR 0007 — Physiology Modules Collocate with the Engine
    - ## Context
    - ## Decision
    - ## Consequences
    - ## Alternatives Considered
    - ## Rollback Plan
    - ## Status Updates

- docs/system/adr/0008-randomuser-provisioning.md
  - # ADR 0008 — Auto-Provision Personnel Directory from RandomUser
    - ## Context
    - ## Decision
    - ## Consequences
    - ## Failure Modes & Mitigations
    - ## Operational Guidance
    - ## Alternatives Considered
    - ## Rollback Plan

- docs/system/adr/0009-simulation-constants-governance.md
  - # ADR 0009 — Simulation Constant Governance & Documentation Loop
    - ## Context
    - ## Decision
    - ## Scope
    - ## Consequences
    - ## References

- docs/system/audit.md
  - # Simulation Audit Runner
    - ## Running an audit
      - ### Output structure
      - ### Baseline comparisons
      - ### CI integration

- docs/system/data-validation.md
  - # Blueprint Data Validation Workflow
    - ## Command
      - ### Options
    - ## Output
    - ## Continuous Integration
    - ## Device Setpoint Casing Guard

- docs/system/employees.md
  - # Weedbreed.AI — Employee System
    - ## Overview
    - ## 1) Candidate Generation & External Name Provider
    - ## 2) Work as Discrete Tasks
    - ## 3) Overtime (Energy-Linked)
  - # DD Additions
    - ## Personnel (new or clarified fields)
    - ## Hiring / Candidate Source
    - ## Tasks (augment existing section)
    - ## Overtime & Policy

- docs/system/facade.md
  - # Weedbreed.AI — System Facade
    - ## 1) Purpose & Responsibilities
    - ## 2) Contract & Guarantees
    - ## 3) Data Surfaces
      - ### 3.1 Read API (snapshots & queries)
      - ### 3.2 Write API (intents/commands)
    - ## 4) Command Surface (categories)
      - ### 4.1 Time & Simulation Control
      - ### 4.2 Data Lifecycle
      - ### 4.3 World Building (Structures → Rooms → Zones)
      - ### 4.4 Devices
      - ### 4.5 Plants & Plantings
      - ### 4.6 Health (Pests/Diseases & Treatments)
      - ### 4.7 Personnel & Tasks
      - ### 4.8 Finance & Market
    - ## 5) Error Handling & Validation
    - ## 6) Events (taxonomy)
    - ## 7) Concurrency Models
    - ## 8) Tick Orchestration (conformance to Simulation Deep Dive)
    - ## 9) Identity & Referencing
    - ## 10) Security & Safety
    - ## 11) Testing & Observability
    - ## 12) Example API Shape (pseudo‑types)
    - ## 13) Anti‑Patterns (explicitly disallowed)
    - ## 14) Migration & Hot‑Reload Notes
    - ## 15) Extensibility

- docs/system/job_market_population.md
  - # Weedbreed.AI — Job Market Population
    - ## Weekly Refresh Lifecycle
    - ## Remote Provider Contract (randomuser.me)
    - ## Startup Provisioning Service
    - ## Deterministic Seeding Strategy
    - ## Candidate Synthesis Pipeline
    - ## Fallback Strategy (Offline Mode)
    - ## Configuration & Operations
    - ## Monitoring & Observability
    - ## Operational Checklist

- docs/system/logging.md
  - # Logging & Telemetry Configuration
    - ## Environment Variables
    - ## Sample `.env`
    - ## Telemetry Context

- docs/system/personnel_roles_blueprint.md
  - # Weedbreed.AI — Personnel Role Blueprint
    - ## Directory Layout
    - ## PersonnelRoleBlueprint Fields
      - ### Salary Config
      - ### Skill Profile
    - ## Normalization & Fallbacks
    - ## Runtime Consumers

- docs/system/runtime-event-bus-migration.md
  - # Runtime Event Bus Migration Notes
    - ## Overview
    - ## Migration Guidance
      - ### Suggested Codemod

- docs/system/simulation-engine.md
  - # Weedbreed.AI — Simulation Engine Deep Dive
    - ## Timebase & Core Loop (fixed-step, scheduler-agnostic)
      - ### Goals
      - ### Process
    - ## Environment Model (per Zone; well-mixed, delta-based)
      - ### Tick Order (environment phase)
    - ## Plant Growth, Stress, Health (per Planting/Plant)
      - ### Inputs from DD
      - ### Tick Order (plant phase)
    - ## Health: Pests & Diseases (detect → progress → spread → treat)
      - ### Tick Order (health phase)
    - ## Tasks & Agentic Employees (utility-based; overtime-aware)
      - ### Task generation (per tick)
      - ### Claiming (pull model with utility)
      - ### Execution & completion
      - ### Overtime (energy-linked)
    - ## Economics (currency-neutral)
    - ## Persistence, Validation, and Hot-Reload
    - ## Determinism & RNG Streams
    - ## Error Handling & Safety
    - ## Future Enhancements (compatible with current contracts)

- docs/system/simulation_philosophy.md
  - # Weedbreed.AI — Simulation Philosophy Deep Dive
    - ## 1. Time & Simulation Loop: Stability and Fairness
    - ## 2. Environmental Model: Emergent Complexity from Simple Rules
    - ## 3. Plant Growth Model: The Core Feedback Loop
    - ## 4. Personnel & AI: Autonomous Agents and Indirect Control
    - ## 5. Economic Model: Constant Pressure and Rewarding Mastery
    - ## 6. Genetics & Breeding: Player-Driven Discovery

- docs/system/socket_protocol.md
  - # Socket Protocol — Simulation Gateway
    - ## UI Stream (`uiStream$`)
    - ## Connection & Handshake
      - ### Frontend Configuration
    - ## Outgoing Events
      - ### `simulationUpdate`
      - ### `sim.tickCompleted`
      - ### `domainEvents`
    - ## Server-Sent Events (`/events`)
    - ## Incoming Commands
      - ### Common Envelope
      - ### `facade.intent` — Domain Command Envelope
        - #### Supported actions per domain
      - ### `simulationControl`
      - ### `config.update`
    - ## Error Handling
    - ## Batching Guarantees
    - ## Versioning

- docs/system/wb-physio.md
  - # Weed Breed Physiology Reference
    - ## Temperature Mixing (`temp.ts`)
    - ## Relative Humidity Mixing (`rh.ts`)
    - ## CO₂ Dynamics (`co2.ts`)
    - ## Photosynthetic Photons (`ppfd.ts`)
    - ## Vapour Pressure Deficit (`vpd.ts`)
    - ## Transpiration (`transpiration.ts`)
    - ## Integration Points

- docs/tasks/20250923-clickdummy-migration_steps.md
  - ## Inventory
  - ## Data shape gaps vs PRD
  - ## Non-determinism & global state to replace
  - ## Migration backlog
  - ## Open questions / risks
  - ## Lösungsweg
    - ### Daten- und Zustandsnormalisierung
    - ### Layout- und Navigationsmigration
    - ### View-spezifische Portierungen
    - ### Modale und Workflows
    - ### Gemeinsame Komponenten & Utilities
    - ### Qualitätssicherung

- docs/tasks/20250923-todo-findings.md

- docs/tasks/20250924-todo-findings.md

- docs/tasks/20250925-job-market-refresh.md
  - # 2025-09-25 — Randomuser-backed job market refresh

- docs/tasks/20250926-personnel-provisioning.md
  - # 2025-09-26 — Personnel directory provisioning follow-ups

- docs/ui/migration-notes.md
  - # Frontend Migration Notes
    - ## Summary
    - ## Omitted Legacy Elements
    - ## Follow-up Tasks
    - ## Connectivity
    - ## Retirement

- docs/ui/ui-components-desciption.md
  - # Component Documentation
    - ## Screenshot Reference Map
    - ## Simulation Facade Intent Coverage
      - ### Time & Loop Control
      - ### Environment Configuration
      - ### World Domain (Structures, Rooms, Zones)
      - ### Device Domain
      - ### Plant Domain
      - ### Health Domain
      - ### Workforce Domain
      - ### Finance Domain
    - ## 1. Top-Level Components
      - ### `src/App.tsx`
    - ## 2. Common Components (`src/components/common/`)
      - ### `ActionIcons.tsx`
      - ### `Breadcrumbs.tsx`
      - ### `Buttons.tsx`
      - ### `Form.tsx`
      - ### `Icons.tsx`
      - ### `InlineEdit.tsx`
      - ### `Modal.tsx`
      - ### `StatCard.tsx`
      - ### `Toast.tsx`
    - ## 3. Layout Components (`src/components/layout/`)
      - ### `DashboardHeader.tsx`
      - ### `EventLog.tsx`
      - ### `MainContent.tsx`
      - ### `Sidebar.tsx`
    - ## 4. Modal Components (`src/components/modals/`)
      - ### `AddDeviceModal.tsx`
      - ### `CreateRoomModal.tsx`
      - ### `CreateZoneModal.tsx`
      - ### `RentStructureModal.tsx`
      - ### `DuplicateStructureModal.tsx`
      - ### `DuplicateRoomModal.tsx`
      - ### `DuplicateZoneModal.tsx`
      - ### `GameMenuModal.tsx`
      - ### `HireEmployeeModal.tsx`
      - ### `InfoModal.tsx`
      - ### `NewGameModal.tsx`
      - ### `PlantDetailModal.tsx`
      - ### `PlantStrainModal.tsx`
      - ### `InstallDeviceModal.tsx`
      - ### `UpdateDeviceModal.tsx`
      - ### `MoveDeviceModal.tsx`
      - ### Device removal confirmation
      - ### `RentStructureModal.tsx`
    - ## 5. Screen Components (`src/components/screens/`)
      - ### `StartScreen.tsx`
    - ## 6. Simulation Components (`src/components/simulation/`)
      - ### `EnvironmentPanel.tsx`
      - ### `ZoneCard.tsx`
      - ### `ZoneDeviceList.tsx`
      - ### `ZonePlantPanel.tsx`
    - ## 7. View Components (`src/components/views/`)
      - ### `DashboardView.tsx`
      - ### `FinanceView.tsx`
      - ### `PersonnelView.tsx`
      - ### `RoomDetailView.tsx`
      - ### `StructureDetailView.tsx`
      - ### `ZoneDetailView.tsx`
    - ## 8. Contexts (`src/contexts/`)
      - ### `ToastContext.tsx`
    - ## Styling and Design System
      - ### Core Philosophy: Tailwind CSS Utility-First
      - ### Color Palette (Dark Theme)
      - ### Typography
      - ### Common UI Pattern Snippets
      - ### Custom CSS: Scrollbar
    - ## Fehlende Schlüsselinformationen für einen UI-Neubau
      - ### Empfohlene Ergänzungen

- docs/ui/ui-implementation-spec.md
  - # Weedbreed.AI — Frontend Implementation Spec
    - ## 1) Overall Architecture & Layout
    - ## 2) Core Components (Behavior & Layout)
      - ### 2.1 Dashboard (primary info & controls)
      - ### 2.2 Navigation Bar (breadcrumbs)
    - ## 3) Hierarchical Views (Structure → Room → Zone)
      - ### 3.1 Structures View
      - ### 3.2 Structure Detail View
      - ### 3.3 Room Detail View
      - ### 3.4 Zone Detail View
    - ## 4) Modal System
    - ## 5) Implemented User Interactions (Command Mapping)
    - ## 6) Icons (Material Symbols Outlined)
    - ## 7) Accessibility & Responsiveness
    - ## 8) Non‑Goals / Anti‑Patterns

- docs/ui/ui-screenshot-insights.md
  - # UI Screenshot Insights
    - ## Overview of the Frontend Idea
    - ## Game Lifecycle Surfaces
    - ## Strategic Management Views
    - ## Operations, Personnel, and Finance Loops
    - ## Interaction & Visual Patterns

- docs/ui/ui_archictecture.md
  - # Weedbreed.AI — UI Architecture
    - ## 1) Core Philosophy — “Dumb” UI, Smart Engine
    - ## 2) Unidirectional Dataflow (Render → Act → Apply → Notify → Re‑render)
    - ## 3) Technical Building Blocks (UI layer)
      - ### 3.1 Bridge Hook (UI ↔ Facade)
      - ### 3.2 Application Orchestrator
      - ### 3.3 Navigation Manager
      - ### 3.4 Modal Manager (Input Workflows)
      - ### 3.5 Views vs. Components
      - ### 3.6 Styling & Theming
    - ## 4) Read Models & Identity in the UI
    - ## 5) Command Usage Patterns (UI)
    - ## 6) Event Consumption
    - ## 7) Performance & Robustness
    - ## 8) Anti‑Patterns (explicitly disallowed)
    - ## 9) Optional React Mapping (for teams using React)

- docs/ui/ui_elements.md
  - # Weedbreed.AI — UI Elements
    - ## Design-System-Primitiven
    - ## 1. Start Screen
    - ## 2. Main Game Interface
      - ### 2.1. The Dashboard (Persistent Header)
      - ### 2.2. Navigation Bar (Breadcrumbs)
    - ## 3. Main Content Views
      - ### 3.1. Structures List (Default View)
      - ### 3.2. Structure Detail View
      - ### 3.3. Room Detail View
      - ### 3.4. Zone Detail View
      - ### 3.5. Finances View
      - ### 3.6. Personnel View
    - ## 4. Modals (Pop-ups)

- docs/ui/ui_interactions_spec.md
  - # Weedbreed.AI — UI Interaction Spec
    - ## 1) Overview of Implemented User Interactions
      - ### A. Game Lifecycle & Setup
      - ### B. Infrastructure Management (Macro Loop)
      - ### C. Cultivation & Zone Management (Micro Loop)
      - ### D. Personnel Management
      - ### E. Financial & Strategic Overview
    - ## 2) Technical UI Component Breakdown (illustrative)
      - ### A. Core Application Structure
      - ### B. Primary Views
      - ### C. Hierarchical Detail Components
      - ### D. UI Chrome & Navigation
      - ### E. Modals (managed by the modal controller)
      - ### F. Reusable & Specialized Components
    - ## 3) Identity, Validation & Safety (UI Contract)
    - ## 4) Performance & UX Notes
    - ## 5) Anti‑Patterns (explicitly disallowed)

- docs/ui-building_guide.md
  - # Weedbreed.AI UI Building Guide
    - ## Table of Contents
    - ## Guiding Principles
    - ## Layout & Navigation
      - ### Application Shell
      - ### Responsive Breakpoints & Navigation Behaviour
      - ### Persistent Dashboard & Controls
      - ### Breadcrumbs & States
      - ### Panel Layouts & Responsive Breakpoints
    - ## Core Views
      - ### Start Screen
      - ### Dashboard & Global Chrome
      - ### Structures Overview
      - ### Structure Detail View
      - ### Room Detail View
        - #### BreedingStation (Lab Rooms)
      - ### Zone Detail View
      - ### Finances View
      - ### Personnel View
      - ### Event Log & Ancillary Panels
    - ## UI Elements & Patterns
      - ### Screenshot Reference Map
      - ### Design-System Primitives
      - ### Generic Components
      - ### Layout Components
      - ### Modal Components
      - ### Simulation Components
      - ### View Components (Composition Level)
      - ### Context Providers
      - ### Contract Type Definitions
      - ### State Management & Backend Integration
      - ### Styling & Responsiveness Guardrails
      - ### Resilience Patterns
    - ## Interactions
      - ### Game Lifecycle
      - ### Infrastructure & Navigation
      - ### Cultivation & Zone Management
      - ### Environment & Telemetry Control
      - ### Personnel & Finance
      - ### Modals & Focus Management
    - ## States & Telemetry
    - ## Accessibility & Performance
    - ## Visual Guardrails
      - ### Iconography
      - ### Spacing & Vertical Rhythm
      - ### Icon Sizing Guidelines
      - ### Dark Theme Tokens
      - ### Core CSS Snippets
      - ### Tailwind Building Blocks
      - ### Custom Scrollbar
      - ### Layout Reminders
    - ## Glossary
    - ## Changelog Note
    - ## Open Issues

- docs/vision_scope.md
  - # Weedbreed.AI — Vision & Scope
    - ## 1. Vision
    - ## 2. Target Audiences & Stakeholders
    - ## 3. Success Criteria
    - ## 4. Canonical Domain Model
    - ## 5. Simulation Philosophy
    - ## 6. Progression & Economy
    - ## 6a. Quality Grades & Price Functions
    - ## 7. Automation & Agents
    - ## 8. Content & Data Strategy
    - ## 9. UX & Presentation Vision (Technology-Agnostic)
    - ## 10. Persistence & Compatibility
    - ## 11. Telemetry, Validation & Tests
    - ## 12. Non-Functional Requirements (NFR)
    - ## 13. Legal & Ethics
    - ## 14. Roadmap & Release Criteria
    - ## 15. Risks & Assumptions
    - ## 16. Binding Rules & Technical Guardrails (Coding‑Ready)
      - ### 16.1 Units & Numerics (SI policy, rounding, tolerances)
      - ### 16.2 Seed policy & RNG sources
      - ### 16.3 Time scaling & pause semantics
      - ### 16.4 Task arbiter – deterministic priorities & fairness
      - ### 16.5 Device degradation & maintenance
      - ### 16.6 Market / price baseline
      - ### 16.7 Storage & post‑harvest quality decay
      - ### 16.8 Pest/disease treatments – side effects
      - ### 16.9 Savegame schema & migrations
      - ### 16.10 Audit metrics – definitions & thresholds
      - ### 16.11 Maximum plants per zone – binding formula
      - ### 16.12 Climate controller – control strategy
      - ### 16.13 Staff shift model
      - ### 16.14 Device conflict / capacity rules
      - ### 16.15 Failure & degrade‑mode matrix

## Task: Replace Frontend Mock Data with Live Simulation Feeds (docs/tasks/20250928-replace-mock-data.md)

Source: [`docs/tasks/20250928-replace-mock-data.md`](../docs/tasks/20250928-replace-mock-data.md)

# Task: Replace Frontend Mock Data with Live Simulation Feeds

## Context

The React dashboard still hydrates several views from hard-coded fixtures (`src/frontend/src/mocks/**`) that were useful during early UI development but now diverge from the backend's Socket.IO payloads and schema contracts. Continuing to rely on these mocks blocks validation of the real-time telemetry experience and risks schema drift between the client store and the authoritative backend events documented in `/docs/system/socket_protocol.md`.

## Objectives

- Eliminate the remaining mock-based data sources from the frontend application.
- Ensure all UI state derives from either live Socket.IO events or testable, typed fixtures aligned with backend schemas.
- Preserve developer ergonomics with deterministic storybook/dev scenarios that do not reintroduce ad-hoc mock objects.
- Provide regression coverage (unit/integration) guarding against schema or contract drift.

## Guiding Principles

1. **Contract Fidelity** – Zustand slices, selectors, and UI components must model the payloads emitted by `buildSimulationSnapshot` and documented telemetry events. Any transformations should be centralized and typed.
2. **Deterministic Dev Experience** – Where offline or replay modes are required (e.g., storybook, vitest), they should replay captured Socket.IO transcripts or use shared TypeScript fixtures produced from backend snapshots.
3. **Incremental Migration** – Replace mocks feature-by-feature to keep the UI usable during transition and simplify QA.
4. Document every task at `/docs/tasks/mock-migration/`

## Workstreams

### 1. Inventory Current Mock Usage

- Enumerate all imports from `src/frontend/src/mocks/**` and any ad-hoc sample objects living inside components/tests.
- Capture the consuming components, hooks, or pages to map dependency graphs.
- Record where the mocks diverge from the latest socket payloads (fields missing, renamed, or shaped differently).

### 2. Align Store & Models with Backend Schemas

- Audit Zustand slices and TypeScript types to confirm they mirror `/docs/system/socket_protocol.md` and the backend source of truth (`buildSimulationSnapshot`).
- Introduce shared DTO types (preferably via `@/types` or generated from schema) to remove locally defined mock-oriented interfaces.
- Plan for derived selectors or normalization logic necessary once live feeds are connected.

### 3. Replace Mock Data Sources

- Swap mock-fed components to subscribe to the live store slices populated by Socket.IO handlers.
- For views that require initial data before the socket handshake completes, add loading placeholders or replay the most recent persisted snapshot.
- Verify charts/tables gracefully handle empty datasets until the first tick arrives.

### 4. Establish Replay/Test Fixtures

- Produce a minimal set of canonical snapshots captured from the backend (e.g., stored in `src/frontend/src/fixtures/**`), validated against schemas, for use in storybook/tests.
- Replace existing mocks in unit tests with these fixtures or factory utilities that hydrate data from schema-conformant JSON.
- Document how to refresh these fixtures when backend schemas evolve.

### 5. Hardening & Regression Coverage

- Add integration tests (vitest + msw/socket mocks) ensuring socket events populate the store and render key dashboard sections.
- Create CI checks comparing fixture shapes against the backend TypeScript types or JSON schemas.
- Update `CHANGELOG.md` and developer docs describing the new data flow.

## Prompts for Granular Task Generation

Use the following prompts to decompose each workstream into actionable tickets or AI-assisted subtasks:

1. **Mock Usage Audit Prompt**

   > "List every file in `src/frontend/src` that imports from `./mocks` or contains inline mock objects, describe the component or test that depends on it, and summarize the schema differences versus `/docs/system/socket_protocol.md`. Suggest the smallest replacement strategy for each consumer."

2. **Store Alignment Prompt**

   > "Analyze the Zustand slices under `src/frontend/src/state` and compare their TypeScript types with the backend `buildSimulationSnapshot` return type. Identify mismatches, missing fields, and required transformations to stay contract-aligned. Output a prioritized refactor checklist."

3. **Live Data Wiring Prompt**

   > "For each dashboard view currently initialized from mocks, outline the steps to hook it into live Socket.IO data, including loading states, error handling, and updates to selectors. Highlight any necessary backend contract confirmations."

4. **Replay Fixture Prompt**

   > "Design a reproducible workflow to capture real socket transcripts from the backend dev server, transform them into reusable fixtures under `src/frontend/src/fixtures`, and wire them into storybook/tests without reintroducing ad-hoc mock objects. Detail tooling, schema validation, and documentation updates."

5. **Regression Coverage Prompt**
   > "Propose automated tests and CI checks that ensure the frontend store and components remain synchronized with backend telemetry schemas after the mocks are removed. Include test tooling, sample assertions, and how to keep fixtures up to date."

## Acceptance Criteria

- No production code imports from `src/frontend/src/mocks/**`.
- Frontend compiles and renders with live Socket.IO data using current backend contracts.
- Storybook/tests rely on schema-validated fixtures derived from real telemetry snapshots.
- Documentation outlines the capture/update workflow for fixtures and data contracts.
- Automated checks fail if frontend types drift from backend schemas.

## Inventory (docs/tasks/20250923-clickdummy-migration_steps.md)

Source: [`docs/tasks/20250923-clickdummy-migration_steps.md`](../docs/tasks/20250923-clickdummy-migration_steps.md)

## Inventory

| Area                          | What’s in the clickdummy                                                                                                                                                                                                                                                                                                             | Recommended target placement in `src/frontend/src`                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Layout shell & navigation     | Simulation header with play/speed controls, global stats, view tabs; sidebar tree for structures/rooms/zones; breadcrumb trail; event ticker; inline renaming widgets and icon buttons.\:codex-file-citation:codex-file-citation:codex-file-citation:codex-file-citation:codex-file-citation:codex-file-citation:codex-file-citation | Fold navigation and status controls into the design-system primitives already living under `components/` (e.g., extend `DashboardHeader`, `Navigation`, `TimeDisplay`).\:codex-file-citation:codex-file-citationSidebar hierarchy and breadcrumbs belong with the world/zone navigation slice (likely `views/world` or a new `views/structures` module) so they can bind to Zustand selection state. Event log can hydrate from the existing game store and live beside `components/TimeDisplay`. |
| Structure/room overview views | Structures dashboard cards, structure detail with room summaries, room detail with zone cards, plus top-level dispatcher that swaps between dashboard/personnel/finance/zone views.\:codex-file-citation:codex-file-citation:codex-file-citation:codex-file-citation                                                                 | Reconcile with the real “overview/world” route implementations in `views/DashboardOverview.tsx` and `views/ZoneDetail.tsx`, augmenting them with structure/room drill-downs and reusing shared cards/panels for consistency.\:codex-file-citation:codex-file-citation Shared cards (e.g., zone tiles) should live under `components/cards` (new subfolder) to stay composable.                                                                                                                    |
| Zone simulation panels        | Collapsible environment controls, plant grid with batch actions, device list, wrapped by `ZoneDetailView`.\:codex-file-citation:codex-file-citation:codex-file-citation:codex-file-citation                                                                                                                                          | Merge functionality into the richer zone analytics page already defined in `views/ZoneDetail.tsx`, adding control widgets and batch actions while wiring to real telemetry and command dispatch (store selectors & intent handlers).\:codex-file-citation Control widgets should become reusable `components/forms` pieces for setpoints.                                                                                                                                                         |
| Personnel & job market        | Job market cards, staff roster with morale bars, hire/fire flows and modal integration.\:codex-file-citation:codex-file-citation                                                                                                                                                                                                     | Enrich the existing personnel dashboard by mapping applicant/employee presentation from the clickdummy onto the live store-backed `views/PersonnelView.tsx`, reusing shared metric/tile components and hooking hire/fire actions into `usePersonnelStore`.\:codex-file-citation Modals should mount through the app modal slice for consistency.                                                                                                                                                  |
| Finance dashboard             | Revenue/expense summary cards, collapsible lists, time-range toggles within `FinanceView`.\:codex-file-citation                                                                                                                                                                                                                      | Blend with `views/FinancesView.tsx`, lifting useful UX (time-range switcher, breakdown lists) while keeping charting and data derived from `financeHistory` in the zone store.\:codex-file-citation Shared breakdown widgets belong in `components/panels` for reuse.                                                                                                                                                                                                                             |
| Modal workflows               | CRUD modals for rooms/zones/devices, plant detail, rent structure, duplicate flows, game menu, deletion confirmation.\:codex-file-citation:codex-file-citation:codex-file-citation:codex-file-citation:codex-file-citation:codex-file-citation                                                                                       | Implement as typed modal descriptors in the existing modal slice (`store`), rendering via the shared `Modal` component and colocating modal bodies with their owning views (e.g., `views/ZoneDetail/modals`). Maintain deterministic payloads for seeded fixtures.                                                                                                                                                                                                                                |
| Shared UI primitives          | Buttons, form controls, stat cards, icon wrappers used across views.\:codex-file-citation:codex-file-citation:codex-file-citation:codex-file-citation                                                                                                                                                                                | Map to the design tokens/components already in `components/` (Card, Panel, ToggleSwitch, Tabs) to avoid duplicating primitives; any missing pieces (e.g., inline edit) should live in `components/inputs`. Align icon usage with the project’s icon strategy instead of ad-hoc Material glyphs.\:codex-file-citation:codex-file-citation                                                                                                                                                          |
| Data fixtures & RNG helpers   | Deterministic mock data factory (`initialMockData`, `generateCandidates`, `createPlant`), constants for job roles and device costs, seeded RNG and incremental IDs.\:codex-file-citation:codex-file-citation:codex-file-citation                                                                                                     | Relocate into a dedicated `fixtures/` (or `mocks/`) module under the frontend package to power offline previews/tests, replacing `deterministicUuid` with the project’s seeded ID utilities (or a new deterministic helper shared via `store/utils`). Fixtures should emit objects that satisfy `SimulationSnapshot`/store hydration types.                                                                                                                                                       |
| Utility helpers               | Structure/room/zone lookup helpers, aggregate yield/progress calculators.\:codex-file-citation                                                                                                                                                                                                                                       | Recast as selector helpers within the Zustand stores (`store/selectors.ts`) or colocated utility modules so they operate on normalized snapshot data and can be unit tested with real types.                                                                                                                                                                                                                                                                                                      |

## Data shape gaps vs PRD

1. GameData.globalStats exposes stringly-typed time and water metrics, whereas the dashboard contracts expect SimulationSnapshot.clock with numeric ticks and SI units (time status already modeled in stores).
2. Structure/room definitions omit required PRD fields (status, rent per tick, volumes, purpose metadata) found in StructureSnapshot/RoomSnapshot, so the migration must enrich fixtures with geometry and lifecycle attributes.
3. Zone records use local controls and KPI arrays with string values (e.g., humidity 52%) while the real schema expects normalized environment floats (0–1 relative humidity) and rolling metrics. Conversions and missing fields like volume, lighting, resources, health must be filled in or derived.
4. Plant objects rely on name/progress/harvestable while the PRD mandates strain IDs, stages, biomass, and linkage to structure/room IDs (PlantSnapshot).
5. Devices only expose name/type; backend contracts require blueprintId, kind, status, maintenance metrics, and settings payloads.
6. Personnel and candidate records lack morale/energy, salary-per-tick units, and optional seeds/gender present in PersonnelSnapshot types; salary semantics should switch from annual numbers to per-tick values.
7. Finance mock data summarizes “7d” figures and ad-hoc breakdowns rather than the tick-based FinanceSummarySnapshot and FinanceTickEntry history consumed by the live finance dashboard.

## Non-determinism & global state to replace

1. SeededRandom is instantiated once at module scope; repeated calls mutate internal state and the global idCounter for deterministicUuid, meaning fixture generation order changes outputs. Swap for explicit seed management tied to store hydration or shared deterministic helpers.

2. App.tsx keeps the entire simulation in React component state and mutates copies with JSON.parse(JSON.stringify(...)), which breaks determinism and bypasses the established Zustand slices (useGameStore, useZoneStore, etc.). Migration should funnel all state changes through the existing stores and intents to stay in sync with PRD expectations.

## Migration backlog

1. Define fixture-to-snapshot translator – Map initialMockData into SimulationSnapshot/store slices so clickdummy content can hydrate the Zustand stores without breaking type guarantees; normalize units and add missing PRD fields in this step.

2. Introduce deterministic helper module – Replace deterministicUuid/module-global RNG with a seeded helper integrated into store/utils, ensuring repeatable fixture generation and aligning with backend seeds.

3. Refactor layout shell – Extend App.tsx to render the real header/navigation/sidebar using existing design-system components, wiring controls to useGameStore for play/speed state and navigation slices for selections.

4. Port structure & room views – Implement structure/room detail pages leveraging DashboardOverview data, adding drill-down panels and breadcrumb logic derived from clickdummy while using normalized store selectors.

5. Enhance zone detail – Merge environment controls, plant grids, and device management into ZoneDetail, binding sliders/toggles to setpoint dispatch and using real telemetry values.

6. Integrate modal workflows – Register modal descriptors for CRUD/treatment flows in the modal slice and reimplement modal bodies with shared Modal while ensuring actions dispatch facade intents or update fixtures deterministically.

7. Rebuild personnel dashboard – Adapt hiring/roster UI to the live usePersonnelStore, translating morale/energy displays and hooking up modal-driven hires/fires using deterministic fixtures when backend data is absent.

8. Align finance UX – Incorporate clickdummy time-range controls and breakdown lists into FinancesView, ensuring metrics and charts consume normalized finance history from the store.

9. Finalize shared primitives & tests – Replace bespoke form/button/icon components with project-standard equivalents, add unit tests for new helpers/selectors, and verify seeded fixture snapshots remain stable.

## Open questions / risks

1. ✅ Do we continue using Material Icons from the clickdummy or switch to the project’s preferred icon set to stay consistent with the design system?
   - **Resolution:** Adopt the app’s component-driven icon approach (React icon components behind a shared wrapper) so we can replace the Material glyph spans during migration without carrying the Google font dependency.

2. ✅ How should setpoint controls interact with the simulation facade—are sendConfigUpdate/sendFacadeIntent handlers already available for temperature, humidity, PPFD, etc., or do we need to extend store slices?
   - **Resolution:** Use the existing `useZoneStore().sendSetpoint` helper, which is wired through the simulation bridge to emit `config.update` messages; extend the slice only when the backend adds new metrics.

3. ✅ What navigation model should drive structure/room/zone selection—expand the existing navigation slice or introduce a dedicated world-browser slice? Clarifying avoids duplicating state between sidebar and top-level navigation.
   - **Resolution:** Reuse and extend the current navigation slice, which already tracks structure/room/zone IDs, so both sidebar and top-level navigation stay in sync without a second store.

4. ✅ Should personnel and finance fixtures represent per-tick values (per PRD) or retain aggregated “7d” placeholders until backend feeds real snapshots? Aligning units is critical for determinism and SI compliance.
   - **Resolution:** Normalize fixtures to the per-tick units defined in the simulation snapshots to preserve determinism and satisfy the SI-based contracts used throughout the UI and backend.

5. ✅ Are duplicate/clone flows (rooms/zones) still required in the MVP, and if so, which backend intents will back them? Current clickdummy logic assumes immediate balance adjustments and device cost tables that may not exist yet.
   - **Resolution:** Keep the duplicate flows and route them through the existing `world.duplicateRoom`/`world.duplicateZone` facade intents, which already recreate devices and post finance events for cost accounting.

---

## Lösungsweg

### Daten- und Zustandsnormalisierung

1. Fixture-Übersetzer aufsetzen: Implementiere ein Modul, das initialMockData und verwandte Datenquellen in SimulationSnapshot-kompatible Strukturen überführt, dabei fehlende PRD-Felder ergänzt (z. B. Volumen, Status) und Einheiten normalisiert.
   - ✅ `translateClickDummyGameData` mappt die Klickdummy-Fixtures jetzt in `src/frontend/src/fixtures/translator.ts` auf vollständige `SimulationSnapshot`-Slices inklusive volumetrischer Geometrie, Ressourcen, Gerätegruppen sowie normalisierten Temperatur-/RH-/VPD-Werten. Tests (`src/frontend/src/fixtures/translator.test.ts`) sichern die SI-Konvertierungen und Gehalts-/Kosten-Normalisierung ab.

2. Zone-Daten konvertieren: Rechne alle zonalen Kennzahlen (RH, KPIs, Ressourcen) in die erwarteten numerischen SI-Einheiten um und fülle fehlende Telemetrie-/Gesundheitsfelder auf, bevor sie die Stores hydratisieren.
   - ✅ Die Übersetzungsschicht normalisiert jetzt sämtliche Zonenkennzahlen (Temperatur, RH, CO₂,
     PPFD, DLI, Ressourcenstände, Verbräuche) auf SI-Einheiten und leitet daraus
     versorgungs- sowie Gesundheitsrestriktionen ab, bevor die Daten in die Stores gelangen
     (`src/frontend/src/fixtures/translator.ts`; Tests sichern die Konvertierung).
3. ✅ Pflanzen-, Geräte-, Personal- und Finanzobjekte anreichern: Fixtures liefern jetzt konsistente strain-IDs/Stadien, Geräte-Blueprint-Metadaten sowie per-Tick-Kosten mitsamt `financeHistory`. Die Umsetzung lebt in `src/frontend/src/fixtures/translator.ts` und den zugehörigen Tests.

4. ✅ Deterministische Hilfsfunktionen zentralisieren: `store/utils/deterministic.ts` stellt jetzt einen seeded Helper bereit (`createDeterministicManager`, `createDeterministicSequence`, `nextDeterministicId`), der von Fixtures (`data/mockData.ts`) und App-Workflows genutzt wird. Globale `SeededRandom`-Instanzen und `deterministicUuid` wurden entfernt, sodass IDs und Zufallsdaten aus der gemeinsamen Utility stammen.

5. ✅ State-Management auf Stores umstellen: Refaktoriere App.tsx, sodass sämtliche Simulationzustände über useGameStore, useZoneStore etc. laufen und lokale JSON-Mutationen entfallen.
   - Die neue App-Shell (`src/frontend/src/App.tsx`) hydratisiert die Stores über `OFFLINE_BOOTSTRAP`
     (`src/frontend/src/fixtures/offlineBootstrap.ts`), zeigt die Telemetrie ausschließlich über
     Store-Selektoren an und verdrahtet Simulationsteuerung, Event-Log sowie Navigationsstatus mit
     `useGameStore`, `useZoneStore` und `useAppStore`.

### Layout- und Navigationsmigration

6. ✅ Layout-Shell refaktorieren: Kombiniere die Klickdummy-Header-/Sidebar-Elemente mit den vorhandenen Komponenten (DashboardHeader, Navigation, TimeDisplay) und verdrahte sie mit den Spiel- und Navigationsslices.
   - `src/frontend/src/App.tsx` nutzt jetzt eine zweispaltige Shell mit persistenter Kopfzeile und Facility-Sidebar.
   - Header-Status, Zeit-Widget, Event-Ticker und View-Tabs werden über `DashboardHeader`, `TimeDisplay` und `Navigation` gerendert und lesen/steuern den Zustand aus `useGameStore`/`useAppStore`.
   - Die Sidebar spiegelt die Struktur-/Raum-/Zonen-Hierarchie aus dem Navigation-Slice wider und erlaubt direkte Selektion per Store-Aktionen (`selectStructure`, `selectRoom`, `selectZone`).

7. ✅ Breadcrumbs und Event-Ticker anbinden: Implementiere Breadcrumbs und Event-Log auf Basis der bestehenden Navigations- und Game-Store-Selektoren, um Auswahlzustand und Telemetrie zu spiegeln.
   - Breadcrumb-Leiste und „Up one level“-Aktion lesen den Zustand (`selectedStructureId`, `selectedRoomId`, `selectedZoneId`) aus `useAppStore` und rufen `navigateUp`/`resetSelection` auf.
   - Der Kopfzeilen-Ticker zeigt die jüngsten Events (`selectRecentEvents`) kompakt an, während die rechte Spalte weiterhin das detaillierte Log liefert.

8. ✅ Navigation-Slice erweitern: Ergänze den bestehenden Slice um Struktur-/Raum-Hierarchie und wende ihn sowohl für Sidebar als auch Kopfzeilen-Navigation an, um Doppelstaat zu vermeiden.
   - Die Navigation verwaltet jetzt `structureHierarchy`, `facilityCounts` und gemeinsame View-Definitionen.
   - Store-Subscriber gleichen Zone- und Personnel-Store-Änderungen automatisch ab und bereinigen ungültige Selektions-IDs.
   - Sidebar-Baum und Kopfzeilen-Tabs konsumieren dieselben Items, wodurch lokale Ableitungen in `App.tsx` entfallen.

### View-spezifische Portierungen

9. ✅ Struktur- und Raumansichten integrieren: Portiere Karten und Detailpanels in DashboardOverview/ZoneDetail, erstelle gemeinsame Kartenkomponenten unter components/cards und implementiere Drilldown-Logik plus Breadcrumbs.
   - `src/frontend/src/components/cards` bündelt jetzt `StructureSummaryCard`, `RoomSummaryCard` und `ZoneSummaryCard`, die Drilldown-taugliche Kennzahlen, Interaktionen und Hervorhebungen kapseln.
   - `DashboardOverview` rendert strukturierte Bereiche für Strukturen, Räume und Zonen, nutzt die neuen Kartenkomponenten und gruppiert die Aggregationen über `computeZoneAggregateMetrics`, sodass ein Klick direkt in die Weltansicht springt.
   - `ZoneDetail` wurde in eine hierarchische Detailansicht für Strukturen, Räume und Zonen erweitert, inklusive verdichteter Kennzahlenleisten, Raum-/Zonenlisten mit Drilldown und erweiterter Status-Panels für Geometrie, Ressourcen und Gesundheitsdaten.

10. ✅ Zonenansicht erweitern: Ergänze ZoneDetail um Steuer-Widgets, Pflanzenaktionen und Gerätelisten; nutze useZoneStore().sendSetpoint für Setpoint-Dispatch und extrahiere Form-Controls in components/forms.

- `ZoneDetail` stellt jetzt ein Panel „Environment controls“ bereit, das Temperatur-, Feuchte-, VPD-, CO₂- und PPFD-Setpoints über die neuen `components/forms`-Slider visualisiert und per `useZoneStore().sendSetpoint` an die Fassade sendet.
- Ein neues Pflanzenaktions-Panel bündelt Bewässerungs- und Nährstoffbefehle, Harvest-Batch-Kommandos sowie das Umschalten aktiver Pflanzpläne über die bestehenden `applyWater`/`applyNutrients`/`harvestPlantings`/`togglePlantingPlan`-Intents.
- Gerätegruppen werden als Automation-Panel mit Toggles dargestellt, während die Geräteinventur detaillierte Wartungs-, Laufzeit- und Settings-Metadaten pro Gerät ausgibt.

11. ✅ Personalbereich neu aufbauen: Spiegle Bewerber- und Mitarbeiterdarstellungen im PersonnelView, verdrahte Hire/Fire-Intents und verlagere Modale in den globalen Modal-Slice.
    - Das Frontend rendert nun symmetrische Karten für Mitarbeitende und Bewerber:innen, inklusive Skill-/Trait-Details sowie Morale-/Energy-Balken.
    - Hire-/Fire-Aktionen öffnen globale Modale aus dem Modal-Slice; Bestätigungen senden die Facade-Intents `workforce.hire` und `workforce.fire`.
    - Der neue `ModalHost` pausiert die Simulation bei modalem Fokus und nutzt den globalen Slice für alle HR-Workflows.

12. ✅ Finanzdashboard abstimmen: Übertrage Zeitbereichs-Umschalter und Aufschlüsselungslisten in FinancesView und stelle sicher, dass sie tickbasierte financeHistory-Daten konsumieren.
    - `src/frontend/src/views/FinancesView.tsx` ergänzt jetzt einen Zeitbereichs-Schalter, der die Diagramme und Kennzahlen direkt über `financeHistory`-Ticks filtert, und fasst die gewählte Spanne in einer kompakten Kennzahlenzeile zusammen.
    - Neue Breakdown-Listen (`components/panels/BreakdownList`) aggregieren OpEx-, Versorgungs- und Wartungskosten auf Basis der Tickdaten und nutzen Geräte-Metadaten für Wartungsaufschlüsselungen.

### Modale und Workflows

13. ✅ Modal-Descriptoren registrieren: Der Modal-Slice exportiert jetzt eine strikt typisierte `ModalDescriptor`-Union mit eigenen Payloads für Anlegen-, Umbenennen-, Duplizier-, Detail- und Löschflows. `ModalHost` rendert die neuen Inhaltskomponenten (`views/world/modals` sowie `views/zone/modals`) für Räume/Zonen/Strukturen und Pflanzen-Details und pausiert weiterhin deterministisch bei aktiven Dialogen.

14. ✅ Fassade-Intents anbinden: Die Duplizieren-Dialoge leiten ihre Bestätigungen jetzt an die Store-Helfer weiter, die getrimmte Namen und Options-Payloads an `facade.world.duplicateRoom` bzw. `facade.world.duplicateZone` senden. Geräte- und Methodenklone entstehen damit ausschließlich im Backend, wodurch CapEx-/Inventarereignisse deterministisch über die Facade-Finanzereignisse in den Stores landen (`src/frontend/src/components/ModalHost.tsx`, `src/frontend/src/store/zoneStore.ts`, `src/frontend/src/store/types.ts`).

### Gemeinsame Komponenten & Utilities

15. ✅ UI-Primitiven angleichen: Schaltflächen, Formularfelder und Icon-Hüllen nutzen jetzt die neuen Design-System-Komponenten unter `components/inputs` (`Button`, `IconButton`, `TextInput`, `Select`, `RangeInput`, `InlineEdit`). Bestehende Klickdummy-Markup-Styles wurden entfernt.

16. ✅ Fixtures/Mocks modularisieren: Verschiebe deterministische Mock-Fabriken und Rollen-/Kostenkonstanten in src/frontend/fixtures und stelle sicher, dass sie die Store-Hydration bedienen.
    - `src/frontend/src/fixtures/deterministic.ts` kapselt jetzt den deterministischen Sequenzgenerator (`createDeterministicManager`, `createDeterministicSequence`) inklusive Shared-Sequenzen für IDs.
    - `src/frontend/src/fixtures/clickDummyFactories.ts` bündelt Mock-Fabriken (`createClickDummyFixture`, `generateCandidates`, `createPlant`) und zieht Rollen-/Kostenkonstanten (`constants.ts`) ins Frontend, sodass Offline-Bootstrap und Tests identische Daten hydratisieren.
    - `offlineBootstrap.ts` erzeugt den Fixture-Snapshot über `createClickDummyFixture()` und übergibt ihn an den Translator, womit die Stores deterministisch aus den neuen Fabriken gespeist werden.

17. ✅ Selektor-Helper neu platzieren: Portiere Struktur-/Raum-/Zonen-Helper als testbare Selektoren in store/selectors.ts oder modulnahe Utilities.
    - Struktur-, Raum- und Zonen-Lookups leben jetzt als wiederverwendbare Selektoren samt Gruppierungshelfern in `src/frontend/src/store/selectors.ts`; `selectors.test.ts` deckt die Abfragen für Eltern-/Kind-Beziehungen ab.
    - `ZoneDetail` und `ModalHost` nutzen die neuen Selektoren für Facility-Breadcrumbs, Aggregationen und Modale, wodurch duplizierte Filter-Logik entfällt und die Helper direkt testbar bleiben (`src/frontend/src/views/ZoneDetail.tsx`, `src/frontend/src/components/ModalHost.tsx`).

### Qualitätssicherung

19. ✅ Unit- und Snapshot-Tests ergänzen: Schreibe Tests für neue Selektoren, deterministische Fixtures und UI-Komponenten, um die Stabilität der migrierten Oberflächen sicherzustellen.
    - `src/frontend/src/store/selectors.test.ts` deckt jetzt die Zeitstatus-, Finanz- und Produktions-Selektoren inklusive Fallback-Logik und Event-Historie ab.
    - Neue fixturespezifische Tests (`src/frontend/src/fixtures/deterministic.test.ts`) prüfen Sequenz- und Manager-Funktionalität, Clones, Scope-Reset sowie die globalen Helper (`getSharedSequence`, `nextSharedId`).
    - UI-Komponenten besitzen Snapshot- und Verhaltenstests: `StructureSummaryCard.test.tsx` verifiziert Metrik-Rendering und Selection-Callbacks, `Navigation.test.tsx` prüft aktive Zustände, Badge-Anzeige, Disabled-Verhalten und erzeugt ein vertikales Layout-Snapshot.

20. ✅ Determinismus verifizieren: Wiederholte Hydrationen mit identischem Seed liefern jetzt bytegleiche Ergebnisse.
    - `createOfflineBootstrapPayload` kapselt die Fixture-Hydration und erzeugt `OFFLINE_BOOTSTRAP`-kompatible Updates.
    - `offlineBootstrap.test.ts` hydratisiert den Snapshot zweimal mit demselben Seed und vergleicht Snapshot, Events und Finance-Historie, um RNG-Regressionsrisiken früh zu erkennen.

## Difficulty Presets Config Sync Analysis (docs/tasks/difficulty-presets-analysis.md)

Source: [`docs/tasks/difficulty-presets-analysis.md`](../docs/tasks/difficulty-presets-analysis.md)

# Difficulty Presets Config Sync Analysis

## Overview

The UI queries the backend via `config.getDifficultyConfig` and receives the presets defined in `data/configs/difficulty.json`. The bridge logic and socket gateway handshake are working as expected, so the presets do reach the client.

## Findings

While debugging the "difficulty presets stay in loading" report we noticed a different systemic issue: the simulation keeps several hard-coded difficulty presets that drift away from the JSON source of truth.

- The JSON file currently ships with `easy.initialCapital = 100_000_000` and `hard.initialCapital = 500_000`.
- The initial world builder (`createInitialState`) still uses a compiled-in table with `easy.initialCapital = 2_000_000` and `hard.initialCapital = 1_000_000`.
- The `WorldService.newGame` fallback table carries yet another copy (`easy = 100_000_000`, `hard = 500_000`).

Any code path that does **not** pass explicit modifiers (e.g. quick-start setups, scripts, or future CLI utilities) will ignore the JSON definition and rely on whichever in-memory table they hit. This leads to divergent cash values and rent multipliers between the save file, backend defaults, and what the UI displays.

## Impact

- Designers editing `data/configs/difficulty.json` cannot rely on their changes applying everywhere: quick-start worlds, tests, or integrations that omit custom modifiers will continue to use stale numbers.
- The compiled copies are already out of sync (2M vs 100M for Easy). Players starting a new session from the Start screen get a different balance depending on whether they go through the quick-start button (uses `createInitialState`) or the New Game workflow (which sends explicit modifiers from the JSON).
- Keeping multiple tables raises the risk of further drift whenever we tune presets or add new difficulty levels.

## Recommendation

Make the JSON config the single source of truth:

1. Load the difficulty config once during bootstrap and inject it into both the initial state factory and the world service.
2. Remove the duplicated `DIFFICULTY_ECONOMICS` tables and derive defaults from the loaded config instead.
3. Extend the tests to cover the easy/normal/hard presets so that future edits to `difficulty.json` must be reflected in the engine.

This change will stabilise the presets across the server lifecycle and align the UI with in-game economics.

## Task: Unify Difficulty Presets with JSON Source (docs/tasks/20250927-difficulty-presets-sync.md)

Source: [`docs/tasks/20250927-difficulty-presets-sync.md`](../docs/tasks/20250927-difficulty-presets-sync.md)

# Task: Unify Difficulty Presets with JSON Source

## Problem Statement

The engine hard-codes difficulty economics in multiple places (`stateFactory.ts`, `worldService.ts`) instead of relying on the loaded `data/configs/difficulty.json`. The values have already diverged (`easy.initialCapital` is 2M in the factory vs 100M in the config), so different entry points produce inconsistent balances.

## Goals

- Treat `data/configs/difficulty.json` as the single source of truth for all preset modifiers.
- Ensure quick-start sessions, `newGame` calls, and any other path without explicit modifiers use the JSON data.
- Prevent future regressions with automated coverage.

## Proposed Steps

1. **Inject Config**
   - Load the difficulty config during bootstrap (already done) and pass it into `createInitialState` and `WorldService` instead of letting those modules rely on local constants.
2. **Refactor State Factory**
   - Replace the `DIFFICULTY_ECONOMICS` map in `stateFactory.ts` with values derived from the injected config.
   - Update type signatures as needed to accept the config payload.
3. **Refactor World Service**
   - Remove the duplicated table inside `WorldService.newGame` and reuse the same config-driven data.
   - Keep support for custom modifiers overriding the preset.
4. **Add Tests**
   - Extend unit/integration tests to assert that the easy/normal/hard presets in the config dictate initial cash and rent multipliers for both the factory and `newGame` fallback.
5. **Docs & Changelog**
   - Document the change in `CHANGELOG.md` and adjust any developer docs that mention the old constants.

## Acceptance Criteria

- Changing a value in `data/configs/difficulty.json` updates the behaviour of quick-start sessions and `newGame` without touching TypeScript sources.
- Tests fail if the config and runtime values fall out of sync.

## • Critical: config.update setpoint rejects UUID zoneIds (backend socketGateway.t (docs/tasks/20250924-todo-findings.md)

Source: [`docs/tasks/20250924-todo-findings.md`](../docs/tasks/20250924-todo-findings.md)

• Critical: config.update setpoint rejects UUID zoneIds (backend socketGateway.ts) — zoneIdSchema enforces /^zone[-\_][a-z0-9]+$/i; this breaks UUID v4 IDs per spec; fix by accepting UUID or any non-empty string (align with facade.findZone), and update docs. Files: src/backend/src/server/socketGateway.ts, docs/system/ui-mplementation-spec.md, docs/system/socket_protocol.md
Status: ✅ Completed 2025-09-24 — Relaxed the socket gateway zoneId validation to trimmed strings (UUID-friendly) and aligned the socket/UI docs.
• Critical: Unsupported frontend intent world.updateStructure (frontend zoneStore) — backend facade has renameStructure (no updateStructure handler); calls will return ERR_VALIDATION; fix store to use world.renameStructure with { structureId, name }. Files: src/frontend/src/store/zoneStore.ts, src/backend/src/facade/index.ts, docs/system/facade.md
Status: ✅ Completed 2025-09-24 — Zone store now issues `world.renameStructure` with the expected payload and the facade docs call out the object signature.
• High: Device-kind mismatch for humidity control (facade vs environment) — facade HUMIDITY_DEVICE_KINDS = ['HumidityControlUnit'] but environment service also recognizes 'Dehumidifier'; setpoint routing will wrongly return ERR_INVALID_STATE when only dehumidifiers are present; align sets and docs. Files: src/backend/src/facade/index.ts, src/backend/src/engine/environment/zoneEnvironment.ts, ADR 0004
Status: ✅ Completed 2025-09-26 — Facade setpoint routing now recognises Dehumidifier devices, integration coverage protects the regression, and socket docs call out the supported humidity device kinds.
• High: Dead alias '@/engine' (frontend Vite) — maps to ../engine which does not exist; remove or point to shared runtime/backend as intended to avoid broken imports and path confusion. Files: src/frontend/vite.config.ts, tsconfig.base.json (verify mirror), docs
Status: ✅ Completed 2025-09-24 — Removed the unused '@/engine' alias from the frontend Vite and TypeScript configs and updated documentation to reflect the cleanup.
• Medium: Modal pause/resume policy not implemented (frontend) — spec requires auto-pause on open and restore prior state on close, but modalSlice only stores flags; implement wiring (read time status, pause on open if running, resume on close if wasRunningBeforeModal). Files: docs/system/ui-mplementation-spec.md §4, src/frontend/src/store/slices/modalSlice.ts, useSimulationBridge + stores
Status: ✅ Completed 2025-09-24 — Modal store now pauses via `openModal` (autoPause by default) and issues a resume on close when the sim was running beforehand, with docs updated.
• Medium: Frontend maintenance type drift — backend snapshot includes maintenance.runtimeHoursAtLastService but frontend DeviceMaintenanceSnapshot omits it; add optional field to keep parity; adjust UI use later if needed. Files:
src/backend/src/lib/uiSnapshot.ts, src/frontend/src/types/simulation.ts
Status: ✅ Completed 2025-09-24 — Exported the backend maintenance snapshot alias and added the optional runtimeHoursAtLastService field to the frontend types to keep parity.
• Medium: Superfluous field in simulationControl payload — useSimulationBridge sends { type: 'simulationControl', ... } though server validates on 'action'; benign but noisy; remove the extra field for clarity (optional). Files: src/frontend/src/hooks/useSimulationBridge.ts, docs/system/socket_protocol.md
Status: ✅ Completed 2025-09-24 — useSimulationBridge now emits bare simulationControl commands and the socket protocol doc clarifies that clients should omit the redundant wrapper.
• Medium: Naming clarity for normalized recurring costs — costAccounting treats structure.rentPerTick as per-hour rate multiplied by tickLengthHours (now normalized), but the name is misleading; either rename to rentPerHour or document the convention consistently. Files: src/backend/src/engine/economy/costAccounting.ts, docs/system/simulation-engine.md §Economics, price/data docs
Status: ✅ Completed 2025-09-24 — Documented the hourly-rate convention across engine/state docs, clarified the socket snapshot note, and added inline helpers so `rentPerTick` reads as a legacy alias for rent-per-hour.
• Medium: Device schema strictness vs usage — deviceSchema.settings is .passthrough; engine expects fields like targetTemperature/targetHumidity/targetCO2; consider tightening/annotating schemas (docs+zod) to catch typos (e.g., “targetCo2” vs “targetCO2”). Files: src/backend/src/data/schemas/deviceSchema.ts, docs/addendum/data-validation.md
Status: ✅ Completed 2025-09-24 — Added a canonical-case guard for device setpoint keys in the schema and documented the validation behavior.
• Low: Optional telemetry not surfaced yet in UI — dashboard reads zone.lighting/plantingPlan but backend snapshot lacks these aggregates; either add derived fields (backend) or guard UI (already guarded) and open an enhancement task. Files: src/backend/src/lib/uiSnapshot.ts, src/frontend/src/views/DashboardOverview.tsx, docs/system/ui-mplementation-spec.md
Status: ✅ Completed 2025-09-25 — buildSimulationSnapshot now emits `zones[].lighting` coverage + plantingPlan snapshots, the dashboard metrics expose active plan capacity, and the UI spec documents the new payload contract.
• Low: Path coupling in runtime imports — runtime/eventBus imports backend src modules directly; acceptable in monorepo but brittle for packaging; consider extracting a small shared package for EventBus contracts. Files: src/runtime/eventBus.ts, src/backend/src/lib/eventBus.ts, ADR 0002/0003
Status: ✅ Completed 2025-09-25 — Extracted the event bus contract to `@runtime/eventBusCore`, updated runtime imports to use the shared module, re-exported it from the backend package, and documented the shared contract in ADR 0002/0003.

## 2025-09-26 — Personnel directory provisioning follow-ups (docs/tasks/20250926-personnel-provisioning.md)

Source: [`docs/tasks/20250926-personnel-provisioning.md`](../docs/tasks/20250926-personnel-provisioning.md)

# 2025-09-26 — Personnel directory provisioning follow-ups

- Task WB-JM-204 (Priority: High) — Implementation: Expose a CLI/ops command to
  re-run `provisionPersonnelDirectory` without restarting the backend so live
  environments can refresh the offline directory after wiping data or rotating
  seeds.
  - Files/Modules: `src/backend/src/server/startServer.ts`,
    `src/backend/src/state/initialization/personnelProvisioner.ts`,
    `src/backend/src/facade/index.ts`.
  - Acceptance: Operators can trigger provisioning via façade or CLI, logs show
    the same counters as startup provisioning, and existing files are merged
    deterministically.

- Task WB-JM-205 (Priority: High) — Testing: Add startup integration tests that
  cover provisioning failure paths (HTTP disabled, missing fetch, empty RandomUser
  payload) so CI catches regressions before release.
  - Files/Modules:
    `src/backend/src/state/initialization/__tests__/personnelProvisioner.test.ts`,
    `src/backend/src/server/__tests__/startServer.test.ts` (new).
  - Acceptance: Tests assert the server aborts with actionable errors when the
    directory is incomplete and provisioning cannot reach RandomUser.

- Task WB-JM-206 (Priority: Medium) — Documentation: Extend the deployment
  runbook with packaging guidance for the new `/data/personnel` files and add a
  troubleshooting checklist for provisioning failures.
  - Files/Modules: `docs/system/audit.md`, `docs/system/logging.md`,
    `docs/operations/deployment.md` (new).
  - Acceptance: Ops docs include steps for bundling provisioned data, verifying
    startup logs, and rerunning the command from WB-JM-204.

## Task Plan — Irrigation & Nutrient Overhaul (2025-09-28) (docs/tasks/20250928-irrgitation-nutrient-overhaul.md)

Source: [`docs/tasks/20250928-irrgitation-nutrient-overhaul.md`](../docs/tasks/20250928-irrgitation-nutrient-overhaul.md)

# Task Plan — Irrigation & Nutrient Overhaul (2025-09-28)

## Überblick & Zielsetzung

- Ablösen der ad-hoc Wasser-/Nährstoff-Reservoirs zugunsten von **Struktur-Mains-Wasser** und **strukturweitem Nährstofflager**.
- Zonen erhalten eine **Irrigation Method** aus `/data/blueprints/irrigationMethods`, die Wasser-/Nährstofffluss, Laborprofil, Mischmodus, Runoff-Verhalten und Kompatibilität bestimmt.
- Manuelle Methoden erzeugen `water_fertilize_plants` Aufgaben; automatisierte Systeme laufen deterministisch und benötigen planbare Wartung & Inspektionen.
- Kosten verbuchen sich über **Wasserzähler (m³)** und **Nährstoffinventar (kg)**.

> **Current State**
>
> - Die Phase `irrigationAndNutrients` im [`SimulationLoop`](../../src/backend/src/sim/loop.ts) fällt derzeit auf einen No-Op zurück, sobald keine expliziten Handler übergeben werden. Damit laufen Phase 1 und Phase 3 im Tick zwar formal durch, führen aber keine Ressourcenmutationen aus.
> - Gleichzeitig entzieht der [`TranspirationFeedbackService`](../../src/backend/src/engine/environment/transpirationFeedback.ts) den Zonen weiterhin Wasser- und Nährstoffvolumen aus dem bestehenden Reservoirmodell (`waterLiters`, `nutrientSolutionLiters`, `reservoirLevel`) und verbucht Verbräuche im Accounting.
> - Die aktiven Felder in [`ZoneResourceState`](../../src/backend/src/state/models.ts) spiegeln dieses Reservoirmodell wider und müssen bei der Migration gezielt ersetzt bzw. migriert werden, damit sich keine alten Restwerte in die neue Infrastruktur schleppen.

## Phasenplan

### Phase 0 – Vorbereitung & Alignment

1. Abstimmung mit Domain-Ownern (Simulation, UI, Data) zur Bestätigung des Zielbilds aus dem Proposal.
2. Artefakte sichten: aktuelle Bewässerungslogik, bestehende Inventar- und Taskdefinitionen, Blueprint-Ladepfad.
3. Entscheidungsvorlage für Deprecation verbleibender Reservoir-Tasks vorbereiten.

### Phase 1 – Datenmodell & Schema-Erweiterungen

1. **Strukturzustand erweitern**: `utilities.waterMeter_m3`, `utilities.lastTickWaterDraw_L`, `inventory.nutrients[]` mit `id`, `name`, `form`, `npk`, `amount_kg` integrieren.
2. **Zonenmodell ergänzen**: `irrigation.methodId`, optionale `targetEC_mS_cm`, `runoffFraction`.
3. **[Verbesserung]** Gemeinsame JSON-Schema-Definition für neue Felder aktualisieren (Savegame, Blueprint, Runtime-State), damit Validierung & Migration automatisiert laufen.
4. Bestehende Serializer/Deserializer (save/load) und deterministischen Seed-State auf neue Felder anpassen.

#### Feldabgleich & Migration (Phase 1)

| Legacy-Feld                                 | Quelle                            | Phase-1-Zielzustand                                                                                 | Betroffene Dateien                                                                                                                  | Migration / Entfernung                                                                                                              |
| ------------------------------------------- | --------------------------------- | --------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| `ZoneResourceState.waterLiters`             | `src/backend/src/state/models.ts` | Strukturweite Verbrauchswerte über `StructureState.utilities.waterMeter_m3` + `lastTickWaterDraw_L` | `src/backend/src/state/models.ts`, `src/backend/src/persistence/saveGame.ts`, `src/backend/src/lib/uiSnapshot.ts`, Accounting-Hooks | Per-Tick-Werte aus Zonen entfernen, Migration setzt Anfangswerte aus Summen alter Reservoirs; Accounting liest künftig Meterstände. |
| `ZoneResourceState.nutrientSolutionLiters`  | `src/backend/src/state/models.ts` | `StructureState.inventory.nutrients[].amount_kg` mit Produkt-Metadaten                              | `src/backend/src/state/models.ts`, `src/backend/src/persistence/schemas.ts`, `src/backend/src/lib/uiSnapshot.ts`, Accounting-Hooks  | Reservoirvolumen löschen, Migration wandelt vorhandene Liter in kg-Bestände gemäß Altdichte-Konstanten.                             |
| `ZoneResourceState.nutrientStrength`        | `src/backend/src/state/models.ts` | `ZoneState.irrigation.targetEC_mS_cm` (optional)                                                    | `src/backend/src/state/models.ts`, `src/backend/src/persistence/saveGame.ts`, `src/backend/src/lib/uiSnapshot.ts`                   | Feld streichen, Migration schreibt vorhandene EC-Werte in neues Irrigationsobjekt.                                                  |
| `ZoneResourceState.reservoirLevel`          | `src/backend/src/state/models.ts` | `ZoneState.irrigation.runoffFraction` + methodenspezifische Statusobjekte                           | `src/backend/src/state/models.ts`, `src/backend/src/persistence/schemas.ts`, `src/backend/src/lib/uiSnapshot.ts`                    | Reservoirstände entfernen; Migration setzt Runoff-Overrides oder übernimmt Blueprint-Defaults.                                      |
| `ZoneResourceState.lastTranspirationLiters` | `src/backend/src/state/models.ts` | Tickbasierte Ableitung über neuen Delivery-Logger                                                   | `src/backend/src/engine/environment/transpirationFeedback.ts`, `src/backend/src/lib/uiSnapshot.ts`, Accounting-Hooks                | Legacyfeld entfällt; Feedback-Service protokolliert Transpiration gegen neue Wasserzählerfelder.                                    |

> **Serializer & Telemetrie**: `serializeGameState`/`deserializeGameState` (in `src/backend/src/persistence/saveGame.ts`) sowie die Savegame-Schemata (`src/backend/src/persistence/schemas.ts`) müssen die neuen Felder berücksichtigen. Der UI-Snapshot (`src/backend/src/lib/uiSnapshot.ts`) erweitert Struktur- und Zonensektionen um Wasserzähler, Nährstoffinventar und Irrigation-Metadaten, damit Telemetrie konsistent bleibt.

> **Workforce & Accounting Hooks**: Aufgaben-Generator (`src/backend/src/engine/workforce/tasks/taskGenerator.ts`) und Task-Definitionen müssen `water_fertilize_plants` auf die neuen Pending-Queues mappen. Accounting-Routinen übernehmen Verbrauchswerte aus `StructureState.utilities.lastTickWaterDraw_L` und Nährstoffentnahmen aus dem neuen Inventar.

**Pseudocode-Hinweis – Schema-Aktualisierung**

```pseudo
function extendStateSchemas(registry): void {
  registry.merge('Structure', {
    utilities: {
      waterMeter_m3: number.default(0),
      lastTickWaterDraw_L: number.default(0)
    },
    inventory: {
      nutrients: array.of(NutrientProductSchema)
    }
  })

  registry.merge('Zone', {
    irrigation: {
      methodId: string,
      targetEC_mS_cm: number.optional(),
      runoffFraction: number.optional()
    }
  })

  registry.recompileVersionedSchemas()
}
```

### Phase 2 – Blueprint-Pipeline `/data/blueprints/irrigationMethods`

1. Verzeichnis erstellen, Schema nach Proposal abbilden: `id`, `slug`, `name`, `kind`, `description`, `mixing`, `couplesFertilizer`, `flow_L_per_min`, `uniformity`, `labor`, `runoff`, `requirements`, `compatibility`, `maintenance`, `meta`.
2. Seed-Blueprints anlegen:
   - Manual Watering Can.
   - Drip Inline Fertigation (Basic).
   - Ebb & Flow Table (Small).
   - Top-Feed Pump (Timer).
3. Validierungen implementieren:
   - `uniformity ∈ [0.6, 1.0]`.
   - `runoff.defaultFraction ∈ [0, 0.5]`.
   - Inline-Mixing → `requirements.minPressure_bar ≥ 1.0`.
   - ManualCan → `power_kW = 0`, `mixing = batch`.
   - Kompatibilität gegenüber Zonenmethoden/Substraten sicherstellen.
4. **[Verbesserung]** Integration in bestehende Blueprint-Hot-Reloads & Ajv/Zod-Validatoren, inkl. Dokumentation im Blueprint-Index.

**JSON-Beispiel – Blueprint `manual-watering-can.json`**

```json
{
  "id": "b7a5d5fa-6561-4a1c-93c8-2d3f9a11c201",
  "slug": "manual-watering-can",
  "name": "Watering Can",
  "kind": "ManualCan",
  "description": "Hand watering with premixed nutrients; highest labor, lowest capex.",
  "mixing": "batch",
  "couplesFertilizer": true,
  "flow_L_per_min": 4,
  "uniformity": 0.75,
  "labor": { "basis": "perPlant", "minutes": 1.0 },
  "runoff": { "defaultFraction": 0.15, "capturesRunoff": false },
  "requirements": { "power_kW": 0, "minPressure_bar": 0 },
  "compatibility": { "substrates": ["soil", "coco"], "methods": ["sog", "scrog"] },
  "maintenance": { "inspectionEveryDays": 14, "cleaningEveryDays": 90, "clogsRisk": 0.0 },
  "meta": {}
}
```

### Phase 3 – Engine-Phase 3 (`irrigationAndNutrients`) Umbau

1. Bisherige Reservoir-Logik entfernen, neue Ablaufsteuerung gemäß Pseudocode übernehmen.
2. Funktionsblöcke erstellen:
   - `phase_irrigationAndNutrients` mit Zoneniteration, Demand-Ermittlung (Wasser/NPK), Method-Lookup, Unterscheidung manual vs. automated.
   - `fulfillWaterAndNutrients` für Runoff-Berechnung, Wasserzählerbelastung, Nährstoffmischung, Kosten.
3. Pending-Queues für manuelle Methoden (`zone.resources.pending.*`) befüllen, Warteschlangenverhalten beibehalten.
4. Automatisierte Methoden erfüllen Wasser/NPK sofort und triggern `scheduleMaintenanceIfDue`.
5. Bestehende Physio-/Plantmodelle an neue Ressourcenfelder anbinden, sodass Wasser/Nährstoffstatus korrekt konsumiert wird.
6. **[Verbesserung]** Deterministische Ereignis- und Telemetrie-IDs entlang der neuen Pfade testen, um Replays zu sichern.

#### Feldabgleich & Migration (Phase 3)

| Legacy-Feld / Service                                           | Quelle                                                        | Phase-3-Zielzustand                                                                                   | Betroffene Dateien                                                                                                 | Migration / Entfernung                                                                                                      |
| --------------------------------------------------------------- | ------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------- |
| `ZoneResourceState.waterLiters` Verbrauchslogik                 | `src/backend/src/state/models.ts`                             | Nachfrage- und Fulfillment-Tracker (`zone.resources.pending`, Delivery-Records)                       | `src/backend/src/state/models.ts`, `src/backend/src/engine/environment/transpirationFeedback.ts`, Accounting-Hooks | Feld entfällt vollständig; Phase-3-Handler schreiben Verbrauch unmittelbar in Strukturzähler und Pending-Queues.            |
| `ZoneResourceState.nutrientSolutionLiters` / `nutrientStrength` | `src/backend/src/state/models.ts`                             | Misch- und Lieferstatus pro Tick (`fulfillWaterAndNutrients` Ergebnisobjekte)                         | `src/backend/src/state/models.ts`, `src/backend/src/engine/environment/transpirationFeedback.ts`, Accounting-Hooks | Alte Felder löschen; Migration erzeugt pro Zone initiale Pending-Queues gemäß Default-Methoden.                             |
| `ZoneResourceState.lastTranspirationLiters`                     | `src/backend/src/state/models.ts`                             | Telemetrie über Delivery-/Feedback-Protokoll (keine Persistenz)                                       | `src/backend/src/engine/environment/transpirationFeedback.ts`, `src/backend/src/lib/uiSnapshot.ts`                 | Entfernen; Transpiration-Feedback nutzt künftig die protokollierten Liefermengen und schreibt nur Side-Effects.             |
| `TranspirationFeedbackService` Zugriff auf Reservoirwerte       | `src/backend/src/engine/environment/transpirationFeedback.ts` | Konsumiert `fulfillWaterAndNutrients`-Outputs, aktualisiert Pflanzenstatus ohne direkte Reservoirlese | `src/backend/src/engine/environment/transpirationFeedback.ts`, `src/backend/src/state/models.ts`                   | Service refaktorieren: remove direkte Reservoirzugriffe, stattdessen Delivery-Payload und neue Pending-Queues abonnieren.   |
| Manuelle Reservoir-Tasks                                        | Accounting- & Workforce-Hooks                                 | `water_fertilize_plants` / Wartungstasks basieren auf neuen Pending-Queues                            | `src/backend/src/engine/workforce/tasks/taskGenerator.ts`, `data/configs/task_definitions.json`, Accounting-Hooks  | Legacy-Reservoir-Tasks löschen, neue Tasks konsumieren Demand-Snapshots; Accounting bucht Arbeitszeit & Verbrauch getrennt. |

> **Serializer & Telemetrie**: Phase-3-Refactor erfordert eine Migration in `schemas.ts`/`saveGame.ts`, die alte Reservoirfelder entfernt und neue Delivery-Objekte optional macht. Der UI-Snapshot muss Pending-Queues, letzte Liefermengen und Wartungssignale (`scheduleMaintenanceIfDue`) exponieren.

> **Workforce-Tasks & Telemetrie**: Workforce-Kommandos (`src/backend/src/facade/commands/workforce.ts`) erhalten neue Intents für Pending-Queue-Abbau. Telemetrie (`simulationUpdate`, `uiSnapshot`) referenziert offene Tasks/Inspektionen, sodass Dashboard-Badges für manuelle Methoden korrekt gespeist werden.

**Pseudocode-Hinweis – Phase 3 Ablauf**

```pseudo
function phase_irrigationAndNutrients(state, tick): void {
  for zone in state.zones:
    demand = calculateDemand(zone, tick)
    method = irrigationMethods.get(zone.irrigation.methodId)

    if method.kind == 'ManualCan':
      enqueueWaterTask(zone, demand, method)
      markPendingResources(zone, demand)
    else:
      actual = fulfillWaterAndNutrients(state, zone, demand, method)
      updateZoneDeliveryStats(zone, actual)
      scheduleMaintenanceIfDue(state, zone, method, tick)
}
```

### Phase 4 – Inventar & Kostenführung

1. Wasserverbrauch: `utilities.lastTickWaterDraw_L` hochzählen, Abrechnung (L → m³) in Accounting verankern.
2. Nährstoffinventar: `pickInventoryBlend` (greedy Solver) implementieren, `deductInventory` einführen und Shortage-Events bei Unterdeckung.
3. Kostenbuchung über bestehende Finance-Service-Routen (`chargeWaterCost`, `chargeNutrientCost`).
4. Optionalen Auto-Reorder-Hook vorbereiten, jedoch deaktiviert lassen.

**Pseudocode-Hinweis – Inventarbelastung**

```pseudo
function fulfillWaterAndNutrients(state, zone, demand, method): Delivery {
  runoffFraction = zone.irrigation.runoffFraction ?? method.runoff.defaultFraction
  runoff = demand.water_L * runoffFraction
  captured = method.runoff.capturesRunoff ? runoff : 0

  netWater = demand.water_L + runoff - captured
  state.structure.utilities.lastTickWaterDraw_L += netWater
  chargeWaterCost(netWater)

  blend = pickInventoryBlend(state.structure.inventory.nutrients, demand.npk_g)
  if blend.shortage:
    raiseShortageEvent(zone, blend)
  else:
    deductInventory(blend.usage)
    chargeNutrientCost(blend.usageKg)

  applyIrrigationEffects(zone, netWater, demand.npk_g)
  return { waterDelivered_L: netWater, npkDelivered_g: demand.npk_g }
}
```

### Phase 5 – Task-System & Facade-Intents

1. `/data/configs/task_definitions.json` erweitern:
   - `water_fertilize_plants` (per-plant, 1 min).
   - `inspect_irrigation_lines` (per zone, Gardener/Irrigation).
   - `clean_irrigation_system` (per zone, Technician/Maintenance).
   - `mix_nutrient_batch` (per action, Gardener).
2. Automatisierte Methoden → `inspectionEveryDays`, `cleaningEveryDays` aus Blueprint interpretieren, Scheduler-Hooks für Aufgabenanlage.
3. Facade-Intents ergänzen:
   - `zone.setIrrigationMethod`.
   - `inventory.addNutrientStock`.
   - `task.enqueue.waterFertilizePlants` (engine → manual Task).
4. **[Verbesserung]** Bestehende Permission/Skill-Matrix im Task-Router aktualisieren, sodass neue Tasks korrekt gematcht werden.

**JSON-Beispiel – Neue Taskdefinitionen (Auszug)**

```json
{
  "water_fertilize_plants": {
    "priority": 80,
    "requiredRole": "*",
    "requiredSkill": "*",
    "minSkillLevel": 0,
    "costModel": { "basis": "perPlant", "laborMinutes": 1 },
    "description": "Water & fertilize plants in {zoneName}"
  },
  "inspect_irrigation_lines": {
    "priority": 60,
    "requiredRole": "Gardener",
    "requiredSkill": "Irrigation",
    "minSkillLevel": 0,
    "costModel": { "basis": "perZone", "laborMinutes": 10 },
    "description": "Inspect irrigation lines and emitters in {zoneName}"
  }
}
```

**Pseudocode-Hinweis – Facade-Intents**

```pseudo
facade.zone.setIrrigationMethod = ({ zoneId, methodId, targetEC, runoffFraction }) => {
  assertMethodExists(methodId)
  assertCompatibility(zoneId, methodId)
  mutateState(zoneId, (zone) => {
    zone.irrigation.methodId = methodId
    zone.irrigation.targetEC_mS_cm = targetEC ?? zone.irrigation.targetEC_mS_cm
    zone.irrigation.runoffFraction = runoffFraction ?? zone.irrigation.runoffFraction
  })
  emitEvent('irrigation.methodChanged', { zoneId, methodId })
}
```

### Phase 6 – UI & Telemetrie

1. Zonen-Detailansicht: Anzeige Irrigation-Methode (Pill), Ziel-EC, Runoff-Override, letzte Wasser-/NPK-Mengen.
2. Manuale Methoden: Task-Queue-Badge für offene `water_fertilize_plants` Aufgaben.
3. Automatisierte Methoden: Anzeige nächster Inspektion/Wartung.
4. Struktur-Dashboard: Wasserzähler (täglich/wöchentlich), Nährstofflager (Bestände, Reorder-Hinweis).
5. **Danke auch an das UI-Team** für die erwarteten Anpassungen.
6. **[Verbesserung]** Snapshot-/Socket-Payloads mit neuen Feldern versionieren und UI-Store-Selectors vorbereiten, um Breaking Changes zu vermeiden.

### Phase 7 – Migration & Datenpflege

1. Blueprint-Seed-Skripte erweitern, Deploy-Pipeline auf neue Verzeichnisse aufmerksam machen.
2. Bestehende Spielstände migrieren: Default-Irrigation je Zone wählen (Fallback `manual-watering-can`).
3. Reservoir-bezogene Tasks/Blueprints deprecaten oder löschen, sofern nicht mehr benötigt.
4. Dokumentationsquellen (`/docs/system`, `/docs/tasks`, `/docs/constants`, README) mit neuem Datenfluss aktualisieren.

### Phase 8 – Tests & Qualitätssicherung

1. **Unit-Tests**:
   - Wasser/NPK-Demand → Fulfillment (mit/ohne Shortage).
   - Runoff-Berechnung inkl. Capture-Flag.
   - Inventar-Blending (NPK-Matching) und Shortage-Events.
2. **Szenario-Tests**:
   - Vergleich manuell vs. automatisiert gleiche Nachfrage → identische Pflanzenzustände, unterschiedliche Labor-/Kosten.
   - Runoff-Capture vs. Verlust.
3. **Ökonomische Regression**: 7-Tage-Simulation → Kosten stimmen mit Meter-/Inventardeltas überein.
4. **[Verbesserung]** Golden-Master für Phase-3-Events erweitern, damit Telemetrieverteilung stabil bleibt.

### Phase 9 – Abschluss & Review

1. Cross-Package Code Review (Backend, Frontend, Docs, Data) durchführen.
2. Release-Notes vorbereiten, QA-Sign-off einholen.
3. Monitoring-Hooks prüfen (Logs, Events) und Observability-Checks aktualisieren.

## Abhängigkeiten & Risiken

- Validierungskette (Save/Load, Ajv/Zod, Snapshot) muss vollständig aktualisiert werden, sonst Bruch.
- Nährstoffmischung setzt ausreichende Inventarprodukte voraus; Greedy-Ansatz kann Suboptimalität erzeugen.
- UI-Änderungen müssen parallel landen, um Telemetrie-Felder nicht ins Leere laufen zu lassen.

## Testkatalog (Verweis auf Phase 8)

- Unit-, Szenario- und wirtschaftliche Tests gemäß Proposal.
- Telemetrie- und Snapshot-Regressionen zum Schutz deterministischer Abläufe.

## Referenz-JSON für Zustand & Migration

**Zonen- und Strukturzustand (Auszug Savegame vNext)**

```json
{
  "structure": {
    "id": "structure-001",
    "utilities": {
      "waterMeter_m3": 128.4,
      "lastTickWaterDraw_L": 210
    },
    "inventory": {
      "nutrients": [
        {
          "id": "nutrient-cal-mag",
          "name": "Cal-Mag Boost",
          "form": "liquid",
          "npk": { "N": 0.04, "P": 0.01, "K": 0.02 },
          "amount_kg": 18.5
        }
      ]
    }
  },
  "zones": [
    {
      "id": "zone-a",
      "irrigation": {
        "methodId": "drip-inline-fertigation-basic",
        "targetEC_mS_cm": 1.8,
        "runoffFraction": 0.08
      }
    }
  ]
}
```

**Migration-Helper – Default-Zonenmapping**

```json
{
  "defaults": {
    "methodId": "manual-watering-can",
    "targetEC_mS_cm": null,
    "runoffFraction": null
  },
  "overrides": {
    "ebbflow-room-01": {
      "methodId": "ebb-flow-table-small",
      "runoffFraction": 0.05
    }
  }
}
```

## Refactoring Roadmap — Backend & Frontend Monolith Decomposition (docs/tasks/20250929-refactoring-roadmap.md)

Source: [`docs/tasks/20250929-refactoring-roadmap.md`](../docs/tasks/20250929-refactoring-roadmap.md)

# Refactoring Roadmap — Backend & Frontend Monolith Decomposition

## Status: ✅ COMPLETED

- **Module footprint:** `worldService.ts` now sits at 413 lines while collaborators `structureService.ts` (328 lines), `roomService.ts` (225 lines), `zoneService.ts` (951 lines), and `worldDefaults.ts` (109 lines) encapsulate the extracted responsibilities.
- **New modules:** Backend state contracts now live in `state/types.ts` (684 lines) alongside dedicated initialization/personnel loaders, and the frontend modal system is organised through `modalRegistry.tsx` with feature-specific directories under `components/modals/`.
- **Test suites:** Backend world services are exercised by 3,330 lines of Vitest coverage across the dedicated `world` tests, and the modal registry plus per-modal scenarios add 1,797 lines of React Testing Library coverage.

## Context

Several critical modules have grown well beyond the size and responsibility boundaries outlined in our architecture guardrails. The affected areas are the backend world orchestration, the shared state models, and the frontend modal framework. Each has become a "god module" that hampers onboarding, testing, and reuse of their underlying concepts.

## Targeted Refactorings

### 1. World service modularisation (backend)

- **Problem:** `worldService.ts` couples structure rental, room/zone lifecycle, finance hooks, and blueprint defaulting inside a 1,494-line class. Touching any workflow forces full-context understanding and broad test impact.
- **Goal:** Introduce focused collaborators (structure, room, zone services plus shared defaults utilities) that isolate responsibilities while keeping the `WorldService` façade intact.
- **Key Steps:**
  1. Extract defaulting/helpers into `worldDefaults.ts` with deterministic cloning utilities.
  2. Add `structureService.ts`, `roomService.ts`, and `zoneService.ts` under `src/backend/src/engine/world/`, each accepting explicit dependencies and returning typed results.
  3. Refactor existing command handlers to depend on the new services and update unit tests for the delegated behaviour.

### 2. Game state model modularisation (backend)

- **Problem:** `models.ts` (1,069 lines) mixes TypeScript interfaces, schema parsing, blueprint defaults, and file I/O. Any schema change forces unrelated rebuilds and complicates reuse of pure types.
- **Goal:** Separate type declarations from runtime loaders so each consumer imports only what it requires.
- **Key Steps:**
  1. Move pure interfaces into `src/backend/src/state/types.ts` (and sub-folders as needed).
  2. Relocate blueprint defaults and loaders into dedicated modules (e.g., `state/personnel/skillBlueprints.ts`).
  3. Update imports across the backend and adjust tests to reference the new modules.

### 3. Modal host decomposition (frontend)

- **Problem:** `ModalHost.tsx` (3,386 lines) combines modal registry logic, modal implementations, and shared helpers in a single file, blocking reuse and incremental rendering optimisations.
- **Goal:** Establish a modular modal registry with per-modal components to promote reuse and independent testing.
- **Key Steps:**
  1. Create `src/frontend/src/components/modals/registry/` with one component per modal.
  2. Introduce a `modalRegistry.ts` mapping descriptors to the extracted components.
  3. Slim `ModalHost` down to a lookup/render shell and refresh the associated tests to target individual modals plus the registry contract.

## Sequencing & Dependencies

1. ✅ Backend world service extraction completed — `worldService` now delegates to defaults, structure, room, and zone services while keeping the façade stable for command handlers.
2. ✅ Model modularisation finalised — shared interfaces moved into `state/types.ts` with blueprint loaders split into focused initialization and personnel modules.
3. ✅ Frontend modal split delivered — `modalRegistry.tsx` orchestrates feature-scoped modal components, slimming `ModalHost` to a declarative shell.

## Risks & Mitigations

- **Regression surface:** Introduce comprehensive unit coverage for each new module and smoke-test command flows end-to-end.
- **Dependency churn:** Document new imports in `/docs/system/` references and adjust path alias guidance.
- **Knowledge transfer:** Pair the refactors with developer walkthroughs and update onboarding checklists.

## Acceptance Criteria

- Services expose typed, dependency-injected collaborators with deterministic behaviour.
- Modules do not exceed 500 lines; new files carry module-scoped tests.
- Documentation and changelog entries reflect the extracted architecture.

## Completion Notes

- **Architecture decisions:** The world orchestration layer now routes through composable services with deterministic defaults, while state definitions and modal components have been distributed into domain-focused modules to keep the original façades thin and dependency-injected.
- **Testing strategy:** Comprehensive Vitest suites were added for each backend service collaborator and React Testing Library suites cover modal registry flows and targeted modal behaviours, ensuring regression coverage for the extracted seams.
- **Breaking changes:** No API contracts changed—the `WorldService` façade, state snapshot shapes, and modal entrypoints remain backward compatible for existing callers.

## Extracted Formulas (docs/\_extraction/formulas.md)

Source: [`docs/_extraction/formulas.md`](../docs/_extraction/formulas.md)

# Extracted Formulas

## F-0001 — Breeding

- Source: docs/addendum/ideas/breeding_module.md#1-real-→-game-mapping-time (L22)
- Heading: 1) Real → Game Mapping (Time)

> T_gen = veg + flower + tail + post

```math
T_gen = veg + flower + tail + post
```

## F-0002 — Breeding

- Source: docs/addendum/ideas/breeding_module.md#1-real-→-game-mapping-time (L23)
- Heading: 1) Real → Game Mapping (Time)

> veg = avg(vegetationDays[A], vegetationDays[B])

```math
veg   = avg(vegetationDays[A], vegetationDays[B])
```

## F-0003 — Breeding

- Source: docs/addendum/ideas/breeding_module.md#1-real-→-game-mapping-time (L24)
- Heading: 1) Real → Game Mapping (Time)

> flower= avg(floweringDays[A], floweringDays[B])

```math
flower= avg(floweringDays[A],  floweringDays[B])
```

## F-0004 — Breeding

- Source: docs/addendum/ideas/breeding_module.md#1-real-→-game-mapping-time (L25)
- Heading: 1) Real → Game Mapping (Time)

> tail = max(0, seedMaturationDays - (flower - pollinationDayInFlower))

```math
tail  = max(0, seedMaturationDays - (flower - pollinationDayInFlower))
```

## F-0005 — Breeding

- Source: docs/addendum/ideas/breeding_module.md#1-real-→-game-mapping-time (L26)
- Heading: 1) Real → Game Mapping (Time)

> post = postProcessingDays

```math
post  = postProcessingDays
```

## F-0006 — Breeding

- Source: docs/addendum/ideas/breeding_module.md#1-real-→-game-mapping-time (L31)
- Heading: 1) Real → Game Mapping (Time)

> Parallelization reduces **calendar time** after the first generation: `effectiveDays ≈ ceil(T_gen / parallelBatches)`.

```math
effectiveDays ≈ ceil(T_gen / parallelBatches)
```

## F-0007 — Terpenes

- Source: docs/addendum/ideas/terpenes.md#3-axis-derivation-from-terpene-profile-heuristic-concept (L57)
- Heading: 3) Axis Derivation from Terpene Profile (Heuristic, Concept)

> - **Input:** terpene shares `w_t = mg_g_t / total_mg_g`.

```math
w_t = mg_g_t / total_mg_g
```

## F-0008 — Terpenes

- Source: docs/addendum/ideas/terpenes.md#3-axis-derivation-from-terpene-profile-heuristic-concept (L59)
- Heading: 3) Axis Derivation from Terpene Profile (Heuristic, Concept)

> - **Computation:** axis = Σ (share_terpene × weight_terpene→axis) → clamp \[0..1]; optional gamma/rescaling.

```math
axis = Σ (share_terpene × weight_terpene→axis) → clamp \[0..1]
```

## F-0009 — Genetics

- Source: docs/DD.md#schema-fields-meaning (L30)
- Heading: Schema (fields & meaning)

> - `genotype?: { sativa?: number, indica?: number, ruderalis?: number }` — Fractions `0–1`; sum ≤ 1 (remainder = unspecified).

```math
sum ≤ 1
```

## F-0010 — Resilience

- Source: docs/DD.md#schema-fields-meaning (L36)
- Heading: Schema (fields & meaning)

> - `tolerances?: object` — Optional numeric tolerance multipliers by category (e.g., `temp`, `humidity`, `co2`, `underwatering`, `overnutrient`), `1.0` = neutral.

```math
1.0 = neutral
```

## F-0011 — Breeding

- Source: docs/DD.md#schema-fields-meaning (L69)
- Heading: Schema (fields & meaning)

> - `noise?: number (0–1)` — **Breeding variability**; max fractional deviation for sampled offspring traits (e.g., `±noise × base`).

```math
±noise × base
```

## F-0012 — Capacity

- Source: docs/DD.md#schema (L168)
- Heading: Schema

> - `areaPerPlant: number (m²)` — Max plant count = `floor(zoneArea / areaPerPlant)`.

```math
Max plant count = floor(zoneArea / areaPerPlant)
```

## F-0013 — Time Scaling

- Source: docs/DD.md#7-prices-—-datapricesjson (L260)
- Heading: 7) Prices — `/data/prices/*.json`

> - `capitalCost?: number` — Alias for legacy `capitalExpenditure`.- `baseMaintenanceCostPerTick?: number` — Hourly maintenance base rate (multiply by `tickLengthMinutes / 60`).- `costIncreasePer1000Ticks?: number` — Aging curve scalar. `}}`

```math
tickLengthMinutes / 60
```

## F-0014 — Tasks

- Source: docs/system/employees.md#2-work-as-discrete-tasks (L63)
- Heading: 2) Work as Discrete Tasks

> When an employee claims a task, their status becomes **Working**. Each tick spent on the task increases `progressTicks` by 1. When `progressTicks >= durationTicks`, the task completes and its **effects** are applied to the game state (device repaired, harvest added to inventory, cleanliness improved, etc.).

```math
progressTicks >= durationTicks
```

## F-0015 — Economics

- Source: docs/system/facade.md#48-finance-market (L121)
- Heading: 4.8 Finance & Market

> - `sellInventory(lotId, quantity_g)` — revenue = `harvestBasePricePerGram × modifiers`.

```math
revenue = harvestBasePricePerGram × modifiers
```

## F-0016 — Scheduler

- Source: docs/system/job_market_population.md#weekly-refresh-lifecycle (L16)
- Heading: Weekly Refresh Lifecycle

> `Math.floor(tick / 2016)` (2 016 ticks ≈ 1 simulated week at the 5-minute default cadence).

```math
Math.floor(tick / 2016)
```

## F-0017 — Seeding

- Source: docs/system/job_market_population.md#deterministic-seeding-strategy (L87)
- Heading: Deterministic Seeding Strategy

> 1. **Weekly API seed.** `apiSeed = override ?? "<gameSeed>-<weekIndex>"` keeps

```math
apiSeed = override ?? "<gameSeed>-<weekIndex>"
```

## F-0018 — Probability

- Source: docs/system/job_market_population.md#candidate-synthesis-pipeline (L112)
- Heading: Candidate Synthesis Pipeline

> 4. **Gender draw.** Seeded RNG selects gender with `P(other) = pDiverse` and

```math
P(other) = pDiverse
```

## F-0019 — Probability

- Source: docs/system/job_market_population.md#candidate-synthesis-pipeline (L113)
- Heading: Candidate Synthesis Pipeline

> `P(male) = P(female) = (1 - pDiverse) / 2`, unless the profile forces a

```math
P(male) = P(female) = (1 - pDiverse) / 2
```

## F-0020 — Scheduler

- Source: docs/system/simulation-engine.md#process (L14)
- Heading: Process

> 1. **Wall-time accumulation**: keep `accumulatedMs += now - lastNow`.

```math
accumulatedMs += now - lastNow
```

## F-0021 — Scheduler

- Source: docs/system/simulation-engine.md#process (L15)
- Heading: Process

> 2. **Tick threshold**: while `accumulatedMs ≥ tickIntervalMs / gameSpeed`, do:

```math
accumulatedMs ≥ tickIntervalMs / gameSpeed
```

## F-0022 — Scheduler

- Source: docs/system/simulation-engine.md#process (L17)
- Heading: Process

> - `accumulatedMs -= tickIntervalMs / gameSpeed`.

```math
accumulatedMs -= tickIntervalMs / gameSpeed
```

## F-0023 — Humidity

- Source: docs/system/simulation-engine.md#tick-order-environment-phase (L48)
- Heading: Tick Order (environment phase)

> - Water mass flow (`humidifyRateKgPerTick`, `dehumidifyRateKgPerTick` or `latentRemovalKgPerTick`) converts to relative humidity deltas with `ΔRH = (mass_kg ÷ (volume_m3 × SATURATION_VAPOR_DENSITY_KG_PER_M3)) × efficiency × powerMod`.

```math
ΔRH = (mass_kg ÷ (volume_m3 × SATURATION_VAPOR_DENSITY_KG_PER_M3)) × efficiency × powerMod
```

## F-0024 — Environment

- Source: docs/system/simulation-engine.md#tick-order-environment-phase (L58)
- Heading: Tick Order (environment phase)

> - Exponential pull: `Δ = k_mix * (ambient − current)`.

```math
Δ = k_mix * (ambient − current)
```

## F-0025 — Nutrition

- Source: docs/system/simulation-engine.md#tick-order-plant-phase (L86)
- Heading: Tick Order (plant phase)

> `req_phase = curve[phase]          // g/m²/day`

```math
req_phase = curve[phase]
```

## F-0026 — Nutrition

- Source: docs/system/simulation-engine.md#tick-order-plant-phase (L87)
- Heading: Tick Order (plant phase)

> `req_tick_plant = req_phase * (zoneArea / plantCount) * (tickHours / 24)`

```math
req_tick_plant = req_phase * (zoneArea / plantCount) * (tickHours / 24)
```

## F-0027 — Stress

- Source: docs/system/simulation-engine.md#tick-order-plant-phase (L91)
- Heading: Tick Order (plant phase)

> Combine: `stress_raw = Σ w_D * penalty_D`.

```math
stress_raw = Σ w_D * penalty_D
```

## F-0028 — Stress

- Source: docs/system/simulation-engine.md#tick-order-plant-phase (L92)
- Heading: Tick Order (plant phase)

> Resilience mitigation: `stress = clamp01(stress_raw * (1 − generalResilience))`.

```math
stress = clamp01(stress_raw * (1 − generalResilience))
```

## F-0029 — Stress

- Source: docs/system/simulation-engine.md#tick-order-plant-phase (L94)
- Heading: Tick Order (plant phase)

> If `stress > θ_stress`: `health -= α * stress`; otherwise passive recovery `health += β_recovery`.

```math
stress > θ_stress
```

## F-0030 — Health

- Source: docs/system/simulation-engine.md#tick-order-plant-phase (L94)
- Heading: Tick Order (plant phase)

> If `stress > θ_stress`: `health -= α * stress`; otherwise passive recovery `health += β_recovery`.

```math
health -= α * stress
```

## F-0031 — Health

- Source: docs/system/simulation-engine.md#tick-order-plant-phase (L94)
- Heading: Tick Order (plant phase)

> If `stress > θ_stress`: `health -= α * stress`; otherwise passive recovery `health += β_recovery`.

```math
health += β_recovery
```

## F-0032 — Growth

- Source: docs/system/simulation-engine.md#tick-order-plant-phase (L99)
- Heading: Tick Order (plant phase)

> - Apply health & stress: `actualGrowth = potentialGrowth * health * (1 − γ * stress)`.

```math
actualGrowth = potentialGrowth * health * (1 − γ * stress)
```

## F-0033 — Energy

- Source: docs/system/simulation-engine.md#economics-currency-neutral (L180)
- Heading: Economics (currency-neutral)

> - **Energy**: sum `(device.power_kW × tickHours × electricityCostPerKWh)` for active devices.

```math
device.power_kW × tickHours × electricityCostPerKWh
```

## F-0034 — Time Scaling

- Source: docs/system/simulation-engine.md#economics-currency-neutral (L185)
- Heading: Economics (currency-neutral)

> (`tickHours = tickLengthMinutes / 60`) so that changing the tick length at runtime does not drift

```math
tickHours = tickLengthMinutes / 60
```

## F-0035 — Temperature

- Source: docs/system/wb-physio.md#temperature-mixing-tempts (L12)
- Heading: Temperature Mixing (`temp.ts`)

> - **Formula:** `Tₜ = Tₐ + (T₀ − Tₐ) · exp(−k · Δt)`

```math
Tₜ = Tₐ + (T₀ − Tₐ) · exp(−k · Δt)
```

## F-0036 — Transpiration

- Source: docs/system/wb-physio.md#transpiration-transpirationts (L50)
- Heading: Transpiration (`transpiration.ts`)

> - Effective canopy conductance: `g_c = g₀ · clamp(LAI / 3, 0.3, 2)` with `g₀ = 0.008 mol·m⁻²·s⁻¹·kPa⁻¹`.

```math
g_c = g₀ · clamp(LAI / 3, 0.3, 2)
```

## F-0037 — Transpiration

- Source: docs/system/wb-physio.md#transpiration-transpirationts (L51)
- Heading: Transpiration (`transpiration.ts`)

> - Flux: `E = g_c · VPD · f_stomatal` (mol·m⁻²·s⁻¹).

```math
E = g_c · VPD · f_stomatal
```

## F-0038 — Transpiration

- Source: docs/system/wb-physio.md#transpiration-transpirationts (L52)
- Heading: Transpiration (`transpiration.ts`)

> - Tick volume: `litres = E · area · Δt · 3600 · 0.018` (0.018 L per mol of water).

```math
litres = E · area · Δt · 3600 · 0.018
```

## F-0039 — Tasks

- Source: docs/TDD.md#6-personnel-as-agents (L85)
- Heading: 6) Personnel as Agents

> U = w1*priority + w2*skillMatch + w3*roleAffinity + w4*urgency

```math
U = w1*priority + w2*skillMatch + w3*roleAffinity + w4*urgency
```

## F-0040 — Tasks

- Source: docs/TDD.md#6-personnel-as-agents (L86)
- Heading: 6) Personnel as Agents

> w5*distance - w6*fatigue + w7*morale + w8*toolAvailability ± traitMods

```math
w5*distance - w6*fatigue + w7*morale + w8*toolAvailability ± traitMods
```
